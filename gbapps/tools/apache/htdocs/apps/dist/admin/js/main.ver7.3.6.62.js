angular.module("gbAdminApp.services",[]).factory("AdminService",["$http","$cookieStore","$cookies","MessageService","GlobalService","$window",function(l,u,c,r,i,a){var s,t,m,g,e,o,n,d=getCookie("umsDomain"),f=i.getVal("infoserverDomain"),p=i.getVal("umsNewApiVer");d&&(n=(o=d.split("/")).pop(),(e={})[o.join("/")]="/"+n+"/xproxy"),f&&(n=(o=f.split("/")).pop(),e[o.join("/")]="/"+n+"/xproxy"),xdomain.slaves(e);return{standard_user_tracking:function(e,t,r,a,s){i.getVal("usertracking_details_limit");var o={},n=getCookie("mps").split(":");return o.switched_feature="Admin Console",n=d+"/user_tracking/"+n[0]+"/"+n[1]+"/"+n[2]+"/"+e+"/"+t+"/"+r,c.prevApplication=e,l.post(n,{details:a,solr_query:s||""},{params:o})},windowFailed:function(e,t){r.setError(e,t)},windowSuccess:function(e,t){r.setSuccess(e,t)},windowWarning:function(e,t){r.setWarning(e,t)},getUserList:function(){var e;if(null!=getCookie("mps"))return e=getCookie("mps").split(":"),l.get(d+"/customer/user/listnonsso/"+e[0],{});a.location.href=localStorage.getItem("logOutUrl")},getRoleList:function(){var e;if(null!=getCookie("mps"))return e=getCookie("mps").split(":"),l.get(d+"/admin/usermanagement/role/list/"+e[0],{});a.location.href=localStorage.getItem("logOutUrl")},addNewUser:function(e){var t;if(null!=getCookie("mps"))return t=getCookie("mps").split(":"),l.post(d+"/admin/customer/user/add/"+t[0],e);a.location.href=localStorage.getItem("logOutUrl")},editUser:function(e){var t;if(null!=getCookie("mps"))return t=getCookie("mps").split(":"),l.post(d+"/customer/user/modify/"+t[0],e);a.location.href=localStorage.getItem("logOutUrl")},addNewRole:function(e){var t;if(null!=getCookie("mps"))return t=getCookie("mps").split(":"),l.post(d+"/admin/usermanagement/role/add/"+t[0],e);a.location.href=localStorage.getItem("logOutUrl")},editRole:function(e){var t;if(null!=getCookie("mps"))return t=getCookie("mps").split(":"),l.post(d+"/admin/usermanagement/role/modify/"+t[0],e);a.location.href=localStorage.getItem("logOutUrl")},resetPass:function(e){var t;if(null!=getCookie("mps"))return t=getCookie("mps").split(":"),l.post(d+"/user/reset/passwd/"+t[0],e);a.location.href=localStorage.getItem("logOutUrl")},deleteUser:function(e){var t;if(null!=getCookie("mps"))return t=getCookie("mps").split(":"),l.post(d+"/customer/user/remove/"+e+"/"+t[0]);a.location.href=localStorage.getItem("logOutUrl")},disableUser:function(e){var t;if(null!=getCookie("mps"))return t=getCookie("mps").split(":"),l.post(d+"/customer/user/disable/"+e+"/"+t[0]);a.location.href=localStorage.getItem("logOutUrl")},enableUser:function(e){var t;if(null!=getCookie("mps"))return t=getCookie("mps").split(":"),l.post(d+"/customer/user/enable/"+e+"/"+t[0]);a.location.href=localStorage.getItem("logOutUrl")},deleteRole:function(e){var t;if(null!=getCookie("mps"))return t=getCookie("mps").split(":"),l.post(d+"/admin/usermanagement/role/delete/"+e+"/"+t[0]);a.location.href=localStorage.getItem("logOutUrl")},logoutInfoserver:function(){var e;if(null!=getCookie("mps"))return e=getCookie("mps").split(":"),l.get(d+"/aa/logout_admin?mps="+e[0]+":"+e[1]+":"+e[2]);a.location.href=localStorage.getItem("logOutUrl")},getLoginFields:function(){var e;if(null!=getCookie("mps"))return e=getCookie("mps").split(":"),l.get(d+"/admin/role/user/details/"+e[0]+"/"+e[1]+"/"+e[2],{});a.location.href=localStorage.getItem("logOutUrl")},updateAccessTime:function(){var e,t=JSON.stringify({details:"admin"});if(null!=getCookie("mps"))return e=getCookie("mps").split(":"),e=d+"/user_tracking/"+e[0]+"/"+e[1]+"/"+e[2]+"/application/admin/document_click",l.post(e,{details:t,solr_query:""},{params:{}});a.location.href=localStorage.getItem("logOutUrl")},getSysIdList:function(e,t,r,a){var s=i.getVal("infoserverDomain"),o="",e=e.split(":"),o=s+"/analytics/system/ec/list/"+e[0]+"/"+e[1]+"/"+e[2]+"/"+e[0]+"/"+t+"/"+r;return a&&(o=s+"/analytics/system/ec/list/"+e[0]+"/"+e[1]+"/"+e[2]+"/"+e[0]+"/"+t+"/"+r+"?pattern="+a),l.get(o,{})},getEndCustomersList:function(){var e=getCookie("mps").split(":");return l.get(d+"/healthcheck/ec/details/"+e[0])},addEndCustomer:function(e,t){e=e.split(":");return l.post(d+"/healthcheck/ec/add/"+e[0]+"/"+e[1]+"/"+e[2],t)},updateEndCustomer:function(e,t){e=e.split(":");return l.post(d+"/healthcheck/ec/update/"+e[0]+"/"+e[1]+"/"+e[2],t)},deleteEndCustomer:function(e){var t={},r=getCookie("mps").split(":"),a=d.slice(0,d.length-2)+p;return t.endcustomer_name=e,t.mps=r[0]+":"+r[1]+":"+r[2],l.post(a+"/healthcheck/ec/delete/"+r[0]+"/"+r[1]+"/"+r[2],t)},getSysIdCount:function(e){var t=i.getVal("infoserverDomain"),e=e.split(":");return l.get(t+"/analytics/system/ec/count/"+e[0]+"/"+e[1]+"/"+e[2]+"/"+e[0],{})},deleteProduct:function(e,t){d.slice(0,d.length-2);if(null!=getCookie("mps"))return l.post(d+"/admin/usermanagement/role/product/delete/"+e+"/"+t[0]+"/"+t[1]+"/"+t[2]);a.location.href=localStorage.getItem("logOutUrl")},setLoggedInUser:function(e){t=e},getLoggedInUser:function(){return t},setLoggedInUserFeatures:function(e){s=e},getLoggedInUserFeatures:function(){return s},isPowerUser:function(){var e;return e=s?-1<s.indexOf("workbench"):e},getTableauUser:function(){var e=this.getLoggedInUser(),t=i.getVal("genericWbusername");return s&&-1<s.indexOf("workbench")?e.org_type==i.getVal("gbUserOrgType")?"glassbeam":e.email:t},getUserName:function(){var e=this.getLoggedInUser();return!e.first_name&&!e.last_name||"NA"==e.first_name&&"NA"==e.last_name?e.email:("NA"!=e.first_name?e.first_name+" ":"")+("NA"!=e.last_name?e.last_name:"")},getTableauSiteId:function(){var e=i.getVal("infoserverDomain"),t=getCookie("mps").split(":"),r={};return this.isPowerUser()&&(r.power=this.isPowerUser(),r.full_name=this.getUserName()),l.get(e+"/tableau/siteuser/info/"+t[0]+"/"+t[1]+"/"+t[2]+"/"+this.getTableauUser(),{params:r})},setSiteId:function(e){m=e},getSiteId:function(){return m},getRealmDetails:function(){var e=getCookie("mps").split(":");return l.get(d+"/realm/"+e[0]+"/"+e[1]+"/"+e[2])},setRealmData:function(e){g=e},getRealmData:function(){return g},enableSiteAdminCreatorRole:function(){var e=!1,t=this.getRealmData();return e=null!==t.vertica_port&&""!==t.vertica_port&&"NA"!==t.vertica_port&&null!==t.vertica_pwd&&""!==t.vertica_pwd&&"NA"!==t.vertica_pwd&&null!==t.vertica_server&&""!==t.vertica_server&&"NA"!==t.vertica_server&&null!==t.vertica_user&&""!==t.vertica_user&&"NA"!==t.vertica_user?!0:e},addNewTableauUser:function(e){var t;if(null!=getCookie("mps"))return t=getCookie("mps").split(":"),l.post(d+"/admin/tableau/tableauAddUpdateUsers/"+t[0]+"/"+t[1]+"/"+t[2],e);a.location.href=localStorage.getItem("logOutUrl")},updateTableauRoleUsers:function(e){var t;if(null!=getCookie("mps"))return t=getCookie("mps").split(":"),l.post(d+"/admin/tableau/tableauUpdateRole/"+t[0]+"/"+t[1]+"/"+t[2],e);a.location.href=localStorage.getItem("logOutUrl")},deleteTableauRoleUsers:function(e){var t;if(null!=getCookie("mps"))return t=getCookie("mps").split(":"),l.post(d+"/admin/tableau/tableauDeleteUsers/"+t[0]+"/"+t[1]+"/"+t[2],e);a.location.href=localStorage.getItem("logOutUrl")}}}]).factory("MessageService",["$http",function(e){var t=[];return{setError:function(e,t){$("#gb-message-alert").modal(),$("#gb-message-title").text(t||"LOGIN"),$("#gb-message-text").html('<div class="alert alert-danger">'+e+"</div>")},setSuccess:function(e,t){$("#gb-message-alert").modal(),$("#gb-message-title").text(t||"LOGIN"),$("#gb-message-text").html('<div class="alert alert-success">'+e+"</div>")},setWarning:function(e,t){$("#gb-message-alert").modal(),$("#gb-message-title").text(t||"LOGIN"),$("#gb-message-text").html('<div class="alert alert-warning">'+e+"</div>")},getMessage:function(e){return t}}}]).factory("GlobalMessages",[function(){var t={INVALIDEMAIL:"Please enter valid email.",EMPTYEMAIL:"Please enter value for email.",EMPTYPASSWORD:"Please enter value for password.",MINLENPASSWORD:"Password should be minimum four character long.",MAILSEND_SUCCESS_TITLE:"We’ve sent you a link to change your password",MAILSEND_SUCCESS_MSG:"We’ve sent you an email that will allow you to reset your password.",MAILSEND_FAILURE_MSG:"We couldn't find a Glassbeam account associated with ",PASSWORDMISSMATCH:"Password not matching!",PAGE_TITLE:"Glassbeam : Administrator",ONE_TIME_MSG:"Please set your password(one-time setup) before you start using the Glassbeam."};return{getValue:function(e){return t[e]}}}]).factory("APILoader",[function(){return{show:function(){},hide:function(){}}}]),angular.module("gbAdminApp.controllers",["ngDraggable","angular.filter"]).controller("MainCtrl",["$scope","$location","AdminService","GlobalMessages","GlobalService","MessageService",function(e,t,r,a,s,o){angular.element(window.document)[0].title=a.getValue("PAGE_TITLE"),e.logo="",e.logo_url="",e.logo_url="/apps/app/login/images/logo.png",e.logo="/apps/app/login/images/logo.png"}]).controller("ManageUserCtrl",["$scope","$location","AdminService","GlobalMessages","GlobalService","MessageService","ngTableParams","$filter","$window","$document","$timeout",function(m,e,g,t,f,r,p,h,U,a,d){angular.element(window.document)[0].title=t.getValue("PAGE_TITLE"),m.logo="",m.currentDomain=e.host().split(/\.(.+)?/)[1],m.logo_url="",m.data_loading=!1,m.logo_url="/apps/app/login/images/logo.png",m.logo="/apps/app/login/images/logo.png",m.selected={},m.userEditSelected=!1,m.singleRoleSelected=!1,m.selectAll=!1,m.data={},m.resetPassErrorFlag=!1,m.sessionTimeOutHeader=f.getVal("sessionTimeOutHeader"),m.themeSupport=f.getVal("themeSupport"),m.sessionTimeOutMessage=f.getVal("sessionTimeOutMessage"),m.sessionExpired=f.getVal("sessionExpired"),m.resetPassHeader=f.getVal("resetPassHeader"),m.selectedRemove=!1,m.slectedCount=0,m.roleSelected=!1,m.selectAllAll=!1,m.isGbStudioEnabled=!1,m.addRoleWarning=!0,m.editRoleWarning=!0,m.addProdWarning=!0,m.rnaFeatureAssigned=!1,m.updatePassword=f.getVal("updatePassword"),m.resetPassHelp=f.getVal("resetPassHelp"),m.phoneNumberNotValid=f.getVal("phoneNumberNotValid"),m.rnaFeatureMsg=f.getVal("rnaFeatureMsg"),m.roleNameNotValid=f.getVal("roleNameNotValid"),m.maxUserReached=f.getVal("maxUserReached"),m.UserStateNotValid=f.getVal("UserStateNotValid"),m.UserCountryNotValid=f.getVal("UserCountryNotValid"),m.charLimitError=f.getVal("charLimitError"),m.emailNotValid=f.getVal("emailNotValid"),m.usersAddedTitle=f.getVal("usersAddedTitle"),m.remainingLicenseTitle=f.getVal("remainingLicenseTitle"),m.totalLicenseTitle=f.getVal("totalLicenseTitle"),m.totalUsersTitle=f.getVal("totalUsersTitle"),m.noRemainingLiceses=f.getVal("noRemainingLiceses"),m.updatePasswordMsgHeader=f.getVal("updatePasswordMsgHeader"),m.associatedRoleList=[],m.associatedEndCustomerList=[],m.associatedRoleProductList={},m.addRoleProdDisplayOptions=[],m.ProdaddRoleProdDisplayOptions=[],m.allUsersEmailList=[],m.allRoleNameList=[],m.newUserDepartment="",m.newUserPhone="",m.newUserlast_name="",m.newUserState="",m.newUserCity="",m.newUserCountry="",m.editUserPhone="",m.editUserDepartment="",m.editUserState="",m.editUserCity="",m.editUserCountry="",m.deletedSingleMsg=f.getVal("deletedSingleMsg"),m.deletedMsg=f.getVal("deletedMsg"),m.editRoleModalHeader=f.getVal("editRoleModalHeader"),m.AddNewUserModalHeader=f.getVal("AddNewUserModalHeader"),m.prodAddedMsg=f.getVal("prodAddedMsg"),m.deleteConfirmMsg=f.getVal("deleteConfirmMsg"),m.addProdcutMsgHeader=f.getVal("addProdcutMsgHeader"),m.addRoleMsgHeader=f.getVal("addRoleMsgHeader"),m.newUserreport_usage=!0,m.deletedMsgHeader=f.getVal("deletedMsgHeader"),m.addUserMsg=f.getVal("addUserMsg"),m.addUserMsgHeader=f.getVal("addUserMsgHeader"),m.addRoleError=!0,m.roleDeletedMsg=f.getVal("roleDeletedMsg"),m.roleDeletedMsgMultiple=f.getVal("roleDeletedMsgMultiple"),m.addRoleErrorMsg=f.getVal("addRoleErrorMsg"),m.sessionTimedOutMsg=f.getVal("sessionTimedOutMsg"),m.sessionTimedOutHeader=f.getVal("sessionTimedOutHeader"),m.editUserMsg=f.getVal("editUserMsg"),m.addUserDuplicateEmail=f.getVal("addUserDuplicateEmail"),m.editUserMsgHeader=f.getVal("editUserMsgHeader"),m.errorDeletedMsg=f.getVal("adminRoleDeleteMsgHeader"),m.adminRoleDeleteMsgHeader=f.getVal("errorDeletedMsg"),m.associatedRoleDeleError=f.getVal("associatedRoleDeleError"),m.updateRoleMsgHeader=f.getVal("updateRoleMsgHeader"),m.updateRoleMsg=f.getVal("updateRoleMsg"),m.updatePasswordMsg=f.getVal("updatePasswordMsg"),m.MsgModelHeader="",m.MsgModelMessage="",m.unSelectAllRole=!1,m.selectAllRole=!1,m.unSelectAll=!0,m.predicate="id",m.deletedUserKey,m.addUserError=!0,m.addProdError=!0,m.editRoleError=!0,m.totalUsers=0,m.powerUsers=0,m.noUsers=!1,m.realmHelp=f.getVal("realmHelp"),m.noUserMsg=f.getVal("noUserMsg"),m.wbUsernameHelp=f.getVal("wbUsernameHelp"),m.editUserError=!0,m.loggedInUsername="",m.loggedInUserrole="",m.loggedInUserroleDisplay="",m.newUsermps_defOptions=[],m.newUserRoleOptions=[],m.addRoleMfrOptions=[],m.addRoleProdOptions=[],m.addRoleSchOptions=[],m.ispoweruser=!1,m.newUserwb_user_nameOptions=f.getVal("userwb_user_name"),m.defaultFeatureCheck=getCookie("default_feature"),m.newUserwb_user_name=m.newUserwb_user_nameOptions[0],m.addRoleRealmOptions=f.getVal("roleRealm"),m.UserColumns=h("filter")(f.getVal("adminUserList"),{enabled:!0}),m.totalUserColumns=m.UserColumns.length+1,m.roleColumns=h("filter")(f.getVal("adminRoleList"),{enabled:!0}),m.roleList=[],m.roleMfr=[],m.roleProd=[],m.roleSch=[],m.columnRole="name",m.columnUser="name",m.reverse=!1,m.newUser_isExternalUser=!1,m.isExternalRole={val:!1},m.showRoleToggle=!1,m.newUserdashboard_admin={val:!1},m.editUserdashboard_admin={val:!1},m.endCustomerList=[],m.sysIdList=[],m.selectedSysIds=[],m.unavailableSysids=[],m.sysIds={toAddList:[],toRemoveList:[]},m.endCustomerProdName=m.newUsermps_defOptions[0],m.endCustomerProductList=[],m.addNewEndCustomer={endCustomerName:"",prodName:{}},m.editEndCustomer={},m.showSysIDList=!1,m.totalSysids=0;m.pagination={pageSize:200,startIndex:0,endIndex:199,noOfPages:0,currentPage:1},m.searchText={val:"",tableSearch:"",rolelistSearch:""},m.showErrorMsg=!1,m.shouldCallLoadPages=!0,m.paginationText="",m.showSearchBox=!1,m.newUserEndCustomer={val:""},m.editUserEndCustomer={val:""},m.selectedEndCustomerToRemove=!1,m.endCustomersToDelete=[],m.showFilterPanel={user:!1,endCustomer:!1},m.filterObj={userList:{},endCustomerList:{}},m.loggedInUser={},m.noFeatureWarning=!0,m.$watch("slectedRoleCount",function(e,t){if(1==m.slectedRoleCount){for(i=0;i<m.roleList.length;i++)if(m.roleList[i].selected&&m.roleList[i].domains.length!=m.addRoleProdDisplayOptions.length-1){m.singleRoleSelected=!0;break}}else m.singleRoleSelected=!1}),m.$watch("selectAll",function(e,t){m.selectAllAll=1==e}),m.$watch("selectAllRole",function(e,t){m.selectAllRoleAll=1==e}),m.$watch("searchKeyword",function(){H(),m.users&&(m.tableParams.$params.page=f.getVal("page"),m.tableParams.reload())}),m.$watch("searchText.tableSearch",function(){V(),0<m.endCustomerList.length&&(m.endCustomerParams.$params.page=f.getVal("page"),m.endCustomerParams.reload())}),m.$watch("searchText.val",function(e,t){e!==t&&(m.shouldCallLoadPages=!0,m.pagination.startIndex=0,m.pagination.endIndex=199)}),m.$watch("searchText.rolelistSearch",function(){W(),0<m.roleList.length&&(m.tableRoleParams.$params.page=f.getVal("page"),m.tableRoleParams.reload())}),m.$watch("selectAllEndCustomers.val",function(e,t){m.selectAllEndCustomersAll=1==e});function u(t){return m.roleList.map(function(e){t.role!==e.name&&t.name!==e.name||e.domains.map(function(e){t.mps_def!==e.mps.join(":")&&t.mfr+":"+t.prod+":"+t.sch!==e.mps.join(":")||(featureList=e.features.replace(/\s/g,"").split(","))})}),featureList}function n(e){F(),m.pagination.noOfPages=Math.ceil(m.totalSysids/m.pagination.pageSize),m.pages=Array.from({length:m.pagination.noOfPages},function(e,t){return r=m.totalSysids,a=m.pagination.pageSize,t=t,s=Math.max(a*t,0),a=Math.min(a*(t+1),r),(t={}).startIndex=s,t.endIndex=a===m.totalSysids?m.totalSysids:a-1,t;var r,a,s})}$.get("../../config/constants/admin_constants.json",function(e,t){m.htmconstdata=e}),m.init=function(){m.getLoginDetails(),m.getRoles(),m.getEndCustomerDetails()},a.bind("click",function(){null==getCookie("mps")&&(m.sessionTimeOutMessage=m.sessionExpired,$("#sessionModal").modal({backdrop:"static",keyboard:!1}))}),m.defaultFeature=function(e,t,r){var a,s=[],o=[];e.value==m.defaultFeatureCheck?(m.addRoleWarningMsg=f.getVal("defaultFeatureErrorMsg"),m.addRoleWarning=!1,m.editRoleWarningMsg=f.getVal("defaultFeatureErrorMsg"),m.editRoleWarning=!1,m.AddProdWarningMsg=f.getVal("defaultFeatureErrorMsg"),m.addProdWarning=!1,e.checked=!0):(m.addRoleWarning=!0,m.editRoleWarning=!0,m.addProdWarning=!0),a=A(e.value),"rules_and_alerts"==e.value&&(s=a.enableFeatures,o=a.disableFeatures),"dashboards"===e.value&&(s=a.enableFeatures,o=a.disableFeatures),"dashboard_admin"===e.value&&(s=a.enableFeatures,o=a.disableFeatures),"workbench"===e.value&&g.enableSiteAdminCreatorRole()&&(s=a.enableFeatures,o=a.disableFeatures),c(e,t,s,o,r)};var c=function(e,t,r,a,s){var o=s.feature;(r||a)&&(e.checked?t.map(function(e){-1!==o.indexOf(e.value)&&-1<r.indexOf(e.value)&&(e.disabled=!1)}):t.map(function(e){-1<a.indexOf(e.value)&&(e.disabled=!0,e.checked=!1)}))},C=(m.userTracking=function(e,t,r){g.standard_user_tracking("adminconsole",e,t,r)},m.CSVDownload=function(e){if("user"==e){var t=angular.copy(m.users);for(m.userTracking("CSV Download","User Csv","CSV Download"),l=0;l<t.length;l++)delete t[l].deleted,delete t[l].selected,delete t[l].adminUserItem,delete t[l].$$hashKey,delete t[l].role,delete t[l].token_id,delete t[l].realm_def,delete t[l].url_def,delete t[l].mps_def,t[l].role=t[l].DisRuleName,delete t[l].DisRuleName,t[l].status=t[l].active?"Active":"Inactive",delete t[l].activeClass,delete t[l].active;var r="User Details"}else{t=angular.copy(m.roleList);for(m.userTracking("CSV Download","Role Csv","CSV Download"),l=0;l<t.length;l++){for(delete t[l].$$hashKey,delete t[l].selected,delete t[l].mps,delete t[l].mps_uidomain,delete t[l].realm_uidomain,delete t[l].name,t[l].name=t[l].DisName,delete t[l].DisName,t[l].product="",j=0;j<t[l].domains.length;j++)t[l].product=t[l].product+t[l].domains[j].name+" : "+t[l].domains[j].features+"\n";delete t[l].domains}r="Role Details"}var a="object"!=typeof t?JSON.parse(t):t,s="",o=(s+=r+"\r\n\n","");for(i in a[0])o+=i+",";s+=(o=o.slice(0,-1))+"\r\n";for(var n,l=0;l<a.length;l++){var i,o="";for(i in a[l])o+='"'+a[l][i]+'",';o.slice(0,o.length-1),s+=o+"\r\n"}""!=s?(e="MyReport_",e+=r.replace(/ /g,"_"),r="data:text/csv;charset=utf-8,"+escape(s),(n=document.createElement("a")).href=r,n.style="visibility:hidden",n.download=e+".csv",document.body.appendChild(n),n.click(),document.body.removeChild(n)):alert("Invalid data")},m.sortColumn=function(e,t){if("roleTable"==t?m.columnRole=e:m.columnUser=e,m.reverse?(m.reverse=!1,m.reverseclass="arrow-up"):(m.reverse=!0,m.reverseclass="arrow-down"),"roleTable"==t)m.roleList=h("orderBy")(m.roleList,m.columnRole,m.reverse),m.tableRoleParams=new p({page:f.getVal("page"),count:f.getVal("count"),reload:m.tableRoleParams},{total:m.roleList.length,getData:function(e,t){m.rdata=m.roleList.slice((t.page()-1)*t.count(),t.page()*t.count()),e.resolve(m.rdata)}});else{var e=m.tableParams.$params.page,r=[],a=m.columnUser;for(i=0;i<m.users.length;i++)r.push(m.users[i][a]);1!=(r=m.unique(r)).length&&(m.users=h("orderBy")(m.users,m.columnUser,m.reverse),m.tableParams=new p({page:e,count:f.getVal("count"),reload:m.tableParams},{counts:[],getData:function(e,t){var r=m.searchData();t.total(r.length),null==t.settings().$scope&&(t.settings().$scope=m),m.data=[],m.data=r.slice((t.page()-1)*t.count(),t.page()*t.count()),e.resolve(m.data)}}))}},m.sortClass=function(e,t){return"roleTable"==t?m.columnRole==e?m.reverse?"arrow-down":"arrow-up":"":m.columnUser==e?m.reverse?"arrow-down":"arrow-up":""},m.AddUserErrorMsg="",m.editUserErrorMsg="",m.requiredCheck=function(e,t){var r,a,s;m.roleFeatures=angular.copy(f.getVal("roleFeatures")),getCookie("mps").substring(0,getCookie("mps").indexOf(":"));if(m.defaultFeatureCheck=getCookie("default_feature"),m.noFeatureWarning=!0,m.addRoleWarning=!0,m.editUserError=!0,m.isExternalRole.val=!1,"newUserRole"==e)if(m.newUserEndCustomer.val="",m.showEndCustomerList=!1,null==m.newUserRole||""==m.newUserRole)m.newUserRole=m.newUserRoleOptions[0],m.roleSelected=!1;else{m.newUsermps_defOptions=[];var o={},n=1,l={id:"",label:"Select Default Product"};for(key in m.newUsermps_defOptions[0]=l,t.productList)(o={}).id=t.productList[key],o.label=key,m.newUsermps_defOptions[n]=o,n++;m.newUsermps_def=m.newUsermps_defOptions[0],m.roleSelected=!0}if(null==m.newUsermps_def&&"newUserMps"==e&&(m.newUsermps_def=m.newUsermps_defOptions[0]),null==m.newUserwb_user_name&&"newUserwb_user_name"==e&&(m.newUserwb_user_name=m.newUserwb_user_nameOptions[0]),null==m.newUserrealm_def&&"newUserRealm"==e&&(m.newUserrealm_def=m.newUserrealm_defOptions[0]),null==m.addProdRoleProd&&"rProdPlus"==e)m.addProdRoleProd=m.ProdaddRoleProdDisplayOptions[0],$("#addProdfeaturesPermission").hide();else if("rProdPlus"==e&&null!=m.addProdRoleProd){var i=t.replace(/\s+/g,"");for(tempArray=i.split(","),n=0;n<m.addProdroleFeatures.length;n++)-1==tempArray.indexOf(m.addProdroleFeatures[n].value)&&(m.addProdroleFeatures[n].disabled=!0),$("#addProdfeaturesPermission").show()}if(null==m.addRoleProdDisplay&&"rProd"==e)m.addRoleProdDisplay=m.addRoleProdDisplayOptions[0],$("#featuresPermission").hide(),m.showRoleToggle=!1;else if("rProd"==e&&null!=m.addRoleProdDisplay){i=t.replace(/\s+/g,"");for(tempArray=i.split(","),n=0;n<m.roleFeatures.length;n++)m.roleFeatures[n].checked=!1,m.roleFeatures[n].value==m.defaultFeatureCheck&&(m.roleFeatures[n].checked=!0,s=m.roleFeatures[n]),-1==tempArray.indexOf(m.roleFeatures[n].value)&&(m.roleFeatures[n].disabled=!0),$("#featuresPermission").show(),m.showRoleToggle=!0;i=A(s.value);"rules_and_alerts"==s.value&&(r=i.enableFeatures,a=i.disableFeatures),"dashboards"===s.value&&(r=i.enableFeatures,a=i.disableFeatures),"dashboard_admin"===s.value&&(r=i.enableFeatures,a=i.disableFeatures),c(s,m.roleFeatures,r,a,m.addRoleProdDisplay)}if("editUserRole"==e)if(m.editUserEndCustomer.val="",m.showEndCustomerList=!1,null==m.editUserRole)m.editUserRole=m.newUserRoleOptions[0],m.roleSelected=!1;else{m.newUsermps_defOptions=[];o={},n=1,l={id:"",label:"Select Default Product"};for(key in m.newUsermps_defOptions[0]=l,t.productList)(o={}).label=key,o.id=t.productList[key],m.newUsermps_defOptions[n]=o,n++;m.editUsermps_def=m.newUsermps_defOptions[0],m.roleSelected=!0}null==m.editUsermps_def&&"editUserMps"==e&&(m.editUsermps_def=m.newUsermps_defOptions[0]),null==m.editUserrealm_def&&"editUserRealm"==e&&(m.editUserrealm_def=m.editUserrealm_defOptions[0]),null==m.editUserwb_user_name&&"editUserwb_user_name"==e&&(m.editUserwb_user_name=m.newUserwb_user_nameOptions[0])},m.getLoginDetails=function(e){g.getLoginFields().then(function(e){var t,r=getCookie("mps").substring(0,getCookie("mps").indexOf(":")),a=e.data.Data,s=1,o={id:"",label:"Select Default Product"};for(t in m.newUsermps_defOptions[0]=o,g.setLoggedInUser(a.user[0]),m.loggedInUserEmail=a.user[0].email,o={},""==e.data.Data.user[0].first_name?m.loggedInUsername=e.data.Data.user[0].email:m.loggedInUsername=e.data.Data.user[0].first_name+" "+e.data.Data.user[0].last_name,e.data.Data.role_details.domains)e.data.Data.role_details.domains[t].substring(0,e.data.Data.role_details.domains[t].indexOf(":"))==r&&((o={}).label=t,o.id=e.data.Data.role_details.domains[t],tempRoleMps=e.data.Data.role_details.domains[t].split(":"),m.roleMfr.push(tempRoleMps[0]),m.roleProd.push(tempRoleMps[1]),m.roleSch.push(tempRoleMps[2]),m.newUsermps_defOptions[s]=o,s++);for(m.endCustomerProductList=m.newUsermps_defOptions,m.addNewEndCustomer.prodName=m.endCustomerProductList[0],m.roleMfr=m.unique(m.roleMfr),j=0;j<m.roleMfr.length;j++)(o={}).id=j,o.label=m.roleMfr[j],m.addRoleMfrOptions[j]=o;for(m.addRoleMfr=m.addRoleMfrOptions[0],m.roleProd=m.unique(m.roleProd),j=0;j<m.roleProd.length;j++)(o={}).id=j,o.label=m.roleProd[j],m.addRoleProdOptions[j]=o;m.addRoleProd=m.addRoleProdOptions[0],m.roleSch=m.unique(m.roleSch);var n=[];for(j=0;j<m.roleSch.length;j++)(o={}).id=j,o.label=m.roleSch[j],m.addRoleSchOptions[j]=o;m.addRoleSch=m.addRoleSchOptions[0],m.newUsermps_def=m.newUsermps_defOptions[0],m.realmDefUser=a.role_details.realm_uidomain,m.loggedInUserrole=a.user[0].role,(n=a.user[0].role.split("_")).splice(0,3),m.loggedInUserroleDisplay=n.join("_")},function(e){m.MsgModelHeader=m.sessionTimedOutHeader,m.MsgModelMessage=m.sessionTimedOutMsg,U.location.href=localStorage.getItem("logOutUrl")})},m.matchFeatures=function(e){var t=(t=e).split(",");for(i=0;i<t.length;i++)switch(t[i]){case"dashboards":t[i]="Dashboards";break;case"explorer":t[i]="Explorer";break;case"rules_and_alerts":t[i]="Rules & Alerts";break;case"rule_creator":t[i]="Rule Creator";break;case"workbench":t[i]="Workbench";break;case"logvault":t[i]="Logvault";break;case"file_upload":t[i]="File Upload";break;case"healthcheck":t[i]="Health Check";break;case"apps":t[i]="Apps";break;case"admin":t[i]="Admin";break;case"gbstudio_apps":t[i]="GB Studio";break;case"dashboard_admin":t[i]="Dashboard Admin";break;case"wb_creator":t[i]="Creator"}return t.join(",")},m.RevertFeaturesText=function(e){var t=(t=e).split(",");for(i=0;i<t.length;i++)switch(t[i]){case"Dashboards":t[i]="dashboards";break;case"Explorer":t[i]="explorer";break;case"Rules & Alerts":t[i]="rules_and_alerts";break;case"Rule Creator":t[i]="rule_creator";break;case"Workbench":t[i]="workbench";break;case"Logvault":t[i]="logvault";break;case"File Upload":t[i]="file_upload";break;case"Health Check":t[i]="healthcheck";break;case"Apps":t[i]="apps";break;case"GB Studio":t[i]="gbstudio_apps";break;case"Dashboard Admin":t[i]="dashboard_admin";break;case"Creator":t[i]="wb_creator"}return t.join(",")},m.getRoles=function(){m.data_loading=!0,m.slectedRoleCount=0,m.rnaFeatureAssigned=!1,m.searchText.rolelistSearch="",m.roleList=[],null==getCookie("mps")?U.location.href=localStorage.getItem("logOutUrl"):(m.singleRoleSelected=!1,g.getRoleList().then(function(e){m.allRoleNameList=[];var t,r=getCookie("mps").substring(0,getCookie("mps").indexOf(":")),a=e.data.Data,s=[],s=(m.addRoleProdDisplayOptions=[],tempObj={},tempObj={id:"",label:"Select Product"},m.addRoleProdDisplayOptions.push(tempObj),[]);for(i=0;i<a.length;i++)(s=a[i].name.split("_"))[0]!=r?(a.splice(i,1),i--):(s.splice(0,3),t=s.join("_"),a[i].DisName=t);var o="";for(i=0;i<a.length;i++)for(var n in a[i].domains)a[i].features[a[i].domains[n]].split(",").filter(function(e){return"admin"==e}).length&&(o=a[i].name);for(m.adminRoleName=o,R(a),b(a),C(),E(a),m.newUserRole=m.newUserRoleOptions[0],m.addRoleProdDisplay=m.addRoleProdDisplayOptions[0],m.copynewUserRoleOptions=angular.copy(m.newUserRoleOptions),m.resetAddNewUserPopup(),v(),w(),i=0;i<m.roleList.length;i++)m.allRoleNameList.push(m.roleList[i].DisName);d(function(){m.getUser()},2e3),m.selectedRemoveRole=!1}))},m.enabledRowColumn=function(e){for(i=0;i<m.roleColumns.length;i++)if(m.roleColumns[i].field==e)return!1;return!0},function(){m.tableRoleParams=new p({page:f.getVal("page"),count:f.getVal("count"),reload:m.tableRoleParams,sorting:{DisName:"asc"}},{total:m.roleList.length,getData:function(e,t){null==t.settings().$scope&&(t.settings().$scope=m);var r=m.searchRoleListData(),r=t.sorting()?h("orderBy")(r,t.orderBy()):r;m.rdata=r.slice((t.page()-1)*t.count(),t.page()*t.count()),t.total(r.length),e.resolve(m.rdata)}})}),v=function(){m.roleList.map(function(e,t){var r;e.roleType="Internal",!e.domains[0].features||1==(r=e.domains[0].features.replace(/\s/g,"").split(",")).length&&-1<r.indexOf("HealthCheck")&&(e.roleType="External")})},w=function(){m.copynewUserRoleOptions.map(function(e,t){e.roleType="Internal",e.features&&e.features.length?e.features&&1===e.features.length&&-1<e.features[0].toLowerCase().indexOf("health")&&(e.roleType="External"):e.roleType=""})},R=function(e){e.map(function(t){t.name===m.adminRoleName&&Object.keys(t.domains).map(function(e){tempObj={},gbStudioFeature={},tempObj.label=e,tempObj.id=t.domains[e],tempObj.feature=t.features[tempObj.id],"-"!=tempObj.label?(m.addRoleProdDisplayOptions.push(tempObj),tempArray=f.getVal("roleFeatures")):(delete t.domains[e],(tempArray=f.getVal("roleFeatures")).filter(function(e){return"gbstudio_apps"===e.value}).length&&(gbStudioFeature.category="Other Apps",gbStudioFeature.name="GB Studio",gbStudioFeature.value="gbstudio_apps",gbStudioFeature.checked=!1,gbStudioFeature.disabled=!1,tempArray.push(gbStudioFeature))),m.roleFeatures=angular.copy(tempArray),m.editroleFeatures=angular.copy(tempArray),m.addProdroleFeatures=angular.copy(tempArray)})}),m.copyOfRoleFeatures=f.getVal("roleFeatures")},b=function(e){m.newUserRoleOptions=[],m.roleList=[];m.newUserRoleOptions[0]={id:"",label:"Select Role",value:""},getCookie("mps").substring(0,getCookie("mps").indexOf(":"));e.map(function(t,e){var r={domains:[],mps:[]},a=(r.name=t.name,r.DisName=t.DisName,r.mps_uidomain=t.mps_uidomain,r.realm_uidomain=t.realm_uidomain,r.selected=!1,{features:[],productList:{}});a.label=t.DisName,Object.keys(t.domains).length&&Object.keys(t.domains).map(function(e){(domainObj={}).name=e,domainObj.mps=t.domains[e].split(":"),domainObj.selected=!1,t.features[t.domains[e]]=t.features[t.domains[e]].split(" ").join(""),domainObj.features=m.matchFeatures(t.features[t.domains[e]]),domainObj.features=domainObj.features.replace(/,/g,", "),r.domains.push(domainObj),a.value=t.name,a.productList=t.domains,a.features=domainObj.features.split(","),Object.keys(a.productList).map(function(e){"default:default:default"===a.productList[e]&&delete a.productList[e]})}),a.id=e,m.roleList.push(r),m.newUserRoleOptions.push(a)})},E=function(e){var t=[],r=g.getLoggedInUser();e.map(function(e){e.name===r.role&&(t=(t=e.features[r.mps_def]).replace(/\s/g,"").split(","),g.setLoggedInUserFeatures(t))}),g.getTableauSiteId().then(function(e){g.setSiteId(e.data.Data.site_id),g.getRealmDetails().then(function(e){g.setRealmData(e.data.Data)})})},M=(m.getUser=function(){m.powerUsers=0,m.totalUsers=0,m.creatorLicensesCount=0;var l,d,u,c=getCookie("mps").substring(0,getCookie("mps").indexOf(":"));m.data_loading=!0,m.rnaFeatureAssigned=!1,m.associatedRoleList=[],m.associatedEndCustomerList=[],m.userFilterGroupedData=angular.copy(f.getVal("userFilterGroupedData")),g.getLoginFields().then(function(e){var o=e.data.Data,n=(m.selectedRemove=!1,m.totalLicense=o.max_licensed_users,m.MaxUsers=o.max_users,m.totalCreatorLicensesCount=o.max_creator_licenses,o.user[0].email);g.getUserList().then(function(e){for(m.users=e.data.Data,i=0;i<m.users.length;i++)l=moment(new Date(m.users[i].modified_on)).local().format("YYYY-MM-DD HH:mm:ss"),m.users[i].modified_on=l,d=moment(new Date(m.users[i].created_on)).local().format("YYYY-MM-DD HH:mm:ss"),m.users[i].created_on=d,u=moment(new Date(m.users[i].last_login)).local().format("YYYY-MM-DD HH:mm:ss"),m.users[i].last_login=u,l<=d&&(m.users[i].modified_on="-"),u<=d&&(m.users[i].last_login="-");for(m.allUsersEmailList=[],i=0;i<m.users.length;i++)m.allUsersEmailList.push(m.users[i].email);var t,r=[],a=(m.usersRemaining=o.max_users-m.totalUsers,[]);for(i=0;i<m.roleList.length;i++)a.push(m.roleList[i].name);for(i=0;i<m.users.length;i++)-1==a.indexOf(m.users[i].role)&&(m.users.splice(i,1),i--);for(i=0;i<m.users.length;i++)m.associatedRoleList.push(m.users[i].role),m.users[i].end_customer&&m.users[i].end_customer.length&&"NA"!==m.users[i].end_customer&&m.associatedEndCustomerList.push(m.users[i].end_customer),m.associatedEndCustomerList=m.unique(m.associatedEndCustomerList),1==m.users[i].active?m.users[i].activeClass="isactive":m.users[i].activeClass="notactive",function(t){m.roleList.map(function(e){t.role===e.name&&e.domains.map(function(e){t.mps_def===e.mps.join(":")&&(-1<(e=e.features.replace(/\s/g,"").split(",")).indexOf("Workbench")&&t.active&&m.powerUsers++,-1<e.indexOf("Creator")&&t.active&&m.creatorLicensesCount++)})})}(m.users[i]),(r=m.users[i].role.split("_"))[0]!=c?(m.users.splice(i,1),i--):(r.splice(0,3),t=r.join("_"),m.users[i].DisRuleName=t,m.users[i].selected=!1,m.users[i].name=m.users[i].first_name+" "+m.users[i].last_name,m.users[i].deleted="notDeleted",n==m.users[i].email&&(m.users[i].adminUserItem=!0));for(i=0;i<m.users.length;i++)m.users[i].active&&m.totalUsers++;0==m.users.length?m.noUsers=!0:m.noUsers=!1,m.remainingLicense=m.powerUsers;var s;getCookie("mps").split(":");if(m.associatedRoleList=m.unique(m.associatedRoleList),s=m.associatedRoleList,e=m.users,m.associatedRoleProductList={},m.associatedRoleUserList={},s.map(function(e){m.associatedRoleProductList[e]=[],m.associatedRoleUserList[e]=[]}),e.map(function(e){-1<s.indexOf(e.role)&&(-1==m.associatedRoleProductList[e.role].indexOf(e.mps_def)&&m.associatedRoleProductList[e.role].push(e.mps_def),-1==m.associatedRoleUserList[e.role].indexOf(e.email)&&m.associatedRoleUserList[e.role].push(e.email))}),m.noOfColumns=m.UserColumns.length-4,0!=m.roleList.length)for(i=0;i<m.users.length;i++)for(j=0;j<m.roleList.length;j++)if(m.users[i].role==m.roleList[j].name)for(k=0;k<m.roleList[j].domains.length;k++)m.users[i].mps_def==m.roleList[j].domains[k].mps.join(":")&&-1!=m.roleList[j].domains[k].features.indexOf("Rules & Alerts")&&(m.rnaFeatureAssigned=!0);if(0!=m.roleList.length&&m.users)for(i=0;i<m.users.length;i++)for(j=0;j<m.roleList.length;j++)if(m.users[i].role==m.roleList[j].name)for(k=0;k<m.roleList[j].domains.length;k++)m.users[i].mps_def==m.roleList[j].domains[k].mps.join(":")&&-1!=m.roleList[j].domains[k].features.indexOf("Rules & Alerts")&&(m.rnaFeatureAssigned=!0);if(null!=m.roleFeatures)for(i=0;i<m.roleFeatures.length;i++)m.roleFeatures[i].value==m.defaultFeatureCheck&&(m.roleFeatures[i].checked=!0);e=0;m.tableParams&&(e=m.tableParams.count()),m.columnUser;m.tableParams=new p({page:f.getVal("page"),count:f.getVal("count"),reload:m.tableParams,sorting:{first_name:"asc"}},{counts:[],getData:function(e,t){var r=m.searchData(),r=(t.total(r.length),null==t.settings().$scope&&(t.settings().$scope=m),m.data=[],t.sorting()?h("orderBy")(r,t.orderBy()):r);m.data=r.slice((t.page()-1)*t.count(),t.page()*t.count()),e.resolve(m.data),r.forEach(function(r){for(key in r)m.userFilterGroupedData.forEach(function(e){var t;e.isDateType?e.data=angular.copy(f.getVal("timeListFilter")):e.columnName===key&&""!==r[key]&&(t={},"role"===key&&(t.disName=r.DisRuleName),t.name=r[key],t.selected=!1,e.data.push(t),e.data=_.uniqBy(e.data,"name"))})})}}),0!=m.users.length&&(setTimeout(function(){m.tableParams.reload()},300),e&&m.tableParams.count(e)),m.searchKeyword="",m.enabledColumn=function(e){for(i=0;i<m.UserColumns.length;i++)if(m.UserColumns[i].field==e)return!1;return!0},m.selectedRemoveRole=!1,m.data_loading=!1})},function(e){m.MsgModelHeader=m.sessionTimedOutHeader,m.MsgModelMessage=m.sessionTimedOutMsg,U.location.href=localStorage.getItem("logOutUrl")}),m.userFilterGroupedData.map(function(e){if(e.appliedFilterCount=0,e.searchText="",Array.isArray(e.data))e.data.map(function(e){e.selected=!1});else for(var t in e.data)e.data[t].selected=!1}),m.filterObj.userList=[]},m.editRow=function(e){m.resetAddNewUserPopup(),m.newUserRoleOptions=P("Internal"),$("#editUserModal .modal-header h4").html("Edit User | "+e.email),$("#editUserModal .modal-header h4").attr("title",e.email),m.oldEditRole=e.role,m.editUserfirst_name=e.first_name,m.editUserlast_name=e.last_name,m.editUserEmail=e.email,m.editUserPhone=e.phone,m.editUserDepartment=e.department,m.editUserState=e.state,m.editUserCity=e.city,m.editUserCountry=e.country,e.email==e.wb_user_name?m.editUserwb_user_name=m.newUserwb_user_nameOptions[1]:m.editUserwb_user_name=m.newUserwb_user_nameOptions[2],m.editUser_isExternalUser=e.is_external,m.editUser_isExternalUser&&(m.newUserRoleOptions=P("External"),m.loadEndCustomerList(e.mps_def),m.editUserEndCustomer.val="NA"!==e.end_customer?e.end_customer:""),m.newUsermps_defOptions=[];var t={};for(m.newUsermps_defOptions[0]={id:"",label:"Select Default Product"},i=1;i<m.newUserRoleOptions.length;i++)if(e.role==m.newUserRoleOptions[i].value.toLowerCase())for(key in m.editUserRole=m.newUserRoleOptions[i],m.editUserRole.productList)(t={}).id=m.editUserRole.productList[key],t.label=key,m.newUsermps_defOptions.push(t);for(i=0;i<m.newUsermps_defOptions.length;i++)if("default:default:default"==m.newUsermps_defOptions[i].id){m.newUsermps_defOptions.splice(i,1);break}for(i=0;i<m.newUsermps_defOptions.length;i++)e.mps_def==m.newUsermps_defOptions[i].id&&(m.editUsermps_def=m.newUsermps_defOptions[i]);m.editUserreport_usage=e.report_usage,m.editUserdashboard_admin.val=e.dashboard_admin,e.adminUserItem?angular.element(document.querySelector("#edituserrole")).attr("disabled",""):angular.element(document.querySelector("#edituserrole")).removeAttr("disabled"),m.roleSelected=!0},m.disableUser=function(s){var o=u(s);m.data_loading=!0,g.disableUser(s.email).then(function(e){var t,r,a;m.userTracking("User","Disable User",JSON.stringify(s.email)),-1<o.indexOf("Creator")&&(t={},r=[],(a={}).userName=s.email,a.roleType="Unlicensed",r.push(a),t.userRole=r,g.addNewTableauUser(t).then(function(e){},function(e){})),m.data_loading=!1,m.init()},function(e){})},m.enableUser=function(a){var e,s=u(a);m.data_loading=!0,M(a)?(m.MsgModelHeader="Enable user",e=-1<s.indexOf("Creator")?"creator":"workbench",m.MsgModelMessage="This user's role has access to "+e+".  But, all the available licences are being used up for now. Hence, you cannot enable this user.",m.data_loading=!1,$("#msgModal").modal("show")):g.enableUser(a.email).then(function(e){var t,r;m.userTracking("User","Enable User",JSON.stringify(a.email)),-1<s.indexOf("Creator")&&(r={},t=y(a,"user"),(t=L(t))&&((r={}).userName=a.email,r.roleType=t,[].push(r)),g.addNewTableauUser(r).then(function(e){},function(e){})),m.data_loading=!1,m.init()},function(e){})},function(t){var r=!1;return m.roleList.map(function(e){t.role===e.name&&e.domains.map(function(e){t.mps_def!==e.mps.join(":")||(-1<(e=e.features.replace(/\s/g,"").split(",")).indexOf("Workbench")&&m.remainingLicense==m.totalLicense||-1<e.indexOf("Creator")&&m.creatorLicensesCount==m.totalCreatorLicensesCount)&&(r=!0)})}),r}),s=(m.resetPass=function(e){m.resetPassUser=e.email,m.resetPassPass="",m.resetPassPass2=""},m.resetPassSubmit=function(){if(!/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[^\w\s]).{6,}$/.test(m.resetPassPass))return m.resetPassError=f.getVal("passwordSpaceError"),void(m.resetPassErrorFlag=!0);if(m.resetPassPass!=m.resetPassPass2)return m.resetPassError=f.getVal("passwordMatchError"),void(m.resetPassErrorFlag=!0);if(null==m.resetPassPass)return m.resetPassError=f.getVal("passwordSpaceError"),void(m.resetPassErrorFlag=!0);if(!m.resetPassPass.replace(/\s/g,"").length)return m.resetPassError=f.getVal("passwordSpaceError"),void(m.resetPassErrorFlag=!0);var t={email:m.resetPassUser,password:m.resetPassPass};$("#ResetPasswordModal").modal("hide"),g.resetPass(t).then(function(e){m.userTracking("User","Reset Password",JSON.stringify(t)),m.MsgModelHeader=m.updatePasswordMsgHeader,m.MsgModelMessage=t.email+m.updatePasswordMsg,$("#msgModal").modal("show")},function(e){m.data_loading=!1})},m.editRoleRow=function(e,t){m.defaultFeatureCheck=getCookie("default_feature"),m.editRoleName=e.name,m.editRoleDisName=e.DisName,m.editRoleDomain=t.name,m.workbenchFeatureAssigned=!1,m.addAdminFeature=!1,m.creatorLicenseAssigned=!1;for(i=0;i<m.addRoleProdDisplayOptions.length;i++)t.name==m.addRoleProdDisplayOptions[i].label&&(m.editRoleProdDisplay=m.addRoleProdDisplayOptions[i]);var r=(r=t.features).replace(/, /g,",");-1!=(r=(r=(r=m.RevertFeaturesText(r)).replace(/ /g,"")).split(",")).indexOf("workbench")||-1!=r.indexOf("Workbench")?m.workbenchFeatureAssigned=!0:m.workbenchFeatureAssigned=!1,m.creatorLicenseAssigned=-1<r.indexOf("wb_creator"),-1!=r.indexOf("admin")||-1!=r.indexOf("Admin")?(m.addAdminFeature=!0,m.MsgErrorModelHeader=f.getVal("adminRoleEditHeader"),m.MsgErrorModelMessage=f.getVal("adminRoleEditMsg"),$("#msgErrorModal").modal("show")):(m.addAdminFeature=!1,$("#editRoleModal").modal("show"));var a=m.editRoleProdDisplay.feature.replace(/\s+/g,"").split(",");for(i=0;i<m.editroleFeatures.length;i++)for(-1==a.indexOf(m.editroleFeatures[i].value)&&(m.editroleFeatures[i].disabled=!0),j=0;j<r.length;j++)m.editroleFeatures[i].value.toLowerCase()==r[j]&&(m.editroleFeatures[i].checked=!0);for(i=0;i<m.addRoleProdDisplayOptions.length;i++)t.name==m.addRoleProdDisplayOptions[i].label&&m.addRoleProdDisplayOptions[i].feature.split(",");(-1!=r.indexOf("rules_and_alerts")?s:o)(m.editroleFeatures,["rule_creator"],a),(-1!=r.indexOf("dashboards")?s:o)(m.editroleFeatures,["dashboard_admin"],a),(-1!=r.indexOf("dashboard_admin")?s:o)(m.editroleFeatures,["workbench"],a),(-1!=r.indexOf("workbench")?s:o)(m.editroleFeatures,["wb_creator"],a),1===r.length&&-1<r[0].toLowerCase().indexOf("health")&&angular.forEach(m.editroleFeatures,function(e){e.checked=!1,e.disabled=!0,"healthcheck"===e.value&&(e.checked=!0,e.disabled=!1,m.defaultFeatureCheck="healthcheck")})},function(e,t,r){e.map(function(e){-1!==r.indexOf(e.value)&&-1<t.indexOf(e.value)&&(e.disabled=!1)})}),o=function(e,t,r){e.map(function(e){-1<t.indexOf(e.value)&&(e.disabled=!0)})},y=(m.isRequired=function(e){var t=f.getVal("addUserMandetoryFields");for(i=0;i<t.length;i++)if(t[i]==e)return!0;return!1},m.isRequiredRole=function(e){var t=f.getVal("addRoleMandetoryFields");for(i=0;i<t.length;i++)if(t[i]==e)return!0;return!1},m.editUser=function(){if(m.data_loading=!0,m.editUserError=!0,m.editUserErrorMsg="Error!",angular.element(document.querySelector(".errorInput")).removeClass("errorInput"),!/^[0-9\)\(+-]+$/g.test(m.editUserPhone)&&0<m.editUserPhone.length)return m.data_loading=!1,m.editUserErrorMsg=m.phoneNumberNotValid,angular.element(document.querySelector("#editUserPhone")).addClass("errorInput"),void(m.editUserError=!1);if(!/^[a-zA-Z]*$/g.test(m.editUserState))return m.data_loading=!1,m.editUserErrorMsg=m.UserStateNotValid,angular.element(document.querySelector("#editUserState")).addClass("errorInput"),void(m.editUserError=!1);if(!/^[a-zA-Z]*$/g.test(m.editUserCountry))return m.data_loading=!1,m.editUserErrorMsg=m.UserCountryNotValid,angular.element(document.querySelector("#editUserCountry")).addClass("errorInput"),void(m.editUserError=!1);if(50<m.editUserfirst_name.length)return m.data_loading=!1,m.editUserErrorMsg=m.charLimitError,angular.element(document.querySelector("#editUserfirst_name")).addClass("errorInput"),void(m.editUserError=!1);if(50<m.editUserlast_name.length)return m.data_loading=!1,m.editUserErrorMsg=m.charLimitError,angular.element(document.querySelector("#editUserlast_name")).addClass("errorInput"),void(m.editUserError=!1);if(50<m.editUserPhone.length)return m.data_loading=!1,m.editUserErrorMsg=m.charLimitError,angular.element(document.querySelector("#editUserPhone")).addClass("errorInput"),void(m.editUserError=!1);if(50<m.editUserDepartment.length)return m.data_loading=!1,m.editUserErrorMsg=m.charLimitError,angular.element(document.querySelector("#editUserDepartment")).addClass("errorInput"),void(m.editUserError=!1);if(50<m.editUserState.length)return m.data_loading=!1,m.editUserErrorMsg=m.charLimitError,angular.element(document.querySelector("#editUserState")).addClass("errorInput"),void(m.editUserError=!1);if(50<m.editUserCity.length)return m.data_loading=!1,m.editUserErrorMsg=m.charLimitError,angular.element(document.querySelector("#editUserCity")).addClass("errorInput"),void(m.editUserError=!1);if(50<m.editUserCountry.length)return m.data_loading=!1,m.editUserErrorMsg=m.charLimitError,angular.element(document.querySelector("#editUserCountry")).addClass("errorInput"),void(m.editUserError=!1);if(null==getCookie("mps"))U.location.href=localStorage.getItem("logOutUrl");else{var e="";for(i=0;i<m.roleList.length;i++)for(j=0;j<m.roleList[i].domains.length;j++)m.editUserRole.value==m.roleList[i].name&&m.roleList[i].domains[j].mps.join(":")==m.editUsermps_def.id&&(e=-1!=m.roleList[i].domains[j].features.search("Workbench")||-1!=m.roleList[i].domains[j].features.search("workbench")?m.editUserEmail:f.getVal("genericUser"),e=-1!=m.roleList[i].domains[j].features.search("Creator")||-1!=m.roleList[i].domains[j].features.search("wb_creator")?m.editUserEmail:f.getVal("genericUser"));if(m.remainingLicense==m.totalLicense&&e==m.editUserEmail)return m.data_loading=!1,m.editUserErrorMsg=m.noRemainingLiceses,void(m.editUserError=!1);if(m.oldEditRole!=m.editUserRole.value){for(i=0;i<m.roleList.length;i++)if(m.editUserRole.value==m.roleList[i].name)for(j=0;j<m.roleList[i].domains.length;j++)m.editUsermps_def.id==m.roleList[i].domains[j].mps.join(":")&&m.roleList[i].domains[j].features.indexOf("Rules & Alerts");for(i=0;i<m.roleList.length;i++)for(j=0;j<m.roleList[i].domains.length;j++)m.oldEditRole==m.roleList[i].name&&(-1==m.roleList[i].domains[0].features.search("Workbench")&&-1==m.roleList[i].domains[0].features.search("workbench")||m.remainingLicense--,-1!=m.roleList[i].domains[0].features.search("Creator")&&m.creatorLicensesCount--)}var o={first_name:m.editUserfirst_name,last_name:m.editUserlast_name,department:m.editUserDepartment,state:m.editUserState,city:m.editUserCity,country:m.editUserCountry,sso:!1,wb_user_name:e,report_usage:!!m.editUserreport_usage,email:m.editUserEmail,phone:m.editUserPhone,org:getCookie("mps").substring(0,getCookie("mps").indexOf(":")),role:m.editUserRole.value,realm_def:"",url_def:getCookie("adminAddUserDefUrl"),mps_def:m.editUsermps_def.id,is_prospect:!1,dashboard_admin:m.editUserdashboard_admin.val,is_external:m.editUser_isExternalUser,end_customer:m.editUser_isExternalUser?m.editUserEndCustomer.val:"",active:!0},n=u(o);if(-1<n.indexOf("Creator")&&m.creatorLicensesCount==m.totalCreatorLicensesCount)return m.data_loading=!1,m.editUserErrorMsg=f.getVal("noCreatorLiceses"),void(m.editUserError=!1);$("#editUserModal").modal("hide"),g.editUser(o).then(function(e){var t,r,a,s;m.userTracking("User","Edit User",JSON.stringify(o)),-1<n.indexOf("Workbench")&&(t=y(o,"user"),r={},(t=L(t))&&(s=[],(a={}).userName=o.email,a.roleType=t,s.push(a)),r.userRole=s,g.addNewTableauUser(r).then(function(e){},function(e){})),m.data_loading=!1,m.MsgModelHeader=m.editUserMsgHeader,m.MsgModelMessage=e.data.Msg,m.roleSelected=!1,$("#msgModal").modal("show")},function(e){m.data_loading=!1,m.editUserErrorMsg=e.data.Msg,m.editUserError=!1})}},m.addNewUser=function(){m.data_loading=!0,m.addUserError=!0,m.AddUserErrorMsg="Error!";var e=/^[\w.!#$%&'*+=?^_`(){|}~-]{1,64}@[a-zA-Z0-9-]+(?:\.[a-zA-Z-]{2,4})*$/.test(m.newUserEmail);if(angular.element(document.querySelector(".errorInput")).removeClass("errorInput"),m.totalUsers==m.MaxUsers)return m.data_loading=!1,m.AddUserErrorMsg=m.maxUserReached,void(m.addUserError=!1);if(!e)return m.data_loading=!1,m.AddUserErrorMsg=m.emailNotValid,angular.element(document.querySelector("#newUserEmail")).addClass("errorInput"),void(m.addUserError=!1);if(!/^[0-9\)\(+-]+$/g.test(m.newUserPhone)&&0<m.newUserPhone.length)return m.data_loading=!1,m.AddUserErrorMsg=m.phoneNumberNotValid,angular.element(document.querySelector("#newUserPhone")).addClass("errorInput"),void(m.addUserError=!1);if(!/^[a-zA-Z]*$/g.test(m.newUserState))return m.data_loading=!1,m.AddUserErrorMsg=m.UserStateNotValid,angular.element(document.querySelector("#newUserState")).addClass("errorInput"),void(m.addUserError=!1);if(!/^[a-zA-Z]*$/g.test(m.newUserCountry))return m.data_loading=!1,m.AddUserErrorMsg=m.UserCountryNotValid,angular.element(document.querySelector("#newUserCountry")).addClass("errorInput"),void(m.addUserError=!1);if(50<m.newUserfirst_name.length)return m.data_loading=!1,m.AddUserErrorMsg=m.charLimitError,angular.element(document.querySelector("#newUserfirst_name")).addClass("errorInput"),void(m.addUserError=!1);if(50<m.newUserlast_name.length)return m.data_loading=!1,m.AddUserErrorMsg=m.charLimitError,angular.element(document.querySelector("#newUserlast_name")).addClass("errorInput"),void(m.addUserError=!1);if(void 0===m.newUserEmail||0===m.newUserEmail.length)return m.data_loading=!1,m.AddUserErrorMsg="Error! Please enter Email ID",angular.element(document.querySelector("#newUserEmail")).addClass("errorInput"),void(m.addUserError=!1);if(50<m.newUserPhone.length)return m.data_loading=!1,m.AddUserErrorMsg=m.charLimitError,angular.element(document.querySelector("#newUserPhone")).addClass("errorInput"),void(m.addUserError=!1);if(50<m.newUserDepartment.length)return m.data_loading=!1,m.AddUserErrorMsg=m.charLimitError,angular.element(document.querySelector("#newUserDepartment")).addClass("errorInput"),void(m.addUserError=!1);if(50<m.newUserState.length)return m.data_loading=!1,m.AddUserErrorMsg=m.charLimitError,angular.element(document.querySelector("#newUserState")).addClass("errorInput"),void(m.addUserError=!1);if(50<m.newUserCity.length)return m.data_loading=!1,m.AddUserErrorMsg=m.charLimitError,angular.element(document.querySelector("#newUserCity")).addClass("errorInput"),void(m.addUserError=!1);if(50<m.newUserCountry.length)return m.data_loading=!1,m.AddUserErrorMsg=m.charLimitError,angular.element(document.querySelector("#newUserCountry")).addClass("errorInput"),void(m.addUserError=!1);if(null==getCookie("mps"))U.location.href=localStorage.getItem("logOutUrl");else if(-1!=m.allUsersEmailList.indexOf(m.newUserEmail))m.data_loading=!1,m.AddUserErrorMsg=m.addUserDuplicateEmail,m.addUserError=!1;else{var t="";for(i=0;i<m.roleList.length;i++)for(j=0;j<m.roleList[i].domains.length;j++)m.newUserRole.value==m.roleList[i].name&&m.roleList[i].domains[j].mps.join(":")==m.newUsermps_def.id&&(t=-1!=m.roleList[i].domains[j].features.search("Workbench")?m.newUserEmail:f.getVal("genericUser"),t=-1!=m.roleList[i].domains[j].features.replace(/\s+/g,"").split(",").indexOf("Creator")?m.newUserEmail:f.getVal("genericUser"));for(i=0;i<m.roleList.length;i++)if(m.newUserRole.value==m.roleList[i].name)for(j=0;j<m.roleList[i].domains.length;j++)m.newUsermps_def.id==m.roleList[i].domains[j].mps.join(":")&&m.roleList[i].domains[j].features.indexOf("Rules & Alerts");if(m.remainingLicense==m.totalLicense&&t==m.newUserEmail)return m.data_loading=!1,m.AddUserErrorMsg=m.noRemainingLiceses,void(m.addUserError=!1);if(m.totalCreatorLicensesCount==m.creatorLicensesCount&&t==m.newUserEmail)return m.data_loading=!1,m.AddUserErrorMsg=f.getVal("noCreatorLiceses"),void(m.addUserError=!1);var o={first_name:m.newUserfirst_name,last_name:""==m.newUserlast_name?" ":m.newUserlast_name,department:m.newUserDepartment,state:m.newUserState,city:m.newUserCity,country:m.newUserCountry,sso:!1,wb_user_name:t,report_usage:!!m.newUserreport_usage,email:m.newUserEmail,phone:m.newUserPhone,org:getCookie("mps").substring(0,getCookie("mps").indexOf(":")),role:m.newUserRole.value,realm_def:"",url_def:getCookie("adminAddUserDefUrl"),mps_def:m.newUsermps_def.id,is_prospect:!1,dashboard_admin:m.newUserdashboard_admin.val,is_external:m.newUser_isExternalUser,end_customer:m.newUser_isExternalUser?m.newUserEndCustomer.val:"",active:!0},n=u(o);g.addNewUser(o).then(function(e){var t,r,a,s;m.userTracking("User","Add New User",JSON.stringify(o)),-1<n.indexOf("Workbench")&&(t=y(o,"user"),r={},(t=L(t))&&(s=[],(a={}).userName=o.email,a.roleType=t,s.push(a)),r.userRole=s,g.addNewTableauUser(r).then(function(e){},function(e){})),$("#addNewUserModal").modal("hide"),m.MsgModelHeader=m.addUserMsgHeader,m.MsgModelMessage=e.data.Msg,m.data_loading=!1,$("#msgModal").modal("show"),m.addUserError=!0},function(e){m.data_loading=!1,m.AddUserErrorMsg=e.data.Msg.toLowerCase(),m.addUserError=!1})}},m.selectAllUser=function(){if(m.selectAll=!m.selectAll,m.selectAll)for(i=0;i<m.data.length;i++)m.data[i].selected=!0,m.selectedRemove=!0;else for(i=0;i<m.data.length;i++)m.data[i].selected=!1,m.selectedRemove=!1},m.editRole=function(){m.data_loading=!0;var e=[];for(i=0;i<m.rdata.length;i++)if(m.rdata[i].name==m.editRoleName)for(j=0;j<m.rdata[i].domains.length;j++)m.rdata[i].domains[j]!=m.editRoleDomain&&e.push(m.rdata[i].domains[j].mps.join(":"));if(e=m.unique(e),null==getCookie("mps"))U.location.href=localStorage.getItem("logOutUrl");else{var t=h("filter")(m.editroleFeatures,{checked:!0}),r=[],a=[];for(i=0;i<m.users.length;i++)m.editRoleName==m.users[i].role&&0;for(i=0;i<t.length;i++)r.push(t[i].value);if(m.workbenchFeatureAssigned)for(i=0;i<m.users.length;i++)m.users[i].role==m.editRoleName&&m.editRoleProdDisplay.id==m.users[i].mps_def&&a.push(m.users[i]);else if(-1!=r.indexOf("workbench")||-1!=r.indexOf("Workbench"))for(i=0;i<m.users.length;i++)m.users[i].role==m.editRoleName&&m.editRoleProdDisplay.id==m.users[i].mps_def&&a.push(m.users[i]);if(a.length>m.totalLicense-m.remainingLicense&&!m.workbenchFeatureAssigned)return m.editRoleErrorMsg=f.getVal("workbenchFeatureError"),m.editRoleError=!1,void(m.data_loading=!1);if(0==r.length)return m.editRoleErrorMsg=f.getVal("nofeatureselected"),m.editRoleError=!1,void(m.data_loading=!1);if(m.creatorLicenseAssigned&&-1==r.indexOf("wb_creator")&&m.creatorLicensesCount--,-1<r.indexOf("wb_creator")&&m.totalCreatorLicensesCount===m.creatorLicensesCount&&m.associatedRoleUserList[m.editRoleName].length)return m.editRoleErrorMsg=f.getVal("creatorFeatureError"),m.editRoleError=!1,void(m.data_loading=!1);getCookie("mps").split(":");var s,o=m.editRoleProdDisplay.id.split(":"),n=(m.addAdminFeature&&r.push("admin"),{name:m.editRoleName,is_super:!1,domain:m.editRoleProdDisplay.label,mfr:o[0],prod:o[1],sch:o[2],features:r,realm:[]}),l=(g.editRole(n).then(function(e){m.userTracking("Role","Edit Role",JSON.stringify(n));var t,r=u(n);$("#editRoleModal").modal("hide"),-1<r.indexOf("Workbench")&&(r=y(n,"role"),(r=L(r))&&((t={}).userName=m.associatedRoleUserList[m.editRoleName],t.roleType=r),g.updateTableauRoleUsers(t).then(function(e){},function(e){})),m.selectedRemoveRole=!1,m.singleRoleSelected=!1,m.MsgModelHeader=m.updateRoleMsgHeader,m.MsgModelMessage=e.data.Msg,$("#msgModal").modal("show"),m.addUserError=!0},function(e){m.data_loading=!1}),f.getVal("genericUser"));for(i=0;i<a.length;i++)m.data_loading=!0,s={first_name:a[i].first_name,last_name:a[i].last_name,department:a[i].department,state:a[i].state,city:a[i].city,country:a[i].country,sso:!1,wb_user_name:-1!=r.indexOf("workbench")||-1!=r.indexOf("Workbench")?a[i].email:l,report_usage:a[i].report_usage,email:a[i].email,phone:a[i].phone,org:a[i].org,role:a[i].role,realm_def:"",url_def:a[i].url_def,mps_def:a[i].mps_def,is_prospect:!1,dashboard_admin:a[i].dashboard_admin,is_external:!1,active:!0},g.editUser(s).then(function(e){m.roleSelected=!1,m.data_loading=!1},function(e){m.data_loading=!1,m.editUserErrorMsg=e.data.Msg,m.editUserError=!1})}},m.addProduct=function(e){m.defaultFeatureCheck=getCookie("default_feature"),$("#addProdfeaturesPermission").hide();var t=e;if(!e)for(i=0;i<m.roleList.length;i++)m.roleList[i].selected&&(t=m.roleList[i]);m.addProdRoleDisName=t.DisName,m.addProdRoleName=t.name;var r,a=[];for(i=0;i<m.addRoleProdDisplayOptions.length;i++)a.push(m.addRoleProdDisplayOptions[i]);for(m.ProdaddRoleProdDisplayOptions=a,i=0;i<t.domains.length;i++)for(j=0;j<m.ProdaddRoleProdDisplayOptions.length;j++)t.domains[i].name==m.ProdaddRoleProdDisplayOptions[j].label&&(r=t.domains[i].features.split(","),m.ProdaddRoleProdDisplayOptions.splice(j,1));for(2==m.ProdaddRoleProdDisplayOptions.length?(m.addProdRoleProd=m.ProdaddRoleProdDisplayOptions[0],tempArray=m.ProdaddRoleProdDisplayOptions[1].feature.split(",")):m.addProdRoleProd=m.ProdaddRoleProdDisplayOptions[0],i=0;i<m.addProdroleFeatures.length;i++)r&&1===r.length&&-1<r[0].toLowerCase().indexOf("health")?(m.addProdroleFeatures[i].checked=!1,m.addProdroleFeatures[i].disabled=!0,"healthcheck"===m.addProdroleFeatures[i].value&&(m.addProdroleFeatures[i].checked=!0,m.addProdroleFeatures[i].disabled=!1,m.defaultFeatureCheck="healthcheck")):m.addProdroleFeatures[i].value==m.defaultFeatureCheck?m.addProdroleFeatures[i].checked=!0:m.addProdroleFeatures[i].checked=!1},m.addProductSubmit=function(){m.data_loading=!0;var e=[],t=[];for(i=0;i<m.rdata.length;i++)if(m.rdata[i].selected)for(j=0;j<m.rdata[i].domains.length;j++)t.push(m.rdata[i].domains[j].mps.join(":")),e.push(m.rdata[i].domains[j].name);if(t=m.unique(t),null==getCookie("mps"))U.location.href=localStorage.getItem("logOutUrl");else{var r=h("filter")(m.addProdroleFeatures,{checked:!0}),a=[];for(i=0;i<r.length;i++)a.push(r[i].value);if(0==a.length)return m.AddProdErrorMsg=f.getVal("nofeatureselected"),m.addProdError=!1,void(m.data_loading=!1);var s=m.addProdRoleProd.id.split(":"),o={name:m.addProdRoleName,is_super:!1,domain:m.addProdRoleProd.label,mfr:s[0],prod:s[1],sch:s[2],features:a,realm:[]};$("#addProductModal").modal("hide"),g.addNewRole(o).then(function(e){m.userTracking("Role","Add Product",JSON.stringify(o)),m.selectedRemoveRole=!1,m.MsgModelHeader=m.addProdcutMsgHeader,m.MsgModelMessage=m.prodAddedMsg,$("#msgModal").modal("show")},function(e){m.data_loading=!1})}},m.addRole=function(){if(m.data_loading=!0,m.noFeatureWarning=!0,!/^[0-9a-zA-Z\_\.\)\(\-]+$/g.test(m.addRoleName))return m.data_loading=!1,m.addRoleErrorMsg=m.roleNameNotValid,angular.element(document.querySelector("#addRoleName")).addClass("errorInput"),void(m.addRoleError=!1);if(null==getCookie("mps"))U.location.href=localStorage.getItem("logOutUrl");else if(-1!=m.allRoleNameList.indexOf(m.addRoleName.toLowerCase()))m.data_loading=!1,m.addRoleError=!1;else{var e=h("filter")(m.roleFeatures,{checked:!0}),t=[];for(i=0;i<e.length;i++)t.push(e[i].value);if(0==t.length)return m.addRoleErrorMsg=f.getVal("nofeatureselected"),m.addRoleError=!1,void(m.data_loading=!1);var r=m.addRoleProdDisplay.id.split(":"),a={name:m.addRoleName,is_super:!1,domain:m.addRoleProdDisplay.label,mfr:r[0],prod:r[1],sch:r[2],features:t,realm:[]};$("#addRoleModal").modal("hide"),g.addNewRole(a).then(function(e){m.userTracking("Role","Add New Role",JSON.stringify(a)),m.singleRoleSelected=!1,m.MsgModelHeader=m.addRoleMsgHeader,m.MsgModelMessage=e.data.Msg,$("#msgModal").modal("show"),m.addUserError=!0},function(e){m.data_loading=!1})}},m.deleteUser=function(){m.data_loading=!0;for(i=0;i<m.data.length;i++)m.data[i].selected&&0;var t,r=[];for(i=0;i<m.data.length;i++)m.data[i].selected&&(t=m.data[i].email,r.push(m.data[i].email),g.deleteUser(m.data[i].email).then(function(e){m.userTracking("User","Delete User",t),m.selectAll=!1,0;e=e.data.Msg;for(t=e.substr(5,e.indexOf("removed")-6),l=0;l<m.data.length;l++)m.data[l].email==t&&(m.data[l].selected=!1,m.selectedRemove=!1,m.selectAll=!1,m.userEditSelected=!1,m.MsgModelHeader=m.deletedMsgHeader,m.MsgModelMessage="User(s) "+r.join(",")+" deleted successfully",m.data_loading=!1,$("#msgModal").modal("show"))},function(e){}));var e={};e.users=r,g.deleteTableauRoleUsers(e).then(function(e){},function(e){})},m.deleteRole=function(){m.data_loading=!0;var t="",r=[],a=[];for(i=0;i<m.rdata.length;i++)m.rdata[i].selected&&r.push(m.rdata[i].name);var s,o=D(m.associatedRoleList,r),r=r.filter(function(e){return-1==o.indexOf(e)}),n=(m.roleList.map(function(e){-1<o.indexOf(e.name)&&"admin"!==e.DisName.toLowerCase()&&a.push(e.DisName)}),-1<r.indexOf(m.loggedInUserrole)?m.loggedInUserroleDisplay+" "+m.adminRoleDeleteMsgHeader:""),l=0<r.length?a.sort().join(",")+" cannot be deleted as they are already associated to some users.":"";if(!(s=r.join(",")).length)return $("#deleteRoleConfModal").modal("hide"),m.MsgModelHeader="Delete Role",m.MsgModelMessage="All roles are associated to users. Cannot delete.",m.data_loading=!1,void $("#msgModal").modal("show");g.deleteRole(s).then(function(e){t=n||(0<o.length&&0<r.length?l+"\n"+e.data.Msg:e.data.Msg),$("#deleteRoleConfModal").modal("hide"),m.userTracking("Role","Delete Role",JSON.stringify(s)),m.MsgModelHeader="Delete Role",m.MsgModelMessage=t,m.selectedRemoveRole=!1,m.selectAllRole=!1,m.singleRoleSelected=!1,m.data_loading=!1,$("#msgModal").modal("show")},function(e){}),0!=m.roleList.length&&m.tableRoleParams.reload()},m.toggleSelectAll=function(e){var t;if(m.slectedCount=0,"all"==e)for(m.selectAll=!m.selectAll,m.selectAllAll=!m.selectAllAll,t=m.filterObj.userList.length?m.searchUseronFilteredData(m.data):m.searchData(),m.data=t,i=0;i<m.data.length;i++)m.data[i].selected=!1,m.selectedRemove=!1,m.selectAll&&!t[i].adminUserItem&&(m.data[i].selected=!0,m.selectedRemove=!0);else{for(e.selected=!e.selected,i=0;i<m.data.length;i++){if(m.data[i].selected){m.selectedRemove=!0;break}m.selectedRemove=!1}m.selectAll=!1}for(i=0;i<m.data.length;i++)m.data[i].selected&&m.slectedCount++;m.slectedCount==m.data.length&&(m.selectAll=!0),1==m.slectedCount?m.userEditSelected=!0:m.userEditSelected=!1},m.toggleSelectAllRole=function(e){if(m.slectedRoleCount=0,"all"==e)if(m.selectAllRole=!m.selectAllRole,m.selectAllRoleAll=!m.selectAllRoleAll,m.rdata=m.searchRoleListData(),m.selectAllRole){for(i=0;i<m.rdata.length;i++)m.rdata[i].selected=!0,m.selectedRemoveRole=!0;m.tableRoleParams.reload()}else{for(i=0;i<m.rdata.length;i++)m.roleList[i].selected=!1,m.selectedRemoveRole=!1;m.tableRoleParams.reload()}else{for(e.selected=!e.selected,i=0;i<m.rdata.length;i++){if(m.rdata[i].selected){m.selectedRemoveRole=!0;break}m.selectedRemoveRole=!1}m.selectAllRole=!1,m.tableRoleParams.reload()}for(i=0;i<m.rdata.length;i++)m.rdata[i].selected&&m.slectedRoleCount++;m.slectedRoleCount==m.rdata.length&&(m.selectAllRole=!0)},m.searchData=function(){return m.searchKeyword?h("filter")(m.users,m.customFilter,m.searchKeyword):m.users},m.searchUseronFilteredData=function(e){return m.searchKeyword?h("filter")(e,m.customFilter,m.searchKeyword):e},m.adminFeatureCheck=function(){for(m.showRoleToggle=!1,m.isExternalRole.val=!1,$("#featuresPermission").hide(),m.defaultFeatureCheck=getCookie("default_feature"),i=0;i<m.roleFeatures.length;i++)m.roleFeatures[i].value==m.defaultFeatureCheck?m.roleFeatures[i].checked=!0:m.roleFeatures[i].checked=!1},m.changeTheme=function(){m.darkModeOff?document.getElementById("theme_css").href="/apps/app/admin/css/admin/styleInverted.css":document.getElementById("theme_css").href="/apps/app/admin/css/admin/style.css"},m.customFilter=function(e){var t=m.searchKeyword.toLowerCase();return-1<"external".indexOf(t)&&e.is_external||-1<"internal".indexOf(t)&&!e.is_external?e:-1!==e.name.toLowerCase().indexOf(t||"")||-1!==e.email.toLowerCase().indexOf(t||"")||-1!==e.DisRuleName.toLowerCase().indexOf(t||"")||-1!==e.report_usage.toString().toLowerCase().toString().indexOf(t||"")||-1!==e.last_login.toLowerCase().toString().indexOf(t||"")||-1!==e.active.toString().toLowerCase().toString().replace("false","inactive").replace("true","active").indexOf(t||"")||-1!==e.dashboard_admin.toString().indexOf(t||"")||-1!==e.created_on.toLowerCase().indexOf(t.toLowerCase()||"")||-1!==e.modified_on.toLowerCase().indexOf(t.toLowerCase()||"")||-1!==e.end_customer.toLowerCase().indexOf(t||"")},m.logoutUser=function(){g.logoutInfoserver().then(function(e){for(var t,r=U.location.href=getCookie("logouturl"),a=document.cookie.split(";"),s=[],o=1;o<=a.length;o++)t=(t=a[o-1].split("=")[0]).trim(),s.push(t);for(o=0;o<s.length;o++)t=s[o],document.cookie=t+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;domain="+m.currentDomain+";path=/";U.location.href=r})},function(t,e){var r;return r=(r="user"===e?m.roleList.filter(function(e){return t.role===e.name})[0].domains.filter(function(e){return t.mps_def===e.mps.join(":")})[0].features:(r=t.features.toString(),m.matchFeatures(r))).replace(/\s+/g,"").split(",")}),L=function(e){for(var t=f.getVal("tableauSiteRoleFeaturesMap"),r=0;r<t.length;r++)if(t[r].features.length===_.intersection(e,t[r].features).length)return t[r].site_role},P=($(".modal").on("hidden.bs.modal",function(){if("msgModal"!=$(this).attr("id")&&"ResetPasswordModal"!=$(this).attr("id")&&"msgErrorModal"!=$(this).attr("id")&&"deleteUserConfModal"!=$(this).attr("id")&&"deleteRoleConfModal"!=$(this).attr("id")&&"editUserModal"!=$(this).attr("id")&&"editUserModal"!=$(this).attr("id")&&"addNewUserModal"!=$(this).attr("id")&&"editRoleModal"!=$(this).attr("id")&&"addProductModal"!=$(this).attr("id")&&"addRoleModal"!=$(this).attr("id")&&"deleteProductConfModal"!=$(this).attr("id")&&($(this).find("form")[0].reset(),m.addRoleError=!0),"editRoleModal"==$(this).attr("id")){for(m.editRoleProdDisplay=m.addRoleProdDisplayOptions[0],i=0;i<m.editroleFeatures.length;i++)m.editroleFeatures[i].checked=!1;m.editRoleError=!0}if("addProductModal"==$(this).attr("id")){for(i=0;i<m.addProdroleFeatures.length;i++)m.addProdroleFeatures[i].value==m.defaultFeatureCheck?m.addProdroleFeatures[i].checked=!0:m.addProdroleFeatures[i].checked=!1;m.addProdRoleProd=m.ProdaddRoleProdDisplayOptions[0]}if("addRoleModal"==$(this).attr("id")){for(m.addRoleProdDisplay=m.addRoleProdDisplayOptions[0],m.addRoleName="",i=0;i<m.roleFeatures.length;i++)m.roleFeatures[i].value==m.defaultFeatureCheck?m.roleFeatures[i].checked=!0:m.roleFeatures[i].checked=!1;m.addRoleError=!0}"addNewUserModal"==$(this).attr("id")&&($(this).find("form")[0].reset(),m.newUserlast_name="",m.newUserRole=m.newUserRoleOptions[0],m.roleSelected=!1,m.addUserError=!0,m.newUserreport_usage=!0),"editUserModal"==$(this).attr("id")&&(m.roleSelected=!1),m.addRoleError=!0,m.editRoleError=!0,m.addProdError=!0,m.addRoleWarning=!0,m.editRoleWarning=!0,m.addProdWarning=!0,m.editUserError=!0,m.resetPassErrorFlag=!1,angular.element(document.querySelector(".errorInput")).removeClass("errorInput")}),angular.element(document).ready(function(){$("#userTablePager").parent().parent().appendTo("#userListPagerLocation"),$("#roleTablePager").parent().parent().appendTo("#roleListPagerLocation")}),m.unique=function(e){for(var t=[],r=0;r<e.length;r++)t.indexOf(e[r])<0&&t.push(e[r]);return t},m.setRoleList=function(){m.newUserRoleOptions=P("Internal")},function(e){var t=[],r=[];return t[0]={id:"",label:"Select Role",value:""},r="External"===e?m.copynewUserRoleOptions.filter(function(e){return"External"===e.roleType}):m.copynewUserRoleOptions.filter(function(e){return"Internal"===e.roleType}),t=t.concat(r)}),O=(m.filterRoles=function(e){var t="Internal";m.roleSelected=!1,m.showEndCustomerList=!1,(m.newUser_isExternalUser||m.editUser_isExternalUser)&&(t="External"),m.newUserRoleOptions=P(t),"edit"===e?(m.editUserRole=m.newUserRoleOptions[0],m.editUserEndCustomer.val=""):(m.newUserRole=m.newUserRoleOptions[0],m.newUserEndCustomer.val="")},m.filterFeatures=function(e,t){var r,a,s;m.addRoleWarning=!0,m.roleFeatures=angular.copy(m.copyOfRoleFeatures),m.noFeatureWarning=!0,m.addRoleError=!0;var o=t.feature.replace(/\s+/g,"").split(",");e?angular.forEach(m.roleFeatures,function(e){e.checked=!1,e.disabled=!0,-1!==o.indexOf(e.value)&&"healthcheck"===e.value&&(e.checked=!0,e.disabled=!1,m.defaultFeatureCheck="healthcheck"),-1==o.indexOf(e.value)&&"healthcheck"===e.value&&(m.noFeatureWarning=!1,m.noFeatureWarningMsg=f.getVal("noFeatureWarningMsg"))}):(m.defaultFeatureCheck=getCookie("default_feature"),angular.forEach(m.roleFeatures,function(e){e.checked=!1,-1==o.indexOf(e.value)&&(e.disabled=!0),m.defaultFeatureCheck===e.value&&(e.checked=!0,r=e)}),t=A(r.value),"rules_and_alerts"==r.value&&(a=t.enableFeatures,s=t.disableFeatures),"dashboards"===r.value&&(a=t.enableFeatures,s=t.disableFeatures),"dashboard_admin"===r.value&&(a=t.enableFeatures,s=t.disableFeatures),c(r,m.roleFeatures,a,s,m.addRoleProdDisplay))},m.loadEndCustomerList=function(e){var t;m.showEndCustomerList=!0,e=e,m.endCustomerMPSList=[],(t=(t=_.groupBy(m.endCustomerList,function(e){return e.mfr+":"+e.prod+":"+e.sch}))[e.id]||t[e])&&(m.endCustomerMPSList=t.map(function(e){return e.endcustomer_name}))},m.addSysIds=function(){m.sysIdList.forEach(function(e,t){var r;-1<m.sysIds.toAddList.indexOf(e.name)&&((r={}).name=e.name,e.selected=!0,m.selectedSysIds.push(r),m.unavailableSysids.push(e.name))}),O(),null==$(".add-sysid-list").val()&&(m.sysIds.toAddList=[])},m.removeSysIds=function(){var r=[];m.sysIds.toRemoveList.map(function(e){var t={};t.name=e,r.push(t)}),angular.forEach(r,function(r,e){angular.forEach(m.sysIdList,function(e,t){e.name===r.name&&(e.selected=!1)})}),r.map(function(e){S(m.selectedSysIds,e)}),O(),null==$(".add-sysid-list").val()&&(m.sysIds.toRemoveList=[])},function(){$(".sysid-list option:selected").prop("selected",!1)}),S=function(r,a){r.forEach(function(e,t){e.name===a.name&&(r.splice(t,1),e=m.unavailableSysids.indexOf(a.name),m.unavailableSysids.splice(e,1))})};m.toggleAll=function(e,t){var r=!t;angular.forEach(e,function(e){e.selected||(e.checked=r)})};m.getSysIDList=function(e){m.sysIdList=[],m.isLoading=!0,m.showSysIDList=!0,g.getSysIdList(e.id,m.pagination.startIndex,m.pagination.endIndex,m.searchText.val).then(function(e){e=e.data.Data,m.totalSysids=parseInt(e.pop()),m.shouldCallLoadPages&&(n(),m.shouldCallLoadPages=!1),e.map(function(e){var t={};t.name=e,t.selected=-1<m.unavailableSysids.indexOf(e),m.sysIdList.push(t)}),m.showSearchBox=0<m.sysIdList.length||0<m.searchText.val.length,m.isLoading=!1,e=m.totalSysids<=m.pagination.endIndex?m.totalSysids:m.pagination.endIndex+1;m.paginationText="Showing "+(m.pagination.startIndex+1)+" to "+e+" of "+m.totalSysids},function(){m.isLoading=!1,m.showErrorMsg=!0,m.showSearchBox=!1})},m.loadNextSet=function(e){m.pagination.currentPage=m.pagination.currentPage+1;var t=m.pages[m.pagination.currentPage-1];m.pagination.startIndex=t.startIndex,m.pagination.endIndex=t.endIndex,m.getSysIDList(e)},m.loadPrevSet=function(e){m.pagination.currentPage=m.pagination.currentPage-1;var t=m.pages[m.pagination.currentPage-1];m.pagination.startIndex=t.startIndex,m.pagination.endIndex=t.endIndex,m.getSysIDList(e)},m.getEndCustomerDetails=function(){m.selectAllEndCustomers={val:!1},m.selectedEndCustomerToRemove=!1,m.filterObj.endCustomerList=[],m.endCustomerFilterGroupedData=angular.copy(f.getVal("endCustomerFilterGroupedData")),g.getEndCustomersList().then(function(e){e=e.data.Data;m.endCustomerList=e,m.endCustomerList.map(function(e){e.updated_on=moment(new Date(e.updated_on)).local().format("YYYY-MM-DD HH:mm:ss"),e.selected=!1}),m.endCustomerNameMap=e.map(function(e){return e.endcustomer_name}),m.endCustomerParams=new p({page:f.getVal("page"),count:f.getVal("count"),reload:m.endCustomerParams,sorting:{endcustomer_name:"asc"}},{counts:[],getData:function(e,t){var r,a=m.searchEndCustomerData();t.total(m.endCustomerList.length),null==t.settings().$scope&&(t.settings().$scope=m),a&&(r=t.sorting()?h("orderBy")(a,t.orderBy()):a,m.endCustomerData=r.slice((t.page()-1)*t.count(),t.page()*t.count())),e.resolve(m.endCustomerData),t.total(r.length),m.copyOfEndCustomerList=angular.copy(m.endCustomerList),r.forEach(function(t){for(key in t)m.endCustomerFilterGroupedData.map(function(r){var e;r.showSearch&&(r.searchText=""),r.isDateType?r.data=angular.copy(f.getVal("timeListFilter")):r.columnName===key&&""!==t[key]&&("serial_number"===key?t[key].forEach(function(e){var t={};t.name=e,t.selected=!1,r.data.push(t)}):((e={}).name=t[key],e.selected=!1,r.data.push(e)),r.data=_.uniqBy(r.data,"name"))})})}}),d(function(){0<m.endCustomerList.length&&m.endCustomerParams.reload()}),m.groupedData=_.groupBy(e,function(e){return e.mfr+":"+e.prod+":"+e.sch})})},m.setUnavailableSysidList=function(e){var e=m.groupedData[e.id],t=[];e?(e.map(function(e){t.push(e.serial_number)}),m.unavailableSysids=_.uniq(_.flatten(t))):m.unavailableSysids=[]},m.openModalPopup=function(e){$(e).modal("show")},m.addEndCustomer=function(){m.showEndCustomerExistsError=!1,m.selectAllEndCustomers.val=!1,m.selectedEndCustomerToRemove=!1;var t={},r=[];m.selectedSysIds.map(function(e){r.push(e.name)}),t.endcustomer_name=m.addNewEndCustomer.endCustomerName,t.serial_number=r.toString(),t.created_by=m.loggedInUserEmail,t.updated_on="",-1!==m.endCustomerNameMap.indexOf(m.addNewEndCustomer.endCustomerName)?m.showEndCustomerExistsError=!0:g.addEndCustomer(m.addNewEndCustomer.prodName.id,t).then(function(e){m.userTracking("User","Add New End Customer",JSON.stringify(t)),$("#addEndCustomerModal").modal("hide"),m.MsgModelHeader="End Customer",m.MsgModelMessage=e.data.Msg,m.data_loading=!1,$("#msgModal").modal("show")},function(e){m.data_loading=!1})},m.editEndCustomerModal=function(e){m.selectedSysIds=[],m.editEndCustomer.endCustomerName=e.endcustomer_name;var t=e.mfr+":"+e.prod+":"+e.sch;angular.forEach(m.endCustomerProductList,function(e){t===e.id&&(m.editEndCustomer.prodName=e)}),m.editEndCustomer.created_by=e.created_by,m.editEndCustomer.updated_on=e.updated_on,m.shouldCallLoadPages=!0,m.searchText.val="",F(),m.getSysIDList(m.editEndCustomer.prodName),m.setUnavailableSysidList(m.editEndCustomer.prodName),0<e.serial_number.length&&angular.forEach(e.serial_number,function(e){var t={};t.name=e,t.checked=!1,t.selected=!0,m.selectedSysIds.push(t)}),$("#editEndCustomerModal").modal("show")},m.updateEndCustomerDetails=function(){var t={},r=[];m.selectedSysIds.map(function(e){r.push(e.name)}),t.endcustomer_name=m.editEndCustomer.endCustomerName,t.serial_number=r.toString(),t.created_by=m.editEndCustomer.created_by,t.updated_on=m.editEndCustomer.updated_on,g.updateEndCustomer(m.editEndCustomer.prodName.id,t).then(function(e){m.userTracking("User","Update End Customer",JSON.stringify(t)),$("#editEndCustomerModal").modal("hide"),m.MsgModelHeader="Edit End Customer",m.MsgModelMessage=e.data.Msg,$("#msgModal").modal("show")},function(){})};var D=function(e,t){return e.filter(function(e){return-1<t.indexOf(e)})},x=(m.deleteEndCustomer=function(){var t=D(m.associatedEndCustomerList,m.endCustomersToDelete),r=(m.endCustomersToDelete=m.endCustomersToDelete.filter(function(e){return-1==t.indexOf(e)}),0<m.endCustomersToDelete.length?t.sort().join(",")+" cannot be deleted as they are already associated to some users.":"");m.MsgModelMessage=0<t.length&&0<m.endCustomersToDelete.length?r+"\nresponse.data.Msg":"response.data.Msg",g.deleteEndCustomer(m.endCustomersToDelete).then(function(e){m.userTracking("User","Delete End Customer",JSON.stringify(m.endCustomersToDelete)),$("#deleteEndCustomerConfModal").modal("hide"),m.MsgModelHeader="Delete End Customer",m.MsgModelMessage=0<t.length&&0<m.endCustomersToDelete.length?r+"\n"+e.data.Msg:e.data.Msg,$("#msgModal").modal("show"),m.selectedEndCustomerToRemove=!1,m.endCustomersToDelete=[]})},m.resetPopup=function(){x(),m.sysIdList=[],m.showSysIDList=!1,m.isLoading=!1,m.selectedSysIds=[],O(),F(),m.shouldCallLoadPages=!0,m.showEndCustomerExistsError=!1,m.showSearchBox=!1,m.searchText.val="",m.searchText.tableSearch=""},function(){m.addNewEndCustomer={endCustomerName:"",prodName:m.endCustomerProductList[0]}}),F=function(){m.pagination={pageSize:200,startIndex:0,endIndex:199,noOfPages:0,currentPage:1}},A=(m.setEndCustomerToDelete=function(e){m.endCustomersToDelete=[],m.endCustomerData.map(function(e){e.selected&&m.endCustomersToDelete.push(e.endcustomer_name)})},m.customEndCustomerFilter=function(e){var t=m.searchText.tableSearch.toLowerCase();return-1!==e.endcustomer_name.toLowerCase().indexOf(t||"")||-1!==e.serial_number.toString().toLowerCase().indexOf(t||"")||-1!==e.created_by.toLowerCase().indexOf(t||"")},m.customRoleListFilter=function(e){var r=m.searchText.rolelistSearch.toLowerCase();if(-1!==e.DisName.toLowerCase().indexOf(r||"")||-1!==e.roleType.toLowerCase().indexOf(r||""))return!0;var a=!1;return angular.forEach(e.domains,function(e){var t=e.features.trim().toLowerCase();-1===e.name.toLowerCase().indexOf(r||"")&&!t.contains(r)||(a=!0)}),a},m.searchEndCustomerData=function(){return m.searchText.tableSearch?h("filter")(m.endCustomerList,m.customEndCustomerFilter,m.searchText.tableSearch):m.endCustomerList},m.searchEndCustomeronFilteredData=function(e){return m.searchText.tableSearch?h("filter")(e,m.customEndCustomerFilter,m.searchText.tableSearch):e},m.searchRoleListData=function(){return m.searchText.rolelistSearch?h("filter")(m.roleList,m.customRoleListFilter,m.searchText.rolelistSearch):m.roleList},m.clearSearchText=function(e){m.searchText.val="",m.getSysIDList(e)},m.finishLoading=function(){d(function(){$("#endCustomerTablePager").parent().parent()&&$("#endCustomerTablePager").parent().parent().appendTo("#endCustomerListPagerLocation")})},m.resetAddNewUserPopup=function(){m.showEndCustomerList=!1,m.newUser_isExternalUser=!1,m.editUser_isExternalUser=!1,m.newUserEndCustomer.val=""},m.resetScrollTop=function(e){d(function(){$("#"+e)[0].scrollTop=0})},m.toggleEndCustomerSelectAll=function(e){var t;if("all"==e)for(m.selectAllEndCustomers.val=!m.selectAllEndCustomers.val,m.selectAllEndCustomersAll=!m.selectAllEndCustomersAll,t=m.filterObj.endCustomerList.length?m.searchEndCustomeronFilteredData(m.endCustomerData):m.searchEndCustomerData(),m.endCustomerData=t,i=0;i<m.endCustomerData.length;i++)m.endCustomerData[i].selected=!1,m.selectedEndCustomerToRemove=!1,m.selectAllEndCustomersAll&&(m.endCustomerData[i].selected=!0,m.selectedEndCustomerToRemove=!0);else{for(e.selected=!e.selected,i=0;i<m.endCustomerData.length;i++){if(m.endCustomerData[i].selected){m.selectedEndCustomerToRemove=!0;break}m.selectedEndCustomerToRemove=!1}m.selectAllEndCustomers.val=!1}},function(e){return f.getVal("enableDisableFeatures")[e]}),I=(m.updateDataFilter=function(e,t,r,a,s,o,n){function l(e){var t=[];return Array.isArray(e)?(e.map(function(e){e.selected&&t.push(e.name)}),t):[]}var i=[];!s&&a&&Array.isArray(o)&&o.map(function(e){r===e.name?e.selected=!0:e.selected=!1}),s="userList"===e?(H(),m.userFilterGroupedData.map(function(e){l(e.data).length?(i.push({columnName:e.columnName,columnValue:l(e.data)}),e.appliedFilterCount=l(e.data).length,e.appliedFilterFirstItem=l(e.data)[0]):(e.appliedFilterCount=0,e.appliedFilterFirstItem="")}),m.filterObj.userList=i,I(m.users,i)):(V(),m.endCustomerFilterGroupedData.map(function(e){l(e.data).length?(i.push({columnName:e.columnName,columnValue:l(e.data)}),e.appliedFilterCount=l(e.data).length,e.appliedFilterFirstItem=l(e.data)[0]):(e.appliedFilterCount=0,e.appliedFilterFirstItem="")}),m.filterObj.endCustomerList=i,I(m.copyOfEndCustomerList,i)),T(e,s)},function(e,s){return e.filter(function(e){for(var t=0;t<s.length;t++){var r=s[t].columnName,a=s[t].columnValue;if(!N(e,r,a))return!1}return!0})}),N=function(e,t,r){switch(innerFound=!1,t){case"end_customer":for(var a=0;a<r.length;a++)if("NA"==r[a]&&""==e[t]||e[t]==r[a])return innerFound=!0;break;case"created_on":case"modified_on":case"last_login":case"updated_on":if(r&&r[0])if(function(e,t){var r=(new Date).getTime(),a=864e5;switch(e){case"Last 24 Hrs":var s=new Date(r-a),o=new Date;break;case"Last Week":s=new Date(r-7*a),o=new Date;break;case"Last Month":s=new Date(r-30*a),o=new Date;break;case"Last 6 Month":s=new Date(r-180*a),o=new Date}e=moment(t,"YYYY-MM-DD HH:mm:ss").toDate();return!!moment(e).isBetween(s,o)}(r[0],e[t]))return innerFound=!0;break;case"status":for(a=0;a<r.length;a++)if(e.active&&"Active"==r[a]||!e.active&&"Inactive"==r[a])return innerFound=!0;break;case"user_type":for(a=0;a<r.length;a++)if(e.is_external&&"External"==r[a]||!e.is_external&&"Internal"==r[a])return innerFound=!0;break;case"serial_number":for(a=0;a<r.length;a++)if(e.serial_number&&-1<e.serial_number.indexOf(r[a]))return innerFound=!0;break;default:for(a=0;a<r.length;a++)if(e[t]==r[a])return innerFound=!0}},T=function(e,a){"userList"==e?(a.length||(m.tableParams.$params.page=f.getVal("page"),m.tableParams.reload()),m.tableParams=new p({count:f.getVal("count"),reload:m.tableParams,sorting:{first_name:"asc"}},{counts:[],total:a.length,getData:function(e,t){null==t.settings().$scope&&(t.settings().$scope=m);var r=m.searchUseronFilteredData(a),r=t.sorting()?h("orderBy")(r,t.orderBy()):r;m.data=r.slice((t.page()-1)*t.count(),t.page()*t.count()),t.total(r.length),e.resolve(m.data),r.length===f.getVal("count")&&(m.tableParams.$params.page=f.getVal("page"))}}),d(function(){m.tableParams.reload()})):(a.length||(m.endCustomerParams.$params.page=f.getVal("page"),m.endCustomerParams.reload()),m.endCustomerParams=new p({count:f.getVal("count"),reload:m.endCustomerParams,sorting:{endcustomer_name:"asc"}},{counts:[],total:a.length,getData:function(e,t){null==t.settings().$scope&&(t.settings().$scope=m);var r=m.searchEndCustomeronFilteredData(a),r=t.sorting()?h("orderBy")(r,t.orderBy()):r;m.endCustomerData=r.slice((t.page()-1)*t.count(),t.page()*t.count()),t.total(r.length),e.resolve(m.endCustomerData),r.length===f.getVal("count")&&(m.endCustomerParams.$params.page=f.getVal("page"))}}),d(function(){m.endCustomerParams.reload()}))},V=function(){m.selectAllEndCustomersAll=!1,m.selectAllEndCustomers.val=!1,m.selectedEndCustomerToRemove=!1,m.endCustomerData&&m.endCustomerData.map(function(e){e.selected=!1})},H=function(){m.selectAllAll=!1,m.selectAll=!1,m.selectedRemove=!1,m.data.length&&m.data.map(function(e){e.selected=!1})},W=function(){m.selectAllRoleAll=!1,m.selectAllRole=!1,m.selectedRemoveRole=!1,m.roleList.length&&m.roleList.map(function(e){e.selected=!1})};m.clearLocalFilter=function(e){var t,r;"userList"===e?(m.filterObj.userList,t=m.userFilterGroupedData,r=m.users,m.filterObj.userList=[],H()):(m.filterObj.endCustomerList,t=m.endCustomerFilterGroupedData,r=m.copyOfEndCustomerList,m.filterObj.endCustomerList=[],V()),t.map(function(e){if(e.appliedFilterCount=0,e.expand=!1,e.searchText="",Array.isArray(e.data))e.data.map(function(e){e.selected=!1});else for(var t in e.data)e.data[t].selected=!1}),T(e,r)},m.setProductToDelete=function(e,t){m.selectedProductToDelete="",m.productMPS=[],$("#deleteProductConfModal").modal("show"),m.selectedProductToDelete=e,m.productMPS=t},m.deleteProduct=function(){var e=m.associatedRoleProductList[m.selectedProductToDelete.name];if(e&&-1<e.indexOf(m.productMPS.mps.join(":"))||1==m.selectedProductToDelete.domains.length)return $("#deleteProductConfModal").modal("hide"),m.MsgModelHeader="Cannot Delete Product",m.MsgModelMessage=e&&-1<e.indexOf(m.productMPS.mps.join(":"))?"Selected Product cannot be deleted as it is already associated to one or more users! Please disassociate the user and try again.":"You cannot delete this product as this is the only product associated with the role "+m.selectedProductToDelete.DisName+".",m.data_loading=!1,void $("#msgModal").modal("show");g.deleteProduct(m.selectedProductToDelete.name,m.productMPS.mps).then(function(e){m.userTracking("Role","Delete Product",JSON.stringify(m.selectedProductToDelete)),$("#deleteProductConfModal").modal("hide"),m.MsgModelHeader="Delete Product",m.MsgModelMessage=e.data.Msg||"Product deleted.",$("#msgModal").modal("show")})},m.resetRoleFeatures=function(){var e=f.getVal("roleFeatures");m.roleFeatures=angular.copy(e),m.editroleFeatures=angular.copy(e),m.addProdroleFeatures=angular.copy(e),m.noFeatureWarning=!0},m.resetFilterExpanded=function(e){"user"===e?m.userFilterGroupedData.map(function(e){e.expand=!1}):m.endCustomerFilterGroupedData.map(function(e){e.expand=!1})}}]).controller("MessageCtrl",["$scope",function(e){}]),angular.module("gbAdminApp.filters",[]).filter("cut",[function(){return function(e,t,r,a){return e?!(r=parseInt(r,10))||e.length<=r?e:(e=e.substr(0,r),!t||-1!=(r=e.lastIndexOf(" "))&&(e=e.substr(0,r)),e+(a||"…")):""}}]).filter("arrayToString",function(){return function(e){return e.toString()}}),angular.module("gbAdminApp.directives",[]).directive("multiCheckboxContainer",function(){return{controller:function(){var o=[],n=[],l=null;this.addCheckbox=function(e,t){o.push(e),n.push(t)},this.onCheckboxClick=function(e,t){var r,a,s;if(t&&l)for(s=e.prop("checked"),t=o.indexOf(l),(r=o.indexOf(e))<t&&(t=(t+=r)-(r=t-r)),a=t;a<=r;a++)o[a].prop("checked",s),n[a].$setViewValue(s);l=e}}}}).directive("multiCheckbox",function(){return{restrict:"A",require:["^^multiCheckboxContainer","ngModel"],link:function(e,t,r,a){var s=a[0],a=a[1];s.addCheckbox(t,a),t.on("click",function(e){s.onCheckboxClick(t,e.shiftKey)})}}}).directive("ngEnter",function(){return function(t,e,r){e.bind("keydown keypress",function(e){13===e.which&&(t.$apply(function(){t.$eval(r.ngEnter)}),e.preventDefault())})}});