<div class="container-fluid padding-0" ng-controller="TestRuleCtrl" style="background-color: #fff">
    <div class="loading height-450" sly-show="info.pageLoading"></div>
    <div class="row-fluid" ng-hide="info.pageLoading">
        <div class="col-sm-12 padding-0">
            <div class="gb-rules-msg-block" ng-if="info.successMsg != '' || info.errorMsg != ''" gb-outside-click="clearMessage()">
                <div ng-if="info.successMsg != ''" class="alert alert-success padding-0 text-align-center margin-btm-0" ng-bind-html="renderHtml(info.successMsg)"></div>
                <div ng-if="info.errorMsg != ''" class="alert alert-danger padding-0 text-align-center margin-btm-0" ng-bind-html="renderHtml(info.errorMsg)"></div>
            </div>
        </div>
    </div>
    <div class="row-fluid" ng-hide="info.pageLoading">
        <div class="col-sm-12">
            <!-- <span title="Upload log file" class="display-block text-align-center font-size-10 font-weight-bold"><a ng-click="openUploadLogModal()">Upload Log</a></span> -->
            <!-- <form class="form-horizontal">
                <div class="form-group margin-btm-5">
                    <label for="inputSerial" class="col-sm-3 control-label font-size-10 font-weight-100">Account Name/Controller Serial</label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control" id="inputSerial" placeholder="Account Name/Controller Serial">
                    </div>
                </div>
            </form> -->
            <!-- <br> -->
            <!-- <span class="display-block text-align-center font-size-10 font-weight-bold">Please select the log below</span> -->
            <div class="gb-rules-logs-container border-ccc">
                <span class="display-block text-align-center font-size-10 padding-4 background-ccc font-weight-bold">
                    Last [{{info.maxBundlesCount}}] Log(s)
                    <!-- <a title="Refresh logs list"><span ng-click="loadAllStageBundles()" class="pull-right icon-loop2 font-size-12"></span></a> -->
                    </span>
                <div class="overflow-184-auto min-height-184">
                    <div ng-show="info.bundlesLoading" class="loading-small padding-top-0"></div>
                    <div ng-if="!info.bundlesList.length && !info.temporaryBundleData.length" ng-hide="info.bundlesLoading" class="text-align-center font-size-10">No records found</div>
                    <div ng-if="!!info.bundlesList.length || !!info.temporaryBundleData.length" class="font-size-10 gb-rules-log" ng-hide="info.bundlesLoading">
                        <table class="table table-hover gb-rules-test-history-table margin-btm-0">
                            <thead>
                                <tr class="color-gray">
                                    <th width="40">S. No.</th>
                                    <th>
                                        Bundle Name
                                    </th>
                                    <th>
                                        Rule(s) Selected
                                    </th>
                                    <th>
                                        <span ng-hide="!info.bundlesList.length">Upload Time</span>
                                    </th>
                                    <th width="100">
                                        Status
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-if="!!info.temporaryBundleData.length" class="height-30">
                                    <td>1</td>
                                    <td>
                                        <span class="color-red" ng-hide="info.temporaryBundleData[0].uploading == true || info.temporaryBundleData[0].processing == true"><b>Please use Upload Log link to upload</b></span>
                                        <span ng-if="info.temporaryBundleData[0].uploading == true || info.temporaryBundleData[0].processing == true" title="{{info.temporaryBundleData[0].bundle_name | bundleName}}">{{info.temporaryBundleData[0].bundle_name | bundleName | cut:false:35:'...'}}</span>
                                    </td>
                                    <td>
                                        <a ng-click="openRulesDetails()">{{info.selectedRules.length}}</a>
                                    </td>
                                    <td></td>
                                    <td>
                                        <a ng-if="info.temporaryBundleData[0].upload_log == true" title="Upload log file" ng-click="openUploadLogModal()">Upload Log</a>
                                        <span ng-if="info.temporaryBundleData[0].waiting == true" class="gb-rules-log-status"><span class="gb-rules-log-uploading"></span>Waiting to upload...</span>
                                        <span ng-if="info.temporaryBundleData[0].uploading == true" class="gb-rules-log-status"><span class="gb-rules-log-uploading"></span>Uploading...</span>
                                        <span ng-if="info.temporaryBundleData[0].processing == true" class="gb-rules-log-status"><span class="gb-rules-log-uploading"></span>Moving File...</span>
                                    </td>
                                </tr>
                                <tr ng-repeat="bundle in info.bundlesList | limitTo: info.maxBundlesCount track by $index" class="height-30" ng-class="{'gb-rules-selected-bundle': bundle.load_id == info.selectedBundleLoadId}">
                                    <td>{{!!info.temporaryBundleData.length ? ($index + 2) : ($index + 1)}}</td>
                                    <td>
                                        <span title="{{bundle.bundle_name | bundleName}}">{{bundle.bundle_name | bundleName | cut:false:35:'...'}}</span>
                                    </td>
                                    <td>
                                        <a ng-click="openRulesDetails(bundle.rule_id)">{{bundle.rule_id.split(',').length}}</a>
                                    </td>
                                    <td>
                                        <span><i>{{bundle.seen_ts}}</i></span>
                                    </td>
                                    <td> 
                                        <span ng-if="info.bundleStatus[bundle.bundle_state] == 'Processing'" class="gb-rules-log-status"><span class="gb-rules-log-uploading"></span>Waiting in queue...</span>
                                        <span ng-if="info.bundleStatus[bundle.bundle_state] == 'Parsing'" class="gb-rules-log-status"><span class="gb-rules-log-uploading"></span>Processing...</span>
                                        <span ng-if="info.bundleStatus[bundle.bundle_state] == 'Failed'" class="gb-rules-log-status">Failed</span>
                                        <a ng-if="info.bundleStatus[bundle.bundle_state] == 'Success'" ng-click="getBundleId(bundle)">View Results</a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- <div ng-show="info.bundlesLoading" class="loading-small"></div>
                    <div ng-if="!info.bundlesList.length" ng-hide="info.bundlesLoading" class="text-align-center font-size-10">No records found</div>
                    <div class="padding-left-right-15 font-size-10 gb-rules-log" ng-repeat="bundle in info.bundlesList | limitTo: info.maxBundlesCount track by $index" ng-hide="info.bundlesLoading">
                        <span title="{{bundle.bundle_name}}">{{bundle.bundle_name | bundleName}}</span>
                        <span class="margin-left-20 display-inline-block"><i>{{bundle.obs_ts}}</i></span>
                        <span class="pull-right"><a ng-click="viewTestResults(bundle)">Show Test Run</a></span>
                    </div> -->
                </div>
            </div>
            <div class="gb-rules-logs-container border-ccc">
                <span class="display-block text-align-center font-size-10 padding-4 background-ccc font-weight-bold">Test Results</span>
                <div class="font-size-10 overflow-184-auto min-height-184">
                    <div ng-show="info.testresultLoading" class="loading-small"></div>                          
                    <table class="table table-hover table-condensed" ng-hide="info.testresultLoading || info.testResultsList.length == 0">
                        <thead>
                            <tr>
                                <th ng-repeat="column in info.testGridColumnsList track by $index">{{column.title}}</th>
                                <th width="60px">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="test in info.testResultsList track by $index">
                                
                                <td ng-repeat="column in info.testGridColumnsList track by $index">
                                    <span ng-if="column.field != 'recommendation'">{{!test[column.field] ? '---' : test[column.field]}}</span>
                                    <span ng-if="column.field == 'recommendation' && !!test[column.field]" ng-bind-html="renderHtml(test[column.field])"></span>
                                    <span ng-if="column.field == 'recommendation' && !test[column.field]">---</span>
                                </td>
                                <td><a ng-if="test.texts.length > 0" class="gb-link" ng-click="showTestDetails(test)" title="Show Details">{{test.texts.length}}</a>
                                    <span ng-if="test.texts.length == 0">{{test.texts.length}}</span>
                                </td>                                     
                            </tr>
                        </tbody>
                    </table>
                    <div class="text-align-center font-size-10" ng-show="info.testResultsList.length == 0 && !info.testresultLoading">No results</div>
                </div>
            </div>
        </div>
    </div>
    <div class="row-fluid" ng-hide="info.pageLoading">
        <div class="col-sm-12">
            <div class="gb-rules-container-footer padding-top-3 height-32">
                <span class="pull-right">
                    <button type="button" class="btn-primary input-sm border-width-1 gb-rules-btn" ng-if="info.ruleTestSucceeded" ng-click="enableRule()">Enable</button>
                    <!-- <button type="button" class="btn-primary input-sm border-width-1 gb-rules-btn">Back</button> -->
                </span>
            </div>
        </div>
    </div>
</div>