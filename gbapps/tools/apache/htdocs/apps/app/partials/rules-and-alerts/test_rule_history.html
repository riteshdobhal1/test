<div class="container-fluid padding-0" ng-controller="TestRuleCtrl">
    <div class="page-loader-white-gb" ng-show="info.pageLoading">
        <div class="page-loader-body">
            <div class="rect rect1"></div>
            <div class="rect rect2"></div>
            <div class="rect rect3"></div>
            <div class="rect rect4"></div>
            <div class="rect rect5"></div>
        </div>
    </div>
    <div class="row-fluid" ng-hide="info.pageLoading">
        <div class="col-sm-12 padding-0">
            <div class="gb-rules-msg-block" ng-if="info.successMsg != '' || info.errorMsg != ''" gb-outside-click="clearMessage()">
                <div ng-if="info.successMsg != ''" class="alert alert-success padding-0 text-align-center margin-btm-0" ng-bind-html="renderHtml(info.successMsg)"></div>
                <div ng-if="info.errorMsg != ''" class="alert alert-danger padding-0 text-align-center margin-btm-0" ng-bind-html="renderHtml(info.errorMsg)"></div>
            </div>
        </div>
    </div>
    <div class="gb-rn-test-rules-cntr" ng-hide="info.pageLoading">
        <div class="gb-test-rules-toolpanel" ng-show="info.selectedRules.length">
            <div class="gb-test-rules-file-upload-panel gb-upload-local-log">
                <span>{{rulesconstants['UPLOAD_FRM_LOCAL']}}</span>
                <div class="gb-flex-center">
                   <!-- <img src="/apps/app/img/upload_icon.png" />  -->
                   <i class="fa fa-upload" style="font :normal normal normal 35px/1 FontAwesome !important "></i>
                </div>
                <span class="gb-rules-list-analyzer-btn gb-ra-test-upload-btn" title="Upload logs from your local machine" ng-click="openUploadLogModal()">Upload</span>
            </div>
            <div class="gb-test-rules-file-upload-panel gb-goto-logvault" ng-if="appCtrl.info.features['logvault']">
                <span>{{rulesconstants['UPLOAD_FROM']}} <strong>{{rulesconstants['LOG_VAULT']}}</strong></span>
                <div class="gb-flex-center">
                    <!-- <img src="/apps/app/img/logvault_icon.png" /> -->
                    <i class="fa fa-folder" style="font :normal normal normal 35px/1 FontAwesome !important "></i>
                </div>                
                <span class="gb-rules-list-analyzer-btn gb-ra-test-upload-btn"  title="Select log bundle from Log Vault"  ng-click="openLogvault()">Upload</span>
            </div>
            <div class="gb-test-rules-selected-file-panel">
                <div class="gb-test-rules-selected-table-overflow gb-custom_scroll-bar">
                    <table class="table table-hover table-condensed">
                        <thead>
                            <tr>
                                <th ng-repeat="column in info.testRuleHistoryColumns track by $index">
                                    {{column.title}}
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="rule in selectedRulesPagination.getData() track by $index">
                                <td ng-repeat="column in info.testRuleHistoryColumns track by $index"  title="{{rule[column.field]}}" >
                                    {{rule[column.field]}}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="gb-rules-table-footer">
                    <span class="page-count-list font-size-10"> Show
                        <div class="form-inline page-count-form">
                            <select class="input-xs page-count-box margin-left-0" ng-model="selectedRulesPagination.currentPageSize" ng-change="selectedRulesPagination.setPageSize(selectedRulesPagination.currentPageSize)">>
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="30">30</option>
                                <option value="40">40</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                        </div> 
                    </span>
                    <span class="gb-pagination gb-rules-pagination"> 
                        <a class="icon-previous2 pagination-icon" title="First Page" ng-click="selectedRulesPagination.first()" ng-class="{'pagination-icon-disabled': (selectedRulesPagination.getCurrentPage() <= 1)}"></a> 
                        <a class="icon-arrow-left7 pagination-icon" title="Previous Page" ng-click="selectedRulesPagination.prev()" ng-class="{'pagination-icon-disabled': (selectedRulesPagination.getCurrentPage() <= 1)}"></a> 
                        <pre class="gb-pagination-msg">{{selectedRulesPagination.getDisplayMsg()}}</pre>              
                        <a class="icon-arrow-right7 pagination-icon" title="Next Page" ng-click="selectedRulesPagination.next()" ng-class="{'pagination-icon-disabled': (selectedRulesPagination.getCurrentPage() >= selectedRulesPagination.getTotalPages())}"></a> 
                        <a class="icon-next2 pagination-icon" title="Last Page" ng-click="selectedRulesPagination.last()" ng-class="{'pagination-icon-disabled': (selectedRulesPagination.getCurrentPage() >= selectedRulesPagination.getTotalPages())}"></a> 
                    </span>             
                </div>
            </div>
        </div>
        <div class="gb-test-rules-history-panel">
            <div class="gb-rules-logs-container">
                <div class="gb-title">
                    {{rulesconstants['LAST']}} {{info.maxBundlesCount}} {{rulesconstants['TEST_RESULTS']}}
                </div>
                <div class="gb-ra-test-history-table-panel">
                    <div ng-show="info.bundlesLoading" class="loading-small padding-top-0"></div>
                    <div ng-if="!info.bundlesList.length && !info.temporaryBundleData.length" ng-hide="info.bundlesLoading" class="text-align-center font-size-10">{{rulesconstants['NO_RECORDS_FOUND']}}</div>
                    <div ng-if="!!info.bundlesList.length || !!info.temporaryBundleData.length" class="font-size-10" ng-hide="info.bundlesLoading">
                        <table class="table table-hover gb-rules-test-history-table">
                            <thead>
                                <tr>
                                    <th width="40">{{rulesconstants['SL_NO']}}</th>
                                    <th>
                                        {{rulesconstants['BUNDLE_NAME']}}
                                    </th>
                                    <th>
                                        {{rulesconstants['RULE_SELECTED']}}
                                    </th>
                                    <th>
                                        <span ng-hide="!info.bundlesList.length"> {{rulesconstants['UPLOAD_TIME']}}</span>
                                    </th>
                                    <th width="100">
                                        {{rulesconstants['STATUS']}}
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="height-30 gb-grid-expandable-row" ng-repeat-start="bundle in info.bundlesList | limitTo: info.maxBundlesCount track by $index" ng-class="{'gb-rules-selected-bundle': bundle.load_id == info.selectedBundleLoadId}">
                                    <td>{{$index + 1}}</td>
                                    <td title="{{bundle.bundle_name | bundleNameWithTimeStamp}}">{{bundle.bundle_name | bundleNameWithTimeStamp }}</td>
                                    <td><a ng-click="openRulesDetails(bundle.rule_id)">{{bundle.rule_id.split(',').length}}</a></td>
                                    <td><span><i>{{bundle.seen_ts | date: 'EEEE, dd MMM yyyy, hh:mm a' : 'UTC'}}</i></span></td>
                                    <td> 
                                        <span ng-if="info.bundleStatus[bundle.bundle_state] == 'Processing'" class="gb-rules-log-status"><span class="gb-rules-log-uploading"></span>{{rulesconstants['WAITING_IN_QUEUE']}}</span>
                                        <span ng-if="info.bundleStatus[bundle.bundle_state] == 'Parsing'" class="gb-rules-log-status"><span class="gb-rules-log-uploading"></span>{{rulesconstants['PROCESSING']}}</span>
                                        <span ng-if="info.bundleStatus[bundle.bundle_state] == 'Failed'" class="gb-rules-log-status">Failed</span>
                                        <a ng-if="info.bundleStatus[bundle.bundle_state] == 'Success'" ng-click="getBundleId(bundle)">{{rulesconstants['VIEW_RESULTS']}}</a>
                                    </td>
                                </tr>
                                <tr ng-repeat-end class="gb-no-hover" ng-show="bundle.expanded">
                                    <td></td>
                                    <td colspan="4" class="gb-ran-history-bundle-details">                                        
                                        <span class="display-block text-align-center font-size-10 padding-4 font-weight-bold">{{rulesconstants['TEST_RESULTS']}}</span>
                                        <div class="font-size-10 overflow-184-auto min-height-184">
                                            <div ng-show="info.testresultLoading" class="loading-small"></div>                          
                                            <table class="table table-hover table-condensed gb-sub-table" ng-hide="info.testresultLoading || info.testResultsList.length == 0">
                                                <thead>
                                                    <tr>
                                                        <th ng-repeat="column in info.testGridColumnsList track by $index" ng-if="!!column.title.length">{{column.title}}</th>
                                                        <th width="60px">Total</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr ng-repeat="test in info.testResultsList track by $index">
                                                        
                                                        <td ng-repeat="column in info.testGridColumnsList track by $index" ng-if="!!column.title.length">
                                                            <span ng-if="column.field != 'recommendation'">{{!test[column.field] ? '---' : test[column.field]}}</span>
                                                            <span ng-if="column.field == 'recommendation' && !!test[column.field]" ng-bind-html="renderHtml(test[column.field])"></span>
                                                            <span ng-if="column.field == 'recommendation' && !test[column.field]">---</span>
                                                        </td>
                                                        <td><a ng-if="test.texts.length > 0" class="gb-link" ng-click="showTestDetails(test)" title="Show Details">{{test.texts.length}}</a>
                                                            <span ng-if="test.texts.length == 0">{{test.texts.length}}</span>
                                                        </td>                                     
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <div class="text-align-center font-size-10" ng-show="info.testResultsList.length == 0 && !info.testresultLoading">{{rulesconstants['NO_RESULT']}}</div> 
                                            <div class="row-fluid" ng-hide="info.pageLoading">
                                                <div class="col-sm-12">
                                                    <div class="gb-rules-container-footer padding-top-3 height-32">
                                                        <span class="pull-right">
                                                            <button type="button" class="gb-primary-btn" ng-if="info.ruleTestSucceeded" ng-click="confirmEnablingRule()">Enable</button>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- <span class="gb-rules-list-analyzer-btn" class="btn-primary input-sm border-width-1 gb-rules-btn" ng-class="{'gb-disabled' : !info.ruleTestSucceeded}" ng-click="enableRule()">Enable</span> -->
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>