angular.module("gbApp.controllers",["gbApp","gbApp.services","gbApp.globals"]).controller("AppCtrl",["$rootScope","$scope","$localStorage","session","metaDataService","SectionsMetaService","MenuService","AppService","NavigationService","ErrorService","$cookieStore","$cookies","$location","GlobalService","$sce","$timeout","ModalService","InstanceHandler","FileUploader","UserTrackingService","DefaultFilterService","$filter","WorkbenchService","$window","$interval","$modal","$controller","ExplorerService","LogVaultService","ConfigDiffService","RulesService",function($rootScope,$scope,$localStorage,session,metaDataService,SectionsMetaService,MenuService,AppService,NavigationService,ErrorService,$cookieStore,$cookies,$location,GlobalService,$sce,$timeout,ModalService,InstanceHandler,FileUploader,UserTrackingService,DefaultFilterService,$filter,WorkbenchService,$window,$interval,$modal,$controller,ExplorerService,LogVaultService,ConfigDiffService,RulesService){var appCtrl=this,milliseconds=(appCtrl.info={},appCtrl.info.currentToken="",appCtrl.updateUserSuccessLogin=function(){AppService.updateUserSuccessLogin().then(function(e){console.log(e)})},appCtrl.addPushToken=function(){var e;console.log(Notification.permission),appCtrl.info.currentToken.length&&(e={username:metaDataService.getUserEmail(),device_token:appCtrl.info.currentToken,app_type:1,app_id:""},console.log(e),AppService.addPushToken(e).then(function(e){console.log(e)}))},appCtrl.removePushToken=function(){var e;console.log(Notification.permission),appCtrl.info.currentToken.length&&(e={username:metaDataService.getUserEmail(),device_token:appCtrl.info.currentToken,app_type:1,app_id:""},console.log(e),AppService.removePushToken(e).then(function(e){console.log(e)}))},"permissions"in navigator&&navigator.permissions.query({name:"notifications"}).then(function(e){e.onchange=function(){console.log("User decided to change his settings. New permission: "+e.state),"granted"==e.state?appCtrl.addPushToken():"denied"!=e.state&&"prompt"!=e.state||appCtrl.removePushToken()}}),(new Date).getTime());appCtrl.noSummaryDashboardMsg=GlobalService.getVal("noSummaryDashboardMsg"),session.then(function(){var modalInstance;function loadDefaultProduct(){angular.forEach(appCtrl.domainList,function(e,t){t==appCtrl.defaultProduct&&appCtrl.changeProduct(e,t)})}GlobalService.getVal("invalidProjectLoaded")&&(modalInstance=ModalService.alertBox({msgKey:"gbstudio_invalid_project"}),modalInstance.result.then(function(e){loadDefaultProduct()},function(e){loadDefaultProduct()})),GlobalService.getVal("projectListMsg")&&ModalService.alertBox({msgKey:"projectListMsg"}),appCtrl.showHelpModal=function(e){$localStorage.hideModal?delete $localStorage.hideModal:$modal.open({templateUrl:"partials/show_info_modal.html",windowClass:"show-info-modal",backdrop:"static",controller:"ShowInfoController as showInfoCtrl",resolve:{showCheckbox:function(){return e}}})};var domainMetaObj=metaDataService.getDomain(),featureMetaObj=metaDataService.getFeatures(),userMetaObj=metaDataService.getUser(),infoserverDomain=GlobalService.getVal("infoserverDomain"),manufacturer=(appCtrl.showGlobalNotification=!1,appCtrl.showGlobalNotificationMsg=GlobalService.getVal("apiCallCancelMsg"),GlobalService.getVal("manufacturer")),product=GlobalService.getVal("product"),schema=GlobalService.getVal("schema"),dserialNumber,dserialNumber,feedbackButtonEnabled=($location.absUrl().match(/serialNumber=(.*)/)&&(dserialNumber=$location.absUrl().match(/serialNumber=(.*)/)[1],dserialNumber=unescape(dserialNumber),GlobalService.setSessionCookies("serialNumber="+dserialNumber)),!!GlobalService.getVal("feedbackButtonEnabled")),msg,domain=(appCtrl.info.hideWorkbench=!1,appCtrl.info.loaded=!1,appCtrl.domainList={},appCtrl.projectsList={},appCtrl.info.showStudio=GlobalService.getVal("showStudio"),appCtrl.info.showLogStatus=GlobalService.getVal("logstatusEnabled"),appCtrl.currentDomain=GlobalService.getVal("primaryDomain"),appCtrl.currentDomainFullName=$location.host(),appCtrl.gbHelpManualLink=GlobalService.getVal("help_link_2"),appCtrl.appsVersion=GlobalService.getVal("appsVersion"),appCtrl.info.mdvizFullIframe=!0,appCtrl.info.explorerDataRestriction=metaDataService.getExplorerDataDuration(),appCtrl.info.explorerDataRestrictionMsg="",appCtrl.hideInfoPanel=function(){return 0<GlobalService.gbAPI.length},""!==appCtrl.info.explorerDataRestriction&&(msg=GlobalService.getVal("data_restriction_msg"),appCtrl.info.explorerDataRestrictionMsg=msg.replace("${val}",appCtrl.info.explorerDataRestriction)),null===GlobalService.getVal("feature_label")||""===GlobalService.getVal("feature_label")||0===GlobalService.getVal("feature_label").length||""===GlobalService.getVal("feature_label")[0]||"NA"===GlobalService.getVal("feature_label")[0]?appCtrl.nav={navExplorer:GlobalService.getVal("navExplorer"),navApps:GlobalService.getVal("navApps"),navWorkbench:GlobalService.getVal("navWorkbench"),navSupport:GlobalService.getVal("navSupport"),navHealth:GlobalService.getVal("navHealth"),navDashboards:GlobalService.getVal("navDashboards"),navRules:GlobalService.getVal("navRules"),navLog:GlobalService.getVal("navLog"),navUpload:GlobalService.getVal("navUpload"),mdViz:GlobalService.getVal("mdViz")}:appCtrl.nav={navExplorer:GlobalService.getVal("feature_label")[0],navApps:GlobalService.getVal("navApps"),navWorkbench:GlobalService.getVal("feature_label")[1],navSupport:GlobalService.getVal("navSupport"),navHealth:GlobalService.getVal("feature_label")[2],navDashboards:GlobalService.getVal("feature_label")[3],navRules:GlobalService.getVal("feature_label")[4],navLog:GlobalService.getVal("feature_label")[5],navUpload:GlobalService.getVal("feature_label")[6],mdViz:GlobalService.getVal("mdViz")},appCtrl.info.showFeedback=!1,feedbackButtonEnabled&&(appCtrl.info.feedbackPluginOptions={ajaxURL:infoserverDomain+"/feedback/"+manufacturer+"/"+product+"/"+schema,html2canvasURL:GlobalService.getVal("html2canvasUrl"),initialBox:!0,postHTML:!1,initButtonText:"Feedback",feedbackButton:".feedback-button","tpl.description":"<div id='feedback-welcome' class='card'>                                 <div class='card-title input-field'>                                     <i class='material-icons left prefix feedback-icon'>feedback</i>                                     <div class='prefixed-header'>Feedback</div>                                 </div>                                 <p>Help us improve Glassbeam Studio by reporting issues, providing new feature ideas and/or suggestions to make your experience better.</p>                                 <textarea id='feedback-note-tmp' placeholder='Please add a description to your feedback'></textarea>                                 <p>Next, please help us identify areas of the page related to your description.</p>                                 <button id='feedback-welcome-next' class='btn-flat feedback-next-btn feedback-btn-gray' type='button'>Next</button>                                 <div id='feedback-welcome-error'>Please enter a description.</div>                                 <div class='feedback-wizard-close'>                                     <i class='material-icons waves-effect waves-red'>close</i>                                 </div>                             </div>","tpl.highlighter":"<div id='feedback-highlighter' class='card'>                                 <div class='card-title input-field'>                                     <i class='material-icons left prefix feedback-icon'>feedback</i>                                     <div class='prefixed-header'>Feedback</div>                                 </div>                                 <p>Please use the 'HIGHLIGHT' and 'BLACKOUT' tools to help us focus on the feature you would like to report.</p>                                 <p>You can drag this dialog box if it overlaps an area you want to focus/hide.</p>                                 <button class='btn waves-effect feedback-sethighlight feedback-active' type='button'>                                     <i class='material-icons left'>highlight</i>                                     <span>Highlight</span>                                 </button>                                 <label class='passive-text'>Highlight areas relevant to your feedback.</label>                                 <button class='btn waves-effect waves-light feedback-setblackout' type='button'>                                     <i class='material-icons left'>content_cut</i>                                     <span>Blackout</span>                                 </button>                                 <label class='passive-text lower'>Black out any personal information.</label>                                 <div class='feedback-buttons'>                                     <button id='feedback-highlighter-next' class='btn-flat feedback-next-btn feedback-btn-gray' type='button'>Next</button>                                     <button id='feedback-highlighter-back' class='btn-flat feedback-back-btn feedback-btn-gray left' type='button'>Back</button>                                 </div>                                 <div class='feedback-wizard-close'>                                     <i class='material-icons waves-effect waves-red'>close</i>                                 </div>                             </div>","tpl.overview":"<div id='feedback-overview' class='card'>                                 <div class='card-title input-field'>                                     <i class='material-icons left prefix feedback-icon'>feedback</i>                                     <div class='prefixed-header'>Feedback Overview</div>                                 </div>                                 <div id='feedback-overview-description'>                                     <div id='feedback-overview-description-text'>                                         <h3>Description</h3>                                     </div>                                 </div>                                 <div id='feedback-overview-screenshot'>                                     <h3>Screenshot</h3>                                 </div>                                 <div class='feedback-buttons'>                                     <button id='feedback-submit' class='btn-flat feedback-submit-btn feedback-btn-blue' type='button'>Submit</button>                                     <button id='feedback-overview-back' class='btn-flat feedback-back-btn feedback-btn-gray left' type='button'>Back</button>                                 </div>                                 <div id='feedback-overview-error'>Please enter a description.</div>                                 <div class='feedback-wizard-close'>                                     <i class='material-icons waves-effect waves-red'>close</i>                                 </div>                             </div>","tpl.submitSuccess":"<div id='feedback-submit-success' class='card'>                                 <div class='card-title input-field'>                                     <i class='material-icons left prefix feedback-icon'>feedback</i>                                     <div class='prefixed-header'>Feedback</div>                                 </div>                                     <p>Thank you for your feedback.</p>                                     <p>Please know that we appreciate your effort in helping us improve the application.</p>                                     <button class='btn-flat feedback-close-btn feedback-btn-gray' type='button'>OK</button>                                     <div class='feedback-wizard-close'>                                         <i class='material-icons waves-effect waves-red'>close</i>                                     </div>                                 </div>","tpl.submitError":"<div id='feedback-submit-error' class='card'>                                 <div class='card-title input-field'>                                     <i class='material-icons left prefix feedback-icon'>feedback</i>                                     <div class='prefixed-header'>Feedback</div>                                 </div>                                 <p>Sadly an error occured while sending your feedback. Please try again.</p>                                 <button class='btn-flat feedback-close-btn feedback-btn-gray' type='button'>OK</button>                                 <div class='feedback-wizard-close'>                                     <i class='material-icons waves-effect waves-red'>close</i>                                 </div>                             </div>"},$timeout(function(){appCtrl.info.showFeedback=!0},200)),appCtrl.hideLeftNav=!1,$scope.firstTimeLoading=!1,appCtrl.info.mps=manufacturer+"/"+product+"/"+schema,appCtrl.info.manufacturer=manufacturer,appCtrl.info.greeting="Welcome ",$cookies.loginurl?appCtrl.info.logoutLink=$cookies.loginurl:appCtrl.info.logoutLink=GlobalService.getVal("session_redirect_url"),GlobalService.getVal("primaryDomain")),cookieLogoutUrl,cookieLogoutUrl=metaDataService.getSsoUser()?metaDataService.getSsoLogoutUrl()?metaDataService.getSsoLogoutUrl():GlobalService.getVal("session_redirect_url").replace(/\?.*/,""):appCtrl.info.logoutLink.replace(/\?.*/,""),landingPage=document.location.href.split("&"),landingPageUrl=landingPage[0],val=(document.cookie="logouturl="+cookieLogoutUrl+";domain="+domain+";path=/",document.cookie="landingPageUrl="+landingPageUrl+";domain="+domain+";path=/",document.cookie="adminAddUserDefUrl="+window.location.pathname.replace("/",""),0==$cookies.globalLogin?appCtrl.info.helpLink=GlobalService.getVal("help_link_local"):appCtrl.info.helpLink=GlobalService.getVal("help_link_global"),appCtrl.info.user=metaDataService.getUserEmail(),appCtrl.info.userName=metaDataService.getUserName(),appCtrl.info.is_external=metaDataService.getUserType(),appCtrl.info.is_external&&(document.cookie="sessionRedirectUrl="+GlobalService.getVal("session_redirect_url")+";domain="+domain+";path=/"),appCtrl.info.external_logo="/apps/app/img/"+metaDataService.getLogo(),appCtrl.info.external_logourl="https://"+metaDataService.getlogourl(),metaDataService.getInternalLogo()),userInfo=(document.cookie="internal_logo="+val+";domain="+domain+";path=/",val&&"NA"!==val?(appCtrl.info.showPoweredBy=!0,appCtrl.info.internal_logo="/apps/app/img/"+metaDataService.getInternalLogo()):(appCtrl.info.showPoweredBy=!1,appCtrl.info.internal_logo="/apps/app/img/glassbeam.png"),appCtrl.info.ssoUser=metaDataService.getSsoUser(),appCtrl.info.infoserverDomain=infoserverDomain,appCtrl.info.userOrg=metaDataService.getUserOrg(),infoserverDomain=appCtrl.info.infoserverDomain,appCtrl.info.complete=!1,appCtrl.info.dashboards_url=GlobalService.getVal("dashboards"),appCtrl.info.analytics_url=GlobalService.getVal("analytics"),appCtrl.info.health_check_dashboards_url=GlobalService.getVal("health_check_dashboards"),appCtrl.info.features=metaDataService.getFeatures(),metaDataService.getUser()),loadPage=(appCtrl.info.powerUser=!!appCtrl.info.features.admin,appCtrl.info.loaded=!0,metaDataService.getDefaultFeature()),freshLanding=(document.cookie="default_feature="+loadPage+";domain="+domain+";path=/",!0),username=userInfo.email,urlParams,mps,username=username?username.toLowerCase():"",firstLoad=(appCtrl.info.ssoUser&&(urlParams=new URLSearchParams(window.location.search),mps=urlParams.get("mps"),$cookies.mps||(document.cookie="mps="+mps+";domain="+domain+";path=/")),1==userInfo.show_info&&appCtrl.showHelpModal(!0),document.cookie="username="+username+";domain="+domain+";path=/",!appCtrl.info.features.workbench||"NA"!=userInfo.wb_user_name&&userInfo.wb_user_name||"workbench"===loadPage&&(loadPage="dashboards"),AppService.hideWorkbenchTab()&&(appCtrl.info.hideWorkbench=!0,"workbench"===loadPage&&(loadPage="dashboards")),appCtrl.info.features.workbench&&(GlobalService.getVal("createDataSourcePemission")?document.cookie="createDataSource=1;domain="+domain+";path=/":document.cookie="createDataSource=0;domain="+domain+";path=/",document.cookie="gb_hide_options=1;domain="+domain+";path=/",userInfo.email!==WorkbenchService.getTableauUser()&&"glassbeam"!==userInfo.role?document.cookie="show_tableau_save_options=0;domain=."+domain+";path=/":document.cookie="show_tableau_save_options=1;domain=."+domain+";path=/"),$window.updateLogiTracking=function(){UserTrackingService.standard_user_tracking("application",appCtrl.nav.navDashboards,"logi_tracking",JSON.stringify({details:"logi"})).then(handleLogPortalSuccess,handleLogPortalError)},$window.tableauUserTracking=function(){UserTrackingService.standard_user_tracking("application",appCtrl.nav.navDashboards,"tableau_tracking",JSON.stringify({details:"tableau"})).then(handleLogPortalSuccess,handleLogPortalError)},$window.scratchpadUserTracking=function(){UserTrackingService.standard_user_tracking("application","scratchpad","scratchpad_tracking",JSON.stringify({details:"scratchpad"})).then(handleLogPortalSuccess,handleLogPortalError)},$window.resizeIframeHeight=function(e){appCtrl.info.mdvizFullIframe=!1,$(window.top.document).find("#gb-mdviz-iframe").height(e+"px")},$window.notificationClick=function(e){console.log(e)},!0),tabview=($window.moveToApplication=function(e){var t;"rules_and_alerts"==e.app?(InstanceHandler.setVisible(!1),$scope.$broadcast("bundleListFromLogVault"),appCtrl.changeCurrentPage(e.app,null,!0)):"logvault"==e.app?(LogVaultService.setLoadView(e),InstanceHandler.setVisible(!1),appCtrl.changeCurrentPage(e.app,null,!0)):"explorer"==e.app?(ExplorerService.setLoadView(e),InstanceHandler.setVisible(!1),appCtrl.changeCurrentPage(e.app,null,!0)):"apps"==e.app&&(t={obs_url:e.observation,namespace_id:$filter("bundleName")(e.observation)+"-0",serial_num:e.sysid1,obs_date:e.obs_date},e.bundle_type&&(t.bundle_type=e.bundle_type),t={type:"apps",title:"View section/config diff",name:$filter("bundleName")(t.obs_url),module:getApplicationForTracking("dashboards"),data:{result:t,bundle:$filter("bundleName")(t.obs_url),sysId:e.sysid1,sysId2:e.sysid2,observation:t.obs_date}},"savedView"==e.type&&(t.data.view=e.view),InstanceHandler.addInstance(t))},$scope.isFeatureEnable=function(e){return appCtrl.info.features[e]},$scope.getQueryVariable=function(e){for(var t=$window.location.search.substring(1).split("&"),a=0;a<t.length;a++){var n=t[a].split("=");if(decodeURIComponent(n[0])==decodeURIComponent(e))return decodeURIComponent(n[1])}},$scope.getQueryLocalstorage=function(e,t){for(var a=e.split("&"),n=0;n<a.length;n++){var i=a[n].split("=");if(decodeURIComponent(i[0])==decodeURIComponent(t))return decodeURIComponent(i[1])}},$localStorage.tabview),searchView=$scope.getQueryVariable("Log Bundle"),loadPage,freshLanding,selsysid,defaultSysId,selobservation,selectedObservation,selobsgroup,selendcustomer,tabType,defaultObservation,bundleData,module,module;function getApplicationForTracking(e){e="logvault"==e||"apps"==e?appCtrl.nav.navLog:"explorer"==e?appCtrl.nav.navExplorer:"rules_and_alerts"==e?appCtrl.nav.navRules:"dashboards"==e?appCtrl.nav.navDashboards:"healthcheck"==e?appCtrl.nav.navHealth:"workbench"==e?appCtrl.nav.navWorkbench:"file_upload"==e?appCtrl.nav.navUpload:e;return e}function handleLogPortalSuccess(){}function handleLogPortalError(e){!appCtrl.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(appCtrl.info.sessionTimedOut=!0,ModalService.sessionTimeout())}function handleLogoutInfoserver(){for(var e,t=document.cookie.split(";"),a=[],n=1;n<=t.length;n++)e=(e=t[n-1].split("=")[0]).trim(),a.push(e);for(n=0;n<a.length;n++)e=a[n],document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;domain="+appCtrl.currentDomain+";path=/";$localStorage.$reset();GlobalService.getVal("umsDomain").replace("/v1","");$window.location.href=cookieLogoutUrl}tabview?(loadPage="apps",freshLanding=!1,selsysid=$scope.getQueryLocalstorage(tabview,"selsysid"),defaultSysId=eval("("+selsysid+")"),DefaultFilterService.setDefaultSysId(defaultSysId),selobservation=$scope.getQueryLocalstorage(tabview,"selobservation"),selectedObservation=eval("("+selobservation+")"),DefaultFilterService.setSelectedObservation(selectedObservation),selobsgroup=$scope.getQueryLocalstorage(tabview,"selobsgroup"),DefaultFilterService.setSelectedObsGrp(selobsgroup),selendcustomer=$scope.getQueryLocalstorage(tabview,"selendcustomer"),DefaultFilterService.setDefaultEndCust(eval("("+selendcustomer+")")),tabType=$scope.getQueryLocalstorage(tabview,"tabview"),"config"===tabType?(GlobalService.setVal("default_landing_label","Config Diff"),GlobalService.setVal("default_landing_page","configdiff")):(GlobalService.setVal("default_landing_label","Section View"),GlobalService.setVal("default_landing_page","sectionview")),defaultObservation=defaultSysId.observations[0],DefaultFilterService.setDefaultObservation(defaultObservation),$localStorage.$reset()):searchView&&(loadPage="explorer",freshLanding=!1,bundleData={},bundleData["Log Bundle"]=searchView,bundleData.bundlename=$scope.getQueryVariable("bundlename"),bundleData.bundle_id=$scope.getQueryVariable("bundle_id"),ExplorerService.setBundleData(bundleData)),$scope.$on("changePageEvent",function(e,t){appCtrl.changeCurrentPage(t,null,!0)}),appCtrl.changeCurrentPage=function(e,t,a){var n,i=GlobalService.getVal("primaryDomain");document.cookie="currentApp="+e+";domain="+i+";path=/","true"==sessionStorage.getItem("dash_mode")&&(null!=metaDataService.getFeatures().dashboards&&1==metaDataService.getFeatures().dashboards?e="dashboards":(sessionStorage.setItem("dash_mode","false"),n=GlobalService.getVal("dashmodeadminemail"),ModalService.alertBox({msg:'Error! You do not have access to dashboard page. Please contact <a href="mailto:'+n+'">'+n+"</a>."}))),"true"==sessionStorage.getItem("clin_mode")&&(null!=metaDataService.getFeatures().healthcheck&&1==metaDataService.getFeatures().healthcheck?e="healthcheck":(sessionStorage.setItem("clin_mode","false"),n=GlobalService.getVal("dashmodeadminemail"),ModalService.alertBox({msg:'Error! You do not have access to healthcheck page. Please contact <a href="mailto:'+n+'">'+n+"</a>."}))),metaDataService.setCurrentPage(e),t?(a=!0,!t.page||"section"==t.page?DefaultFilterService.setLoadPage("sectionview"):"config"==t.page&&DefaultFilterService.setLoadPage("configdiff"),DefaultFilterService.setLoadSysId(t.sysid),DefaultFilterService.setLoadObservation(t.obs_url),DefaultFilterService.setSelectedObsGrp("Last N"),NavigationService.setUrl(GlobalService.getVal("default_landing_label")),MenuService.getAppsLoaded()&&(!t.page||"section"==t.page?(NavigationService.setUrl("sectionview"),MenuService.setCurrentLabel("Section View")):"config"==t.page&&(NavigationService.setUrl("configdiff"),MenuService.setCurrentLabel("Config Diff"))),SectionsMetaService.setReady(!1),i={"System ID":t.sysid,"Bundle Name":$filter("bundleName")(t.obs_url)},UserTrackingService.standard_user_tracking(getApplicationForTracking("logvault"),getApplicationForTracking("logvault"),"Switch to "+getApplicationForTracking("apps"),JSON.stringify(i)).then(handleLogPortalSuccess,handleLogPortalError)):freshLanding||(ExplorerService.getBundleData()?UserTrackingService.standard_user_tracking(getApplicationForTracking("logvault"),getApplicationForTracking("logvault"),"Switch to "+getApplicationForTracking("explorer"),JSON.stringify(ExplorerService.getBundleData())):UserTrackingService.standard_user_tracking(getApplicationForTracking(e),getApplicationForTracking(e),"landing",JSON.stringify({}))).then(handleLogPortalSuccess,handleLogPortalError),appCtrl.info.current=e,angular.element(document.getElementById("gb-tab-loader")).css("display","block"),angular.element(document.getElementById("gb-tab-cntr")).css("display","none"),$scope.$broadcast("AppLoadEvent-"+e,a)},appCtrl.showUpload=function(){ErrorService.clearErrors("fileupload"),UserTrackingService.getAllConfig().then(function(e){userInfo.is_external?(AppService.setFileUploadData(e.data.Data.file_upload_config),appCtrl.changeCurrentPage("file_upload")):$modal.open({templateUrl:"partials/upload_popup.html",windowClass:!1,backdrop:"static",controller:"FileUploadController as fileUploadCtrl",resolve:{fileUploadData:function(){return e.data.Data.file_upload_config}}}),UserTrackingService.standard_user_tracking(appCtrl.nav.navUpload,appCtrl.nav.navUpload,"View","{''}").then(handleLogPortalSuccess,handleLogPortalError)},handleLogPortalError)},appCtrl.showScratchpad=function(){appCtrl.info.mdvizFullIframe=!0,metaDataService.setCurrentPage("scratchpad"),appCtrl.info.current="scratchpad"},appCtrl.reloadIframe=function(){document.getElementById("gb-mdviz-iframe").src="./MDViz/index.html",appCtrl.info.mdvizFullIframe=!0},"file_upload"==loadPage?appCtrl.showUpload():appCtrl.changeCurrentPage(loadPage),freshLanding&&(module="",module="apps"==loadPage?GlobalService.getVal("default_landing_label"):"rules_and_alerts"==loadPage?"Rules list":getApplicationForTracking(loadPage),delete $cookies.prevApplication,freshLanding=!1,UserTrackingService.standard_user_tracking(getApplicationForTracking(loadPage),module,"Default landing","{''}").then(handleLogPortalSuccess,handleLogPortalError)),GlobalService.setVal("features",appCtrl.info.features),appCtrl.info.complete=!0,appCtrl.info.sessionTimedOut=!1,appCtrl.showHelp=function(){var e=!1;return e="explorer"!==appCtrl.info.current&&"apps"!==appCtrl.info.current&&"dashboards"!==appCtrl.info.current&&"logvault"!==appCtrl.info.current?e:!0},appCtrl.logShowHelp=function(){UserTrackingService.standard_user_tracking(getApplicationForTracking(appCtrl.info.current),getApplicationForTracking(appCtrl.info.current),"Show help","{}").then(handleLogPortalSuccess,handleLogPortalError)},AppService.setAuthorized(!0),AppService.setInfoServerUp(!0),appCtrl.complete=!0,appCtrl.dashboards_url=GlobalService.getVal("dashboards"),appCtrl.analytics_url=GlobalService.getVal("analytics"),AppService.getUserDomain(userInfo.role).then(function(e){if(e.data.Data){var t,a=e.data.Data.domains,n={},a=(angular.forEach(a,function(e,t){t.length&&"-"!=t&&(n[t]=e)}),appCtrl.domainsCount=Object.keys(n).length,e.data.Data.mps_uidomain);for(t in n){var i=n[t];appCtrl.info.mps!=i||AppService.isGbStudioApp()||(appCtrl.currentProduct=t),userInfo.mps_def==i&&(appCtrl.defaultProduct=t)}appCtrl.domainList=n,appCtrl.realm_mps=a}},function(e){appCtrl.domainList=[],appCtrl.realm_mps=""}),GlobalService.getVal("showStudio")&&(appCtrl.projectsList=GlobalService.getVal("projectsList"),angular.forEach(appCtrl.projectsList,function(e,t){AppService.isGbStudioApp()&&t==GlobalService.getVal("projectname")&&(appCtrl.currentProduct=t)})),appCtrl.showMultipleDomainList=function(){var e=Object.keys(appCtrl.domainList)||[],t=Object.keys(appCtrl.projectsList)||[];return 0<e.length+t.length},appCtrl.changeProduct=function(e,t){var t=appCtrl.realm_mps[e],a=$location.absUrl();appCtrl.info.ssoUser&&(a=$location.absUrl().replace(/\?.*/,"")),e&&(document.cookie="mps="+e+";domain="+appCtrl.currentDomain+";path=/",userInfo.show_info&&($localStorage.hideModal=!0),UserTrackingService.standard_user_tracking(getApplicationForTracking(appCtrl.info.current),getApplicationForTracking(appCtrl.info.current),"Switch product",JSON.stringify({URL:t,MPS:e})).then(handleLogPortalSuccess,handleLogPortalError),$timeout(function(){appCtrl.info.ssoUser?$window.open(a.replace($location.host(),t)+"?mps="+e,"_self"):$window.open(a.replace($location.host(),t),"_self")},200))},appCtrl.changeProject=function(e,t){$location.absUrl().replace(/\?.*/,"");var a=$location.absUrl().replace(/\?.*/,"")+"?mps="+e+"&projectname="+t;e&&$timeout(function(){$window.open(a.replace($location.host(),GlobalService.getVal("role_details").mps_uidomain[GlobalService.getVal("gb_studio_apps_realm")]),"_self")},200)},appCtrl.trackFeedback=function(){UserTrackingService.standard_user_tracking(getApplicationForTracking(appCtrl.info.current),getApplicationForTracking(appCtrl.info.current),"Feedback",JSON.stringify({})).then(handleLogPortalSuccess,handleLogPortalError)},appCtrl.setDefaultDomain=function(e,t){var a=appCtrl.realm_mps[e],n=(n=$window.location.pathname).replace(/^\//,"");AppService.setDefaultDomain({realm_def:a,url_def:n,mps_def:e}).then(function(e){ModalService.alertBox({msg:"Default domain set as '"+t+"'"}),appCtrl.defaultProduct=t},function(e){ModalService.alertBox({msg:"Failed!"})})},appCtrl.logoutUser=function(){localStorage.clear(),AppService.logoutInfoserver(getApplicationForTracking(appCtrl.info.current)).then(handleLogoutInfoserver,handleLogoutInfoserver)},$scope.renderHtml=function(e){return $sce.trustAsHtml(e)},appCtrl.getValue=function(e){return GlobalService.getVal(e)},appCtrl.getURL=function(e){return appCtrl.info.current!=e||appCtrl.info[e]||(appCtrl.info[e]=GlobalService.getVal(e)),appCtrl.info[e]},appCtrl.instanceViewerFullscreen=function(){return InstanceHandler.isVisible()},appCtrl.isThereInstanceViewer=function(){return InstanceHandler.getNumberOfInstances()},appCtrl.changePassword=function(){$modal.open({templateUrl:"partials/changepassword.html",controller:"ChangePasswordCtrl as changePswdCtrl",resolve:{application:function(){return getApplicationForTracking(appCtrl.info.current)}}})},appCtrl.loadGBStudio=function(){GlobalService.getVal("studioDown")?(GlobalService.logError(Object.values(GlobalService.getVal("errorMsgs"))[5]),ModalService.alertBox({msgKey:"studio_down_message"})):$window.open(GlobalService.getVal("gb_studio_protocol")+"://"+GlobalService.getVal("studioSPLURL"),"gbstudio_tab")},appCtrl.loadAdminConsole=function(){var e=GlobalService.getVal("umsDomain").replace("/v1","");document.cookie="adminClick=1;domain="+domain+";path=/",$window.open(e)},appCtrl.loadLogStatusConsole=function(){$window.open(GlobalService.getVal("logStatusUrl")+"?"+milliseconds,"logstatus_tab")},appCtrl.createRuleFromText=function(){InstanceHandler.setVisible(!1),RulesService.loadExplorerRules(),appCtrl.changeCurrentPage("rules_and_alerts")},$interval(function(){AppService.getRequestFromApps()&&(appCtrl.createRuleFromText(),AppService.setRequestFromApps(!1))},1e3),$scope.createRuleFromExplorer=function(){appCtrl.createRuleFromText()},appCtrl.APICallWait=function(){GlobalService.APICallWait()},appCtrl.cancelHTTPCall=function(){GlobalService.APICallCancel(),appCtrl.showGlobalNotification=!0},appCtrl.closeGlobalNotification=function(){appCtrl.showGlobalNotification=!1},appCtrl.openSystemInfoPopup=function(){$modal.open({templateUrl:"partials/systemInfo.html",controller:"SystemInfoCtrl",resolve:{application:function(){return getApplicationForTracking(appCtrl.info.current)}},size:"lg",backdrop:"static"})},"true"!=sessionStorage.getItem("dash_mode")&&(document.getElementById("gb-full-page-loader").style.display="none"),document.body.className=document.body.className.replace("gb-bg-trasparent",""),document.getElementById("gb-apps-body").style.display="block",$scope.enableContextualHelp=!1,$scope.loadHelpContent=function(){$scope.enableContextualHelp=!$scope.enableContextualHelp,$scope.enableContextualHelp?gbInlineHelp.showContextualIcon():gbInlineHelp.hideContextualIcon()};var rules_and_alerts_templates_inline_help=["rules_list","add_rule","add_edit_template","add_edit_API_template","api_admin_config"],swRegistration,messaging;$scope.$on("$includeContentLoaded",function(e,t){t=t.split("/"),t=t[t.length-1].split(".")[0];0<=rules_and_alerts_templates_inline_help.indexOf(t)&&$scope.enableContextualHelp?$timeout(function(){gbInlineHelp.resetRulesInlineHelp(),gbInlineHelp.showContextualIcon()}):$timeout(function(){$scope.enableContextualHelp&&gbInlineHelp.showContextualIcon()})}),appCtrl.info.currentToken="","serviceWorker"in navigator&&"PushManager"in window?(swRegistration=null,firebase.initializeApp(metaDataService.getFirebaseConfig().firebaseConfig),messaging=firebase.messaging(),navigator.serviceWorker.register("../../../../firebase-messaging-sw.js").then(function(e){swRegistration=e,"default"!=Notification.permission&&"granted"!=Notification.permission||messaging.getToken({vapidKey:metaDataService.getFirebaseConfig().vapidKey,serviceWorkerRegistration:swRegistration}).then(function(e){(appCtrl.info.currentToken=e)&&appCtrl.addPushToken()}).catch(function(e){})}).catch(function(e){}),messaging.onMessage(function(e){console.log("foreground notification received. ",e);var t={body:e.notification.body,icon:"/apps/dist/img/clinsight_resize2.png",data:e.data};swRegistration.showNotification(e.notification.title,t),"healthcheck"==appCtrl.info.current&&$timeout(function(){$scope.$broadcast("updateUnreadCount")},1e3)})):console.log("Push messaging is not supported")})}]).controller("ChangePasswordCtrl",["$modalInstance","PasswordService","GlobalService","metaDataService","UserTrackingService",function(e,t,a,n,i){var o=this;function s(e){var t="ChangePassword";"ERR_6"==e.data?o.form.message=a.getVal("invalid_old_passwd"):(o.form.message=a.getVal("passwd_change_success"),i.standard_user_tracking(t,t,"Change Password","{}")),o.form.visible=!1}function r(e){o.form.visible=!1,o.form.message=a.getVal("passwd_change_failure")}o.form={visible:!0,message:"",character_limit:a.getVal("passwd_maxlimit")},o.getValue=function(e){return a.getVal(e)},o.matchPassword=function(){return o.form.new_passwd!==o.form.renew_passwd},o.maxLimit=function(){return null==o.form.new_passwd||null==o.form.renew_passwd||(o.form.new_passwd.length>o.form.character_limit||o.form.renew_passwd.length>o.form.character_limit)},o.checkPasswordValid=function(){return/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[^\w\s]).{6,}$/.test(o.form.new_passwd)},o.submitForm=function(e){e.userForm.$valid&&!o.matchPassword()&&!o.maxLimit()&&o.checkPasswordValid()&&t.change(o.form.new_passwd,n.getUserEmail()).then(s,r)},o.ok=function(){e.close("Ok")},o.cancel=function(){e.dismiss("Dismissed")}}]).controller("SessionController",["$modalInstance","GlobalService","AppService",function(e,t,a){this.msg=t.getVal("session_timeout_msg"),this.ok=function(){a.logoutSessionTimeout(),e.close("Ok")}}]).controller("AbortUploadController",["$modalInstance","GlobalService",function(e,t){this.msg=t.getVal("abort_upld"),this.hideAbortUpload=function(){e.dismiss("cancel")},this.abortUpload=function(){e.close("ok")}}]).controller("AlertController",["$modalInstance","GlobalService","items","$sce",function(e,t,a,n){a.msg?this.msg=a.msg:this.msg=t.getVal(a.msgKey),this.ok=function(){e.close("ok")},this.renderHtml=function(e){return n.trustAsHtml(e)}}]).controller("ConfirmationController",["$modalInstance","GlobalService","$sce","titleObj","msgObj","successText","cancelText",function(e,t,a,n,i,o,s){var r=this;n.msg?r.title=n.msg:r.title=t.getVal(n.msgKey),i.msg?r.msg=i.msg:r.msg=t.getVal(i.msgKey),r.ok=function(){e.close("ok")},r.successText=o,r.cancelText=s,r.cancel=function(){e.dismiss("cancel")},r.renderHtml=function(e){return a.trustAsHtml(e)}}]).controller("FileUploadController",["$modalInstance","FileUploader","GlobalService","ErrorService","ModalService","UserTrackingService","AppService","$filter","fileUploadData","$interval","$sce",function(o,t,s,r,l,f,e,g,d,a,p){var c=this;for(i in c.uploadForm={},c.info={},c.fadeUploadModal=!1,c.info.showCancelAllConfirmBox=!1,c.info.mandatoryLabel=s.getVal("fileupload_mandatory_label"),c.info.showMandatoryLabel=!1,d&&"NA"!==d||(e.hidePanelLoading(),d=e.getFileUploadData()),c.info.uploadData=d.json_form&&JSON.parse(d.json_form),c.info.uploadData)c.info.uploadData[i].mandatory&&(c.info.showMandatoryLabel=!0);c.info.uploadDataMaxSize=d.max_upload_size;var e=s.getVal("infoserverDomain"),m=s.getVal("manufacturer"),h=s.getVal("product"),b=s.getVal("schema");function n(){for(var e in c.info.uploader.clearQueue(),c.uploadForm)c.uploadForm.hasOwnProperty(e)&&(c.uploadForm[e].nodeVal="",c.uploadForm[e].error=!1);r.clearErrors("fileupload"),o.close("Ok"),c.info.uploadDone=!1,c.fadeUploadModal=!1}function u(){var e,t=0;for(e in c.info.uploader.queue)t+=c.info.uploader.queue[e].file.size;r.clearErrors("fileupload"),t>c.info.uploadDataMaxSize&&r.setError("fileupload",s.getVal("file_upld_maxsize")+'<span title="'+c.info.uploadDataMaxSize+' B">'+g("fileSize")(c.info.uploadDataMaxSize)+"</span>")}function _(){}function v(e){!c.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(c.info.sessionTimedOut=!0,l.sessionTimeout())}c.info.uploader=new t({url:e+"/fileupload/uploadfile/"+m+"/"+h+"/"+b,queueLimit:s.getVal("file_upld_limit"),filters:[{name:"extensionFilter",fn:function(e){var t,a=!1,n=d.allowed_extension.split(", ");for(t in n)e.name.endsWith(n[t])&&(a=!0);return a}}],onAfterAddingFile:function(e){u()},onWhenAddingFileFailed:function(e,t,a){"queueLimit"==t.name?r.setError("fileupload",s.getVal("file_upld_limit_exceeded")):r.setError("fileupload",s.getVal("file_upld_unsupported"))},onErrorItem:function(e,t,a,n){!c.info.sessionTimedOut&&t&&t.hasOwnProperty("Msg")&&t.Msg.match(/timeout/)&&(o&&o.close("Ok"),c.info.sessionTimedOut=!0,l.sessionTimeout())},onBeforeUploadItem:function(a){var n;angular.forEach(c.uploadForm,function(e,t){(n={})[t]=e.nodeVal,a.formData.push(n)}),c.info.uploadDone=!1},onCompleteAll:function(){var e,t=!1,a=!1,n=!1,i={};for(e in c.uploadForm)c.uploadForm.hasOwnProperty(e)&&(i[e]=c.uploadForm[e].nodeVal);for(e in i.files=[],c.info.uploader.queue)c.info.uploader.queue[e].isSuccess?(t=!0,i.files.push(c.info.uploader.queue[e].file.name)):c.info.uploader.queue[e].isCancel?n=!0:a=!0;0<i.files.length&&f.standard_user_tracking(s.getVal("navUpload"),s.getVal("navUpload"),"Upload","{'"+JSON.stringify(i)+"'}").then(_,v),u(),t&&n&&a||t&&n&&!a?r.setError("fileupload",s.getVal("file_upld_partial")):t||!n||a?!t||n||a?(!t&&!n&&a||!t&&n&&a||t&&!n&&a)&&r.setError("fileupload",s.getVal("file_upld_fail")):c.info.uploadDone=!0:r.setError("fileupload",s.getVal("file_upld_cancel"))}}),c.beginUpload=function(){var t,a,e=!0;for(t in u(),c.info.uploadData)try{c.info.uploadData[t].required&&c.info.uploadData[t].mandatory&&(null==c.uploadForm[c.info.uploadData[t].name].nodeVal||""==c.uploadForm[c.info.uploadData[t].name].nodeVal?a=c.uploadForm[c.info.uploadData[t].name].error=!0:c.uploadForm[c.info.uploadData[t].name].error=!1)}catch(e){c.uploadForm[c.info.uploadData[t].name]={},a=c.uploadForm[c.info.uploadData[t].name].error=!0}a&&(e=!1),0==r.getErrors("fileupload").length&&e&&c.info.uploader.uploadAll()},c.removeAll=function(){c.info.uploadDone=!1,c.info.uploader.clearQueue(),r.clearErrors("fileupload")},c.removeFile=function(e){e.remove(),u(),0==c.info.uploader.queue.length&&(c.info.uploadDone=!1)},c.getUploadErrors=function(){return r.getErrors("fileupload")},c.closeUploadModal=function(){c.info.uploader.isUploading?(l.abortUpload().result.then(function(){var t;t=a(function(){var e=c.info.uploader.getNotUploadedItems().filter(function(e){return e.isUploading});0==e.length&&(a.cancel(t),c.info.showCancelAllConfirmBox=!1),angular.forEach(e,function(e){e.cancel&&e.cancel()})},100),n()}),c.fadeUploadModal=!0):n()},c.renderHtml=function(e){return p.trustAsHtml(e)},c.getValue=function(e){return s.getVal(e)}}]).controller("InstanceCtrl",["$scope","$filter","InstanceHandler","GlobalService","$timeout","$sce","WorkbenchService","$window","AppService","ExplorerService","ModalService",function(n,r,i,t,e,a,o,s,d,c,l){n.selectedSections={},n.delay=!1,n.info={},n.info.application="Explorer",n.info.sessionTimedOut=!1,s.dashboardLoadingDone=function(e){var t;e&&e.target&&(-1==(e=e.target.className.match(/idashboard\-[^\s]*/)[0].replace("idashboard-","")).indexOf("}}")&&((t=i.getInstanceByMD5(e)).iframeLoadingCheck?t.iframeLoadingCheck++:t.iframeLoadingCheck=1,n.checkIframeLoader(t,e)))},n.checkIframeLoader=function(e,t){angular.element("#idashboard-iframe-div-"+t+".gb-opacity-50-per")&&angular.element("#idashboard-iframe-div-"+t+".gb-opacity-50-per").removeClass("gb-opacity-50-per").addClass("gb-opacity-100-per"),angular.element("#dashboard-content-loader-"+t+".gb-show")&&angular.element("#dashboard-content-loader-"+t+".gb-show").removeClass("gb-show").addClass("gb-hide"),e&&(delete e.loading,i.updateInstanceByMD5(t,e),n.$apply())},n.getDefaultTab=function(){return i.getDefaultTab()},n.setDefaultTab=function(e,t){"changes"==e&&10<t.getNumberofSelectedSection()?l.alertBox({msgKey:"instance_view_max_section"}):(t&&i.getDefaultTab()!=e&&t.applyFilter(e),i.setDefaultTab(e))},n.showDisabledMsgViewChangesTab=function(e){i.showDisabledMsgViewChangesTab(e)},n.getInstances=function(){return i.getInstances()},n.isVisible=function(){return!!i.getNumberOfInstances()},n.addInstance=function(e,t,a){i.addInstance(e,t,a)},n.removeInstance=function(e){i.removeInstance(e)},n.showInstance=function(e){i.showInstance(e)},n.isViewerVisible=function(){return i.isVisible()},n.setViewerVisible=function(e){return i.setVisible(e)},n.getiTabId=function(e){return e.md5+"-gb-instance-viewer-tab"},n.secureURL=function(e){return a.trustAsResourceUrl(e)},n.getId=function(e,t){return e?e.namespace_id.split("-").pop()+t+"-section-content":""},n.getRefreshCount=function(){return i.getRefreshCount()},n.filterSections=function(e,t){var a,n={};if(t&&t.length){for(a in e)e.hasOwnProperty(a)&&"label"!=a&&-1!=e[a].label.toUpperCase().indexOf(t.toUpperCase())&&(n[a]=e[a]);return n}return e},n.getURL=function(e){return"event"==e?t.getVal("intanceviewer_event"):"section"==e?t.getVal("intanceviewer_section"):void 0},n.generateUrlForBundle=function(){var e,t="",a="";if(arguments.length)t+="obs_url="+(a=(a=(a=arguments[0].obs_url).split("/"))[a.length-1]);else for(e in n.bundleList)""!=t&&(t+="&"),t+="obs_url="+(a=(a=(a=n.bundleList[e].obs_url).split("/"))[a.length-1]);return t},n.generateUrlForFile=function(e,t,a){if(a&&a.bundleList&&a.bundleList.bundles)for(var n=a.bundleList.bundles,i=0;i<n.length;i++)if(r("bundleName")(n[i])==a.file){t=n[i];break}var o={},s={};return s.bundle_name=e,s.files=[],s.files.push(t),o.bundles=[],o.bundles.push(s),o.download_type="files",JSON.stringify(o)},n.isOwner=function(e){return o.getUserId()===e.owner},n.goToEdit=function(e){e.data.mode="editor",e.delay=!1},n.goToView=function(e){e.data.mode="viewer",e.delay=!1},n.renderHtml=function(e){return a.trustAsHtml(e)},n.unescape=function(e){if(e)return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#39;/g,"'").replace(/&quot;/g,'"')}}]).controller("ShowInfoController",["$modalInstance","GlobalService","showCheckbox","AppService","$filter",function(e,t,a,n,i){var o=this;o.openedOnStartup=a,o.modalElements=i("filter")(t.getVal("startupModalFields"),{enabled:!0})||[],t.getVal("showVersionOnHelpModal")&&(o.appsVersion=t.getVal("appsVersion")),o.close=function(){o.startupModalCheckbox&&n.disableStartupModal(),e.close("ok")}}]).controller("SystemInfoCtrl",["$modalInstance","GlobalService","RulesService","$scope","$cookies",function(e,t,a,i,n){i.info={},i.info.sysPageSize=200,i.info.sysidSearchObj={search:{}},i.info.sysIdList=[],i.loading=!1,i.info.sysidPagination={pageSiz:i.info.sysPageSize,startIndex:0,endIndex:i.info.sysPageSize-1,noOfPages:0,currentPage:1,paginationText:""},i.init=function(){i.info.loading=!0,i.info.colsLoading=!0,a.getSysidColList().then(function(e){i.info.sysIdAttributeList=e.data.Data.cols,i.info.colsLoading=!1,i.getInitialSysidList()})},i.cancel=function(){e.dismiss("cancel")},i.getInitialSysidList=function(){a.getSysidList(i.info.sysidPagination.startIndex,i.info.sysidPagination.endIndex+1,i.info.sysidSearchObj,n.username).then(function(e){i.info.totalSysidCount=parseInt(e.data.Count),i.info.sysIdList=e.data.Data,i.info.loading=!1,i.getPages()})},i.getSysId=function(){i.info.sysIdList=[],i.info.loading=!0,a.getSysidList(i.info.sysidPagination.startIndex,i.info.sysidPagination.endIndex,i.info.sysidSearchObj,n.username).then(function(e){i.info.totalSysidCount=parseInt(e.data.Count),i.info.sysIdList=e.data.Data;e=i.info.totalSysidCount<=i.info.sysidPagination.endIndex?i.info.totalSysidCount:i.info.sysidPagination.endIndex+1;i.info.sysidPagination.paginationText="Showing "+(i.info.sysidPagination.startIndex+1)+" to "+e+" of "+i.info.totalSysidCount,i.info.loading=!1},function(e){console.error("Unable to load "),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&t.logError(Object.values(t.getVal("errorMsgs"))[1]),handleSessionTimeout(e),i.info.sysIdList=[]})},i.getPageLabel=function(e,t,a){var n=Math.max(i.getPageStart(t,a),0),t=Math.min(i.getPageStart(t,a+1),e),a={};return a.startIndex=n,a.endIndex=t===i.info.totalSysidCount?i.info.totalSysidCount:t-1,a},i.getPageStart=function(e,t){return e*t},i.loadNextSet=function(){i.info.sysidPagination.currentPage=i.info.sysidPagination.currentPage+1;var e=i.info.pages[i.info.sysidPagination.currentPage-1];i.info.sysidPagination.startIndex=e.startIndex,i.info.sysidPagination.endIndex=e.endIndex,i.getSysId()},i.loadPrevSet=function(){i.info.sysidPagination.currentPage=i.info.sysidPagination.currentPage-1;var e=i.info.pages[i.info.sysidPagination.currentPage-1];i.info.sysidPagination.startIndex=e.startIndex,i.info.sysidPagination.endIndex=e.endIndex,i.getSysId()},i.resetPagination=function(){i.info.sysidPagination={pageSiz:i.info.sysPageSize,startIndex:0,endIndex:i.info.sysPageSize-1,noOfPages:0,currentPage:1,paginationText:""}},i.getPages=function(){i.resetPagination(),i.info.sysidPagination.noOfPages=Math.ceil(i.info.totalSysidCount/i.info.sysidPagination.pageSiz),i.info.pages=Array.from({length:i.info.sysidPagination.noOfPages},function(e,t){return i.getPageLabel(i.info.totalSysidCount,i.info.sysidPagination.pageSiz,t)})},i.init()}]),angular.module("gbApp.services",[]).factory("Authenticate",["$http","$cookies","$location",function(e,t,a){return{authorize:function(){}}}]),angular.module("gbApp.services").factory("ModalService",["$modal","$cookies",function(o,e){return{openModal:function(e,t,a,n,i){return o.open({templateUrl:e,windowClass:a||"",backdrop:n||!1,keyboard:!i,scope:t})},sessionTimeout:function(){return delete e.prevApplication,o.open({templateUrl:"partials/session_timeout.html",windowClass:!1,backdrop:"static",controller:"SessionController as sessionCtrl"})},abortUpload:function(){return o.open({templateUrl:"partials/abort_upload.html",windowClass:!1,backdrop:"static",controller:"AbortUploadController as abortCtrl"})},alertBox:function(e,t){return o.open({templateUrl:"partials/alert_box.html",windowClass:!1,backdrop:!1!==t,controller:"AlertController as alertCtrl",resolve:{items:function(){return e}}})},confirmationBox:function(e,t,a,n){return o.open({templateUrl:"partials/confirmation_box.html",windowClass:!1,backdrop:!0,controller:"ConfirmationController as confirmationCtrl",resolve:{titleObj:function(){return e},msgObj:function(){return t},successText:function(){return a},cancelText:function(){return n}}})}}}]),angular.module("gbApp.services").factory("metaDataService",["$modal","$cookies","GlobalService","$location","RulesTestWithLogvault",function(e,u,o,f,g){var t={},s={},a={},n={},i={},r="",l="",d="",c="",p={};return{setCurrentPage:function(e){l=e},getCurrentPage:function(e){return l},setDashboardType:function(e){d=e},getDashboardType:function(){return d},setRaACurrentPage:function(e){c=e,g.setCurrentPage(e)},getRaACurrentPage:function(){return c},setDomain:function(e){t=e,o.setVal("feature_label",t.feature_label),o.setVal("ssoLogoutUrl",t.sso_logout_url)},setFeature:function(e){s=e},setUser:function(e){a=e,o.setVal("userSso",a.sso)},setExplorerDataDuration:function(e){r=e},getExplorerDataDuration:function(){return r},getDomain:function(){return t},getDefaultFeature:function(){return a.is_external?t.def_feature_external:t.def_feature_internal},getUser:function(){return a},getManufacturer:function(){return t.mfr},getProduct:function(){return t.prod},getSchema:function(){return t.sch},getNsrEnabled:function(){return t.nsr_enabled},getNsrType:function(){return t.nsr_type},getSsoIdpId:function(){return t.sso_idp_id},getSsoLoginUrl:function(){return t.sso_login_url},getSsoLogoutUrl:function(){return t.sso_logout_url},getSsoParams:function(){return t.sso_params},getSsoParamsSfdc:function(){return t.sso_params_sfdc},getSsoRoles:function(){return t.sso_roles},getEndCustomer:function(){return t.ec},getFeedbackApiKey:function(){return t.feedback_api_key},getFeedbackBtn:function(){return t.feedback_button},getLogo:function(){return t.logo},getInternalLogo:function(){return t.logo_internal},getlogourl:function(){return t.logo_url},getFeatures:function(){var e=null,e=o.getVal("showStudio")&&o.getVal("role_details").mps_uidomain[o.getVal("gb_studio_apps_realm")]==f.host()?this.getStudioMPS().replace(/\//g,":"):o.getVal("manufacturer")+"/"+o.getVal("product")+"/"+o.getVal("schema");if(s){var t,a=[];for(t in s)if(t==e){a=s[t];break}if(!a||!a.split)return{};for(var a=a.split(","),n=0;n<a.length;n++)a[n]=a[n].replace(/^\s+|\s+$/g,"");for(var i={},n=0;n<a.length;n++)i[a[n]]=!0;return i}},getUserEmail:function(){return a.email},getUserType:function(){return a.is_external},getUserFirstName:function(){return a.first_name},getUserLastName:function(){return a.last_name},getDashAdmin:function(){return a.dashboard_admin},getUserName:function(){return!a.first_name&&!a.last_name||"NA"==a.first_name&&"NA"==a.last_name?a.email:("NA"!=a.first_name?a.first_name+" ":"")+("NA"!=a.last_name?a.last_name:"")},getUserRole:function(){return a.role},getUserEndCustomer:function(){return a.end_customer},getUserOrgType:function(){return a.org_type},getUserOrg:function(){return a.org},getSsoUser:function(){return a.sso},setUiConfig:function(e){n=e},getUiConfig:function(e){return n},setGbConfig:function(e){i=e},getGbConfig:function(e){return i},isSysid2Enable:function(){return!!(i.filter_columns&&i.filter_columns.length&&0<i.filter_columns.length&&-1!=i.filter_columns.indexOf("sysid2"))},getStudioURL:function(){return o.getVal("role_details")?o.getVal("role_details").mps_uidomain[o.getVal("gb_studio_apps_realm")]:null},getStudioMPS:function(){return o.getVal("gbstudio_manufacturer")+"/"+o.getVal("gbstudio_product")+"/"+o.getVal("gbstudio_schema")},getStringToDate:function(e){return moment(e,"YYYY-MM-DD HH:mm:ss").toDate()},getTodayDate:function(){return moment(moment.utc().format("YYYY-MM-DD HH:mm:ss"),"YYYY-MM-DD HH:mm:ss").toDate()},setFirebaseConfig:function(e){p=e},getFirebaseConfig:function(){return p}}}]),angular.module("gbApp.services").factory("AppService",["$http","$window","GlobalService","$cookies","$location","metaDataService","WorkbenchService",function(a,t,n,i,o,e,c){var s,r=!1,l=!1,d=!1;return{getRequestFromApps:function(){return d},setRequestFromApps:function(e){d=e},logOutUrl:function(){t.location.href=(getCookie("loginurl")?getCookie("loginurl"):n.getVal("session_redirect_url")).replace(/\?.*/,"")},isInfoServerUp:function(){return r},setInfoServerUp:function(e){r=e},setAuthorized:function(e){l=e},setFileUploadData:function(e){s=e},getFileUploadData:function(){return s},isAuthorized:function(){return l},getUploadData:function(){var e=n.getVal("infoserverDomain");return a.get(e+"/fileupload/jsonform/"+n.getVal("manufacturer")+"/"+n.getVal("product")+"/"+n.getVal("schema"),{cache:!0})},logoutUser:function(e,t,a,n,i){},logoutInfoserver:function(e){var t=n.getVal("umsDomain");return delete i.prevApplication,a.get(t+"/aa/logout?mps="+n.getVal("manufacturer")+":"+n.getVal("product")+":"+n.getVal("schema")+"&feature="+e)},updateUserSuccessLogin:function(){var e=n.getVal("umsDomain");return a.post(e+"/aa/updateloginsuccess")},logoutSessionTimeout:function(){localStorage.clear(),this.logoutInfoserver().then(this.logOutUrl,this.logOutUrl)},hidePanelLoading:function(){angular.element(document.getElementById("gb-tab-loader")).css("display","none"),angular.element(document.getElementById("gb-tab-cntr")).css("display","block")},getUserDomain:function(e){var t=n.getVal("umsDomain");return a.get(t+"/admin/role/domains/"+(this.isGbStudioApp()?n.getVal("gbstudio_manufacturer"):n.getVal("manufacturer"))+"/"+e)},getGBStudioProjects:function(){var e=n.getVal("infoserverDomain");return a.get(e+"/studio/user/projects")},setDefaultDomain:function(e){var t=n.getVal("umsDomain");return a.post(t+"/user/update/defaults/"+n.getVal("manufacturer"),e)},refreshMeta:function(){var e=n.getVal("infoserverDomain");return a.get(e+"/meta/refresh/"+n.getVal("manufacturer")+"/"+n.getVal("product")+"/"+n.getVal("schema"))},getMPS:function(e){var t=i.mps;return!this.isGbStudioApp()&&t&&"null"!=t&&"Null"!=t?t.replace(/:/g,"/"):this.getMPSfromQueryParam()},isGbStudioApp:function(){return e.getStudioURL()==o.host()},getMPSfromQueryParam:function(){var e=new RegExp("(?:[?&]+mps=)([^&]*)?","i").exec(t.location.href),e=null===e?e:e[1];return e=(e=unescape(e)).replace(/:/g,"/")},isDemoUser:function(){for(var e=n.getVal("gb_demo_apps_realms"),t=0;t<e.length;t++)if(n.getVal("role_details").mps_uidomain[e[t]]==o.host())return!0;return!1},hideWorkbenchTab:function(){return!(e.getUser().email==c.getTableauUser()||e.getUser().org_type==n.getVal("gbUserOrgType")||e.getUser().org_type==n.getVal("studioUserOrgType")&&this.isGbStudioApp()||e.getUser().org_type==n.getVal("wbUserOrgType")&&this.isDemoUser())},disableStartupModal:function(){var e=n.getVal("umsDomain");return a.post(e+"/user/disable/info/"+n.getVal("manufacturer"))},addPushToken:function(e){var t=n.getVal("umsDomain");return a.post(t+"/user_info/update/device_info",e)},removePushToken:function(e){var t=n.getVal("umsDomain");return a.post(t+"/user_info/delete/device_info",e)},getClinsightUrl:function(e){var t=n.getVal("infoserverDomain");return a.get(t+"/dashboards/healthcheckreport/"+n.getVal("manufacturer")+"/"+n.getVal("product")+"/"+n.getVal("schema"))}}}]),angular.module("gbApp.services").factory("PasswordService",["$http","GlobalService",function(n,i){return{change:function(e,t){var a=i.getVal("umsDomain");return n.post(a+"/user/change/passwd/"+i.getVal("manufacturer"),{email:t,token_id:"",passwd:e})}}}]),angular.module("gbApp.services").factory("UtilService",["ModalService",function(t){return{parseDate:function(e){return new Date(e.replace(/-/g,"/").replace("T"," ").substring(0,19))},localPagination:function(){return{currentPage:1,pageSize:10,totalPages:1,totalRecs:0,firstBtn:!1,prevBtn:!1,nextBtn:!1,lastBtn:!1,data:[],currentRecordsSet:[],startIndex:0,endIndex:0,msg:"",next:function(){this.firstBtn=!0,this.prevBtn=!0,this.currentPage++,this.currentPage>=this.totalPages?(this.nextBtn=!1,this.lastBtn=!1,this.currentPage=this.totalPages):this.endIndex>this.totalRecs?(this.endIndex=this.totalRecs,this.nextBtn=!1,this.lastBtn=!1):(this.nextBtn=!0,this.lastBtn=!0),this.startIndex=(this.currentPage-1)*this.pageSize,this.endIndex=this.currentPage*this.pageSize,this.endIndex>this.totalRecs&&(this.endIndex=this.totalRecs,this.nextBtn=!1,this.lastBtn=!1),this.process(!0)},prev:function(){this.nextBtn=!0,this.lastBtn=!0,this.currentPage--,this.currentPage<=1?(this.currentPage=1,this.firstBtn=!1,this.prevBtn=!1,this.startIndex=0,this.endIndex=this.pageSize):(this.firstBtn=!0,this.prevBtn=!0),this.startIndex=(this.currentPage-1)*this.pageSize,this.endIndex=this.currentPage*this.pageSize,this.process(!0)},first:function(){this.firstBtn=!1,this.prevBtn=!1,this.nextBtn=!0,this.lastBtn=!0,this.currentPage=1,this.startIndex=0,this.endIndex=this.pageSize,this.process(!0)},last:function(){this.firstBtn=!0,this.prevBtn=!0,this.nextBtn=!1,this.lastBtn=!1,this.currentPage=this.totalPages,this.startIndex=(this.currentPage-1)*this.pageSize,this.endIndex=this.totalRecs,this.process(!0)},init:function(e){this.data=e,this.firstBtn=!1,this.prevBtn=!1,this.nextBtn=!1,this.lastBtn=!1,this.currentPage=1,this.totalRecs=this.data.length,this.currentRecordsSet=[],this.totalRecs&&this.totalRecs>this.pageSize?(this.totalPages=Math.ceil(this.totalRecs/this.pageSize),this.startIndex=0,this.endIndex=this.pageSize,this.nextBtn=!0,this.lastBtn=!0,this.msg="1-"+this.pageSize+" of "+this.totalRecs):(this.msg="1-"+this.totalRecs+" of "+this.totalRecs,this.startIndex=0,this.endIndex=this.totalRecs),this.process(!1)},process:function(e){this.currentRecordsSet=angular.copy(this.data.slice(this.startIndex,this.endIndex)),!0===e&&(this.msg=this.startIndex+1+" - "+this.endIndex+" of "+this.totalRecs)}}},downloadCSV:function(e,t){var e=new Blob([e],{type:"text/csv"}),a=document.createElement("a");a.download=t,a.href=window.URL.createObjectURL(e),a.style.display="none",document.body.appendChild(a),a.click()},compareFirstWithSecondList:function(e,t){for(var a=!1,n=[],i=0;i<t.length;i++){for(var a=!1,o=0;o<e.length;o++)if(t[i].split(".")[0]==e[o].split(".")[0]){a=!0;break}a||n.push(t[i].split(".")[0])}return n},showModal:function(e){t.alertBox({msg:e})}}}]),angular.module("gbApp.services").factory("ErrorService",[function(){var a={gbApp:[]};return{setError:function(e,t){a[e]||(a[e]=[]),-1==a[e].indexOf(t)&&a[e].push(t)},getErrors:function(e){return 0<a.gbApp.length?a.gbApp:a[e]||[]},getFeatureErrors:function(e){return a[e]||[]},clearErrors:function(e){a[e]&&(a[e].length=0)}}}]),angular.module("gbApp.services").factory("InstanceHandler",["UserTrackingService","ExplorerService","SectionsMetaService","$filter","$location","GlobalService","ModalService","WorkbenchService","ConfigDiffService","DefaultFilterService","$sce","metaDataService","$timeout","AppService","$modal",function(s,g,e,r,n,l,d,p,o,m,h,i,b,_,f){function c(){function n(){0<i.length&&i.splice(0,i.length)}var i=[],o=l.getVal("eventViewerBucketSize"),s=null,r=null;return{clear:function(){n()},lastRecord:function(){return s},getPosition:function(){return r},first:function(){return i[0]},last:function(){return i[i.length-1]},get:function(){return i},add:function(e,t,a){t&&0,"up"==a?(s=i[0],i=e.concat(i),r="top"):"down"==a?(s=i[i.length-1],i=i.concat(e),r="bottom"):i=(n(),e),i.length>o&&("up"==a?0<i.length&&(t=i.length-o,t=i.length-t,i.splice(t,i.length)):"down"==a?0<i.length&&(t=i.length-o,i.splice(0,t)):"default"==a&&(i=e))}}}var u=[],t=0,a=!1;return{defaultTab:"section",isVisible:function(){return a},setVisible:function(e){a=e},setRefreshCount:function(e){t=e},getRefreshCount:function(){return t},setDefaultTab:function(e){this.defaultTab=e},showDisabledMsgViewChangesTab:function(){d.alertBox({msgKey:"instance_view_changes_disabled_msg"})},getDefaultTab:function(){return this.defaultTab},addInstance:function(o,e,t){var a,f,n=this;o.md5=CryptoJS.MD5(angular.toJson(o)).toString(),a=this.getInstanceByMD5(o.md5),o.defaultTab?this.setDefaultTab(o.defaultTab):this.setDefaultTab("section"),o.data.sysId2&&m.setSysId2(o.data.sysId2),a?this.showInstance(a):u.length>=l.getVal("instance_limit")?d.alertBox({msgKey:"instance_limit_msg"}):-1!=l.getVal("intanceviewer_iframe_apps").indexOf(o.type)?(o.loading=!0,u.push(o),this.showInstance(o),a=l.getVal("primaryDomain"),i.getUser(),i.getUser().email==p.getTableauUser()||i.getUser().org_type==l.getVal("gbUserOrgType")||i.getUser().org_type==l.getVal("studioUserOrgType")&&this.isGbStudioApp()||i.getUser().org_type==l.getVal("wbUserOrgType")?document.cookie="show_tableau_save_options=1;domain=."+a+";path=/":document.cookie="show_tableau_save_options=0;domain=."+a+";path=/"):(f={type:o.type,instanceHandler:n,isGbStudio:_.isGbStudioApp(),showEventsAcrossSources:!0,name:o.title,id:o.md5,md5:o.md5,app:o.app,module:o.module,selectAllSections:!1,filterBatchPageSize:l.getVal("instance_filter_section_page_size"),filterBatchCurrentPageNo:1,filterBatchTotalCount:0,MAXED_OUT:!1,Max_Limit:0,Max_Totalrecords:0,eventSourcesDuplicate:[],loadingState:{section:!1,event:!1,diff:!1},timefilter:{currentValue:"1 minute",totalRecords:0,startIndex:0,endIndex:0,scrolldirection:"default",baseIndex:0,offset:0,applied:!1,quickFilters:["1 minute","5 minutes","15 minutes","30 minutes","1 hour","4 hours","8 hours","Custom time"],customFilter:{fromDate:{gDate:new Date,hr:0,min:0,sec:0},toDate:{gDate:new Date,hr:0,min:0,sec:0}}},event30Buckets:new c,event60Buckets:new c,data:{loading:!0,sessionTimedOut:!1,sysId:o.data.sysId,bundle:o.data.bundle,file:o.data.file,instanceDisplay:o.data.instanceDisplay,eventSource:o.data.eventSource,fileDiffAttr:o.data.fileDiffAttr,content:[],isContentLoading:{loading1:!0},content30:[],content60:[],observation:o.data.observation,observationStr:o.data.observationStr,facetStr:o.data.facetStr,result:o.data.result,sections:{},bundleList:{bundles:[],filter:"",isLoading:!0},sectionsData:[],diffSections:[],noDiffSections:[],observationList:[],selectedSections:[],sectionFilterList:{},sectionFilterValue:"",sectionDiffMsg:"",sectionDiffError:!1,sectionDiffUrl:"",sectionLogUrl:"",currentObs:""},isEventExpanded:!1,severityFilter:o.data.severityFilter,severityFilterApplied:!1,filterLoader:!1,severityPayload:"",expandAll:!1,handleSessionTimeout:function(e){!f.data.sessionTimedOut&&e&&e.hasOwnProperty("Msg")&&e.Msg.match(/timeout/)&&(f.data.sessionTimedOut=!0,n.setVisible(!1),d.sessionTimeout())},logSectionData:function(e){var t={"Serial Number":f.data.sysId,Bundle:f.data.bundle,File:f.data.file,Observation:f.data.observationStr,"Sections Selected":e};e.length&&s.standard_user_tracking(f.app,f.module,"Section Viewer",JSON.stringify(t)).then(function(e){},f.handleSessionTimeout)},getAllSectionsListForAFile:function(e){var t=e.result,a={};a.ts=t.obs_date,a.bundle=e.bundle,a.ns=t.namespace,f.data.loading=!0,g.getSectionsContent(a).then(function(e){e=e.data.Data;f.data.loading=!1,e&&(f.data.sectionsData=e),f.data.sectionsData&&f.data.sectionsData.length&&0==f.data.sectionsData.length&&(f.data.sectionsData=[]),f.isGbStudio||(f.logSectionData(t.namespace),f.data.result.currentNS=a.ns,0==f.data.observationList.length?f.getObservations(t):f.getFileDiffSection(t))},function(e){console.log("Error:"+e),f.handleSessionTimeout(e)})},sectionLoading:function(){var e,t;return!!f.data.loading||(e=document.getElementById(this.md5+"-section-container"),(t=document.getElementById(this.id+this.md5+"-section-content"))&&(e.scrollTop=t.offsetTop),!1)},getObservations:function(t){f.data.loading=!0;var e=t.sysid1||t.sysid,a=t.sysid2||"";g.getAllBundles(e,a).then(function(e){f.data.loading=!1;e=e.data.Data;f.data.observationList=[],e&&e.length&&0<e.length&&(angular.forEach(e,function(e){r("utcDate")(e.obs_ts)<r("utcDate")(f.data.observation)&&f.data.observationList.push(e)}),f.data.observationList.length&&0<f.data.observationList.length&&(f.data.currentObs=f.data.observationList[0])),f.getFileDiffSection(t)},function(e){console.log("Error:"+e),f.handleSessionTimeout(e)})},getFileDiffSection:function(e){var i=l.getVal("infoserverDomain");if(!(f.data.observationList&&0<f.data.observationList.length))return f.data.sectionDiffError=!0,f.data.loading=!1,f.data.sectionDiffMsg=l.getVal("section_ErrorMsg1"),void(f.data.loading=!1);var t=f.data.currentObs.obs_ts,a=e.obs_date,n={srcbundle:r("bundleName")(f.data.currentObs.bundle_name),tgtbundle:f.data.bundle,ns:[]},o={};0==f.data.selectedSections.length?n.ns.push(e.namespace):angular.forEach(f.data.selectedSections,function(e){n.ns.push(f.data.sections[parseInt(e)].name),o[f.data.sections[parseInt(e)].name]=f.data.sections[parseInt(e)].label}),f.data.loading=!0,f.data.diffSections=[],f.data.noDiffSections=[],f.data.sectionDiffError=!1,f.loadingState.diff=!0,g.getFileDiffSection(t,a,n).then(function(e){f.data.loading=!1,f.loadingState.diff=!1;e=e.data.Data,e.hasOwnProperty("gb_error")?(f.data.sectionDiffError=!0,"ERR_9"===e.gb_error&&(f.data.sectionDiffMsg=l.getVal("section_ErrorMsg6"))):angular.forEach(e,function(e,t){var a={},n=(a.name=o[t],!1);switch(e){case"MSG_1":a.error=!0,f.data.noDiffSections.push(a),a.errorMsg=l.getVal("section_ErrorMsg2"),n=!0;break;case"MSG_2":a.error=!0,a.errorMsg=l.getVal("section_ErrorMsg3");break;case"MSG_3":a.error=!0,a.errorMsg=l.getVal("section_ErrorMsg4");break;case"MSG_7":a.error=!0,a.errorMsg=l.getVal("section_ErrorMsg5");break;case"ERR_1":a.error=!0,a.errorMsg=l.getVal("section_ErrorMsg6");break;case"ERR_0":a.error=!0,a.errorMsg=l.getVal("section_ErrorMsg7");break;case"ERR_7":a.error=!0,a.errorMsg=l.getVal("section_ErrorMsg8");break;default:a.error=!1,a.URL=h.trustAsResourceUrl(i+"/explorer/sectiondiff/view/"+l.getVal("manufacturer")+"/"+l.getVal("product")+"/"+l.getVal("schema")+"/"+e)}n||f.data.diffSections.push(a)}),e={"Serial Number":f.data.sysId,Bundle:f.data.bundle,File:f.data.file,Observation:r("utcDate")(t)+" -- "+r("utcDate")(a),"Sections Selected":n.ns};s.standard_user_tracking(f.app,f.module,"Section Viewer Changes",JSON.stringify(e)).then(function(e){},f.handleSessionTimeout)},function(e){f.data.diffSections=[],f.data.noDiffSections=[],f.data.loading=!1,f.data.sectionDiffError=!0,f.data.sectionDiffMsg=l.getVal("section_ErrorMsg6"),console.log("Error:"+e),f.handleSessionTimeout(e)})},getMyConfig:function(){return f},isContentLoading:function(){var t,a=this,n="top",e=null,i=null,o=null;return!!a.data.isContentLoading.loading1||(t=a.id+"-main-container",o=document.getElementById(t),"default"==f.timefilter.scrolldirection?(i=f.showEventsAcrossSources?document.getElementById("test-with-source"):document.getElementById(a.id+"-with-out-source"),n=null):(n=(e=(f.showEventsAcrossSources?f.event60Buckets:f.event30Buckets).lastRecord(),f.event60Buckets.getPosition()),i=e?(e=e.scrollId,document.getElementById(e)):null),o&&null!=i&&!a.loadingState.event&&o.scrollTop!=i.offsetTop&&b(function(){var e;a.loadingState.event=!0,"top"==n?i.offsetTop-20?o.scrollTop=i.offsetTop-20:o.scrollTop=i.offsetTop:"bottom"==n?(e=$("#"+t).height(),i.offsetTop-(e-50)?o.scrollTop=i.offsetTop-(e-50):o.scrollTop=i.offsetTop):o.scrollTop=i.offsetParent.offsetTop},1e3,a),!!f.timefilter.sourceFilter)},getAllSection:function(e){f.data.sectionsLoading=!0,g.getSectionViewerSections().then(function(e){e=r("filter")(e.data.Data,{namespace_type:"!EVENT"}),e=r("filter")(e,{namespace_type:"!UNPARSED"});e=r("orderBy")(e,"label"),f.data.sections=e,f.data.sectionsLoading=!1},function(e){console.log("Error:"+e),f.handleSessionTimeout(e)})},selectedSectionsChange:function(e,t){var a;if("string"==typeof e&&"all"==e.toLowerCase())return a=this.getAllSectionOnUI(this.data.sections,this.data.sectionFilterValue),void(this.selectAllSections?(this.selectedAllSections(a),n=f.data.sectionFilterList,this.filterBatchTotalCount=Object.keys(n).length,this.applyFilter("all")):(this.unselectedAllSections(a),n=f.data.sectionFilterList,this.filterBatchTotalCount=Object.keys(n).length,this.clearFilter(this.data.section)));this.selectAllSections=!1,e.selected?f.data.sectionFilterList[t]=e.label:f.data.sectionFilterList[t]&&delete f.data.sectionFilterList[t];var n=f.data.sectionFilterList;this.filterBatchTotalCount=Object.keys(n).length},getAllSectionOnUI:function(e,t){var a,n={};if(t&&t.length){for(a in e)e.hasOwnProperty(a)&&"label"!=a&&-1!=e[a].label.toUpperCase().indexOf(t.toUpperCase())&&(n[a]=e[a]);return n}return e},selectedAllSections:function(e){var t,a="",n="";for(t in e)for(var i in e.hasOwnProperty(t)&&((a=e[t]).selected=!0,this.data.sectionFilterList[t]=a.label),a)e.hasOwnProperty(i)&&((n=e[i]).selected=!0,this.data.sectionFilterList[i]=n.label)},unselectedAllSections:function(e){var t,a="";for(t in e)for(var n in e.hasOwnProperty(t)&&((a=e[t]).selected=!1,this.data.sectionFilterList[t]&&delete this.data.sectionFilterList[t]),a)e.hasOwnProperty(n)&&(e[n].selected=!1,this.data.sectionFilterList[n]&&delete this.data.sectionFilterList[n])},getNumberofSelectedSection:function(){return Object.keys(f.data.sectionFilterList).length},unselectSection:function(e,t,a){for(var n in t)for(var i in t.hasOwnProperty(n)&&t[n].label==e&&(t[n].selected=!1),t[n])t[n][i]&&t[n][i].ns_label==e&&(t[n][i].selected=!1);delete f.data.sectionFilterList[a]},applyFilter:function(e){var t,a=f.data.sectionFilterList;for(t in f.data.selectedSections=[],a)f.data.selectedSections.push(t);var n,i=Object.keys(a).length;0!=i&&(o.data.start_time,o.data.end_time,(n={}).ts=f.data.result.obs_date,n.bundle=f.data.bundle,n.ns=[],f.filterBatchCurrentPageNo=1,f.data.sectionsData=[],n.ns=f.getNamespaceOfSelectedSection(a),e&&("section"!=e&&"changes"==e?i<=l.getVal("instance_selected_sections_limit")?(f.data.loading=!0,f.getFileDiffSection(o.data.result)):d.alertBox({msgKey:"instance_view_max_section"}):(f.data.loading=!0,f.apiGetSectionsConten(n))))},apiGetSectionsConten:function(t){f.loadingState.section=!0,g.getSectionsContent(t).then(function(e){e=e.data.Data;f.data.loading=!1,f.loadingState.section=!1,e&&(f.data.sectionsData=f.data.sectionsData.concat(e)),f.data.sectionsData&&f.data.sectionsData.length&&0==f.data.sectionsData.length&&(f.data.sectionsData=[]),f.logSectionData(t.ns),f.data.result.currentNS=t.ns,angular.element("#"+f.md5+"-section-container").scrollTop(5e4)},function(e){console.log("Error:"+e),f.handleSessionTimeout(e),f.loadingState.section=!1})},getNamespaceOfSelectedSection:function(e){var t,a,n,i,o=[],s=0,r=f,l=0;if(0==(a=Math.ceil(r.filterBatchTotalCount/r.filterBatchPageSize)))return[];for(n in 1==r.filterBatchCurrentPageNo?(s=0,t=r.filterBatchPageSize):(s=(r.filterBatchCurrentPageNo-1)*r.filterBatchPageSize,(r.filterBatchCurrentPageNo>a||(t=r.filterBatchCurrentPageNo*r.filterBatchPageSize)>r.filterBatchTotalCount)&&(t=r.filterBatchTotalCount)),e)if(s<++l&&(i=f.data.sections[parseInt(n)],o.push(i.name)),t<=l)break;return o},scrollInfinite:function(e){var t=f.md5+"-section-container";if((e=angular.element(document.getElementById(t)))[0]&&e[0].scrollHeight){t=e[0].scrollHeight-1100;if(!(e.scrollTop()<t||f.loadingState.section)){var a,e=f.data.sectionFilterList;for(a in f.data.selectedSections=[],e)f.data.selectedSections.push(a);0!=Object.keys(e).length&&(f.filterBatchCurrentPageNo++,o.data.start_time,o.data.end_time,(t={}).ts=f.data.result.obs_date,t.bundle=f.data.bundle,t.ns=[],t.ns=f.getNamespaceOfSelectedSection(e),Array.isArray(t.ns)&&0==t.ns.length||f.apiGetSectionsConten(t))}}},resetObservation:function(e){f.clearFilter(e)},clearFilter:function(t){for(var a in f.data.loading=!0,f.data.sectionFilterList={},f.data.selectedSections=[],f.data.diffSections=[],f.data.noDiffSections=[],f.data.sectionsData=[],f.selectAllSections=!1,t)for(var e in t[a].selected=!1,t[a])try{t[a][e].selected=!1}catch(e){t[a].selected=!1}"random.namespace.by.apps"==f.data.result.namespace&&n.setDefaultTab("section"),this.getAllSectionsListForAFile(f.data)},changeObservation:function(){f.getFileDiffSection(o.data.result)},getEventSources:function(){f.eventSourcesAll=!0,f.eventSourcesFilter="",g.getEventSources().then(function(e){e=e.data.Data;angular.forEach(e,function(e){e.checked=!0}),f.eventSources=e,f.eventSourcesDuplicate=angular.copy(f.eventSources)})},logEventData:function(){var e={},t=f.showEventsAcrossSources?"Show events across sources":"Show events in a file",a={"Serial Number":f.data.sysId,Bundle:f.data.bundle,File:f.data.file,Observation:f.data.observationStr,Timefilter:f.timefilter.currentValue};e[t]=a,s.standard_user_tracking(f.app,f.module,"Event Viewer",JSON.stringify(e)).then(function(e){},f.handleSessionTimeout)},getTimeRangeForEventContent:function(e){var t,a,n,i={sDate:"",eDate:""},o=(e=e||new Date,new Date(e)),s=new Date(e),e=new Date(e);if("1 minute"==f.timefilter.currentValue)s.setMinutes(o.getMinutes()-1),e.setMinutes(o.getMinutes()+1);else if("5 minutes"==f.timefilter.currentValue)s.setMinutes(o.getMinutes()-5),e.setMinutes(o.getMinutes()+5);else if(-1!=f.timefilter.currentValue.indexOf(15))s.setMinutes(o.getMinutes()-15),e.setMinutes(o.getMinutes()+15);else if(-1!=f.timefilter.currentValue.indexOf(30))s.setMinutes(o.getMinutes()-30),e.setMinutes(o.getMinutes()+30);else if(-1!=f.timefilter.currentValue.indexOf(1))s.setHours(o.getHours()-1),e.setHours(o.getHours()+1);else if(-1!=f.timefilter.currentValue.indexOf(4))s.setHours(o.getHours()-4),e.setHours(o.getHours()+4);else if(-1!=f.timefilter.currentValue.indexOf(8))s.setHours(o.getHours()-8),e.setHours(o.getHours()+8);else if(-1!=f.timefilter.currentValue.indexOf("Custom"))return s=moment(f.timefilter.customFilter.fromDate.gDate).format("YYYY-MM-DD"),e=moment(f.timefilter.customFilter.toDate.gDate).format("YYYY-MM-DD"),t=(10<(o=f.timefilter.customFilter.fromDate.hr)?o:"0"+o)+":"+(10<(a=f.timefilter.customFilter.fromDate.min)?a:"0"+a)+":"+(10<(n=f.timefilter.customFilter.fromDate.sec)?n:"0"+n),o=(10<(o=f.timefilter.customFilter.toDate.hr)?o:"0"+o)+":"+(10<(a=f.timefilter.customFilter.toDate.min)?a:"0"+a)+":"+(10<(n=f.timefilter.customFilter.toDate.sec)?n:"0"+n),i.sDate=s+"T"+t+"Z",i.eDate=e+"T"+o+"Z",i;return i.sDate=s.toISOString(),i.eDate=e.toISOString(),i},eventScrollUp:function(){var e=o.showEventsAcrossSources?f.event60Buckets:f.event30Buckets;return!(0==e.get().length||f.timefilter.offset>=f.timefilter.totalRecords)&&(!f.timefilter.request&&(f.timefilter.request=!1,f.timefilter.endIndex=e.first().index,f.timefilter.startIndex=f.timefilter.endIndex-f.timefilter.offset,f.timefilter.scrolldirection="scroll",f.timefilter.startIndex<=0&&(f.timefilter.startIndex=0),f.timefilter.endIndex>=f.timefilter.totalRecords&&(f.timefilter.endIndex=f.timefilter.totalRecords),void this.eventFilterSources("up")))},eventScrollDown:function(){var e=o.showEventsAcrossSources?f.event60Buckets:f.event30Buckets;return!(0==e.get().length||f.timefilter.offset>=f.timefilter.totalRecords)&&(!f.timefilter.request&&(f.timefilter.request=!1,f.timefilter.startIndex=e.last().index,!(f.timefilter.startIndex>=f.timefilter.totalRecords-1)&&(f.timefilter.scrolldirection="scroll",f.timefilter.endIndex=f.timefilter.startIndex+f.timefilter.offset,f.timefilter.endIndex>=f.timefilter.totalRecords&&(f.timefilter.endIndex=f.timefilter.totalRecords),void this.eventFilterSources("down"))))},eventContentApplyFilter:function(){if(-1!=f.timefilter.currentValue.indexOf("Custom")){var e=this.getTimeRangeForEventContent(),t=e.sDate;if(e.eDate===t)return f.timefilter.request=!1,f.data.isContentLoading.loading1=!1,f.loadingState.event=!1,void(f.timefilter.applied=!1)}else f.eventResetCustomFilter();f.timefilter.applied=!0,this.eventResetPaginationInfo(),f.getEventContent(o.data)},eventResetPaginationInfo:function(){f.timefilter.startIndex=0,f.timefilter.endIndex=0,f.timefilter.baseIndex=0,f.timefilter.totalRecords=0,f.timefilter.scrolldirection="default",(o.showEventsAcrossSources?f.event60Buckets:f.event30Buckets).clear()},changeEventAcrossSources:function(e){var t,a;f.showEventsAcrossSources&&f.eventSourceSelectAll(),-1!=f.timefilter.currentValue.indexOf("Custom")&&(a=(t=this.getTimeRangeForEventContent()).sDate,t.eDate!==a&&f.timefilter.applied||(f.timefilter.currentValue=f.timefilter.quickFilters[0],f.eventResetCustomFilter())),f.logEventData(),f.eventResetPaginationInfo(),f.getEventContent(e)},eventResetCustomFilter:function(){var e=new Date(o.data.result.obs_date);e.setHours("0"),e.setMinutes("0"),e.setSeconds("0"),f.timefilter.customFilter.fromDate.hr=0,f.timefilter.customFilter.fromDate.min=0,f.timefilter.customFilter.fromDate.sec=0,f.timefilter.customFilter.toDate.hr=0,f.timefilter.customFilter.toDate.min=0,f.timefilter.customFilter.toDate.sec=0,f.timefilter.customFilter.fromDate.gDate=e,f.timefilter.customFilter.toDate.gDate=e},eventScrollUpEnd:function(){if(f.isContentLoading())return!1;if(f.timefilter.request)return!1;if(0==f.timefilter.startIndex)return!1;var e=o.showEventsAcrossSources?f.event60Buckets:f.event30Buckets;return!(0==e.get().length||f.timefilter.offset>=f.timefilter.totalRecords)&&(f.timefilter.startIndex=e.first().index,1<f.timefilter.startIndex)},evetScrollDownEnd:function(){if(f.isContentLoading())return!1;if(f.timefilter.request)return!1;var e=o.showEventsAcrossSources?f.event60Buckets:f.event30Buckets;if(0==e.get().length||f.timefilter.offset>=f.timefilter.totalRecords)return!1;f.timefilter.endIndex=e.last().index;e=f.timefilter.totalRecords;return f.timefilter.endIndex<--e},eventPaginationToolbar:function(){var e=o.showEventsAcrossSources?f.event60Buckets:f.event30Buckets,t=f.timefilter.totalRecords,a=e.first()?e.first().index:"0",e=e.last()?e.last().index:"0";return parseInt(a)+1+" - "+(parseInt(e)+1)+" of "+t},eventGetSelectedSources:function(){for(var e=[],t=0;t<f.eventSourcesDuplicate.length;t++){var a=f.eventSourcesDuplicate[t];a.checked?(e.push(a.namespace_actual),f.eventSources[t].checked=!0):f.eventSources[t].checked=!1}return e},eventFilterSources:function(e){if(e||(f.timefilter.startIndex=0,f.timefilter.endIndex=f.timefilter.offset,f.timefilter.sourceFilter=!0,f.timefilter.scrolldirection="scroll",f.event60Buckets.clear()),"default"==e){for(var t=this.eventGetSelectedSources(),a=0;a<t.length&&t[a]!=f.timefilter.defaultNS;a++);f.timefilter.endIndex=0,f.timefilter.startIndex=0,f.timefilter.sourceFilter=!0,f.event60Buckets.clear()}this.getEventContent(o.data,e)},eventResetSourceSelection:function(){f.eventSourcesFilter="";for(var e=0;e<f.eventSources.length;e++)f.eventSources[e].checked?f.eventSourcesDuplicate[e].checked=!0:f.eventSourcesDuplicate[e].checked=!1},eventSelectAllSources:function(){this.eventSourcesAll?angular.forEach(f.eventSourcesDuplicate,function(e){e.checked=!0}):angular.forEach(f.eventSourcesDuplicate,function(e){e.checked=!1})},eventIsSelectAllOption:function(){for(var e=0;e<f.eventSourcesDuplicate.length;e++)if(!f.eventSourcesDuplicate[e].checked)return this.eventSourcesAll=!1;return this.eventSourcesAll=!0},eventSourceSelectAll:function(){f.showEventsAcrossSources&&angular.forEach(f.eventSourcesDuplicate,function(e){e.checked=!0})},eventClearSourceSelection:function(){for(var e=0;e<f.eventSources.length;e++)f.eventSources[e].checked&&(f.eventSources[e].checked=!1)},showPagination:function(){return f.data.content30.length,0!=f.data.content60.length},getEventContent:function(e,t){f.filterLoader=!0,f.expandAll=!1,t&&(f.timefilter.scrolldirection="default"===t?"default":"scroll"),"default"==f.timefilter.scrolldirection?(f.timefilter.request=!0,f.data.isContentLoading.loading1=!0):f.timefilter.request=!0;var a=this.getTimeRangeForEventContent(e.result.obs_date),n="",i="",o=(n=(n="ns_id="+e.result.namespace_id)+"&filename="+encodeURIComponent(e.result.filename),this.eventGetSelectedSources());if(o&&o.length&&0<o.length)for(var s=0;s<o.length;s++)i=0==s?"ns="+o[s]:i+"&ns="+o[s];else i="ns="+e.result.namespace;this.eventIsSelectAllOption()||(n=n+"&"+i);var r=f.timefilter.scrolldirection,l=(f.timefilter.startIndex++,f.timefilter.startIndex),d=f.timefilter.endIndex,c=a.sDate,a=a.eDate,u=f.severityPayload;g.getEventsContent(e.result.obs_date,n,"bundle",c,a,r,l,d,u).then(function(e){var e=e.data.Data,a=[],n=(f.timefilter.request=!1,f.data.content60=[],new Date-new Date("2000-01-01 00:00:00"));angular.forEach(e.event60,function(e){angular.forEach(e,function(e,t){"NA"!=e.severity&&e.severity_color||(e.severity_color="#ffffff00"),e.display=!0,e.isExpanded=!1,e.namespace_id=t,"default"==r&&e.highlight&&"true"==e.highlight?(e.ns_index&&(f.timefilter.baseIndex=e.ns_index),e.num_of_rows&&(f.timefilter.offset=e.num_of_rows),f.timefilter.defaultNS=e.namespace):(f.timefilter.currentValue.indexOf("Custom"),e.ns_index&&(f.timefilter.baseIndex=e.ns_index)),f.timefilter.endIndex=e.index,e.totalRows&&(f.timefilter.totalRecords=e.totalRows),e.scrollId=n+"-"+e.index,a.push(e)})}),f.timefilter.offset||(f.timefilter.offset=200),f.event60Buckets.add(a,f.timefilter.offset,"default"==r?"default":t),f.data.content60=f.event60Buckets.get(),f.data.content30=[],angular.forEach(e.event30,function(e){angular.forEach(e,function(e,t){"NA"==e.severity&&(e.severity_color="#ffffff00"),e.namespace_id=t,"default"==r&&e.highlight&&"true"==e.highlight?(e.ns_index&&(f.timefilter.baseIndex=e.ns_index),e.num_of_rows&&(f.timefilter.offset=e.num_of_rows)):-1!=f.timefilter.currentValue.indexOf("Custom")&&e.ns_index&&(f.timefilter.baseIndex=e.ns_index),e.totalRows&&(f.timefilter.totalRecords=e.totalRows),f.timefilter.endIndex=e.index,e.scrollId=n+"-"+e.index,a.push(e)})}),f.timefilter.offset||(f.timefilter.offset=200),f.event30Buckets.add(a,f.timefilter.offset,"default"==r?"default":t),f.data.content30=f.event30Buckets.get(),f.data.isContentLoading.loading1=!1,f.timefilter.sourceFilter=!1,f.logEventData(),f.loadingState.event=!1,f.filterLoader=!1},function(e){e.data.Msg.match(/SURROUNDING_EVENTS_MAXED_OUT/)?(f.Max_Limit=e.data.Data.limit,f.Max_Totalrecords=e.data.Data.totalRecords,f.handleSessionTimeout(e),f.data.isContentLoading.loading1=!1,f.loadingState.event=!1,f.timefilter.sourceFilter=!1,f.timefilter.request=!1,f.MAXED_OUT=!0,console.log(f.MAXED_OUT)):(console.log("Error:"+e.status+"and"+e.Msg),f.handleSessionTimeout(e),f.data.isContentLoading.loading1=!1,f.loadingState.event=!1,f.timefilter.sourceFilter=!1,f.timefilter.request=!1)})},isOverflowing:function(e,t){t=t.currentTarget;e.isExpanded?e.isExpanded=!1:t.scrollWidth>t.offsetWidth&&(e.isExpanded=!0)},isFilterApplied:function(){var e=f.severityFilter.filter(function(e){return!e.selected});return 0<e.length&&f.severityFilter.length!=e.length},getFilterArr:function(){return f.severityFilter.reduce(function(e,t){return t.selected&&e.push(t.label),e},[])},showpre:function(e){var t=f.getFilterArr()||[];return!f.severityFilterApplied||(!!(f.severityFilterApplied&&"true"==e.highlight&&t.includes(e.severity)||f.severityFilterApplied&&"false"==e.highlight&&t.includes(e.severity))||!(f.severityFilterApplied&&"true"==e.highlight&&!t.includes(e.severity))&&void 0)},createSeverityPayload:function(){return f.isFilterApplied()?f.severityFilter.reduce(function(e,t){return e+=t.selected?0===e.length?t.label:"~"+t.label:""},""):""},applySeverityFilter:function(){f.severityPayload=f.createSeverityPayload(),this.eventResetPaginationInfo(),f.getEventContent(o.data)},clearSeverityFilter:function(){f.filterLoader=!0,f.severityFilter.forEach(function(e){e.selected=!1}),f.applySeverityFilter()},expandAllEvents:function(){for(var e=f.expandAll?document.getElementsByClassName("noflow"):document.getElementsByClassName("yesFlow"),t=0;t<e.length;t++)f.isOverflowingElement(e[t],angular.element(e[t]).scope().cnt)},isOverflowingElement:function(e,t){t.isExpanded?t.isExpanded=!1:e.scrollWidth>e.offsetWidth&&(t.isExpanded=!0)}},"event"==o.type?(f.getEventContent(o.data),f.getEventSources(),a=new Date(o.data.result.obs_date),f.timefilter.customFilter.fromDate.gDate=a,f.timefilter.customFilter.toDate.gDate=a,f.timefilter.customFilter.todayDate=null!=e.todayDate?e.todayDate:a,f.timefilter.customFilter.MinDate=null!=e.info.MinDate?e.info.MinDate:a):"app"==o.type||"EVENT_GROUP"==o.type||(f.getAllSection(o.data),f.getAllSectionsListForAFile(o.data)),u.push(f),this.showInstance(f))},getInstanceByMD5:function(e){for(var t in u)if(u[t].md5===e)return u[t];return null},updateInstanceByMD5:function(e,t){for(var a in u)u[a].md5===e&&(u[a]=t)},showInstance:function(e){for(var t in u)u[t].md5==e.md5?u[t].visible=!0:u[t].visible=!1;this.setVisible(!0)},getInstances:function(){return u},removeInstance:function(e){if(("dashboard"==e.type||"tableau"==e.type)&&localStorage.getItem("rid"))for(var t=localStorage.getItem("rid").split(","),a=localStorage.getItem("did").split(","),n=0;n<t.length;n++)e.data.view?e.data.view.id==t[n]&&(t.splice(n,1),a.splice(n,1),n--):e.data.report.r_id==t[n]&&(t.splice(n,1),a.splice(n,1),n--);for(var n in"dashboard"!=e.type&&"tableau"!=e.type||null!=localStorage.getItem("rid")&&(localStorage.setItem("rid",t.toString()),localStorage.setItem("did",a.toString())),u)if(u[n].md5===e.md5)return void u.splice(n,1)},yesRemoveInstance:function(){for(var e in u)if(u[e].md5===instance.md5)return void u.splice(e,1)},noRemoveInstance:function(){this.modalInstance.close()},getNumberOfInstances:function(){return u.length}}}]),angular.module("gbApp.services").factory("UserTrackingService",["$http","GlobalService","$q","$cookies","$timeout","AppService","metaDataService",function(f,g,e,p,t,a,n){var i=!1,o=null;return{standard_user_tracking:function(e,t,c,a,u){var n=g.getVal("umsDomain"),i=g.getVal("usertracking_details_limit"),o={};try{var s=JSON.parse(a);if(Object.keys(s).length>i){for(var r=0;r<i;r++){var l=Object.keys(s)[r];o[l]=s[l]}a=JSON.stringify(o)}}catch(e){}var d={};return p.prevApplication&&p.prevApplication!=e&&(d.switched_feature=p.prevApplication),n=n+"/user_tracking/"+g.getVal("manufacturer")+"/"+g.getVal("product")+"/"+g.getVal("schema")+"/"+e+"/"+t+"/"+c,p.prevApplication=e,f.post(n,{details:a,solr_query:u||""},{params:d})},custom_user_tracking:function(e,t){var a=g.getVal("infoserverDomain");return f.get(a+"/user_tracking/"+g.getVal("manufacturer")+"/"+g.getVal("product")+"/"+g.getVal("schema")+"/"+e+"/"+t)},getAllConfig:function(){var e=g.getVal("infoserverDomain");return i||(i=!0,o=f.get(e+"/uimeta/config/"+g.getVal("manufacturer")+"/"+g.getVal("product")+"/"+g.getVal("schema"),{cache:!0})),o}}}]),angular.module("gbApp.services").factory("RulesTestWithLogvault",[function(){return new function(){var t=this;t.page=null,t.rules=[],t.setCurrentPage=function(e){t.page=e,"test_rule_history"!=t.page&&(t.rules=[])},t.getCurrentPage=function(){return t.page},t.setRulesSelected=function(e){t.rules=e},t.getRulesSelected=function(){return t.rules}}}]),angular.module("gbApp.filters",[]).filter("bundleName",[function(){return function(e){return null==e||"NA"===e?"":e.split("/")[e.split("/").length-1].replace(/\.gz$/,"")}}]).filter("bundleNameWithTimeStamp",[function(){return function(e){if(null==e||"NA"===e)return"";e=e.split("/")[e.split("/").length-1].replace(/\.gz$/,"");return(e=e.split("_")).reverse(),e.pop(),e.reverse(),e=e.join("")}}]).filter("filterRules",[function(){return function(e,t){if(0===Object.keys(t).length)return e;var a,n=[],i=Object.keys(t);for(a in e){var o,s=!0;for(o in i)if("label_display"===i[o]||"description"===i[o]||"author"===i[o]||"rule_name"===i[o]){var r=new RegExp(t[i[o]],"i");if(-1===e[a][i[o]].search(r)){s=!1;break}}else if("created_ts"===i[o]||"modified_ts"===i[o]){var r=t[i[o]][0],c=moment(r.startTime,"YYYY-MM-DD HH:mm:ss").toDate(),u=moment(r.endTime,"YYYY-MM-DD HH:mm:ss").toDate(),f=moment(e[a][i[o]],"YYYY-MM-DD HH:mm:ss").toDate();if(!moment(f).isBetween(c,u)){s=!1;break}}else if("tags"===i[o]){var l=!1;for(d in t[i[o]])if(e[a][i[o]]&&-1!=e[a][i[o]].map(function(e){return e.tag_name}).indexOf(t[i[o]][d])){l=!0;break}if(!l){s=!1;break}}else{var d,l=!1;for(d in t[i[o]])if(e[a][i[o]]&&e[a][i[o]]===t[i[o]][d]){l=!0;break}if(!l){s=!1;break}}s&&n.push(e[a])}return n}}]).filter("filterSavedView",[function(){return function(e,t){if(!t)return e;t=t.toLowerCase();for(var a=[],n=0;n<e.length;n++)-1==unescape(e[n].view_name).toLowerCase().indexOf(t)&&-1==unescape(e[n].desc).toLowerCase().indexOf(t)&&-1==e[n].created_by.toLowerCase().indexOf(t)||a.push(e[n]);return a}}]).filter("filterTemplates",[function(){return function(e,t){if(0===Object.keys(t).length)return e;var a,n=[],i=Object.keys(t);for(a in e){var o,s=!0;for(o in i){var r=new RegExp(t[i[o]],"i");if(-1===e[a][i[o]].search(r)){s=!1;break}}s&&n.push(e[a])}return n}}]).filter("filterBooks",[function(){return function(e,t){if(!t)return e;var a,n=[];for(a in e){var i=!1;if(!(i=e[a].name&&-1<e[a].name.toLowerCase().indexOf(t.toLowerCase())||e[a].dname&&-1<e[a].dname.toLowerCase().indexOf(t.toLowerCase())?!0:i)&&e[a].tags)for(var o in e[a].tags)if(-1<e[a].tags[o].toLowerCase().indexOf(t.toLowerCase())){i=!0;break}if(!i&&e[a].tag)for(var o in e[a].tag)if(-1<e[a].tag[o].toLowerCase().indexOf(t.toLowerCase())){i=!0;break}if(!i&&e[a].reports&&0<e[a].reports.length)for(var o in e[a].reports)if(-1<e[a].reports[o].rname.toLowerCase().indexOf(t.toLowerCase())){e[a].expand=i=!0;break}if(!i&&e[a].f_views&&0<e[a].f_views.length)for(var o in e[a].f_views)if(-1<e[a].f_views[o].name.toLowerCase().indexOf(t.toLowerCase())){e[a].expand=i=!0;break}i&&n.push(e[a])}return n}}]).filter("filterDashboards",[function(){return function(e,t){if(!t)return e;var a,n=[];for(a in e)(-1<e[a].rdesc.toLowerCase().indexOf(t.toLowerCase())||-1<e[a].rname.toLowerCase().indexOf(t.toLowerCase()))&&n.push(e[a]);return n}}]).filter("filterMultiples",[function(){return function(e,t){if(0===Object.keys(t).length)return e;var a,n=[],i=Object.keys(t);for(a in e){var o,s=!0,r=!1;for(o in i){for(var l in t[i[o]])if(e[a][i[o]]===t[i[o]][l]){r=!0;break}if(!r){s=!1;break}}s&&n.push(e[a])}return n}}]).filter("svFileName",[function(){return function(e,t){if(null==e||"NA"===e)return"";var a=e.split("/")[e.split("/").length-1];return"s3:"!==e.split("/")[0]&&((e=a.split(".")).pop(),a=e.join(".")),a}}]).filter("bundleLessExt",[function(){return function(e){return null==e||"NA"===e?"":((e=e.split("/")[e.split("/").length-1].split(".")).pop(),e.join(".").endsWith("tar")&&e.pop(),e.join("."))}}]).filter("toTimeStr",[function(){return function(e){return e?e.replace(/T/g," ").replace(/Z/g,""):""}}]).filter("fileSize",[function(){return function(e){return 1048576<=parseInt(e)?(e/1024/1024).toFixed(2)+" MB (Approx.)":parseInt(e)<1048576&&1024<parseInt(e)?(e/1024).toFixed(2)+" KB (Approx.)":e+" B"}}]).filter("cut",[function(){return function(e,t,a,n){return e?!(a=parseInt(a,10))||e.length<=a?e:(e=e.substr(0,a),!t||-1!=(a=e.lastIndexOf(" "))&&(e=e.substr(0,a)),e+(n||"")):""}}]).filter("numberFilter",["$filter",function(d){return function(e,t){if(e&&t){for(var a,n,i,o,s,r=Object.keys(t),l=0;l<r.length;l++)if("boolean"!=t[r[l]].type)if("number"==t[r[l]].type){if(null!=t[r[l]].value&&String(t[r[l]].value).length){for(a in o=[],e)for(n in i=Object.keys(e[a]))if(i[n]==t[r[l]].field)switch(t[r[l]].operator){case">":e[a][i[n]]>t[r[l]].value&&o.push(e[a]);break;case"<":e[a][i[n]]<t[r[l]].value&&o.push(e[a]);break;case"=":e[a][i[n]]==t[r[l]].value&&o.push(e[a])}e=o}}else(s={})[t[r[l]].field]=t[r[l]].value,e=d("filter")(e,s);return e}return null}}]).filter("numberFixedLen",function(){return function(e,t){return(1e4+e+"").slice(-t)}}).filter("subStringToX",function(){return function(e,t){return e=e&&e.length>t?e.substring(0,t)+"...":e}}).filter("utcDate",function(){return function(e){return e=e&&(e=new Date(e)).getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()}}).filter("utcDateTZ",function(){return function(e){return e=e&&(e=new Date(e)).getUTCFullYear()+"-"+parseInt(e.getUTCMonth()+1)+"-"+e.getUTCDate()+"T"+e.getUTCHours()+":"+e.getUTCMinutes()+":"+e.getUTCSeconds()+"Z"}}).filter("tags",function(){return function(e){if(void 0===e)return"";var t,a="";if(Array.isArray(e)){for(t in e)a.length&&(a+=", "),a+=e[t]._label;return a}return e._label}}).filter("gbunescape",function(){return function(e){return unescape(e)}}).filter("unixDateTime",function(){return function(e){e=new Date(e);return Math.round(e.getTime()/1e3)}}).filter("internalDashboards",function(){return function(e){for(var t=[],a=0;a<e.length;a++)("Internal"===e[a].d_type||"Summary"===e[a].d_type&&"Internal"===e[a].typ)&&t.push(e[a]);return t}}).filter("removeDup",function(){return function(e){var t=[];return angular.forEach(e,function(a,e){var n=!1;angular.forEach(t,function(e,t){angular.equals(a.rule_name,e.rule_name)&&(n=!0)}),0==n&&""!=a.rule_name&&t.push(a)}),t}}).filter("unique",function(){return function(e,a){var n=[],i=[];return angular.forEach(e,function(e){var t=e[a];-1===i.indexOf(t)&&(i.push(t),n.push(e))}),n}}).filter("filterArrayItems",function(){return function(e,t,a){for(var n=[],i=0;i<e.length;i++){var o=e[i];a===o[t]&&n.push(o)}return n}}),angular.module("gbApp.controllers.explorer",["gbApp.services","gbApp.services.explorer","gbApp.globals"]).controller("ExplorerCtrl",["$scope","$cookies","$sce","$filter","ErrorService","ModalService","ExplorerService","InstanceHandler","GlobalService","AppService","$timeout","$window","$q","UserTrackingService","metaDataService","$interval",function(h,e,a,s,S,l,p,o,m,D,c,w,r,b,_,u){function v(e){!h.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(h.info.sessionTimedOut=!0,l.sessionTimeout())}$.get("../config/constants/explorer_constants.json",function(e,t){h.explorerconstants=e}),h.info={},h.$parent.justforflag.stillloading=!0,h.nographmarks=!1,h.exportCsvTitle=m.getVal("exportCsvTitle"),h.bottom10Title=m.getVal("bottom10Title"),h.top10Title=m.getVal("top10Title"),h.enableFacetStats=m.getVal("enableFacetStats"),h.noOfRecordsLbl=m.getVal("noOfRecordsLbl"),h.fromPageLbl=m.getVal("fromPageLbl"),h.minNoOFRecords=m.getVal("minNoOFRecords"),h.maxNoOFRecords=m.getVal("maxNoOFRecords"),h.limitFacet=m.getVal("limitFacet"),h.limitFacetTotal=m.getVal("limitFacetTotal"),h.events_export_limit=m.getVal("events_export_limit"),h.show_more_characters_limit=m.getVal("show_more_characters_limit"),h.gbStore={fromDate:"",toDate:""},h.timelineGraphDrilDown=[],h.ctrlId=h.$parent.activeTab.id,h.todayDate=_.getTodayDate(),h.csvpage=[],h.csvpage.pagevalue="current",null==h.events_export_limit||0==h.events_export_limit?h.csvpage.noOfRecordsCsv=1:h.csvpage.noOfRecordsCsv=h.events_export_limit,h.csvdownloaderror=!1,h.noOfRecordsCsv="",h.info.uploadedBy=null,h.info.hasSections=!1,h.info.hasEvents=!1,h.info.fromDate=null,h.info.toDate=null,h.info.fromTime={},h.info.refCount=0,h.info.toTime={},h.facets=[],h.selectedFacets={},h.info.chartLevel="YEAR",h.info.defaultLevel="YEAR",h.info.selectedEvtAttribs=[],h.info.tSelectedEvtAttribs=[],h.info.evtAttribs=[],h.info.selectedFilterName="Select View",h.info.showDropdown=!1,h.info.autoOpen=!0,h.defaultFacet=null,h.d3Attr={height:180,width:800},h.info.sortOrder={label:"Latest",val:"desc"},h.info.page={total:0,current:0,pages:0,count:10},h.info.urlList={},h.info.filterBtn="all",h.savedFiltersList=[],h.savedFiltersListNotFound=!1,h.allUsersInfo=[],h.currentUserId=null,h.exportUrl=null,h.info.facetCharts=[],h.info.pristine=!0,h.dateRangeFilterName=m.getVal("customdate"),h.info.facetLoading=!0,h.info.resultLoading=!0,h.info.dataLoading=!0,h.info.defaultState=!0,h.info.currentViewID=null,h.info.fields=[],h.info.eventSectionSelection=!0,h.info.defaultSearchText="*",h.info.facetLimit=m.getVal("facets_limit"),h.info.allConfigLoading=!0,h.toggleChartCnt=!0,h.info.response={docs:[],numFound:0},h.info.setDefaultFilterOperation={filterId:null,statusCode:0},h.info.changeFilterAccesibilityOperation={filterId:null,statusCode:0},h.saveModal={},h.form={},h.info.filterSuggest="*",h.info.filterSuggestApply=!1,h.info.filterSuggestLoading=!1,h.info.filterSuggestions=[{error:{label:"Start typing to get suggestions.",dataType:"none"}}],h.info.filterSuggestionsSectionsList=[],h.info.filterSuggestionsAttriList=[],h.info.filterSuggestLatest="",h.info.filterSuggestItem="",h.info.filterSavedFilterRemote=[],h.info.filterSuggestType="sections",h.info.filterSuggestSelectedSection=null,h.savedFiltersListNotLoaded=!0,h.facetLoadingGradually=!1,h.facetGradualFillingCount=0,h.facetDataLocally=[],h.info.sessionTimedOut=!1,h.info.eventGroupsLabel=m.getVal("event_group_tab_label"),h.info.statistics={loading:!1},h.d3Data=[],h.info.application=m.getVal("navExplorer"),h.info.rnaEnabled=_.getFeatures().rules_and_alerts,h.info.dataRestrictionMsg="",h.info.initialDatesSaved=!1,h.info.callRefreshIfFromDateInRange=!0,h.info.callRefreshIfToDateInRange=!0,h.reloadGraph=function(e){var t=[],a="";if(e&&e.obs_date&&e.obs_date.counts&&0!=e.obs_date.counts.length||(h.d3Data=[],e={obs_date:{end:"2018-07-24T04:00:04Z",gap:"+1YEAR/YEAR",start:"2013-01-31T04:00:04Z",counts:[]}}),0<=e.obs_date.gap.indexOf("YEAR"))for(a="Year View (UTC)",i=0;i<e.obs_date.counts.length/2;++i)t_data={},t_date=new Date(e.obs_date.counts[2*i].replace(/-/g,"/").replace("T"," ").substring(0,19)),t_data.name=t_date.getFullYear().toString(),t_data.actDate=t_date,t_data.value=e.obs_date.counts[2*i+1],t_data.link="j-drillDown-"+e.obs_date.counts[2*i],t_data.title=a,t.push(t_data);else if(0<=e.obs_date.gap.indexOf("MONTH"))for(a="Month View (UTC)",i=0;i<e.obs_date.counts.length/2;++i)t_data={},t_date=new Date(e.obs_date.counts[2*i].replace(/-/g,"/").replace("T"," ").substring(0,19)),t_data.name=t_date.getFullYear()+"-"+t_date.getMonthName().substring(0,3),t_data.actDate=t_date,t_data.value=e.obs_date.counts[2*i+1],t_data.link="j-drillDown-"+e.obs_date.counts[2*i],t_data.title=a,t.push(t_data);else if(0<=e.obs_date.gap.indexOf("DAY"))for(a="Day of Month View (UTC)",i=0;i<e.obs_date.counts.length/2;++i)t_data={},t_date=new Date(e.obs_date.counts[2*i].replace(/-/g,"/").replace("T"," ").substring(0,19)),t_data.name=(9<t_date.getDate()?t_date.getDate():"0"+t_date.getDate())+" "+t_date.getMonthName().substring(0,3),t_data.actDate=t_date,t_data.value=e.obs_date.counts[2*i+1],t_data.link="j-drillDown-"+e.obs_date.counts[2*i],t_data.title=a,t.push(t_data);else if(0<=e.obs_date.gap.indexOf("HOUR"))for(a="Hours View (UTC) (HH:MM Month-Date)",i=0;i<e.obs_date.counts.length/2;++i){t_data={};var n=e.obs_date.counts[2*i].replace(/-/g,"/").replace("T"," ").replace("Z","");t_date=new Date(n),t_data.name=(9<t_date.getHours()?t_date.getHours():"0"+t_date.getHours())+":"+(9<t_date.getMinutes()?t_date.getMinutes():"0"+t_date.getMinutes())+" "+t_date.getMonthNameShort()+" "+t_date.getDate(),t_data.actDate=t_date,t_data.value=e.obs_date.counts[2*i+1],t_data.link="j-drillDown-"+e.obs_date.counts[2*i],t_data.title=a,t.push(t_data)}else if(0<=e.obs_date.gap.indexOf("MINUTES"))for(a="Minutes View (UTC) (HH:MM)",i=0;i<e.obs_date.counts.length/2;++i){t_data={};var n=e.obs_date.counts[2*i].replace(/-/g,"/").replace("T"," ").replace("Z",""),o=(9<(t_date=new Date(n)).getHours()?t_date.getHours():"0"+t_date.getHours())+":"+(9<t_date.getMinutes()?t_date.getMinutes():"0"+t_date.getMinutes());t_data.name=o,t_data.actDate=t_date,t_data.value=e.obs_date.counts[2*i+1],t_data.link="j-drillDown-"+e.obs_date.counts[2*i],t_data.title=a,t.push(t_data)}else if(0<=e.obs_date.gap.indexOf("SECONDS"))for(a="Seconds View (UTC) (MM:SS)",i=0;i<e.obs_date.counts.length/2;++i){t_data={};n=e.obs_date.counts[2*i].replace(/-/g,"/").replace("T"," ").replace("Z",""),o=(t_date=new Date(n)).getMinutes()+":"+t_date.getSeconds();t_data.name=o,t_data.actDate=t_date,t_data.value=e.obs_date.counts[2*i+1],t_data.title=a,t.push(t_data)}else for(a="Year View (UTC)",i=0;i<e.obs_date.counts.length/2;++i)t_data={},t_date=new Date(e.obs_date.counts[2*i].replace(/-/g,"/").replace("T"," ").substring(0,19)),t_data.name=t_date,t_data.actDate=t_date,t_data.value=e.obs_date.counts[2*i+1],t_data.link="j-drillDown-"+e.obs_date.counts[2*i],t_data.title=a,t.push(t_data);t.reverse(),h.d3Data=t;var s=u(function(){d3.select("#explorerTab_"+h.$parent.activeTab.id+" .d3-chart-container-explorer").node().getBoundingClientRect().height&&(u.cancel(s),h.d3BarRender())},100);w.onresize=function(){return h.svg.selectAll("rect").remove(),h.d3BarRender()}},h.d3BarRender=function(){var e=h.d3Data;p.getDrillDown()&&h.svg.selectAll("#explorerTab_"+h.$parent.activeTab.id+" rect").remove(),void 0===h.svg&&(d3v4.selectAll("#explorerTab_"+h.$parent.activeTab.id+" .d3-chart-container-explorer svg").remove(),h.d3margin={top:30,right:30,bottom:20,left:80},h.d3width=d3v4.select("#explorerTab_"+h.$parent.activeTab.id+" .d3-chart-container-explorer").node().getBoundingClientRect().width-h.d3margin.left-h.d3margin.right,h.d3height=d3v4.select("#explorerTab_"+h.$parent.activeTab.id+" .d3-chart-container-explorer").node().getBoundingClientRect().height-h.d3margin.bottom-h.d3margin.top,h.svg=d3v4.select("#explorerTab_"+h.$parent.activeTab.id+" .d3-chart-container-explorer").append("svg").attr("width",h.d3width+h.d3margin.left+h.d3margin.right).attr("height",h.d3height+h.d3margin.top+h.d3margin.bottom).append("g").attr("transform","translate("+h.d3margin.left+","+h.d3margin.top+")"),h.x=d3v4.scaleBand().range([0,h.d3width]).padding(.2),h.xAxis=h.svg.append("g").attr("transform","translate(0,"+h.d3height+")").attr("class","myXaxis"),h.svg.append("text").attr("text-anchor","end").attr("transform","rotate(-90)").attr("y",15-h.d3margin.left).attr("x",-h.d3margin.top).text("Count").style("font-size","10px"),h.y=d3v4.scaleLinear().range([h.d3height,0]),h.yAxis=h.svg.append("g").attr("class","myYaxis")),0!==e.length||h.facetLoadingGradually?h.updateGraphData(e):(d3v4.selectAll("#explorerTab_"+h.$parent.activeTab.id+" .d3-chart-container-explorer svg").remove(),h.svg=void 0,d3v4.select("#explorerTab_"+h.$parent.activeTab.id+" .d3-chart-container-explorer").append("svg").attr("width",h.d3width+h.d3margin.left+h.d3margin.right).attr("height",h.d3height+h.d3margin.top+h.d3margin.bottom).append("g").attr("transform","translate("+h.d3margin.left+","+h.d3margin.top+")").append("text").attr("x",h.d3width/2).attr("y",h.d3height/2).style("font-size","12px").text("No Data Found"))},h.updateGraphData=function(e){var t=d3v4.max(e,function(e){return e.value}),e=(void 0===h.graphtooltip&&(h.graphtooltip=d3.select("body").append("div").attr("class","graphtoolTip")),h.svg.attr("class","chartlevel-"+h.info.chartLevel),d3v4.selectAll("#explorerTab_"+h.ctrlId+" .chartTitle").remove(),h.x.domain(e.map(function(e){return e.name})),(h.x.domain().length<=10?h.xAxis.call(d3v4.axisBottom(h.x)):10<h.x.domain().length&&h.x.domain().length<50?h.xAxis.call(d3v4.axisBottom(h.x).tickValues(h.x.domain().filter(function(e,t){return!(t%4)}))):h.xAxis.call(d3v4.axisBottom(h.x).tickValues(h.x.domain().filter(function(e,t){return!(t%11)})))).selectAll("text").attr("x","0"),h.svg.append("text").attr("x",h.d3width/2).attr("y",0-h.d3margin.top/2).style("font-size","12px").attr("class","chartTitle").text(e[0].title),h.y.domain([-.02*t,d3v4.max(e,function(e){return e.value})]),h.yAxis.transition().duration(1e3).call(d3v4.axisLeft(h.y).tickValues([0,d3v4.max(e,function(e){return e.value})-.6666*d3v4.max(e,function(e){return e.value}),d3v4.max(e,function(e){return e.value})-.3333*d3v4.max(e,function(e){return e.value}),d3v4.max(e,function(e){return e.value})])),h.svg.selectAll("rect").data(e));e.enter().append("rect").on("click",function(e){"SECONDS"!=h.info.chartLevel&&(h.graphtooltip.remove(),h.graphtooltip=void 0,expDrillDown(e.link))}).merge(e).on("mousemove",function(e){h.graphtooltip.style("left",d3v4.event.pageX-50+"px").style("top",d3v4.event.pageY-70+"px").style("display","inline-block").html("<small>"+e.name+"</small><br><b>"+e.value+"</b>")}).on("mouseout",function(e){h.graphtooltip.style("display","none")}).attr("x",function(e){return-1*(h.x.bandwidth()+h.x(e.name))}).attr("transform","rotate(180)").attr("y",-1*h.y(-.02*t)).attr("title",function(e){return e.value}).transition().duration(1e3).attr("width",h.x.bandwidth()).attr("height",function(e){return 0===e.value?0:h.d3height-h.y(e.value)}).attr("fill","#0079c1"),e.exit().remove(),h.svg.selectAll("rect").attr("class","cursor-pointer"),h.svg.selectAll("circle").attr("class","cursor-pointer")},h.hideFacets=function(){d3v4.select("#explorerTab_"+h.$parent.activeTab.id+" .d3-chart-container-explorer").selectAll("*").remove(),c(function(){h.svg=void 0,h.d3BarRender()},500)},p.getAllConfig().then(function(e){var t=e.data.Data;for(i in t&&t.ec_sysid_map&&""==t.ec_sysid_map.sysid1&&(t.ec_sysid_map.sysid1="sysid1"),h.customDateFilter=!0,h.customDateFilterApplied=!0,h.info.linkedAttribute=t,_.setGbConfig(t.config),h.info.sysId=t.ec_sysid_map.sysid1,D.isGbStudioApp()&&(t.config=t.default_config||t.config),h.info.config=t.config,h.info.max_days_in_sec=86400*t.config.MAX_DAY_RANGE_ALLOWED,h.info.default_days=t.config.DEFAULT_PERIOD_IN_SEC,h.info.explorerDataDuration=_.getExplorerDataDuration(),h.info.default_days&&(h.info.default_days=1e3*h.info.default_days),h.info.max_days_allowed=t.config.MAX_DAY_RANGE_ALLOWED,h.info.MinDate=new Date(_.getTodayDate()),h.info.MinDate.setDate(_.getTodayDate().getDate()-h.info.max_days_allowed),h.info.sectionsContent=t.sections_content,h.info.evtAttribsDefault=[],angular.forEach(t.event_columns,function(e,t){"evt_date_str"!=t&&"evt_text"!=t&&(e.key=t,h.info.evtAttribs.push(e),h.info.evtAttribsDefault.push(e))}),h.info.tSelectedEvtAttribs.push({key:"evt_date_str",dataType:"STRING",label:"Date",default:!0}),h.info.tSelectedEvtAttribs.push({key:"evt_text",dataType:"STRING",label:"Event Text",default:!0}),h.info.selectedEvtAttribs.push({key:"evt_date_str",dataType:"STRING",label:"Date",default:!0}),h.info.selectedEvtAttribs.push({key:"evt_text",dataType:"STRING",label:"Event Text",default:!0}),angular.forEach(t.facet_label_map,function(e){angular.forEach(e,function(e,t){var a={};a.key=t,a.label=e,a.data=[],a.expanded=!1,h.facets.push(a),h.selectedFacets[t]=[]})}),angular.forEach(t.sections_content,function(e){"EVENT"==e.nsType||"SESSION"==e.nsType?h.info.hasEvents=!0:"SECTION"==e.nsType&&(h.info.hasSections=!0)}),h.sectionsContent=t.sections_content,h.info.hasEvents&&(h.facets.push({key:"events",label:"Event Source",data:[],expanded:!1}),h.selectedFacets.events=[]),"EVENT"==h.info.config.DEFAULT_VIEW?(h.info.eventsection="event",h.info.events=!0,h.info.sections=!1):(h.info.eventsection="section",h.info.sections=!0,h.info.events=!1),D.isGbStudioApp()&&("EVENT"==h.info.config.DEFAULT_VIEW?!h.info.hasEvents&&h.info.hasSections&&(h.info.eventsection="section",h.info.sections=!0,h.info.events=!1):!h.info.hasSections&&h.info.hasEvents&&(h.info.eventsection="event",h.info.events=!0,h.info.sections=!1)),keys=Object.keys(t.config.fields))(field={}).key=keys[i],field.label=t.config.fields[keys[i]],h.info.fields.push(field);h.info.listView=!0,p.getStats().then(function(e){var t,a=_.getTodayDate();e.data.Data&&(h.info.statistics.obs_min=e.data.Data.obs_min,h.info.statistics.obs_max=e.data.Data.obs_max,e=(e=h.info.statistics.obs_min.replace("T"," ")).replace("Z",""),t=(t=h.info.statistics.obs_max.replace("T"," ")).replace("Z",""),h.info.solrEndDate=/^\s*\d{4}\-\d{2}-\d{2}T\d{2}\:\d{2}\:\d{2}Z$/.test(h.info.statistics.obs_max)&&_.getStringToDate(t)<a?_.getStringToDate(t):a,h.info.display_obs_min=_.getStringToDate(e),h.info.display_obs_max=_.getStringToDate(t),a=p.getBundleData(),h.info.allConfigLoading=!1,!a||p.getLoadView()?h.loadDefaultFilter():h.searchFromLogvault())},function(e){h.info.statistics.obs_min="",h.info.statistics.obs_max=""})},function(e){S.setError("explorer",m.getVal("config_fail")),v(e)}),h.updateBreadCrumb=function(e,t){h.customDateFilterApplied=!1,h.dateRangeFilterName=m.getVal("customdate"),h.customDateFilter=!0,h.info.drillDown=!0,h.info.quick=0;var a,n=_.getTodayDate();0==h.timelineGraphDrilDown.length&&(a=new Date(h.info.fromDate.getFullYear(),h.info.fromDate.getMonth(),h.info.fromDate.getDate(),h.info.fromTime.hr,h.info.fromTime.min,h.info.fromTime.sec),e=moment(a),e=new Date(e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second()),a=new Date(h.info.toDate.getFullYear(),h.info.toDate.getMonth(),h.info.toDate.getDate(),h.info.toTime.hr,h.info.toTime.min,h.info.toTime.sec),t=moment(a),t=new Date(t.year(),t.month(),t.date(),t.hour(),t.minute(),t.second())),h.timelineGraphDrilDown.push({ts:h.info.chartLevel,from:e,to:t,st:n.getTime()})},h.isShowBreadCrumb=function(){return h.timelineGraphDrilDown.length},h.changeBreadCrumb=function(){var e=h.timelineGraphDrilDown.pop();h.loadDataForBreadCrumb(e)},h.breadCrumbHistoryAction=function(e,t){for(var a=0;a<h.timelineGraphDrilDown.length;a++)if(h.timelineGraphDrilDown[a].ts==e.ts){t=a;break}h.timelineGraphDrilDown.splice(t,1),h.loadDataForBreadCrumb(e)},h.loadDataForBreadCrumb=function(e){var t,a;h.customDateFilterApplied=!1,h.dateRangeFilterName=m.getVal("customdate"),h.drillDown=!0,h.info.currentFacet=null;var n=e.ts;if(0!=h.timelineGraphDrilDown.length)switch(t=new Date(e.from),a=new Date(e.to),n){case"YEAR":h.setFromTo(t,a);break;case"MONTH":t.setMonth(0),t.setDate(1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),a.setMonth(12),a.setDate(0),a.setHours(23),a.setMinutes(59),a.setSeconds(59),h.setFromTo(t,a);break;case"DAY":t.setDate(1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),a.setMonth(a.getMonth()+1),a.setDate(0),a.setHours(23),a.setMinutes(59),a.setSeconds(59),h.setFromTo(t,a);break;case"HOUR":t.setHours(0),t.setMinutes(0),t.setSeconds(0),a.setHours(23),a.setMinutes(59),a.setSeconds(59),h.setFromTo(t,a);break;case"MINUTES":t.setMinutes(0),t.setSeconds(0),a.setMinutes(59),a.setSeconds(59),h.setFromTo(t,a)}else h.setFromTo(e.from,e.to)},h.getFacetName=function(e){for(var t=0;t<h.facets.length;t++)if(h.facets[t].key==e)return h.facets[t].label},h.getFacet=function(e){for(var t=0;t<h.facets.length;t++)if(h.facets[t].key==e)return h.facets[t]};var M=null,V=null;function L(e,r){if(h.facets.map(function(e){h.info.currentFacet&&h.info.currentFacet.label===e.label&&h.info.currentFacet.key===e.key||(e.data=[])}),e.hasOwnProperty("gb_error"))h.info.hideFacets=!0;else{var t,a,n,l=h.info.hideFacets=!1,o=(1==h.info.notFacetSearch&&(l=!0,h.info.notFacetSearch=!1),h.facetCounts=e.facet_counts,!0);for(t in h.selectedFacets)if(0<h.selectedFacets[t].length){o=!1;break}for(i in o&&(h.info.currentFacet=void 0),angular.forEach(e.facet_counts.facet_fields,function(e,t){var a,n,i,o,s;if("namespace"!=t||h.info.currentFacet&&("namespace"==h.info.currentFacet.key||"events"==h.info.currentFacet.key)){for(h.info.currentFacet&&h.info.currentFacet.data&&1==h.info.currentFacet.data.length&&!h.info.currentFacet.data[0].selected&&(h.info.currentFacet=void 0),n=0;n<h.facets.length;++n)if(h.facets[n].key===t&&"namespace"!=t&&(l||!h.info.currentFacet||h.info.currentFacet.key!=t)){for(h.facets[n].data=[],i=0;i<e.length;i+=2)(a={}).title=h.facets[n].label,a.label=e[i],a.value=e[i+1],a.selected=!1,h.facets[n].data.push(a);r&&(h.facets[n].expanded=!1);break}}else{for(n in h.facets)"namespace"==h.facets[n].key&&(s=n),"events"==h.facets[n].key&&(o=n);for(s&&(h.facets[s].data=[]),o&&(h.facets[o].data=[]),n=0;n<e.length;n+=2)a={},h.info.sectionsContent[e[n]]&&(a.label=h.info.sectionsContent[e[n]].description,a.value=e[n+1],a.key=e[n],a.selected=!1,!o||"EVENT"!=h.info.sectionsContent[e[n]].nsType&&"SESSION"!=h.info.sectionsContent[e[n]].nsType?s&&(a.title="Section Name",h.facets[s].data.push(a),r&&(h.facets[s].expanded=!1)):(a.title="Event Source",h.facets[o].data.push(a),r&&(h.facets[o].expanded=!1)))}}),h.facets)for(j in h.selectedFacets[h.facets[i].key]){for(k=0;k<h.facets[i].data.length;++k)if(h.selectedFacets[h.facets[i].key][j].key){if(h.selectedFacets[h.facets[i].key][j].key==h.facets[i].data[k].key){h.facets[i].data[k].selected=!0,h.facets[i].expanded=!0;break}}else if(h.selectedFacets[h.facets[i].key][j].label==h.facets[i].data[k].label){h.facets[i].data[k].selected=!0,h.facets[i].expanded=!0;break}k>=h.facets[i].data.length&&(h.selectedFacets[h.facets[i].key][j].selected=!0,h.facets[i].data.push(h.selectedFacets[h.facets[i].key][j]))}e.facet_counts.facet_ranges.obs_date?(n=e.facet_counts.facet_ranges.obs_date.start,a=e.facet_counts.facet_ranges.obs_date.end,n&&(n=(n=n.replace("T"," ")).replace("Z",""),(n=_.getStringToDate(n)).getTime()!=new Date(""+h.gbStore.fromDate).getTime()&&(h.info.fromDate=n,h.gbStore.fromDate=n)),a&&(a=(a=a.replace("T"," ")).replace("Z",""),(n=_.getStringToDate(a)).getTime()!=new Date(""+h.gbStore.toDate).getTime()&&(h.info.toDate=n,h.gbStore.toDate=n)),h.info.fromTime.hr=h.info.fromDate.getHours(),h.info.fromTime.min=h.info.fromDate.getMinutes(),h.info.fromTime.sec=h.info.fromDate.getSeconds(),h.info.toTime.hr=h.info.toDate.getHours(),h.info.toTime.min=h.info.toDate.getMinutes(),h.info.toTime.sec=h.info.toDate.getSeconds(),h.info.chartLevel=e.facet_counts.facet_ranges.obs_date.gap.split("/")[1],h.reloadGraph(e.facet_counts.facet_ranges)):h.reloadGraph([])}}h.refresh=function(o,e){e?p.setDrillDown(!0):p.setDrillDown(!1),D.isGbStudioApp()&&("EVENT"==h.info.config.DEFAULT_VIEW?!h.info.hasEvents&&h.info.hasSections&&(h.info.eventsection="section",h.info.sections=!0,h.info.events=!1):!h.info.hasSections&&h.info.hasEvents&&(h.info.eventsection="event",h.info.events=!0,h.info.sections=!1)),V=M,h.info.dataTabs=!1,M=h.info.eventsection,h.info.dataLoading=!0,h.info.refCount++;var a,s={},c=(angular.forEach(h.selectedFacets,function(e,t){if(Array.isArray(s[t])||"events"==t||"namespace"==t||(s[t]=[]),"events"==t||"namespace"==t)for(a in e)s[t]||(s[t]=[]),s[t].push(e[a].key);else for(a in e)s[t].push(e[a].label)}),h.info.page.count),u=h.info.page.current*h.info.page.count,t=h.getFrom(e),e=h.getTo(e),n=h.info.sortOrder.val,i="",r=h.info.quick,f=h.info.uploadedBy,g=(h.dateRangeFilterName,h.info.events?"EVENT":"SECTION"),t=t+"/"+e+"/"+u+"/"+c+"/"+g,e={},l=!1;if(Object.keys(s).length)for(key in s)if(s[key]&&s[key].length&&0<s[key].length){""!=i&&(i+=" ~||~ ");for(var d=0;d<s[key].length;d++)""==i?i=("events"==key?"namespace":key)+'="'+s[key][d]+'"':0==d?i+=("events"==key?"namespace":key)+'="'+s[key][d]+'"':(i=i.replace(/(\")$/g,""),i+="~"+s[key][d]+'"')}h.defaultFacet&&(i=i?'obs_url="'+h.defaultFacet.label+'" ~||~ '+i:'obs_url="'+h.defaultFacet.label+'"'),h.facetStr=null,i&&(e.filter=i,h.facetStr=i),r&&(e.quick_filter=r,1==h.drillDown&&(e.drill_down=!0)),n&&(e.sortby="obs_date "+n),f&&(e.uploaded_by=f),-1!=h.info.filterSuggest.indexOf("CompoundSearch=")&&(l=!0,0==h.info.page.current?e.compound_search="new":e.compound_search="pagination"),""==h.info.filterSuggest&&(h.info.filterSuggest="*"),""===h.info.filterSuggest||"*"===h.info.filterSuggest?h.info.filterSuggestApply=!1:h.info.filterSuggestApply=!0,h.info.viewLoad?h.info.viewLoad=!1:h.info.selectedFilterName="Select View",h.info.queryParam=e,p.getData(t,e,h.info.filterSuggest).then(function(e){h.$parent.justforflag.stillloading=!1;var a,t,n,i=e.data.Data,e=(h.responseMessage=e.data.Msg,h.info.resultLoading=!1,h.info.dataLoading=!1,{});if(h.info.clearFilter||h.info.sorting||h.info.changePageSize?h.info.changePageSize&&(e.Count=h.info.page.count):(n={},angular.forEach(s,function(e,t){e.length&&angular.forEach(e,function(e){n.hasOwnProperty(t)||(n[t]=[]),n[t].push(e)})}),Object.keys(n).length&&(e["Facets Selected"]=n),h.dateRangeFilterName&&(e["Quick Filter"]=h.dateRangeFilterName),e["Time Range"]=h.getFrom()+" - "+h.getTo(),e["Sort Order"]="desc"==h.info.sortOrder.val?"Descending":"Ascending",e["Search Text"]=encodeURIComponent(h.info.filterSuggest.replace(/\'/g,"%27")),e["Search Type"]=g),1==h.drillDown?h.drillDown=!(t="Drill Down"):1==h.info.zoomout?h.info.zoomout=!(t="Default Graph View"):1==h.info.clearFilter?h.info.clearFilter=!(t="Clear Filter"):1==h.info.sorting?(t="Sort "+("desc"==h.info.sortOrder.val?"Descending":"Ascending"),h.info.sorting=!1):1==h.info.changePageSize?h.info.changePageSize=!(t="Change Page Count"):1==h.info.quickFilter?(t=h.dateRangeFilterName,h.info.quickFilter=!1):t="filter",1==h.info.paginate?h.info.paginate=!1:b.standard_user_tracking(h.info.application,h.info.events?"Event":"Section",t,JSON.stringify(e),i.solr_query).then(y,v),l){if(i.hasOwnProperty("gb_error"))return h.reloadGraph(null),h.d3BarRender(),"ERR_3"==i.gb_error||"ERR_8"==i.gb_error||"ERR_14"==i.gb_error?(h.info.no_result=!0,h.response=null,h.info.err_msg=1):"ERR_2"==i.gb_error?(h.info.no_result=!0,h.response=null,h.info.err_msg=2):"ERR_13"==i.gb_error&&(h.info.no_result=!0,h.response=null,h.info.err_msg=3),void(M!=V&&L(i));L(i)}"ERR_3"==i.gb_error||"ERR_8"==i.gb_error||"ERR_14"==i.gb_error?(h.info.no_result=!0,h.response=null,h.info.err_msg=1):"ERR_2"==i.gb_error?(h.info.no_result=!0,h.response=null,h.info.err_msg=2):"ERR_13"==i.gb_error?(h.info.no_result=!0,h.response=null,h.info.err_msg=3):"ERR_0"==i.gb_error?w.location.href=m.getVal("redirect_login_url"):(h.info.no_result=!1,h.response=i.response,o||h.loadFacetsGraduallyUpdatePagination(i),a=0,angular.forEach(i.response.docs,function(e,t){angular.forEach(i.highlighting,function(e,t){t==h.response.docs[a].namespace_id&&e.content&&e.content[0]&&(h.response.docs[a].content=e.content[0].replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/&lt;em&gt;/g,"<em>").replace(/&lt;\/em&gt;/g,"</em>").replace(/~~/g,"<br>"))}),a++})),h.response&&h.response.docs&&0!=h.response.docs.length||(h.info.hideFacets=!0)},function(e){400===e.status&&"Failure"===e.data.Status?(S.setError("explorer",e.data.Msg),h.info.err_msg=9,h.info.badRequestMsg=e.data.Msg):(S.setError("explorer",m.getVal("data_fail")),h.info.err_msg=1),h.info.resultLoading=!1,h.info.dataLoading=!1,h.drillDown=!1,h.info.zoomout=!1,h.info.clearFilter=!1,h.info.sorting=!1,h.info.changePageSize=!1,h.info.paginate=!1,h.info.no_result=!0,h.response=null,v(e)}),o||l||h.loadFacetsGradually(t,e,h.info.filterSuggest,M)},h.loadFacetsGradually=function(t,a,n,i){t+="?sortby=obs_date desc&facet_collection_head=",h.facetDataLocally=[],h.facetLoadingGradually=!0,h.showGradualfillingProgressbar(0),h.drillDown||(h.timelineGraphDrilDown=[]),m.cancelAllAPIs("/explorer/search/facets/"),h.loadFacetsGraduallyTimmer&&c.cancel(h.loadFacetsGraduallyTimmer),h.info.facetsLoading=!0,p.getFacetsGrdually(t,a,n).then(function(e){h.loadFacetsGraduallySuccessful(e,t,a,n,i)},function(e){-1!=e.status&&h.loadFacetsGraduallyFailure(e,t,a,n,i)})},h.loadFacetsGraduallySuccessful=function(e,t,a,n,i){e=e.data.Data;h.info.facetLoading=!1,h.info.facetsLoading=!1,"ERR_3"==e.gb_error||"ERR_8"==e.gb_error||"ERR_14"==e.gb_error?(h.reloadGraph(null),h.facetLoadingGradually=!1,h.d3BarRender(),i!=V&&L(e)):"ERR_2"==e.gb_error||"ERR_13"==e.gb_error?(h.facetLoadingGradually=!1,h.reloadGraph(null),h.d3BarRender(),i!=V&&L(e)):"ERR_0"==e.gb_error?(h.facetLoadingGradually=!1,w.location.href=m.getVal("redirect_login_url")):(L(e,!0),(h.facetDataLocally=e).done?(h.facetLoadingGradually=!1,h.loadFacetsGraduallyUpdatePagination(e)):(h.loadFacetsGraduallyUpdateFacets(e,!0),h.loadFacetsGraduallyCallUntillGetCompleteData(t,a,n,i,e.next)))},h.loadFacetsGraduallyUpdatePagination=function(e){if(e.facet_counts&&e.facet_counts.facet_ranges&&e.facet_counts.facet_ranges.obs_date&&e.facet_counts.facet_ranges.obs_date.counts){for(var t=0,a=e.facet_counts.facet_ranges.obs_date.counts,n=0;n<a.length;n++)n%2==0&&(t+=a[n+1]);h.paginator(t)}},h.loadFacetsGraduallyFailure=function(e,t,a,n,i){400===e.status&&"Failure"===e.data.Status?(h.info.err_msg=9,h.info.badRequestMsg=e.data.Msg):h.info.err_msg=1,h.facetLoadingGradually=!1,h.info.facetLoading=!1,h.info.facetsLoading=!1,h.info.resultLoading=!1,h.info.dataLoading=!1,h.info.no_result=!0,h.reloadGraph(null),h.d3BarRender(),v(e)},h.loadFacetsGraduallyCallUntillGetCompleteData=function(t,a,n,i,e){h.loadFacetsGraduallyTimmer=c(function(){p.getFacetsGrdually(t,a,n,e).then(function(e){e=e.data.Data;h.loadFacetsGraduallyUpdateFacets(e),e.done?h.facetLoadingGradually=!1:h.loadFacetsGraduallyCallUntillGetCompleteData(t,a,n,i,e.next)},function(e){v(e)})},500)},h.loadFacetsGraduallyUpdateFacets=function(e,t){if(e.percComplete&&h.showGradualfillingProgressbar(e.percComplete),e.facet_counts.facet_ranges&&e.facet_counts.facet_ranges.obs_date&&e.facet_counts.facet_ranges.obs_date.counts)if(h.facetDataLocally.facet_counts&&h.facetDataLocally.facet_counts.facet_ranges&&h.facetDataLocally.facet_counts.facet_ranges.obs_date&&h.facetDataLocally.facet_counts.facet_ranges.obs_date.counts){if(t)return h.facetDataLocally.facet_counts.facet_ranges.obs_date.counts=h.loadFacetsGraduallyUpdateFacetsGraph([],angular.copy(e.facet_counts.facet_ranges.obs_date.counts)),void L(h.facetDataLocally);h.facetDataLocally.facet_counts.facet_ranges.obs_date.counts=h.loadFacetsGraduallyUpdateFacetsGraph(h.facetDataLocally.facet_counts.facet_ranges.obs_date.counts,angular.copy(e.facet_counts.facet_ranges.obs_date.counts))}else h.facetDataLocally.facet_counts||(h.facetDataLocally.facet_counts={}),h.facetDataLocally.facet_counts.facet_ranges||(h.facetDataLocally.facet_counts.facet_ranges={}),h.facetDataLocally.facet_counts.facet_ranges.obs_date||(h.facetDataLocally.facet_counts.facet_ranges.obs_date={}),h.facetDataLocally.facet_counts.facet_ranges.obs_date.counts||(h.facetDataLocally.facet_counts.facet_ranges.obs_date.counts=[]),h.loadFacetsGraduallyUpdateFacetsGraph(h.facetDataLocally.facet_counts.facet_ranges.obs_date.counts,angular.copy(e.facet_counts.facet_ranges.obs_date.counts)),h.facetDataLocally.facet_counts.facet_ranges=angular.copy(e.facet_counts.facet_ranges);if(e.facet_counts&&e.facet_counts.facet_fields){var a,n=h.facetDataLocally.facet_counts.facet_fields,i=angular.copy(e.facet_counts.facet_fields);for(a in i)if(n[a])for(var o=i[a],s=n[a],r=0;r<o.length;r++){for(var l=!1,d=0;d<s.length;d++)if(d%2==0&&r%2==0&&s[d]===o[r]){s[d+1]=s[d+1]+o[r+1],l=!0;break}l||r%2!=0||(s.push(o[r]),s.push(o[r+1]))}else n[a]=i[a]}L(h.facetDataLocally)},h.loadFacetsGraduallyUpdateFacetsGraph=function(e,t){if(0==e.length){for(var a=0,n=0;n<t.length;n++)n%2==0&&(e[n]=t[n],e[n+1]=t[n+1],a+=e[n+1]);return h.paginator(a),e}for(n=0;n<t.length;n++)for(var i=0;i<e.length;i++)n%2==0&&i%2==0&&t[n]===t[i]&&(e[i+1]=e[i+1]+t[n+1]);for(a=0,i=0;i<e.length;i++)i%2==0&&(a+=e[i+1]);return h.paginator(a),e},h.showGradualfillingProgressbar=function(e){$("#gb-gradualfilling-page-loader .gb-page-loader-gradualfilling-bar").css("width",e+"%"),h.facetGradualFillingCount=e},h.showContent=function(e,t){if(e.content)return e.content.length<=150?(e.showExpanded=!1,"*"===h.info.filterSuggest||""===h.info.filterSuggest?a.trustAsHtml(unescape(escape(e.content))):a.trustAsHtml(e.content.replace(new RegExp(h.info.filterSuggest.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),"gi"),'<span class="highlight">$&</span>'))):(e.showExpanded=!0,1==t?"*"===h.info.filterSuggest||""===h.info.filterSuggest?a.trustAsHtml(e.content.substring(0,150)):a.trustAsHtml(e.content.substring(0,150).replace(new RegExp(h.info.filterSuggest.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),"gi"),'<span class="highlight">$&</span>')):"*"===h.info.filterSuggest||""===h.info.filterSuggest?a.trustAsHtml(e.content.substring(0,h.show_more_characters_limit)):a.trustAsHtml(e.content.substring(0,h.show_more_characters_limit).replace(new RegExp(h.info.filterSuggest.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),"gi"),'<span class="highlight">$&</span>')))},h.resetFromUI=function(){h.info.selectedFilterName="Select View",h.info.clearFilter=!0,h.customDateFilter=!0,h.customDateFilterApplied=!0,h.info.drillDown=!1,h.info.page.current=0,h.info.initialDatesSaved=!1,h.info.callRefreshIfFromDateInRange=!0,h.info.callRefreshIfToDateInRange=!0,h.reset(!0)},h.checkChange=function(e,t){h.info.defaultState=!1,h.info.page.current=0,h.info.pristine=!1,h.info.drillDown=!1,t.selected?h.addSelected(e,t):h.removeSelected(e,t)},h.isNoFilteredFacetFound=function(e){var t=e.filter;return!!t&&!(0<e.data.filter(function(e){return!!e.label&&-1!=e.label.toLowerCase().indexOf(t.toLowerCase())}).length)},h.showfacetSelectAllOption=function(e){return!!e.filter||!!h.info.filterSuggestApply},h.facetSelectAll=function(e){void 0===e.selectAll&&(e.selectAll=!1),h.noRefresh=!1;m.getVal("limitFacetMsg"),m.getVal("limitFacetMsg1");var t=0,a=(h.msg="",!1),n=e.data,o=e.filter,s=e.selectAll;for(o?n.map(function(e){if(!e.label)return!1;-1!=e.label.toLowerCase().indexOf(o.toLowerCase())?e.selected=!s:e.selected=!1}):n.map(function(e){if(!e.label)return!1;e.selected=!s}),i=0;i<n.length;i++)n[i].selected&&t++;for(key in h.selectedFacets)0<h.selectedFacets[key].length&&(key!=e.key&&(a=!0),t=h.selectedFacets[key].length+t);a&&t>h.limitFacetTotal?(h.msg=m.getVal("limitFacetTotalMsg1")+h.limitFacetTotal,h.modal1=l.openModal("partials/alert_box_extra.html",h,!1,!0),n.map(function(e){if(!e.label)return!1;e.selected=!!s})):!a&&t>h.limitFacet?(h.msg=m.getVal("limitFacetMsg1")+h.limitFacet,h.modal1=l.openModal("partials/alert_box_extra.html",h,!1,!0),n.map(function(e){if(!e.label)return!1;e.selected=!!s})):(h.facetApplyMultiple(e,s),e.selectAll=!e.selectAll)},h.isAllFacetSelected=function(e){for(var t=e.data,a=!0,n=0;n<t.length;n++)if(!t[n].selected){a=!1;break}return a},h.selectAllFacetsLabel=function(e){return e.selectAll=h.isAllFacetSelected(e),e.selectAll?"Unselect all":"Select all"},h.getSelectedFacetData=function(e){return h.facets[e]},h.facetApplyMultiple=function(e,t){var a,n,i=e.data,o=0;if(t)for(var s=i.filter(function(e){return!e.selected}),r=0;r<s.length;r++)a=s[r],h.removeSelected(e,a,!0);else for(s=i.filter(function(e){return!!e.selected}),r=0;r<s.length;r++)a=s[r],h.addSelected(e,a,!0);for(n in h.info.defaultState=!1,h.selectedFacets)0!=h.selectedFacets[n].length&&(o=h.selectedFacets[n].length+o);h.info.page.current=0,h.info.pristine=!1,h.info.currentFacet=e,h.refresh()},h.facetApplyFromMoreWindow=function(e,t,a){h.selectedFacets[e.key]&&(h.selectedFacets[e.key]=[]),h.facets[a].data.map(function(e){e.selected=!1});for(var n=0;n<t.length;n++)h.addSelected(e,t[n],!0);h.info.defaultState=!1,h.info.page.current=0,h.info.pristine=!1,h.info.currentFacet=e,h.refresh()},h.checkDisabled=function(e,t){for(var a in h.selectedFacets[e.key])if(h.selectedFacets[e.key][a].label===t.label&&h.selectedFacets[e.key][a].disabled)return t.disabled=!0;return!1},h.changeEventSection=function(){if(h.toggleChartCnt=!0,"section"==h.info.eventsection)h.info.sections=!0,h.info.events=!1,h.info.selectedFilterName="Select View";else{if("event"!=h.info.eventsection)return;h.info.sections=!1,h.info.events=!0,h.info.selectedFilterName="Select View"}-1==h.info.filterSuggest.indexOf("CompoundSearch=")||"section"!=h.info.eventsection?(h.info.currentFacet=void 0,h.selectedFacets={},"*"!=h.info.filterSuggest&&""!=h.info.filterSuggest||h.dateRangeFilterName!=m.getVal("customdate")||new Date(h.info.toDate).getTime()!==new Date(h.info.solrEndDate).getTime()||(h.info.pristine=!0),h.info.page.current=0,h.refresh()):l.alertBox({msgKey:"events_only"})},h.toggleTimelineGraph=function(){h.toggleChartCnt=!h.toggleChartCnt,h.logToggleTimeline(h.toggleChartCnt)},h.isInEvent=function(){return"event"==h.info.eventsection},h.addSelected=function(e,t,a){h.info.defaultState=!1,h.info.currentFacet=e,h.selectedFacets[e.key]||(h.selectedFacets[e.key]=[]),h.isCheckSelectedFacetExist(h.selectedFacets[e.key],t)||(t.groupName=t.title,t.groupCount=h.selectedFacets[e.key].length+1,h.selectedFacets[e.key].push(t)),h.info.pristine=!1,a||h.refresh()},h.isCheckSelectedFacetExist=function(e,t){for(var a=0;a<e.length;a++)if(e[a].label==t.label)return!0;return!1},h.removeSelected=function(e,t,a){for(n in h.info.defaultState=!1,h.info.currentFacet=e,h.selectedFacets[e.key])if(h.selectedFacets[e.key][n].label===t.label){h.selectedFacets[e.key].splice(n,1);break}var n,i=!1;for(n in h.selectedFacets)for(var o=0;o<h.selectedFacets[n].length;o++)if(!h.selectedFacets[n][o].disabled){i=!0;break}i||!h.customDateFilter?h.info.pristine=!1:h.info.pristine=!0,a||h.refresh()},h.removeFacet=function(e,t){h.info.defaultState=!1,h.info.page.current=0,h.info.pristine=!1,h.info.drillDown=!1,t.selected=!1,h.info.currentFacet=h.getFacet(e);for(var a=0;a<h.info.currentFacet.data.length;a++)t.label===h.info.currentFacet.data[a].label&&(h.info.currentFacet.data[a].selected=!1);var n,i=!1;for(n in h.selectedFacets[e].splice(h.selectedFacets[e].indexOf(t),1),0==h.selectedFacets[e].length&&(h.selectedFacets[e]=[]),h.selectedFacets)for(var o=0;o<h.selectedFacets[n].length;o++)if(!h.selectedFacets[n][o].disabled){i=!0;break}i||!h.customDateFilter?h.info.pristine=!1:h.info.pristine=!0,h.refresh()},h.removeFacetGroup=function(e,t){h.info.defaultState=!1,h.info.currentFacet=null,h.info.pristine=!1;for(var a,n=t.selected=!1,i=h.selectedFacets[e].length,a=0;a<i;a++)h.selectedFacets[e].splice(h.selectedFacets[e].indexOf(h.selectedFacets[e][a]),1);for(a in h.selectedFacets[e].count=h.selectedFacets[e].length,0==h.selectedFacets[e].length&&(h.selectedFacets[e]=[]),h.selectedFacets)for(var o=0;o<h.selectedFacets[a].length;o++)if(!h.selectedFacets[a][o].disabled){n=!0;break}n||!h.customDateFilter?h.info.pristine=!1:h.info.pristine=!0,h.refresh()},h.removeDefaultFacet=function(){h.defaultFacet=null;var e,t=!1;for(e in h.selectedFacets)for(var a=0;a<h.selectedFacets[e].length;a++)if(!h.selectedFacets[e][a].disabled){t=!0;break}t||!h.customDateFilter?h.info.pristine=!1:h.info.pristine=!0,""!==h.info.explorerDataDuration?h.reset():h.refresh()},h.getExportUrl=function(e){var a,n={},c=(angular.forEach(h.selectedFacets,function(e,t){if(Array.isArray(n[t])||"events"==t||"namespace"==t||(n[t]=[]),"events"==t||"namespace"==t)for(a in e)n.namespace||(n.namespace=[]),n.namespace.push(e[a].key);else for(a in e)n[t].push(e[a].label)}),h.csvpage.noOfRecordsCsv),e=1==e?0:h.info.page.current*h.info.page.count,t=h.getFrom(),i=h.getTo(),o=h.info.sortOrder.val,s="",r=h.info.quick,l=h.info.uploadedBy,t=(h.dateRangeFilterName,t+"/"+i+"/"+e+"/"+c+"/"+(h.info.events?"EVENT":"SECTION")),i={};if(Object.keys(n).length)for(key in n)if(n[key]&&n[key].length&&0<n[key].length){""!=s&&(s+=" ~||~ ");for(var d=0;d<n[key].length;d++)""==s?s=key+'="'+n[key][d]+'"':0==d?s+=key+'="'+n[key][d]+'"':(s=s.replace(/(\")$/g,""),s+="~"+n[key][d]+'"')}(s=h.defaultFacet?s?'obs_url="'+h.defaultFacet.label+'" ~||~ '+s:'obs_url="'+h.defaultFacet.label+'"':s)&&(i.filter=s),r&&(i.quick_filter=r),o&&(i.sortby="obs_date "+o),l&&(i.uploaded_by=l),-1!=h.info.filterSuggest.indexOf("CompoundSearch=")&&(i.compound_search="pagination");e=document.getElementById("gb-download-bundle-hidden-form");e.action=p.getExportUrl(t,i),document.getElementById("gb-download-bundle-hidden-form-searchtext").value=h.info.filterSuggest,e.submit()},h.setFromTo=function(e,t,a,n){h.info.fromDate=e,h.info.fromTime.hr=e.getHours(),h.info.fromTime.min=e.getMinutes(),h.info.fromTime.sec=e.getSeconds();var i=_.getTodayDate();new Date(t)>i?a||(h.info.bundleToDate=t):h.info.bundleToDate=null,h.info.toDate=t,h.info.toTime.hr=t.getHours(),h.info.toTime.min=t.getMinutes(),h.info.toTime.sec=t.getSeconds(),h.info.page.current=0,h.defaultFacet&&(i=new Date(e).getTime()<=new Date(h.info.fromDateOfLogVault).getTime(),h.info.dateRestrictionMinDate=i?e:h.info.fromDateOfLogVault),h.info.callRefreshIfFromDateInRange||h.info.callRefreshIfToDateInRange?h.refresh(!1,a):(h.info.no_result=!0,h.response=null,h.info.err_msg=0,t=h.getValue("data_restriction_savedviews"),h.info.dataRestrictionMsg=t.replace("${val}",h.info.explorerDataDuration),h.info.hideFacets=!0,h.d3Data=[],h.d3BarRender(),h.info.resultLoading=!1,h.info.dataLoading=!1,h.info.viewLoad=!1)},h.getFrom=function(e){var t=new Date(h.info.fromDate.getFullYear(),h.info.fromDate.getMonth(),h.info.fromDate.getDate(),h.info.fromTime.hr,h.info.fromTime.min,h.info.fromTime.sec);return(h.info.fromDate=t).getFullYear()+"-"+h.makeT2DigitValue(parseInt(t.getMonth()+1))+"-"+h.makeT2DigitValue(t.getDate())+"T"+h.makeT2DigitValue(h.info.fromTime.hr)+":"+h.makeT2DigitValue(h.info.fromTime.min)+":"+h.makeT2DigitValue(h.info.fromTime.sec)+"Z"},h.makeT2DigitValue=function(e){return parseInt(e)<10?"0"+e:e},h.$watch("info.toDate",function(){var e=_.getTodayDate();e<h.info.toDate&&(h.info.toDate=e)}),h.$watch("info.resultLoading",function(){h.info.resultLoading||D.hidePanelLoading()}),h.$on("AppLoadEvent-explorer",function(e,t){h.info.resultLoading||D.hidePanelLoading(),t&&(console.log(h.tabContainId),p.getLoadView()&&!h.info.allConfigLoading?h.loadDefaultFilter():h.tabContainId==h.$parent.activeTab.id&&h.searchFromLogvault())}),h.getTo=function(e){var t=_.getTodayDate();return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t=h.defaultFacet&&h.info.bundleToDate&&h.info.toDate>t?new Date(h.info.bundleToDate):new Date(h.info.toDate.getFullYear(),h.info.toDate.getMonth(),h.info.toDate.getDate(),h.info.toTime.hr,h.info.toTime.min,h.info.toTime.sec),(h.info.toDate=t).getFullYear()+"-"+h.makeT2DigitValue(parseInt(t.getMonth()+1))+"-"+h.makeT2DigitValue(t.getDate())+"T"+h.makeT2DigitValue(h.info.toTime.hr)+":"+h.makeT2DigitValue(h.info.toTime.min)+":"+h.makeT2DigitValue(h.info.toTime.sec)+"Z"},h.getError=function(){return S.getErrors("explorer")},h.getSysErrors=function(){return S.getErrors("gbApp")},h.renderHtml=function(e){return a.trustAsHtml(e)},h.addAttrib=function(e){h.info.tSelectedEvtAttribs.length>=m.getVal("max_evt_attr")?l.alertBox({msgKey:"max_evt_attr_msg"}):(h.info.evtAttribs.splice(h.info.evtAttribs.indexOf(e),1),h.info.tSelectedEvtAttribs.push(e))},h.removeAttrib=function(e){e.default||(h.info.evtAttribs.push(e),h.info.tSelectedEvtAttribs.splice(h.info.tSelectedEvtAttribs.indexOf(e),1))},h.removeAllAttrib=function(){for(var e in h.info.tSelectedEvtAttribs)h.info.tSelectedEvtAttribs[e].default||h.info.evtAttribs.push(h.info.tSelectedEvtAttribs[e]);h.info.tSelectedEvtAttribs.length=0,h.info.tSelectedEvtAttribs.push({key:"evt_date_str",dataType:"STRING",label:"Date",default:!0}),h.info.tSelectedEvtAttribs.push({key:"evt_text",dataType:"STRING",label:"Event Text",default:!0})},h.saveEvtAttrib=function(){for(var e in h.info.selectedEvtAttribs.length=0,h.info.tSelectedEvtAttribs)h.info.selectedEvtAttribs[e]=h.info.tSelectedEvtAttribs[e];h.refresh()},h.cancelEvtAttrib=function(){for(var e in h.info.evtAttribs=[],h.info.tSelectedEvtAttribs=[],h.info.tSelectedEvtAttribs.push({key:"evt_date_str",dataType:"STRING",label:"Date",default:!0}),h.info.tSelectedEvtAttribs.push({key:"evt_text",dataType:"STRING",label:"Event Text",default:!0}),h.info.evtAttribsDefault)(-1==h.info.selectedEvtAttribs.indexOf(h.info.evtAttribsDefault[e])?h.info.evtAttribs:h.info.tSelectedEvtAttribs).push(h.info.evtAttribsDefault[e])},h.showAggregate=function(e){var t,a=0,n=20,i=0,o=h.facetCounts.facet_fields;if(o[e.key]){for(h.info.aggregateData={},h.info.aggregateData.title=e.label,h.info.aggregateData.data=[],a=0;a<o[e.key].length;a+=2)i+=o[e.key][a+1];for(o[e.key].length<20&&(n=o[e.key].length),a=0;a<n;a+=2)(t={}).label=o[e.key][a],t.count=o[e.key][a+1],t.percentage=Math.round(o[e.key][a+1]/i*100),h.info.aggregateData.data.push(t);h.info.isAggregate=!0}else l.alertBox({msg:"No Data Found!"})},h.addAppsInstance=function(e){e.namespace=e.namespace,e.currentNS="random.namespace.by.apps",e.namespace_id=s("bundleName")(e.obs_url)+"-0",e.serial_num=e[h.info.sysId];var t={type:"apps",title:"View section/config diff",name:s("bundleName")(e.obs_url),module:h.info.application,data:{result:e,source:"explorer",bundle:e.obs_url,sysId:e[h.info.sysId],sysId2:null,instanceDisplay:h.info.fields,start_time:h.getFrom(),end_time:h.getTo(),observation:e.obs_date,observationStr:e.obs_date_str}};e.sysid2&&(t.data.sysId2=e.sysid2),b.standard_user_tracking(h.info.application,"Apps","Log View",JSON.stringify(e)).then(y,v),o.addInstance(t)},h.getSeverityFilter=function(){return JSON.parse(JSON.stringify(h.getFacet("severity").data)).map(function(e){return e.selected=!0,e})},h.addInstance=function(e,t){var a,n,i=h.info.sectionsContent[e.namespace].nsType,t=("EVENT"==i||"SESSION"==i?(i="event",a="Event Viewer",n=h.getSeverityFilter()||[]):(i="section",a="Section Viewer"),i={type:i,title:a,app:h.info.application,module:h.info.events?"Event":"Section",data:{result:e,bundle:s("bundleName")(e.obs_url),sysId:e[h.info.sysId],file:s("bundleName")(e.filename),instanceDisplay:h.info.fields,fileDiffAttr:h.info.config.file_diff_key,eventSource:t.description,start_time:h.getFrom(),end_time:h.getTo(),observation:e.obs_date,observationStr:e.obs_date_str,facetStr:h.facetStr,severityFilter:n}},{"Serial Number":e[h.info.sysId],Bundle:e.obs_url,File:s("bundleName")(e.filename),Observation:e.obs_date_str});o.addInstance(i,h)},h.paginator=function(e){h.info.page.total=e,h.info.page.pages=Math.ceil(h.info.page.total/h.info.page.count),h.info.page.current>=h.info.page.pages&&(h.info.page.current=h.info.page.pages-1)},h.changePageSize=function(){h.info.page.count=parseInt(h.info.page.count),h.info.page.pages=Math.ceil(h.info.page.total/h.info.page.count),h.info.page.current=0,h.info.changePageSize=!0,h.refresh(!0)},h.nextPage=function(){h.info.page.current<h.info.page.pages-1&&(h.info.page.current+=1,h.info.paginate=!0,h.refresh(!0))},h.prevPage=function(){0<h.info.page.current&&(--h.info.page.current,h.info.paginate=!0,h.refresh(!0))},h.firstPage=function(){0!=h.info.page.current&&(h.info.page.current=0,h.info.paginate=!0,h.refresh(!0))},h.lastPage=function(){h.info.page.current!=h.info.page.pages-1&&(h.info.page.current=h.info.page.pages-1,h.info.paginate=!0,h.refresh(!0))},h.sortResults=function(e){h.info.sortOrder="desc"==e?{label:"Latest",val:"desc"}:{label:"Oldest",val:"asc"},h.drillDown=!1,h.refresh(!0)},h.instanceDashboardFullscreen=!1,h.instanceDashboardItems=[{name:"(1) Event Viewer"}],h.reset=function(e){var t,a,n,i,o;for(t in h.info.quick=0,h.info.uploadedBy=null,h.info.disable_time=!1,h.info.selectedFilterName="Select View",e||("SECTION"==h.info.config.DEFAULT_VIEW?(h.info.eventsection="section",h.info.sections=!0,h.info.events=!1):(h.info.eventsection="event",h.info.sections=!1,h.info.events=!0)),h.facets){for(a in h.facets[t].data)null!=h.facets[t].data[a].disabled&&0!=h.facets[t].data[a].disabled||(h.facets[t].data[a].selected=!1);h.facets[t].filter&&(h.facets[t].filter="")}for(t in n=Object.keys(h.selectedFacets)){var s=[];for(a in h.selectedFacets[n[t]])null!=h.selectedFacets[n[t]][a].disabled&&1==h.selectedFacets[n[t]][a].disabled&&s.push(h.selectedFacets[n[t]][a]);h.selectedFacets[n[t]]=s}h.customDateFilter=!0,h.dateRangeFilterName=m.getVal("customdate"),e=new Date(h.info.solrEndDate),o=new Date(h.info.solrEndDate),h.info.default_days&&""===h.info.explorerDataDuration?(e.setTime(e.getTime()-h.info.default_days),e.setSeconds(e.getSeconds())):e.setFullYear(e.getFullYear()-10),h.info.MinDate=new Date(h.info.solrEndDate),h.info.MinDate.setDate(h.info.solrEndDate.getDate()-h.info.max_days_allowed),h.info.filterSuggest=h.info.defaultSearchText,h.info.default_days&&""!==h.info.explorerDataDuration&&(e=(i=h.setInitialDates()).fromDate,o=i.toDate),h.setFromTo(e,o),h.info.pristine=!0},h.setInitialDates=function(){var e={},t=(d=new Date(h.info.solrEndDate),d1=new Date(h.info.solrEndDate),h.info.explorerDataDuration),a=moment.duration(h.info.default_days,"milliseconds").asDays(),n=moment(new Date,"DD-MM-YYYY"),t=moment(new Date).subtract(t,"days"),a=moment(new Date(h.info.solrEndDate)).subtract(a,"days");return d1=moment(new Date(h.info.solrEndDate)).isBetween(t,n,null,[])?new Date(h.info.solrEndDate):new Date(n),d=moment(new Date(a)).isBetween(t,n,null,[])?new Date(a):new Date(t),h.info.dateRestrictionMinDate=new Date(t),h.info.dateRestrictionMaxDate=new Date(n),e.fromDate=d,e.toDate=d1,h.info.initialDatesSaved||(h.info.initialFromDate=new Date(t),h.info.initialToDate=new Date(d1)),e},h.loadView=function(e){h.info.defaultState=!1,h.info.drillDown=!1,h.info.selectedFilterName="OUTOFBOX"!=e.search_type?e.view_name:h.getValue("last"+e.last_n_log_by_user+"byme"),h.applyView(h.parseView(e));e={"View Name":h.info.selectedFilterName};b.standard_user_tracking(h.info.application,h.info.events?"Event":"Section","Apply View",JSON.stringify(e)).then(y,v)},h.loadLogsByMe=function(e,t){h.info.defaultState=!1,h.info.quick=e,h.info.pristine=!1,h.info.selectedFilterName=h.getValue("last"+h.info.quick+"byme"),h.info.uploadedBy=h.getLoggedInUserName(),h.resetFacets(),t?(t=new Date(h.info.solrEndDate),a=new Date(h.info.solrEndDate),h.info.default_days?t.setTime(t.getTime()-h.info.default_days):t.setFullYear(t.getFullYear()-10),h.info.filterSuggest=h.info.defaultSearchText,h.setFromTo(t,a)):h.refresh();var a,t={"View Name":h.getValue("last"+e+"byme")};b.standard_user_tracking(h.info.application,h.info.events?"Event":"Section","Apply View",JSON.stringify(t)).then(y,v)},h.resetFacets=function(){var e,t;for(e in h.facets)for(t in Array.isArray(h.selectedFacets[h.facets[e].key])&&(h.selectedFacets[h.facets[e].key].length=0),h.facets[e].data)1==h.facets[e].data[t].selected&&(h.facets[e].data[t].selected=!1)},h.removeOutOfBox=function(){h.info.defaultState=!1,h.info.quick=0,"EVENT"==h.info.config.DEFAULT_VIEW?"*"==h.info.filterSuggest&&h.info.events&&!h.info.sections&&(h.info.pristine=!0):"*"==h.info.filterSuggest&&!h.info.events&&h.info.sections&&(h.info.pristine=!0),h.info.selectedFilterName="Select View",h.info.uploadedBy=null,h.refresh()},h.checkFacets=function(){for(var e in h.selectedFacets)if(0<h.selectedFacets[e].length)return!0;return!!h.defaultFacet},h.applyView=function(e){var t,a,n,i,c,o,u,f,s,g,p,m,r,l,d=[];if(h.info.viewLoad=!0,e.sections||e.events){for(t in e.facets&&(d=Object.keys(e.facets)),h.info.defaultSearchText="*",h.info.filterSuggest=e.search_text,h.info.sections=e.sections,h.info.events=e.events,1==h.info.sections?h.info.eventsection="section":h.info.eventsection="event",h.resetFacets(),h.info.disable_time=!1,h.info.pristine=!1,h.info.quick=0,h.info.uploadedBy=null,d)for(a in h.facets)if("relativetimefilter"!=d[t]&&d[t]===h.facets[a].key)for(Array.isArray(h.selectedFacets[d[t]])||(h.selectedFacets[d[t]]=[]),n=0;n<e.facets[d[t]].length;n++){for(i=0;i<h.facets[a].data.length;++i)if(e.facets[d[t]][n]==h.facets[a].data[i].label){if(h.selectedFacets[d[t]]&&h.selectedFacets[d[t]].length){for(c=0;c<h.selectedFacets[d[t]].length;++c)if(h.facets[a].data[i].label==h.selectedFacets[d[t]][c].label){h.facets[a].data[i].disabled=!0,h.selectedFacets[d[t]][c].disabled=!0;break}c>=h.selectedFacets[d[t]].length&&(h.facets[a].data[i].selected=!0,h.facets[a].data[i].disabled=!1,h.selectedFacets[d[t]].push(h.facets[a].data[i]))}else h.facets[a].data[i].selected=!0,h.facets[a].data[i].disabled=!1,h.selectedFacets[d[t]].push(h.facets[a].data[i]);break}i>=h.facets[a].data.length&&((o={}).label=e.facets[d[t]][n],e.facetKeys.hasOwnProperty(e.facets[d[t]][n])&&(o.key=e.facetKeys[e.facets[d[t]][n]]),o.value=0,o.selected=!0,o.disabled=!1,h.facets[a].data.push(o),h.selectedFacets[d[t]].push(o))}-1!=d.indexOf("relativetimefilter")?h.changeQuickFilter(e.facets.relativetimefilter[0]):(h.customDateFilter=!0,h.customDateFilterApplied=!0,s=(s=e.start_time.replace("T"," ")).replace("Z",""),l=(l=e.end_time.replace("T"," ")).replace("Z",""),r=_.getStringToDate(s),u=_.getStringToDate(l),""!==h.info.explorerDataDuration&&(h.setInitialDates(),f=moment(s).format("YYYY-MM-DD"),s=moment(new Date(l)).diff(new Date(s),"days"),g=moment(l).format("YYYY-MM-DD"),p=moment(h.info.initialFromDate).format("YYYY-MM-DD"),m=moment(h.info.initialToDate).format("YYYY-MM-DD"),moment(g).isBetween(p,m,null,[])?(u=new Date(l),h.info.callRefreshIfFromDateInRange=!0):(u=new Date(h.info.initialToDate),h.info.callRefreshIfFromDateInRange=!1),l=moment(g).subtract(h.info.explorerDataDuration,"days"),r=s<h.info.explorerDataDuration?f:l,moment(r).isBetween(p,m,null,[])?(r=moment(r).toDate(),h.info.callRefreshIfToDateInRange=!0):(r=new Date(h.info.initialFromDate),h.info.callRefreshIfToDateInRange=!1)),h.info.MinDate=r,h.todayDate=u,h.setFromTo(r,u,""))}else h.loadLogsByMe(e.lastnbyme,!0)},h.parseView=function(e){var t,a,n,i={};if("NA"!=e.facet_filters[0])for(t in i.facets={},i.facetKeys={},a=e.facet_filters[0].match(/`([^`]+)`/g))a[t]=a[t].replace(/`/g,""),i.facets.hasOwnProperty(a[t].split("^")[0])||(i.facets[a[t].split("^")[0]]=[]),"namespace"==a[t].split("^")[0]||"events"==a[t].split("^")[0]?(i.facets[a[t].split("^")[0]].push(a[t].split("^")[1]),i.facetKeys[a[t].split("^")[1]]=a[t].split("^")[2]):i.facets[a[t].split("^")[0]].push(a[t].split("^")[1]);return e.extraFacets&&(n=!1,angular.forEach(e.extraFacets,function(e,t){i.facets[t]?angular.forEach(e,function(e){"namespace"!=(t="namespace"!=t||"EVENT"!=h.sectionsContent[e].nsType&&"SESSION"!=h.sectionsContent[e].nsType?t:"events")&&"events"!=t||-1!=i.facets[t].indexOf(h.sectionsContent[e].description)?"namespace"!=t&&"events"!=t&&-1==i.facets[t].indexOf(e)&&(i.facets[t].push(e),n=!0):(i.facets[t].push(h.sectionsContent[e].description),i.facetKeys[h.sectionsContent[e].description]=e,n=!0)}):(i.facets[t]=[],angular.forEach(e,function(e){"namespace"!=t||"EVENT"!=h.sectionsContent[e].nsType&&"SESSION"!=h.sectionsContent[e].nsType||(t="events"),n=("namespace"==t||"events"==t?(i.facets[t].push(h.sectionsContent[e].description),i.facetKeys[h.sectionsContent[e].description]=e):i.facets[t].push(e),!0)}))}),n&&(h.info.selectedFilterName="Select View")),i.search_text=decodeURIComponent(e.search_text).replace(/%27/g,"'"),i.start_time=e.start_ts,i.end_time=e.end_ts,i.events="EVENT"==e.search_type,i.sections="SECTION"==e.search_type,i.lastn=e.last_n_log,i.lastnbyme=e.last_n_log_by_user,i.default=e.default,i},e.savedFilters?e.savedFilters.split("#@#")&&e.savedFilters.split("#@#").length&&0<e.savedFilters.split("#@#").length&&(h.info.savedFilters=e.savedFilters.split("#@#")):h.info.savedFilters=[],h.showSaveFilterModal=function(){var t=h.getLoggedInUserName();if(h.savedFiltersList&&h.savedFiltersList.filter(function(e){return e.created_by==t}).length>=m.getVal("max_views_limit"))return void l.alertBox({msgKey:"max_views_msg"});h.saveModal={},h.saveModal.saveStatus="initiated",h.saveModal.message="",h.saveModal.filters="",h.saveModal.filtersString="",h.saveModal.searchQuery=h.info.filterSuggest,h.saveModal.timeRange=h.getFrom(!0).replace(/T|Z/g," ")+"To "+h.getTo(!0).replace(/T|Z/g," ");0==h.customDateFilter&&(h.saveModal.timeRange=h.dateRangeFilterName,h.saveModal.filtersString+="`relativetimefilter^"+h.dateRangeFilterName+"`");var e,a=Object.keys(h.selectedFacets);for(e in a)for(var n in h.selectedFacets[a[e]])h.saveModal.filtersString&&(h.saveModal.filtersString+=","),h.saveModal.filtersString+="`"+a[e]+"^"+h.selectedFacets[a[e]][n].label+(h.selectedFacets[a[e]][n].hasOwnProperty("key")?"^"+h.selectedFacets[a[e]][n].key:"")+"`",""!=h.saveModal.filters?h.saveModal.filters=h.saveModal.filters+", "+h.selectedFacets[a[e]][n].label:h.saveModal.filters=h.selectedFacets[a[e]][n].label;h.modal=l.openModal("partials/explorer-save-filter.html",h,!1,!0),h.form={visible:!0,message:""}},h.allSavedFiltersList=[],h.saveModal.viewOverwrite=!1,h.checkViewName=function(){if(h.saveModal.viewOverwrite=!1,h.savedFiltersList&&h.savedFiltersList.length&&0<h.savedFiltersList.length){for(var e=!1,t=0;t<h.savedFiltersList.length;t++)if(h.savedFiltersList[t].view_name==h.saveModal.filterName){if(!h.savedFiltersList[t].currentUser){e=!0;break}h.saveModal.viewOverwrite=!0}e?h.form.saveViewModal.viewName.$setValidity("duplicate",!1):h.form.saveViewModal.viewName.$setValidity("duplicate",!0)}else h.getSavedFilters()},h.saveFilter=function(){h.form.saveViewModal.$valid&&h.callSaveViewAPI()},h.callSaveViewAPI=function(){var a={search_string:encodeURIComponent(h.saveModal.searchQuery.replace(/\'/g,"%27")),search_type:h.info.sections?"SECTION":"EVENT",last_n_log:1<h.info.quick?h.info.quick:0,last_n_log_uploaded_by_me:1==h.info.quick?h.info.quick:0,facet_string:h.saveModal.filtersString,start_time:h.getFrom(),end_time:h.getTo(),search_name:h.saveModal.filterName,search_desc:escape(h.saveModal.desc),is_public:"public"==h.saveModal.access,is_default:h.info.defaultFilterInfo.view_name==h.saveModal.filterName};h.saveModal.saveStatus="progress",p.saveFilter(a).then(function(e){var t={"View Name":h.saveModal.filterName,"Search Text":encodeURIComponent(h.saveModal.searchQuery.replace(/\'/g,"%27")),"Facet String":h.saveModal.filtersString,"Time Range":h.getFrom()+"--"+h.getTo(),"Search Type":a.search_type};b.standard_user_tracking(h.info.application,h.info.events?"Event":"Section","Save View","{'"+JSON.stringify(t)+"'}").then(y,v),h.saveModal.saveStatus="success",h.saveModal.message="View saved successfully.",h.getSavedFilters()},function(e){h.saveModal.saveStatus="error",h.saveModal.message="Oops! Something went wrong!",v(e)})},h.hideModalPanel=function(e){h.saveModal.saveStatus="initiated"},h.savedFiltersListLoading=!0,h.getSavedFilters=function(e){h.savedFiltersListNotFound=!1,h.savedFiltersListLoading=!0,p.getSavedFilters().then(function(e){h.savedFiltersList=[],h.allFilterList=e.data.Data,angular.forEach(h.allFilterList,function(e){"SECTION"!=e.search_type&&"EVENT"!=e.search_type||h.savedFiltersList.push(e)}),e=s("filter")(h.allFilterList,{created_by:h.getLoggedInUserName(),default:!0})||[],h.info.defaultFilterInfo=e.length?e[0]:{},h.savedFiltersListLoading=!1,h.savedFiltersList&&0<h.savedFiltersList.length?h.savedFiltersListNotFound=!1:h.savedFiltersListNotFound=!0;for(var t=[],a=0;a<h.savedFiltersList.length;a++)h.savedFiltersList[a].currentUser=h.savedFiltersList[a].created_by==h.getLoggedInUserName(),t.push(h.savedFiltersList[a].view_name);if(e={"Name of views":t},b.standard_user_tracking(h.info.application,h.info.events?"Event":"Section","List view",JSON.stringify(e)).then(y,v),h.saveModal.filterName&&h.form.saveViewModal){for(var n=!1,a=0;a<h.savedFiltersList.length;a++)if(h.savedFiltersList[a].view_name==h.saveModal.filterName){if(!h.savedFiltersList[a].currentUser){n=!0;break}h.saveModal.viewOverwrite=!0}n&&h.form.saveViewModal.viewName?h.form.saveViewModal.viewName.$setValidity("duplicate",!1):h.form.saveViewModal.viewName.$setValidity("duplicate",!0)}},function(e){h.savedFiltersListLoading=!1,h.savedFiltersListNotFound=!0,v(e)})},h.deleteSavedFilter=function(e,t){h.modal=l.openModal("partials/explorer_delete_filter.html",h,!1,!0),h.deleteModal={},h.deleteModal.filter={},h.deleteModal.filter.name=e.view_name,h.deleteModal.filter.desc=decodeURIComponent(e.desc),h.deleteModal.filter.isDefault=e.default,h.deleteModal.status="initiated",h.deleteModal.deleteOperationMsg=""},h.changeFilterAccessibility=function(n){h.savedFiltersListLoading=!0,p.changeFilterAccessibility(n).then(function(e){h.info.changeFilterAccesibilityOperation.statusCode=0,h.getSavedFilters();var t=n.public?"Set View Private":"Set View Public",a={"View Name":n.view_name};b.standard_user_tracking(h.info.application,h.info.events?"Event":"Section",t,JSON.stringify(a)).then(y,v)},function(e){h.info.changeFilterAccesibilityOperation.statusCode=-1,h.savedFiltersListNotFound=!0,h.savedFiltersListLoading=!1,v(e)})},h.changeDefaultFilter=function(i,e){var o;h.savedFiltersListLoading=!0,e?(o="last_"+i+"_by_"+h.getLoggedInUserName(),e={search_string:"*",search_type:"OUTOFBOX",last_n_log:0,last_n_log_uploaded_by_me:i,facet_string:"",start_time:h.getFrom(),end_time:h.getTo(),search_name:o,search_desc:"undefined",is_public:!1,is_default:!1},p.saveFilter(e).then(function(e){var t=s("filter")(h.allFilterList,{view_name:o})||[],a="",n={"View Name":h.getValue("last"+i+"byme")};t.length&&!t[0].default||!t.length?(t={view_name:o,default:!(a="Set Default View")},h.info.defaultFilterInfo={search_type:"OUTOFBOX",last_n_log_by_user:i},h.loadLogsByMe(i,!1),p.setResetDefaultFilter(t).then(function(e){h.getSavedFilters()},function(e){h.savedFiltersListLoading=!1,v(e)})):(a="Reset Default View",h.getValue("last"+i+"byme")==h.info.selectedFilterName&&(h.selectedFacets={},h.info.defaultFilterInfo={},h.reset()),h.getSavedFilters()),b.standard_user_tracking(h.info.application,h.info.events?"Event":"Section",a,JSON.stringify(n)).then(y,v)},function(e){h.savedFiltersListLoading=!1,v(e)})):p.setResetDefaultFilter(i).then(function(e){i.default=!i.default;var t="",t=i.default?"Set Default View":(i.view_name==h.info.selectedFilterName&&(h.info.defaultFilterInfo={}),"Reset Default View"),a={"View Name":i.view_name};b.standard_user_tracking(h.info.application,h.info.events?"Event":"Section",t,JSON.stringify(a)).then(y,v),h.getSavedFilters()},function(e){h.savedFiltersListLoading=!1,v(e)})},h.dateRangeFilterName=m.getVal("customdate"),h.changeQuickFilter=function(e){var t,a;if(h.info.defaultState=!1,h.info.pristine=!1,h.info.quickFilter=!0,t=_.getTodayDate(),a=_.getTodayDate(),h.info.page.current=0,"customdate"!=e)switch(h.customDateFilter=!1,h.dateRangeFilterName=m.getVal(e),h.info.quick=0,h.info.uploadedBy=null,e){case"lasthour":case m.getVal("lasthour"):t.setHours(t.getHours()-1),h.setFromTo(t,a),h.dateRangeFilterName=m.getVal("lasthour");break;case"today":case m.getVal("today"):t.setHours(0),t.setMinutes(0),t.setSeconds(0),h.setFromTo(t,a),h.dateRangeFilterName=m.getVal("today");break;case"yesterday":case m.getVal("yesterday"):t.setDate(t.getDate()-1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),a.setDate(a.getDate()-1),a.setHours(23),a.setMinutes(59),a.setSeconds(59),h.setFromTo(t,a),h.dateRangeFilterName=m.getVal("yesterday");break;case"thisweek":case m.getVal("thisweek"):t.setDate(t.getDate()-t.getDay()+1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),h.setFromTo(t,a),h.dateRangeFilterName=m.getVal("thisweek");break;case"thismonth":case m.getVal("thismonth"):t.setDate(1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),h.setFromTo(t,a),h.dateRangeFilterName=m.getVal("thismonth");break;case"last2days":case m.getVal("last2days"):t.setDate(t.getDate()-2),t.setHours(0),t.setMinutes(0),t.setSeconds(0),h.setFromTo(t,a),h.dateRangeFilterName=m.getVal("last2days");break;case"last7days":case m.getVal("last7days"):t.setDate(t.getDate()-7),t.setHours(0),t.setMinutes(0),t.setSeconds(0),h.setFromTo(t,a),h.dateRangeFilterName=m.getVal("last7days");break;case"last30days":case m.getVal("last30days"):t.setDate(t.getDate()-30),t.setHours(0),t.setMinutes(0),t.setSeconds(0),h.setFromTo(t,a),h.dateRangeFilterName=m.getVal("last30days");break;case"mostrecent":case m.getVal("mostrecent"):h.info.quick=1;var n=new Date(h.info.solrEndDate);h.info.max_days_allowed?n.setDate(n.getDate()-h.info.max_days_allowed):n.setFullYear(n.getFullYear()-10),h.setFromTo(n,new Date(h.info.solrEndDate)),h.dateRangeFilterName=m.getVal("mostrecent");break;case"last5":case m.getVal("last5"):h.info.quick=5;n=new Date(h.info.solrEndDate);h.info.max_days_allowed?n.setDate(n.getDate()-h.info.max_days_allowed):n.setFullYear(n.getFullYear()-10),h.setFromTo(n,new Date(h.info.solrEndDate)),h.dateRangeFilterName=m.getVal("last5");break;case"last10":case m.getVal("last10"):h.info.quick=10;n=new Date(h.info.solrEndDate);h.info.max_days_allowed?n.setDate(n.getDate()-h.info.max_days_allowed):n.setFullYear(n.getFullYear()-10),h.setFromTo(n,new Date(h.info.solrEndDate)),h.dateRangeFilterName=m.getVal("last10");break;default:l.alertBox({msg:"Nothing"}),h.dateRangeFilterName=m.getVal("customdate")}else h.customDateFilter=!0,h.customDateFilterApplied=!0,h.info.quickFilter=!1,h.info.quick=0,h.info.uploadedBy=null,h.dateRangeFilterName=m.getVal(e)},h.getValue=function(e){return m.getVal(e)},h.hideModal=function(){h.modal.close()},h.showEventGroup=function(){return!!m.getVal("event_group_tab")&&(h.defaultFacet&&h.defaultFacet.selected&&h.response&&h.response.docs&&h.response.docs.length&&"event"==h.info.eventsection||(h.info.dataTabs=!1))},h.breadcrumbYearView=function(){var e=new Date(h.info.fromDate),t=new Date(h.info.toDate);e.setFullYear(e.getFullYear()-10),h.setFromTo(e,t)},h.breadcrumbMonthView=function(){var e=h.info.fromDate,t=h.info.toDate;h.setFromTo(e,t)},h.breadcrumbDayView=function(){var e=new Date(h.info.solrEndDate),t=new Date(h.info.solrEndDate);h.setFromTo(e,t)};var n=!(h.deleteFilterRequest=function(a){h.deleteModal.status="progress",p.deleteSavedFilter(a).then(function(e){h.deleteModal.status="success",h.info.selectedFilterName==a&&(h.info.selectedFilterName="Select View"),h.deleteModal.deleteOperationMsg="Deleted successfully";var t={"View Name":h.deleteModal.filter.name};b.standard_user_tracking(h.info.application,h.info.events?"Event":"Section","Delete View","{'"+JSON.stringify(t)+"'}").then(y,v),h.deleteModal.filter.isDefault&&(h.info.defaultFilterInfo="",h.resetFromUI()),h.getSavedFilters()},function(e){h.deleteModal.status="error",h.deleteModal.deleteOperationMsg="Error : "+e.data.msg,h.savedFiltersListNotFound=!0,v(e)})});function y(e){}h.loadDefaultFilter=function(){var e,a,t=p.getLoadView();t&&(h.defaultFacet=null,"custom"==t.type?(t.view.facet_filters.hasOwnProperty("obs_url")&&(h.defaultFacet={label:t.view.facet_filters.obs_url[0],selected:!0,title:t.view.facet_filters.obs_url[0],value:""},delete t.view.facet_filters.obs_url),(e=t.view).view_name="Select View",a="",angular.forEach(e.facet_filters,function(e,t){angular.forEach(e,function(e){e="`"+(t="namespace"!=t||"EVENT"!=h.sectionsContent[e].nsType&&"SESSION"!=h.sectionsContent[e].nsType?t:"events")+("namespace"==t||"events"==t?"^"+h.sectionsContent[e].description:"")+"^"+e+"`";a+=(a.length?",":"")+e})}),e.facet_filters=[a],n=!0,h.loadView(e)):"savedView"==t.type&&(h.info.dataLoading=!0,h.info.facetsLoading=!0,p.getSavedFilters().then(function(e){h.info.dataLoading=!1,h.info.facetsLoading=!1;e=s("filter")(e.data.Data,{view_name:t.view},!0)||[];1==e.length?(t.facets&&(e[0].extraFacets=t.facets),h.loadView(e[0])):(l.alertBox({msg:"View not found"}),n?n=!0:(p.setLoadView(null),h.loadDefaultFilter()))},function(e){h.info.dataLoading=!1,h.info.facetsLoading=!1})),p.setLoadView(null)),p.getDefaultFilterInfo().then(function(e){h.info.defaultFilterInfo=e.data.Data,""==h.info.defaultFilterInfo?(h.info.defaultFilterInfo={},t||(n=!0,h.reset())):"object"==typeof h.info.defaultFilterInfo&&(t||(n=!0,h.loadView(h.info.defaultFilterInfo)))},function(e){console.error("Unable to fetch default filter."),v(e)})},h.getFilterScope=function(e){return"all"==h.info.filterBtn?e.currentUser||!e.currentUser&&e.public:"my"==h.info.filterBtn?e.currentUser:h.getFilterOtherScope(e)},h.getFilterOtherScope=function(e){return!e.currentUser&&e.public},h.getLoggedInUserName=function(){return _.getUser().email},h.getSearchKey=function(e){var t,a=[" and "," or "," not "],n=0;e=e.toLowerCase();for(var i=0;i<a.length;i++)n<(t=e.lastIndexOf(a[i]))&&(n=t,n+=0==i&&2==i?6:5);return e.substr(n,e.length)},h.getSearchKeyIndex=function(e){var t,a=[" and "," or "," not "],n=-1;e=e.toLowerCase();for(var i=0;i<a.length;i++)n<(t=e.lastIndexOf(a[i]))&&(n=t-1+a[i].length);return n},h.showAutoSuggestDD=function(){h.info.showDropdown=!0},h.filterSuggest=function(){var e,t,a,n,i,o;h.showAutoSuggestDD(),h.suggestionData=[],h.info.filterSuggest&&0<h.info.filterSuggest.length?(t=h.info.filterSuggest,h.info.filterSuggestItem=t,-1!=(e=(i=h.info.filterSuggestLatest=t).lastIndexOf(" "))&&(i=i.substr(e+1,i.length)),e=h.getSearchKey(t),h.info.filterSuggestLoading=!(i=""),h.info.suggestionsPending&&h.suggestionsDeferred.resolve(),h.suggestionsDeferred=r.defer(),t=!(h.info.suggestionsPending=!0),-1==e.indexOf(".")?t=!0:(e.indexOf(".")==e.length-1||(a=e.lastIndexOf(".")+1,n=e.length,i=e.substring(a,n)),e=h.info.filterSuggestSelectedSection.table_name),(!t||0!=h.info.filterSuggestionsSectionsList.length)&&t?(h.loadSectionsListForSuggestionApplyFilter(e,t,i),h.info.suggestionsPending=!1,h.info.filterSuggestLoading=!1):h.loadSectionsListForSuggestion(e,t,i),h.savedFiltersListNotLoaded?(h.loadSavedFilterForSuggestionDD(),h.savedFiltersListNotLoaded=!1):(o=h.info.filterSuggestItem.toLowerCase(),h.info.filterSavedFilterRemote=h.savedFiltersList.filter(function(e){return-1!=e.view_name.toLowerCase().indexOf(o)}))):(h.info.suggestionsPending&&(h.suggestionsDeferred.resolve(),h.info.filterSuggestLoading=!1),h.info.filterSuggestions=[{error:{label:"Start typing to get suggestions.",dataType:"none"}}])},h.loadSavedFilterForSuggestionDD=function(){p.getSavedFilters().then(function(e){e=e.data.Data;h.applySuggesstedFilterOnAllSavedView(e)},v)},h.applySuggesstedFilterOnAllSavedView=function(e){var t=[];for(a in e)(e[a].created_by==h.getLoggedInUserName()||e[a].created_by!=h.getLoggedInUserName()&&1==e[a].public)&&t.push(e[a]);if(t){for(var a=0;a<t.length;a++){var n=t[a];n.desc&&(n=n.desc.replace(/&#39;/g,"").replace(/\%20/g," "),t[a].desc=n)}h.savedFiltersList=t;var i=h.info.filterSuggestItem.toLowerCase();h.info.filterSavedFilterRemote=t.filter(function(e){return-1!=e.view_name.toLowerCase().indexOf(i)})}},h.loadSectionsListForSuggestion=function(t,a,n){p.suggestFilterSearch(h.info.eventsection,t,a,h.suggestionsDeferred).then(function(e){h.info.suggestionsPending=!1,h.info.filterSuggestLoading=!1,!e.data.Data.length||e.data.Data.hasOwnProperty("gb_error")?h.info.filterSuggestions=[{error:{label:"No matching suggestions.",dataType:"none"}}]:(0==e.data.Data.length&&(h.info.filterSuggestions=[{error:{label:"No matching suggestions.",dataType:"none"}}]),a?h.info.filterSuggestionsSectionsList=e.data.Data:h.info.filterSuggestionsAttriList=e.data.Data,h.loadSectionsListForSuggestionApplyFilter(t,a,n))},function(e){-1!=e.status&&(h.info.filterSuggestLoading=!1),h.info.suggestionsPending=!1,h.info.filterSuggestLoading=!1,v(e)})},h.loadSectionsListForSuggestionApplyFilter=function(a,e,n){e=e?(h.info.filterSuggestType="sections",h.info.filterSuggestionsSectionsList.filter(function(e){if(!e.namespace_desc)return!1;var e=e.namespace_desc.toLowerCase(),t=a.toLowerCase();return-1!=e.indexOf(t)})):(h.info.filterSuggestType="attributes",h.info.filterSuggestionsAttriList.filter(function(e){for(var t in e){var t=e[t].attribute_label.toLowerCase(),a=n.toLowerCase();return-1!=t.indexOf(a)}}));if(0==h.info.filterSuggestions.length)h.info.filterSuggestions=[{error:{label:"No matching suggestions.",dataType:"none"}}];else{if(0==(h.suggestionData=e).length)return h.info.filterSuggestions=[{error:{label:"No matching suggestions.",dataType:"none"}}],void h.suggestionPaginationReset();h.suggestionPaginationReset(),h.suggestionPaginationLoadData()}},h.suggestionPagination={pageSize:50,page:0,msg:"",visible:!1,next:function(){this.page++,this.page>=Math.ceil(parseInt(h.suggestionData.length/this.pageSize))&&(this.page=Math.ceil(parseInt(h.suggestionData.length/this.pageSize))),h.suggestionPaginationLoadData()},prev:function(){this.page--,this.page<=0&&(this.page=0),h.suggestionPaginationLoadData()},first:function(){this.page=0,h.suggestionPaginationLoadData()},last:function(){this.page=Math.ceil(parseInt(h.suggestionData.length/this.pageSize)),h.suggestionPaginationLoadData()}},h.suggestionPaginationReset=function(){h.suggestionPagination.page=0},h.suggestionPaginationLoadData=function(){var e=(h.suggestionPagination.page+1)*h.suggestionPagination.pageSize,t=e-h.suggestionPagination.pageSize;h.suggestionData.length<=e&&(e=h.suggestionData.length),h.suggestionData.length>h.suggestionPagination.pageSize?h.suggestionPagination.visible=!0:h.suggestionPagination.visible=!1,h.suggestionPagination.msg=1+t+" - "+e+" of "+h.suggestionData.length,h.info.filterSuggestions=h.suggestionData.slice(t,e)},h.getMostRecentQueries=function(){var t=h.info.filterSuggestItem.toLowerCase();return h.info.savedFilters.filter(function(e){return-1!=e.toLowerCase().indexOf(t)})},h.updateMatchingSection=function(e){var t,a,n,i;h.info.filterSuggestType="sections","none"!=(h.info.filterSuggestSelectedSection=e).type&&(i=h.info.filterSuggestLatest,t=h.getSearchKeyIndex(i),h.logMatching("Matching sections",e.namespace_desc+"."+e.label),-1!=t?(a=new RegExp(/[^'(.)+'$]/).test(i),n=i.substr(t+1,i.length),i=i.substr(0,t+1),a&&0<n.length?h.info.filterSuggest=i+"'{"+e.namespace_desc+"}.":h.info.filterSuggest=i):h.info.filterSuggest="'{"+e.namespace_desc+"}.",h.filterSuggest())},h.updateMatchingAttr=function(e){var t,a,n,i;h.info.filterSuggestType="attributes","none"!=e.dataType&&(t=(i=h.info.filterSuggestLatest).lastIndexOf("}"),h.logMatching("Matching attributes",h.info.filterSuggestSelectedSection.namespace_desc+"."+e.attribute_label),-1!=t?(a=new RegExp(/[^'(.)+'$]/).test(i),n=i.substr(t+1,i.length),i=i.substr(0,t+1),a&&0<n.length?h.info.filterSuggest=i+"."+e.attribute_label+"'":h.info.filterSuggest=i):h.info.filterSuggest="."+e.attribute_label+"'")},h.$watch("info.filterSuggest",function(){h.info.filterSuggest=h.info.filterSuggest.replace(/&#39;/g,"")}),h.checkDateRange=function(){-1!=h.info.filterSuggest.indexOf("CompoundSearch=")&&h.info.sections?l.alertBox({msgKey:"events_only"}):Math.round(Math.abs((h.info.toDate.getTime()-h.info.fromDate.getTime())/864e5))>h.info.max_days_allowed&&0<h.info.max_days_allowed?(h.msg="Your date range exceeds "+h.info.max_days_allowed+" days. Please restrict your queries to "+h.info.max_days_allowed+" days or lesser.<br>Click Ok to get data for "+h.info.max_days_allowed+" days or click Cancel and change the date range.",h.modal=l.openModal("partials/date_range_exceeded.html",h,!1,"static")):Math.round(Math.abs(h.info.solrEndDate.getTime()-h.info.fromDate.getTime())/864e5)>h.info.max_days_allowed&&0<h.info.max_days_allowed?(h.msg="You are querying data older than "+h.info.max_days_allowed+" days, your response will be slower. Are you sure to continue?.",h.modal=l.openModal("partials/expensive_query.html",h,!1,"static")):h.setCookiesFrMostRecentSearch()},h.confirmDateRangeSelect=function(){h.info.fromDate=new Date(h.info.toDate.getTime()-864e5*h.info.max_days_allowed),h.setCookiesFrMostRecentSearch()},h.setCookiesFrMostRecentSearch=function(){h.info.page.current=0,h.customDateFilter&&(h.customDateFilterApplied=!0),h.info.filterSuggest&&""!=h.info.filterSuggest&&(h.isDuplicateMostRecentSearch(h.info.filterSuggest)||(e.savedFilters?e.savedFilters+="#@#"+h.info.filterSuggest:e.savedFilters=h.info.filterSuggest,h.info.savedFilters=e.savedFilters.split("#@#")),h.info.notFacetSearch=!0),h.refresh()},h.isDuplicateMostRecentSearch=function(e){if(!h.info.savedFilters||!h.info.savedFilters.length)return!1;for(var t=h.info.savedFilters.length,a=0;a<t;a++)if(e==h.info.savedFilters[a])return!0;return!1},h.createRule=function(e){p.setRuleSection(e),p.setRuleText(""),h.$parent.createRuleFromExplorer()},h.openExportPopup=function(){h.info.exportPopupPage=h.info.page.current+1,h.modalInstance=l.openModal("partials/explorer/exportcsv.html",h)},h.openFacetStatsPopup=function(e,t){h.facetStats=e.label;var a=[],n=0,o=h.meanFacetValue=0;for(i=0;i<e.data.length;i++)a.push(e.data[i]),n+=e.data[i].value;for(h.facetValueSum=n,h.meanFacetValue=n/e.data.length,i=0;i<a.length;i++)a[i].perc=(100*a[i].value/n).toFixed(2),a[i].stdDev=(a[i].value-h.meanFacetValue)*(a[i].value-h.meanFacetValue);var s=(h.facetData=a).sort(function(e,t){return e.value<t.value?1:-1}).slice(0,10),r=a.sort(function(e,t){return e.value>t.value?1:-1}).slice(0,10);for(i=0;i<a.length;i++)o=Math.floor(o+a[i].stdDev);h.stdDevValue=Math.sqrt(o/a.length),h.top10facet=s.sort(function(e,t){return d3.descending(e.value,t.value)}),h.bottom10facet=r.sort(function(e,t){return d3.descending(e.value,t.value)}),h.maxFacetValue=h.top10facet[0].value,h.minFacetValue=h.bottom10facet[0].value,b.standard_user_tracking(h.info.application,h.info.events?"Event":"Section","Open facet stats popup",JSON.stringify(e)).then(y,v),h.modalInstance=l.openModal("partials/explorer/facetstats.html",h)},h.downloadCsv=function(){h.info.dataLoading=!0,0==h.csvpage.noOfRecordsCsv||h.csvpage.noOfRecordsCsv<m.getVal("minNoOFRecords")||h.csvpage.noOfRecordsCsv>m.getVal("maxNoOFRecords")?(h.csvdownloaderror=!0,h.info.dataLoading=!1):p.updateLimit(h.csvpage.noOfRecordsCsv).then(function(e){"current"==h.csvpage.pagevalue?(h.logExportEvents(!1),h.getExportUrl(0)):(h.logExportEvents(!0),h.getExportUrl(1)),b.standard_user_tracking(h.info.application,"Events","Download CSV","Count:"+h.csvpage.noOfRecordsCsv),setTimeout(function(){h.info.dataLoading=!1},2e3),h.csvdownloaderror=!1,m.setVal("events_export_limit",h.csvpage.noOfRecordsCsv),h.events_export_limit=m.getVal("events_export_limit"),h.closeModal()})},h.logShowTime=function(){var e=(h.info.showOTime?"Show":"Hide")+" Original Time";b.standard_user_tracking(h.info.application,h.info.events?"Event":"Section",e,JSON.stringify({})).then(y,v)},h.logExportEvents=function(e){b.standard_user_tracking(h.info.application,h.info.events?"Event":"Section",e?"Export CSV from 1st page":"Export CSV from current page",JSON.stringify({})).then(y,v)},h.logStatistics=function(){var e={"oldest data":moment(h.$scope.info.display_obs_min).format("YYYY-MM-DD HH:mm:ss"),"Newest data":moment(h.info.display_obs_max).format("YYYY-MM-DD HH:mm:ss")};b.standard_user_tracking(h.info.application,h.info.events?"Event":"Section","Show statistics",JSON.stringify(e)).then(y,v)},h.logShowMoreLess=function(e){b.standard_user_tracking(h.info.application,h.info.events?"Event":"Section",e?"Show More":"Show Less",JSON.stringify({})).then(y,v)},h.logToggleTimeline=function(e){var t={};t.Timeline=e?"Show Timeline":"Hide Timeline";b.standard_user_tracking(h.info.application,h.info.events?"Event":"Section","Toggle Timeline",JSON.stringify(t)).then(y,v)},h.logAutoOpen=function(e){e||(h.info.showDropdown=!1);b.standard_user_tracking(h.info.application,h.info.events?"Event":"Section",e?"Turn On Auto-Open":"Turn Off Auto-Open",JSON.stringify({})).then(y,v)},h.logMatching=function(e,t){b.standard_user_tracking(h.info.application,h.info.events?"Event":"Section",e,JSON.stringify({Detail:t})).then(y,v)},h.searchFromLogvault=function(){h.info.defaultFilterInfo={},h.selectedFacets={},h.info.pristine=!0,h.info.selectedFilterName="Select View",h.info.clearFilter=!0,h.customDateFilter=!0,h.customDateFilterApplied=!0,h.info.page.current=0;var e=p.getBundleData();h.defaultFacet={label:e.bundlename,selected:!0,title:e.bundlename,value:""},h.info.hasSections||(h.info.events=!0),bundleId=e.bundle_id,p.getDateRange(bundleId).then(function(e){e=e.data.Data;(fDate=_.getTodayDate()).setYear(e.obs_min.split("-")[0]),fDate.setMonth(e.obs_min.split("-")[1]-1),fDate.setDate(e.obs_min.split("-")[2].substring(0,2)),fDate.setHours(e.obs_min.split("-")[2].substring(3,5)),fDate.setMinutes(e.obs_min.split("-")[2].substring(6,8)),fDate.setSeconds(e.obs_min.split("-")[2].substring(9,11)),fDate.setDate(fDate.getDate()-1),(tDate=_.getTodayDate()).setYear(e.obs_max.split("-")[0]),tDate.setMonth(e.obs_max.split("-")[1]-1),tDate.setDate(e.obs_max.split("-")[2].substring(0,2)),tDate.setHours(e.obs_max.split("-")[2].substring(3,5)),tDate.setMinutes(e.obs_max.split("-")[2].substring(6,8)),tDate.setSeconds(e.obs_max.split("-")[2].substring(9,11)),tDate.setDate(tDate.getDate()+2),h.info.logBundleSearch=!0,""!==h.info.explorerDataDuration&&(h.info.fromDateOfLogVault=fDate,h.info.dateRestrictionMinDate=fDate,h.info.dateRestrictionMaxDate=h.todayDate),h.setFromTo(fDate,tDate)},function(e){console.error(e)})},h.eventGroups={originalRecors:[],records:[],currentPageData:[],pageSize:[{value:20,active:!1,disabled:!1},{value:40,active:!1,disabled:!0},{value:60,active:!1,disabled:!0},{value:80,active:!1,disabled:!0},{value:100,active:!1,disabled:!0}],inlineSearchValue:"",countColumnSort:"",urlPart:"",queryParam:"",filterSuggest:"",loading:!1,noDataFound:!1,pagination:{offset:20,defaultOffset:20,currentPage:1,totalPages:1,startIndex:0,pages:[{value:1,active:!0}]},api:function(){var t=this,e=p.getDrillDown(),e=h.getFrom(e)+"/"+h.getTo(e)+"/"+h.info.page.total;t.isChanged()&&(t.filterSuggest=h.info.filterSuggest,t.queryParam=h.info.queryParam,t.urlPart=e,t.loading=!0,p.getEventGroups(e,h.info.queryParam,h.info.filterSuggest).then(function(e){e=e.data.Data;t.set(e),t.loading=!1,e&&e.length&&0!=e.length?t.noDataFound=!1:t.noDataFound=!0,t.resetPagination()},function(){t.set([]),t.loading=!1,t.noDataFound=!0,t.resetPagination()}))},isChanged:function(){return h.getFrom()+"/"+h.getTo()+"/"+h.info.page.total!==this.urlPart||this.filterSuggest!==h.info.filterSuggest||this.queryParam!==h.info.queryParam},set:function(e){this.originalRecors=e,this.records=e},get:function(){return this.records},applyInlineFilter:function(t){t?this.records=this.originalRecors.filter(function(e){return-1!=e.eventType.toLowerCase().indexOf(t.toLowerCase())}):this.resetInlineFilter(),this.resetPagination()},resetInlineFilter:function(){this.records=angular.copy(this.originalRecors)},resetPagination:function(e){for(var t,a=this,n=a.records.length,i=0;i<a.pageSize.length;i++)1<n/(t=a.pageSize[i]).value?t.disabled=!1:t.disabled=!0;if(e){a.pagination.offset=e;for(i=0;i<a.pageSize.length;i++)a.pageSize[i].value==e?a.pageSize[i].active=!0:a.pageSize[i].active=!1}else{for(i=0;i<a.pageSize.length;i++)a.pageSize[i].active=!1;a.pageSize[0].active=!0,a.pagination.offset=a.pagination.defaultOffset}a.pagination.currentPage=1,a.updateDataToShow(),a.pagination.totalPages=Math.ceil(a.records.length/a.pagination.offset),a.pagination.pages=[];for(i=0;i<a.pagination.totalPages;i++)a.pagination.pages.push({value:i+1,active:!1});a.pagination.pages.length&&(a.pagination.pages[0].active=!0)},updateDataToShow:function(){var e=this,t=(e.pagination.currentPage-1)*e.pagination.offset,a=t+e.pagination.offset;0<e.records.length&&(e.currentPageData=e.records.slice(t,a))},changePageSize:function(e){if(e.disabled)return!1;this.resetPagination(e.value)},changePage:function(e){var t=this;t.pagination.currentPage=e.value,t.updateDataToShow();for(var a=0;a<t.pagination.pages.length;a++)t.pagination.pages[a].value==e.value?t.pagination.pages[a].active=!0:t.pagination.pages[a].active=!1},sortCountColumn:function(){var e,t=this;!t.countColumnSort||"fa-sort"==t.countColumnSort||"fa-sort-numeric-desc"==t.countColumnSort?(t.countColumnSort="fa-sort-numeric-asc",e="asc"):"fa-sort-numeric-asc"==t.countColumnSort&&(t.countColumnSort="fa-sort-numeric-desc",e="desc"),t.sortData(e)},sortData:function(a){if(!this.records.length)return!1;this.records.sort(function(e,t){return"asc"==a?parseInt(e.count)-parseInt(t.count):parseInt(t.count)-parseInt(e.count)}),this.updateDataToShow()},openInstanceViewer:function(e){e={type:"EVENT_GROUP",title:m.getVal("event_group_tab_label"),app:h.info.application,module:"Event",data:{result:e}};o.addInstance(e,h)}},h.logreduceMinLimit=m.getVal("event_group_tab_confirm_limit_min"),h.logreduceMaxLimit=m.getVal("event_group_tab_confirm_limit_max"),h.logreduceMaxLimitMsg=m.getVal("event_group_tab_confirm_limit_min_msg"),h.loadEventGroups=function(){h.info.dataTabs||(h.info.page.total>=h.logreduceMinLimit&&h.info.page.total<=h.logreduceMaxLimit?h.showEventGroupChangeConfirmMin():h.info.page.total>h.logreduceMaxLimit?h.showEventGroupChangeConfirmMax():h.initiateLogReduce())},h.initiateLogReduce=function(){h.info.dataTabs=!0,h.eventGroups.api(),h.modalInstance&&h.modalInstance.close()},h.showEventGroupChangeConfirmMin=function(){h.logreduceMaxLimitMsg=m.getVal("event_group_tab_confirm_limit_min_msg"),h.modalInstance=l.openModal("partials/explorer/event_group_confirmation.html",h)},h.showEventGroupChangeConfirmMax=function(){h.logreduceMaxLimitMsg=m.getVal("event_group_tab_confirm_limit_max_msg"),h.modalInstance=l.openModal("partials/explorer/event_group_confirmation.html",h)},h.closeModal=function(){h.modalInstance.close(),null==h.events_export_limit||0==h.events_export_limit?h.csvpage.noOfRecordsCsv=1:h.csvpage.noOfRecordsCsv=h.events_export_limit,h.csvdownloaderror=!1},h.downloadFacetsData=function(e){for(var t=angular.copy(e),a=[],n=[],i=0;i<t.length;i++)if(t[i].data&&0<t[i].data.length){for(var o=t[i].data,n=[],s=0;s<o.length;s++)"obs_url"==o[s].key||"Section Name"==o[s].label&&"section"!=h.info.eventsection||n.push(o[s]);0<n.length&&(a=a.concat(n))}a.forEach(function(e){delete e.selected,delete e.key,e["Facet Name"]=e.title,delete e.title,e["Facet Identifier"]=e.label,delete e.label,e["Number of results"]=e.value,delete e.value});var r=angular.copy(h.d3Data),l=r[0].title;c(function(){f(a,"Facet Report",r,l)},0),b.standard_user_tracking(h.info.application,"Explorer","Export csv",JSON.stringify({activity:"Export as csv"})).then(function(e){},v)};var f=function(e,t,a,n){var c,i="object"!=typeof e?JSON.parse(e):e,o="",s=[],r="";if(o+=t+"\r\n\n",ShowLabel=!0){for(var l in i[0])s.push(l),r+=l+",";o+=(r=r.slice(0,-1))+"\r\n"}r="";for(l=0;l<s.length;l++)r+='"----------------------------------",';o+=r+"\r\n";for(var d=0;d<i.length;d++){for(r="",l=0;l<s.length;l++)r+='"'+i[d][s[l]]+'",';r.slice(0,r.length-1),o+=r+"\r\n"}if(n&&a.length)for(o=o+("\r\n"+n+"\r\n")+'"----------------------------------",\r\n',d=0;d<a.length;d++)r="",o+=(r+='"'+(c=a[d]).name+'","'+c.value+'",')+"\r\n";""!=o?(e=t.replace(/ /g,"_"),n="data:text/csv;charset=utf-8,"+escape(o),(t=document.createElement("a")).href=n,t.style="visibility:hidden",t.download=e+".csv",document.body.appendChild(t),t.click(),document.body.removeChild(t)):alert("Invalid data")};h.showMoreOption=function(e){return e.length>h.info.facetLimit},p.getSavedFilters().then(function(e){h.savedFiltersList=e.data.Data},function(e){h.savedFiltersListLoading=!1,h.savedFiltersListNotFound=!0,v(e)})}]).controller("ExplorerTabCtrl",["$scope","ModalService","GlobalService","AppService","ExplorerService","$timeout",function(n,e,t,a,o,s){n.maxExplorerTabChar=t.getVal("maxExplorerTabChar"),n.justforflag={},n.justforflag.stillloading=!1,n.tabList=[{id:"tab1",name:"Default",editMode:!1}],n.activeTab=n.tabList[0],n.getDisableTabStatus=function(e){if(n.justforflag.stillloading)return!0;if(null!=e&&e.id==n.activeTab.id)return!1;for(i=0;i<n.tabList.length;i++)if(n.tabList[i].editMode)return!0;return!1},n.addNewTab=function(){if(!n.getDisableTabStatus()){for(i=0;i<n.tabList.length;i++)n.tabList[i].editMode=!1;var e=[];for(i=0;i<n.tabList.length;i++)e.push(n.tabList[i].id);do{var t="tab"+parseInt(Math.floor(100*Math.random()))}while(-1!=e.indexOf(t));var a={id:t,name:"Explorer Tab",editMode:!1};o.setBundleData(null),n.tabList.push(a),n.activeTab=a}},n.enableEditMode=function(e){for(i=0;i<n.tabList.length;i++)n.tabList[i].id==e.id&&("tab1"==e.id||e.id!=n.activeTab.id?n.tabList[i].editMode=!1:n.tabList[i].editMode=!0)},n.getDisableButtonStatus=function(e){return""==e.name||/^\s+$/.test(e.name)},n.changeTab=function(e){if(!n.getDisableTabStatus()){for(i=0;i<n.tabList.length;i++)e.id!=n.tabList[i].id&&(n.tabList[i].editMode=!1);n.activeTab=e}},n.getMaxTabs=function(){return t.getVal("maxExplorerTabs")>n.tabList.length},n.closeTab=function(t){e.confirmationBox({msg:"Close Tab"},{msg:"Do you want to close this tab?"},"Yes","No").result.then(function(e){for(i=0;i<n.tabList.length;i++)if(n.tabList[i].id==t.id){n.tabList.splice(i,1),n.activeTab=n.tabList[i-1];break}},function(e){})}}]).controller("MoreFacetCtrl",["$scope","ModalService","GlobalService","AppService","ExplorerService","$timeout",function(n,o,s,e,t,a){var r=this;r.facetList=[],r.inlineSearch="",r.inlineSearchText="",r.tempList=[],r.tempObject=null,r.loading=!0,r.sortByAlpha=!0,r.facetGrouped={"#":[],A:[],B:[],C:[],D:[],E:[],F:[],G:[],H:[],I:[],J:[],K:[],L:[],M:[],N:[],O:[],P:[],Q:[],R:[],S:[],T:[],U:[],V:[],W:[],X:[],Y:[],Z:[]},r.resetfacetGroup=function(){Object.keys(r.facetGrouped).map(function(e){0<r.facetGrouped[e].length&&(r.facetGrouped[e]=[])})},r.loadFacetGroup=function(e){e||(r.tempObject=n.$parent.getSelectedFacetData(r.findex),r.tempObject&&r.tempObject.data&&(r.tempList=angular.copy(r.tempObject.data)),r.tempList.sort(function(e,t){return e.label.toLowerCase()>t.label.toLowerCase()?1:-1})),1==r.sortByAlpha?(r.tempList.map(function(e,t,a){e.label=e.label.trim(),(/^[a-zA-Z]+$/.test(e.label.charAt(0))?r.facetGrouped[e.label.charAt(0).toUpperCase()]:r.facetGrouped["#"]).push(e)}),Object.keys(r.facetGrouped).map(function(e){0<r.facetGrouped[e].length&&(r.facetList=r.facetList.concat([{label:e,listTitle:!0}]),r.facetList=r.facetList.concat(r.facetGrouped[e]))})):(r.makeFacetData(),r.sortFacetsByCount()),r.loading=!1},r.showMoreFacetWindow=function(e){n.modal=o.openModal("partials/explorer/load-more-facets.html",n,"gb-facet-more-popup",!1),r.loading=!0;r.facetList=[],r.inlineSearch="",r.inlineSearchText="",r.sortByAlpha=!0,a(function(){r.resetfacetGroup(),r.loadFacetGroup()},1e3)},r.makeFacetData=function(){r.tempList.map(function(e,t,a){e.label=e.label.trim(),-1!=e.label.toLowerCase().indexOf(r.inlineSearch.toLowerCase())&&(/^[a-zA-Z]+$/.test(e.label.charAt(0))?r.facetGrouped[e.label.charAt(0).toUpperCase()]:r.facetGrouped["#"]).push(e)}),Object.keys(r.facetGrouped).map(function(e){0<r.facetGrouped[e].length&&(r.facetList=r.facetList.concat([{label:e,listTitle:!0}]),r.facetList=r.facetList.concat(r.facetGrouped[e]))})},r.inlineFilter=function(){r.inlineSearch=r.inlineSearchText,r.loading=!0,r.facetList=[],r.resetfacetGroup(),""!=r.inlineSearch?(1==r.sortByAlpha?r.makeFacetData():(r.makeFacetData(),r.sortFacetsByCount()),r.loading=!1):r.loadFacetGroup(!0)},r.highlightItem=function(e){var t;0!=r.facetGrouped[e].length&&("#"==e&&(e="0"),e=$("#gb-facet-more-grouped-name-"+e),(t=$("#gb-facet-more-popup-facet-list")).animate({scrollLeft:t.scrollLeft()+Math.ceil(e.offset().left)-550},500))},r.submit=function(){r.loadFacetGroup(!0);var e=0,t=!1,a=[];for(r.facetList.filter(function(e){e.selected&&a.push(e)}),i=0;i<r.tempList.length;i++)r.tempList[i].selected&&e++;for(key in n.$parent.selectedFacets)key!=r.tempObject.key&&0!=n.$parent.selectedFacets[key].length&&(t=!0,e=n.$parent.selectedFacets[key].length+e);t&&e>s.getVal("limitFacetTotal")?(r.close(),n.msg=s.getVal("limitFacetTotalMsg1")+s.getVal("limitFacetTotal"),n.modal1=o.openModal("partials/alert_box_extra.html",n,!1,!0)):!t&&e>s.getVal("limitFacet")?(r.close(),n.msg=s.getVal("limitFacetMsg1")+s.getVal("limitFacet"),n.modal1=o.openModal("partials/alert_box_extra.html",n,!1,!0)):(n.$parent.facetApplyFromMoreWindow(r.tempObject,a,r.findex),r.close())},r.showBody=function(){return!!r.loading||0!=r.facetList.length},r.close=function(){n.modal.close()},r.sortFacetsByCount=function(){r.sortByAlpha=!1,r.removeEmptyValue(),r.facetList.sort(function(e,t){return e.value<t.value?1:-1})},r.removeEmptyValue=function(){for(var e=0;e<r.facetList.length;e++)if(r.facetList[e].listTitle)return void r.deleteElementFromList(e)},r.deleteElementFromList=function(e){r.facetList.splice(e,1),r.removeEmptyValue()},r.sort=function(e){if(r.sortByAlpha=!0,"alpha"==e)r.inlineSearch?r.inlineFilter():(r.facetList=[],r.resetfacetGroup(),r.loadFacetGroup());else{if(r.sortByAlpha=!1,r.inlineSearch)return r.inlineFilter(),void r.sortFacetsByCount();r.sortByAlpha=!1,r.sortFacetsByCount()}}}]),angular.module("gbApp.services.explorer",[]).factory("ExplorerService",["$http","UserTrackingService","GlobalService",function(c,e,u){var t,a=null,n="",i="",o=!1;return{getLoadView:function(){return a},setLoadView:function(e){a=e},getRuleText:function(){return n},setRuleText:function(e){n=e},getRuleSection:function(){return i},setRuleSection:function(e){i=e},getAllConfig:function(){return e.getAllConfig()},getStats:function(){var e=u.getVal("infoserverDomain");return c.get(e+"/solr/stats/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema"))},getData:function(e,t,a){var e=u.getVal("infoserverDomain")+"/explorer/search/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema")+"/"+e,n=angular.copy(t),t=angular.copy(t);return delete t.filter,c.post(e,{searchtext:a,filter:n.filter},{params:t})},getFacets:function(e,t,a){var e=u.getVal("infoserverDomain")+"/explorer/search/facets/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema")+"/"+e,n=angular.copy(t),t=angular.copy(t);return delete t.filter,c.post(e,{searchtext:a,filter:n.filter},{params:t})},getFacetsGrdually:function(e,t,a,n){e=u.getVal("infoserverDomain")+"/explorer/search/facets/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema")+"/"+e+(n||""),n=angular.copy(t),t=angular.copy(t);return delete t.filter,c.post(e,{searchtext:a,filter:n.filter},{params:t})},getExportUrl:function(e,t){var a,n=u.getVal("infoserverDomain")+"/explorer/export/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema")+"/"+e;return Object.keys(t).length&&(n+="?",a=!0,angular.forEach(t,function(e,t){n+=(a?"":"&")+t+"="+e.replace(/\&/g,"%26").replace(/\//g,"%2F"),a=!1})),n},getSavedFilters:function(){var e=u.getVal("infoserverDomain");return c.get(e+"/explorer/view/list/all/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema"))},deleteSavedFilter:function(e){var t=u.getVal("infoserverDomain");return c.post(t+"/explorer/view/delete/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema")+"/"+e)},updateLimit:function(e){var t=u.getVal("umsDomain");return c.post(t+"/user/eventexport/"+e+"/"+u.getVal("manufacturer"))},changeFilterAccessibility:function(e){var t=u.getVal("infoserverDomain");return c.post(t+"/explorer/view/setpublic/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema")+"/"+!e.public+"/"+e.view_name)},getDefaultFilterInfo:function(e){var t=u.getVal("infoserverDomain");return c.get(t+"/explorer/view/getdefault/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema"))},getSectionViewerSections:function(){var e=u.getVal("infoserverDomain");return c.get(e+"/meta/sections/solr/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema")+"/SECTION")},saveFilter:function(e){var t=u.getVal("infoserverDomain")+"/explorer/view/add/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema")+"/"+e.is_public+"/"+e.search_name+"/"+e.is_default,e={desc:e.search_desc,start_time:e.start_time,end_time:e.end_time,facet_filters:e.facet_string,search_text:e.search_string,search_type:e.search_type,last_n_log:e.last_n_log,last_n_log_by_me:e.last_n_log_uploaded_by_me};return c.post(t,e)},suggestFilter:function(e,t){var a=u.getVal("infoserverDomain");return c.get(a+"/explorer/attribute/suggestion/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema")+"/"+e,{timeout:t.promise})},suggestFilterSection:function(e,t){var a=u.getVal("infoserverDomain");return e=e.toUpperCase(),c.get(a+"/meta/sections/type/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema")+"/"+e,{timeout:t.promise})},suggestFilterAttribute:function(e,t){var a=u.getVal("infoserverDomain");return c({url:a+"/meta/columns/table_name/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema")+"/"+e,method:"GET",params:{timeout:t.promise},cache:!0})},suggestFilterSearch:function(e,t,a,n){return a?this.suggestFilterSection(e,n):this.suggestFilterAttribute(t,n)},setResetDefaultFilter:function(e){e=u.getVal("infoserverDomain")+"/explorer/view/"+(e.default?"resetdefault":"setdefault")+"/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema")+"/"+e.view_name;return c.post(e)},getLinkedAttributes:function(){},getLinkedAttributesData:function(e){},getSectionsContent:function(e){var t=u.getVal("infoserverDomain");e.ns_id&&e.ns_id;return c({url:t+"/explorer/nscontent/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema"),method:"GET",params:e,cache:!0})},getEventsContent:function(d,e,t,a,n,i,o,s,r){var l=u.getVal("infoserverDomain"),t="/explorer/events/viewer/"+t+"/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema")+"/"+a+"/"+n+"/"+i+"/"+o+"/"+s+"?"+e;return r.length&&(t=t+'&filter=severity="'+r+'"'),c.get(l+t)},getEventSources:function(){var e=u.getVal("infoserverDomain");return c.get(e+"/meta/sections/type/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema")+"/EVENT")},getAllBundles:function(e,t){var a=u.getVal("infoserverDomain");t=t||"NA";return c.get(a+"/bundles/all/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema")+"/"+u.getVal("manufacturer")+"/"+e+"/"+t,{params:{col:"obs_ts",orderby:"obs_ts desc"}})},getAllBundlesInRange:function(e,t,a,n){var i=u.getVal("infoserverDomain");t=t||"NA";return c.get(i+"/bundles/time_range/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema")+"/"+u.getVal("manufacturer")+"/"+e+"/"+t+"/"+a+"/"+n,{params:{col:"obs_ts",orderby:"obs_ts desc"}})},processUrls:function(e){var t,a={};for(t in e)Array.isArray(a[e[t].attribute_name])||(a[e[t].attribute_name]=[]),a[e[t].attribute_name].push(e[t]);return a},getFileDiffSection:function(e,t,a){var n=u.getVal("infoserverDomain");return c.get(n+"/explorer/sectiondiff/data/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema")+"/"+e+"/"+t,{params:a})},getBundles:function(e,t,a){var n=u.getVal("infoserverDomain");return c.get(n+"/bundles/files/named/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema")+"/"+u.getVal("manufacturer")+"/"+t+"/"+a,{params:{obs_url:e}})},getBundleData:function(){return t},setBundleData:function(e){t=e},getDateRange:function(e){var t=u.getVal("infoserverDomain");return c.get(t+"/bundles/date_boundaries/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema")+"/"+u.getVal("manufacturer")+"/"+e)},getEventGroups:function(e,t,a){var n=u.getVal("infoserverDomain");return c.post(n+"/explorer/eventtype/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema")+"/"+u.getVal("manufacturer")+"/"+e,{searchtext:a},{params:t})},getEventGroupsData:function(e,t,a){var n=u.getVal("infoserverDomain");return c.get(n+"/explorer/viewer/eventtype/"+u.getVal("manufacturer")+"/"+u.getVal("product")+"/"+u.getVal("schema")+"/"+e+"/"+t+"/"+a)},setDrillDown:function(e){o=e},getDrillDown:function(){return o}}}]);var reloadExplorerGraph=function(e){var t,a,n,i,o=[],s="",r={chart:{animation:"1",bgcolor:"FFFFFF",canvasbgColor:"FAFAFA",canvasbgAlpha:"100",bgAlpha:"100",canvasBorderColor:"000000",canvasBorderThickness:"0.1",paletteColors:"#51BBFD",plotGradientColor:"4682B4",plotFillAlpha:"95,100",plotFillRatio:"20,80",plotBorderColor:"51BBFD",plotSpacePercent:"40",caption:"",xaxisname:"",yaxisname:"Result Count",showvalues:"0",decimals:"0",formatnumberscale:"0",numDivLines:"0",toolTipSepChar:" : ",baseFontSize:"9",baseFontColor:"286594",chartLeftMargin:"5",chartBottomMargin:"3",chartTopMargin:"5",captionPadding:"3",labelDisplay:"ROTATE",rotatelabels:"1",slantlabels:"1"}};if(e)if(0<=e.obs_date.gap.indexOf("YEAR")){for(r.chart.caption=s="Year View (UTC)",r.chart.rotatelabels=0,r.chart.slantlabels=0,r.chart.labelDisplay="auto",t=0;t<e.obs_date.counts.length/2;++t)n={},i=new Date(e.obs_date.counts[2*t].replace(/-/g,"/").replace("T"," ").substring(0,19)),n.label=""+i.getFullYear(),n.value=e.obs_date.counts[2*t+1],n.link="j-expDrillDown-"+e.obs_date.counts[2*t],n.color="0099FF",o.push(n);FusionCharts("explorerChart")?(FusionCharts("explorerChart").setJSONData({chart:r.chart,data:o}),FusionCharts("explorerChart").render("explorer_chart")):new FusionCharts({type:"column2d",renderAt:"explorer_chart",width:"100%",id:"explorerChart",height:"100%",dataFormat:"json",dataSource:{chart:r.chart,data:o}}).render("explorer_chart")}else if(0<=e.obs_date.gap.indexOf("MONTH")){for(r.chart.caption=s="Month View (UTC)",t=0;t<e.obs_date.counts.length/2;++t)n={},i=new Date(e.obs_date.counts[2*t].replace(/-/g,"/").replace("T"," ").substring(0,19)),n.label=i.getFullYear()+"-"+i.getMonthName().substring(0,3),n.value=e.obs_date.counts[2*t+1],n.link="j-expDrillDown-"+e.obs_date.counts[2*t],n.color="0099FF",o.push(n);FusionCharts("explorerChart")?(FusionCharts("explorerChart").setJSONData({chart:r.chart,data:o}),FusionCharts("explorerChart").render("explorer_chart")):new FusionCharts({type:"column2d",renderAt:"explorer_chart",width:"100%",id:"explorerChart",height:"100%",dataFormat:"json",dataSource:{chart:r.chart,data:o}}).render("explorer_chart")}else if(0<=e.obs_date.gap.indexOf("DAY")){for(r.chart.caption=s="Day of Month View (UTC)",t=0;t<e.obs_date.counts.length/2;++t)n={},i=new Date(e.obs_date.counts[2*t].replace(/-/g,"/").replace("T"," ").substring(0,19)),n.label=(9<i.getDate()?i.getDate():"0"+i.getDate())+" "+i.getMonthName().substring(0,3),n.value=e.obs_date.counts[2*t+1],n.link="j-expDrillDown-"+e.obs_date.counts[2*t],n.color="0099FF",o.push(n);FusionCharts("explorerChart")?(FusionCharts("explorerChart").setJSONData({chart:r.chart,data:o}),FusionCharts("explorerChart").render("explorer_chart")):new FusionCharts({type:"column2d",renderAt:"explorer_chart",width:"100%",id:"explorerChart",height:"100%",dataFormat:"json",dataSource:{chart:r.chart,data:o}}).render("explorer_chart")}else if(0<=e.obs_date.gap.indexOf("HOUR")){for(r.chart.caption=s="Hours View (UTC) (HH:MM Month-Date)",t=0;t<e.obs_date.counts.length/2;++t)n={},i=new Date(e.obs_date.counts[2*t].replace(/-/g,"/").replace("T"," ").substring(0,19)),n.label=(9<i.getHours()?i.getHours():"0"+i.getHours())+":"+(9<i.getMinutes()?i.getMinutes():"0"+i.getMinutes())+" "+i.getMonthName().substring(0,3)+" "+i.getDate(),n.value=e.obs_date.counts[2*t+1],n.link="j-expDrillDown-"+e.obs_date.counts[2*t],n.color="0099FF",o.push(n);FusionCharts("explorerChart")?(FusionCharts("explorerChart").setJSONData({chart:r.chart,data:o}),FusionCharts("explorerChart").render("explorer_chart")):new FusionCharts({type:"column2d",renderAt:"explorer_chart",width:"100%",id:"explorerChart",height:"100%",dataFormat:"json",dataSource:{chart:r.chart,data:o}}).render("explorer_chart")}else if(0<=e.obs_date.gap.indexOf("MINUTES")){for(r.chart.caption=s="Minutes View (UTC) (HH:MM)",a=0;a<60;++a){for(t=0;t<e.obs_date.counts.length/2&&(i=new Date(e.obs_date.counts[2*t].replace(/-/g,"/").replace("T"," ").substring(0,19))).getMinutes()!=a;++t);n={},t<e.obs_date.counts.length/2?n.value=e.obs_date.counts[2*t+1]:n.value=0,n.label=(9<i.getHours()?i.getHours():"0"+i.getHours())+":"+(9<a?a:"0"+a),n.link="j-expDrillDown-"+e.obs_date.counts[2*t],n.color="0099FF",o.push(n)}FusionCharts("explorerChart")?(FusionCharts("explorerChart").setJSONData({chart:r.chart,data:o}),FusionCharts("explorerChart").render("explorer_chart")):new FusionCharts({type:"column2d",renderAt:"explorer_chart",width:"100%",id:"explorerChart",height:"100%",dataFormat:"json",dataSource:{chart:r.chart,data:o}}).render("explorer_chart")}else if(0<=e.obs_date.gap.indexOf("SECONDS")){for(r.chart.caption=s="Seconds View (UTC) (MM:SS)",a=0;a<60;++a){for(t=0;t<e.obs_date.counts.length/2&&(i=new Date(e.obs_date.counts[2*t].replace(/-/g,"/").replace("T"," ").substring(0,19))).getSeconds()!=a;++t);n={},t<e.obs_date.counts.length/2?n.value=e.obs_date.counts[2*t+1]:n.value=0,n.label=(9<i.getSeconds()?i.getSeconds():"0"+i.getSeconds())+":"+(9<a?a:"0"+a),n.color="0099FF",o.push(n)}FusionCharts("explorerChart")?(FusionCharts("explorerChart").setJSONData({chart:r.chart,data:o}),FusionCharts("explorerChart").render("explorer_chart")):new FusionCharts({type:"column2d",renderAt:"explorer_chart",width:"100%",id:"explorerChart",height:"100%",dataFormat:"json",dataSource:{chart:r.chart,data:o}}).render("explorer_chart")}else{for(r.chart.caption=s="Year View (UTC)",t=0;t<e.obs_date.counts.length/2;++t)n={},i=new Date(e.obs_date.counts[2*t].replace(/-/g,"/").replace("T"," ").substring(0,19)),n.label=i,n.value=e.obs_date.counts[2*t+1],n.link="j-expDrillDown-"+e.obs_date.counts[2*t],n.color="0099FF",o.push(n);FusionCharts("explorerChart")?(FusionCharts("explorerChart").setJSONData({chart:r.chart,data:o}),FusionCharts("explorerChart").render("explorer_chart")):new FusionCharts({type:"column2d",renderAt:"explorer_chart",width:"100%",id:"explorerChart",height:"100%",dataFormat:"json",dataSource:{chart:r.chart,data:o}}).render("explorer_chart")}else FusionCharts("explorerChart")?(FusionCharts("explorerChart").setJSONData({chart:{caption:s,canvasBgColor:"F6F6F6",showBorder:1,yAxisName:"Result Count",theme:"zune"},data:[]}),FusionCharts("explorerChart").render("explorer_chart")):new FusionCharts({type:"column2d",renderAt:"explorer_chart",width:"100%",id:"explorer_chart",height:"100%",dataFormat:"json",dataSource:{chart:{caption:s,canvasBgColor:"F6F6F6",showBorder:1,yAxisName:"Result Count",theme:"zune"},data:[]}}).render("explorer_chart")},expDrillDown=function(e){var t=new Date(e.replace("j-drillDown-","").replace(/-/g,"/").replace("T"," ").substring(0,19)),a=new Date(e.replace("j-drillDown-","").replace(/-/g,"/").replace("T"," ").substring(0,19));switch(angular.element(".gb-explorer."+angular.element(".gb-explorer").scope().$parent.activeTab.id).scope().customDateFilterApplied=!1,angular.element(".gb-explorer."+angular.element(".gb-explorer").scope().$parent.activeTab.id).scope().drillDown=!0,angular.element(".gb-explorer."+angular.element(".gb-explorer").scope().$parent.activeTab.id).scope().info.currentFacet=null,angular.element(".gb-explorer."+angular.element(".gb-explorer").scope().$parent.activeTab.id).scope().getUTCTime=!1,angular.element(".gb-explorer."+angular.element(".gb-explorer").scope().$parent.activeTab.id).scope().info.chartLevel){case"YEAR":t.setMonth(0),t.setDate(1),a.setMonth(12),a.setDate(0),a.setHours(23),a.setMinutes(59),a.setSeconds(59);break;case"MONTH":t.setDate(1),a.setMonth(a.getMonth()+1),a.setDate(0),a.setHours(23),a.setMinutes(59),a.setSeconds(59);break;case"DAY":a.setHours(23),a.setMinutes(59),a.setSeconds(59);break;case"HOUR":a.setMinutes(59),a.setSeconds(59);break;case"MINUTES":a.setSeconds(59)}angular.element(".gb-explorer."+angular.element(".gb-explorer").scope().$parent.activeTab.id).scope().updateBreadCrumb(t,a),angular.element(".gb-explorer."+angular.element(".gb-explorer").scope().$parent.activeTab.id).scope().setFromTo(t,a,!0)},facetChart=function(){var e=$('<div class="gb-facet-chart-window"><div class="gb-facet-chart-window-title"><label class="radio-inline pull-left gb-modal-toolbar-radio-label"><input type="radio" name="facetChartType" value="bar"> Bar Chart </label><label class="radio-inline pull-left gb-modal-toolbar-radio-label"><input type="radio" name="facetChartType" value="line"> Line Chart</label><span class="icon-file-pdf gb-modal-toolbar-icon gb-modal-toolbar-icon-sendToPFD pull-left" title="Export As PDF"></span><span class="icon-image2 gb-modal-toolbar-icon pull-left" title="Export As Image"></span><span class="icon-close2 pull-right gb-modal-toolbar-controller gb-modal-toolbar-icon-close" title="close window"></span><span class="pull-right gb-modal-toolbar-controller" title="maximize window"></span>\t</div><div class="gb-facet-chart-window-body"><div class="chart"></div>\t</div></div>');$("body").append(e)},reloadGraph=(angular.module("gbApp.controllers.analytics",["gbApp.services","gbApp.globals","gbApp.services.analytics"]).controller("MenuCtrl",["$modal","MenuService","NavigationService","GlobalService","AppService","$filter","SectionsMetaService","DefaultFilterService","ConfigDiffService","ModalService",function(e,a,n,t,i,o,s,d,c,r){var l=this;a.getConfig().then(function(e){l.menu=e.data.Data},function(e){l.menu=e.data.Data,!l.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(l.info.sessionTimedOut=!0,r.sessionTimeout())}),l.info={},a.setCurrentLabel(t.getVal("default_landing_label")),l.info.tabview="sectionview",l.info.sessionTimedOut=!1,a.setAppsLoaded(),l.setUrl=function(e,t){n.getUrl()!=n.getUrlByKey(e)&&"#"!==e&&i.isAuthorized()&&i.isInfoServerUp()&&(n.setUrl(e),a.setCurrentLabel(t))},l.getCurrentLabel=function(){return a.getCurrentLabel()}}]).controller("ChangeViewController",["$modalInstance","$localStorage","$sce","$window","SectionsMetaService","ConfigDiffService","GlobalService","DefaultFilterService","items","NavigationService","$timeout",function(i,o,e,s,t,a,r,l,d,n,c){this.msg=e.trustAsHtml(r.getVal("nav_confirm")),this.changeViewConfirm=function(){n.setUrl(d.key),"configdiff"===d.key?t.clearSectionView():a.clearConfigDiff(),i.close(d.label)},this.hideChangeViewModal=function(){i.dismiss("cancel")},this.openChangeViewModal=function(){var e=JSON.stringify(l.getDefaultSysId()),t=JSON.stringify(l.getSelectedObservation()),a=(JSON.stringify(l.getDefaultEndCust()),l.getSelectedObsGrp()),n="",n="Section View"===d.current?"tabview=config":"tabview=section";o.tabview=n+="&selobsgroup="+a+"&selsysid="+e+"&selobservation="+t,c(function(){s.open(r.getVal("redirect_new_window"),"_blank")},250),i.dismiss("cancel")}}]).controller("SectionsCtrl",["$filter","metaDataService","SectionsMetaService","DefaultFilterService","UserTrackingService","GlobalService","ModalService","$window","$cookies","InstanceHandler","AppService","$sce","ExplorerService",function(f,e,s,r,o,t,l,a,g,p,m,h,i){var d=this;function b(e){var t,a="",n=!0;for(t in e.columns)""!=a&&(a+=", "),e.columns[t].visible=e.columns[t].selected,e.columns[t].visible&&(n=!1,a+=e.name+":"+e.columns[t].title);e.no_cols=!!n}function c(e){!d.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(d.info.sessionTimedOut=!0,l.sessionTimeout())}function u(){}d.select={},d.search={},d.select.selected=!0,d.info={},d.info.sessionTimedOut=!1,d.info.application=t.getVal("navLog"),d.isReady=function(){return s.isReady()},d.getSections=function(){return s.getSections(r.getDefaultObservation())},d.getSectionsLoading=function(){return s.getSectionLoading()},d.renderHtml=function(e){return h.trustAsHtml(e)},d.getValue=function(e){return t.getVal(e)},d.removeSection=function(){"Select view"!=s.getViewName()&&(s.setViewName("Select view"),s.setKbLink(null))},d.doTranspose=function(e){e.isTranspose=!e.isTranspose,d.removeSection(),o.standard_user_tracking(d.info.application,"Section View","Transpose Section","{'"+e.label+"'}").then(u,c)},d.hasFilter=function(e){var t,a,n=!1;if(e.filter&&0!=(a=Object.keys(e.filter)).length)for(t in a)!e.filter[a[t]].value&&0!==e.filter[a[t]].value||(n=!0);return n},d.addSectionInstance=function(e){var t,a,n;r.getDefaultObservation()?(t=r.getDefaultObservation().obs_url,a={filename:t=-1!=t.indexOf("/")?(n=t.split("/"))[n.length-1]:t,namespace_id:t+"-0",namespace:e.name,obs_date:r.getDefaultObservation().obs_time.substring(0,19)+"Z",sysid:r.getDefaultSysId().sys_id},angular.forEach(r.getLogVaultRec(),function(e,t){a[t]||(a[t]=e)}),n={type:"section",title:"Section Viewer",app:d.info.application,module:"Section View",data:{result:a,bundle:t,sysId:r.getDefaultSysId().sys_id,instanceDisplay:r.getConfigDiffFields(),start_time:r.getDefaultObservation().obs_time.substring(0,19)+"Z",end_time:r.getDefaultObservation().obs_time.substring(0,19)+"Z",observation:r.getDefaultObservation().obs_time,observationStr:r.getDefaultObservation().obs_time}},p.addInstance(n)):l.alertBox({msg:"Please select observation"})},d.toggleShowlog=function(e){var t=e.showlog?"Hide Log":"Show Log";e.showlog=!e.showlog,o.standard_user_tracking(d.info.application,"Section View",t,"{'"+e.label+"'}").then(u,c)},d.hasColumnFilter=function(e,t){if(!e.columns)return!1;var a=!1;return a=e.filter[t.field]&&(e.filter[t.field].value||0===e.filter[t.field].value)?!0:a},d.resetFilter=function(e){s.resetFilter(e),d.removeSection()},d.cancel=function(){var e,t=s.getSections(r.getDefaultObservation());for(e in t)t[e].default=t[e].selected;s.setSections(r.getDefaultObservation(),t),0},d.done=function(e){if(r.getDefaultObservation()){var t,a="",n=s.getSections(r.getDefaultObservation());if(null===r.getDefaultEndCust()&&(a+="Please select End Customer.\n"),null===r.getDefaultSysId()&&(a+="Please select System ID.\n"),0<a.length){for(t in n)1==n[t].selected?n[t].default=!0:n[t].default=!1;s.setSections(r.getDefaultObservation(),n)}else{var i="";for(t in n)1==n[t].default?(i+=""==i?n[t].label:","+n[t].label,n[t].selected||d.removeSection(),n[t].selected||s.loadData(n[t],d),n[t].selected=!0):(1==n[t].selected&&d.removeSection(),n[t].selected=!1);o.standard_user_tracking(d.info.application,"Section View","Sections Selected","{'"+i+"'}").then(u,c),s.setSections(r.getDefaultObservation(),n),0}}else l.alertBox({msg:"Please select observation!"})},d.toggleAll=function(e){var t,a="";for(t in e.columns)e.columns[t].selected=e.meta.shownAll,e.columns[t].selected&&(a+=""==a?e.columnsMap[e.columns[t].title]:","+e.columnsMap[e.columns[t].title]);d.removeSection(),b(e),o.standard_user_tracking(d.info.application,"Section View","Columns selected","{'"+e.label+"':'"+a+"'}").then(u,c)},d.changeShownAll=function(e){var t,a="",n=!0;for(t in e.columns)e.columns[t].selected?a+=""==a?e.columnsMap[e.columns[t].title]:","+e.columnsMap[e.columns[t].title]:n=!1;e.meta.shownAll=n,d.removeSection(),b(e),o.standard_user_tracking(d.info.application,"Section View","Columns selected","{'"+e.label+"':'"+a+"'}").then(u,c)},d.stopFilter=function(e,t,a){e.stopPropagation()},d.doneFilter=function(e,t,a){var n="",i=(n+=t.name,a.filter={},a.filter.field=a.field,a.filter.type=a.type,"boolean"==a.type?(a.filter.true=a.true,a.filter.false=a.false):"number"==a.type?(a.filter.value=a.value,a.filter.operator=a.operator):a.value&&a.value.length?a.filter.value=a.value:a.filter={},t.filter[a.field]=a.filter,Math.ceil(t.info.page.total/t.info.page.count));0==i?t.info.page.current=1:t.info.page.current>i&&(t.info.page.current=i),s.populateSectionData(t),t.firstLoad=!1,angular.element(document.querySelector(".dropdown.open")).removeClass("open"),n+=":"+a.field+":"+JSON.stringify(a.filter),d.removeSection(),o.standard_user_tracking(d.info.application,"Section View","Column Filters","{'"+n+"'}").then(u,c)},d.sortClicked=function(e,t,a){"columnHeader"!=e.target.id&&"columnDiv"!=e.target.id&&"columnLabel"!=e.target.id||d.changeSortField(t,a)},d.changeSortField=function(e,t){e.info.sorting&&e.info.sorting.field==t?e.info.sorting.reverse=!e.info.sorting.reverse:e.info.sorting={field:t,reverse:!1},s.populateSectionData(e)},d.getSectionColumns=function(e){var t=0;if(!e||!e.length)return e;for(var a=0;a<e.length;a++)e[a].firstVisible=!1,e[a].visible&&t++;if(1<t){for(a=0;a<e.length;a++)e[a].firstVisible=!1,e[a].visible&&t++;for(a=0;a<e.length;a++)if(e[a].visible){e[a].firstVisible=!0;break}}return e},d.exportAllPDF=function(){var e=s.getSections(r.getDefaultObservation());if((d.getSelectedSections()||[]).length)if(function(){var e,t=f("filter")(s.getSections(r.getDefaultObservation()),{selected:!0}),a=[];for(e in t){var n=t[e];if(n.a_data){var i,o=n.columns;for(i in o)if(o[i].visible){a.push(n);break}}else a.push(n)}return a}().length){var t,a,c,u,i=!1;for(a in t=f("filter")(e,{selected:!0})||[])if(t[a].display_data){i=!0;break}i?(e=d.getSelectedSections()||[],c=!1,u=new jsPDF("p","pt","a1"),angular.forEach(e,function(i){if(Array.isArray(i.export_data)&&i.export_data.length){var e=f("filter")(i.columns,{selected:!0})||[];if(e.length){var t=!1,a=(2250<u.autoTableEndPosY()&&(u.addPage(),t=!0),(c&&!t?u.autoTableEndPosY():0)+60),o=(u.text(i.label,40,a-10),t=!1,[]),s=[],r={};if(i.isTranspose)for(n=0;n<i.export_data.length;n+=20){for(var o=[{title:"",key:"col_name"}],l=n+20<=i.export_data.length?n+20:i.export_data.length,d=n;d<l;d++)o.push({title:"",key:"col"+d});s=[],angular.forEach(e,function(e){var t={};t.col_name=i.columnsMap[e.title];for(var a=n;a<l;a++)t["col"+a]=i.export_data[a][e.title];s.push(t)}),r={startY:a=0!=n?u.autoTableEndPosY()+15:a,tableWidth:"auto",columnWidth:"auto",styles:{overflow:"linebreak"},createdCell:function(e,t){"col_name"===t.column.dataKey&&(e.styles.fillColor=t.row.index%2==0?[41,128,185]:[61,148,205],e.styles.textColor=255)},createdHeaderCell:function(e,t){e.styles.rowHeight=0,e.styles.fillColor=255}},l!=i.export_data.length&&(u.autoTable(o,s,r),c=!0)}else angular.forEach(e,function(e){o.push({title:i.columnsMap[e.title],key:e.title})}),s=i.export_data,r={startY:a,tableWidth:"auto",columnWidth:"auto",styles:{overflow:"linebreak"}};u.autoTable(o,s,r),c=!0}}}),c&&u.save("Sections.pdf")):l.alertBox({msg:"Please select a section with data"})}else l.alertBox({msg:"Please select at least one column in a section!"});else l.alertBox({msg:"Please select at least one section!"})},d.getSelectedSections=function(){return f("filter")(s.getSections(r.getDefaultObservation()),{selected:!0})},d.cancelFilter=function(e,t,a){angular.element(document.querySelector(".dropdown.open")).removeClass("open")},d.increasePageSize=function(e){e.count=parseInt(e.count,10)<100&&parseInt(e.count,10)<e.tot_count?parseInt(e.count)+10:e.count,e.info.page.count=e.count,s.populateSectionData(e)},d.decreasePageSize=function(e){e.count=10<parseInt(e.count,10)?parseInt(e.count)-10:e.count,e.info.page.count=e.count,s.populateSectionData(e)},d.firstPage=function(e){1!=e.info.page.current&&(e.info.page.current=1,s.populateSectionData(e))},d.prevPage=function(e){1<e.info.page.current&&(--e.info.page.current,s.populateSectionData(e))},d.nextPage=function(e){e.info.page.current<e.info.page.pages&&(e.info.page.current+=1,s.populateSectionData(e))},d.lastPage=function(e){e.info.page.current!=e.info.page.pages&&(e.info.page.current=e.info.page.pages,s.populateSectionData(e))},d.generateRuleLogic=function(e,t){i.setRuleSection(e.name);var a=i.getRuleText();"string"==t.type?a="{"+e.label+"."+e.columnsMap[t.title]+"} LIKE '%"+a+"%'":"number"==t.type&&(a="{"+e.label+"."+e.columnsMap[t.title]+"} = "+a),i.setRuleText(a)}}]).controller("DefaultFilterCtrl",["$scope","DefaultFilterService","SectionsMetaService","UtilService","GlobalService","ModalService","AppService","UserTrackingService","$filter","$window","$timeout","$q","$modal","metaDataService",function(a,r,s,i,n,o,f,g,l,e,t,p,m,h){var b,d=this;d.info={},d.defaultFilters=[],d.info.ready=!1,d.resultLoading=!0,d.info.setObservationNull=!1,d.info.sysIdIndex=-1,d.info.selectedSystemId=null,d.info.sid2=null,d.info.subSysfilter="",d.application=n.getVal("navLog"),d.info.sysIdLimit=n.getVal("max_sysid_limit");d.info.selectedObsGroup=null,s.setSectionLoading(!0),d.info.sessionTimedOut=!1,a.$watch("defaultFilterCtrl.resultLoading",function(){d.resultLoading||f.hidePanelLoading()}),a.$on("AppLoadEvent-apps",function(e,t){d.resultLoading||f.hidePanelLoading(),t&&a.init()}),a.init=function(){d.resultLoading=!1,s.setReady(!0),s.getAll().then(function(e){r.getDefaultObservation();e=l("filter")(e.data.Data,{namespace_type:"!EVENT"}),e=l("filter")(e,{namespace_type:"!UNPARSED"});e=l("orderBy")(e,"label"),s.setSections(r.getDefaultObservation(),e),sections=s.getSections(r.getDefaultObservation()),s.getDefault().then(function(e){var t=s.getLoadView();t?d.loadDashboardView(t,e.data.Data):d.loadDefaultView(e.data.Data),d.info.ready=!0,s.setReady(!0)},u)},function(e){sections=e.data.Data,u(e)})},d.changeSubSysId=function(e){if(r.getSysId2()!=e){r.setSysId2(e),d.info.ready=!0,old_sections=s.getSections(r.getDefaultObservation()),s.setSectionLoading(!1);var t=s.getSections(r.getDefaultObservation());r.getDefaultObservation();for(section in old_sections)1==old_sections[section].selected?(t[section].selected=!0,t[section].default=!0,t[section].a_data=null,s.loadData(t[section],d)):(t[section].selected=!1,t[section].default=!1);1==d.info.setObservationNull&&(d.info.setObservationNull=!1,d.info.defaultObservation=null,r.setDefaultObservation(null),r.setSelectedObservation(null));var e=s.getLoadView();e?d.loadDashboardView(e):"Select view"!=s.getViewName()&&(e=s.getSelectedView(),s.loadView(e).then(function(e){e=e.data.Data[0];e?s.applyView(e,a):o.alertBox({msg:"No Applied View"})},u)),s.setSections(r.getDefaultObservation(),t)}},d.getSysId2=function(){return r.getSysId2()},d.selectObsGroup=function(e){d.info.selectedObsGroup=e,r.setSelectedObsGrp(e)},d.getKbLink=function(){return s.getKbLink()},d.moveThroughSysId=function(e){var t=d.info.defaultEndCust.sys_ids;if(d.sysfilter&&(t=l("filter")(d.info.defaultEndCust.sys_ids,d.sysfilter)),40==e.keyCode){for(var a in-1==d.info.sysIdIndex||d.info.sysIdIndex==t.length-1?d.info.sysIdIndex=0:d.info.sysIdIndex++,t)t[a].selected=!1;t[d.info.sysIdIndex].selected=!0,d.info.selectedSystemId=t[d.info.sysIdIndex]}else if(38==e.keyCode){for(var a in-1==d.info.sysIdIndex||0==d.info.sysIdIndex?d.info.sysIdIndex=t.length-1:d.info.sysIdIndex--,d.info.defaultEndCust.sys_ids)d.info.defaultEndCust.sys_ids[a].selected=!1;t[d.info.sysIdIndex].selected=!0,d.info.selectedSystemId=t[d.info.sysIdIndex]}else 13==e.keyCode?(d.info.defaultSysId=d.info.selectedSystemId,d.changeSysId(),d.resetMoveThroughSysId(),angular.element(".btn-group.open .dropdown-toggle").dropdown("toggle"),d.sysfilter&&(d.sysfilter.sys_id="")):d.resetMoveThroughSysId()},d.resetMoveThroughSysId=function(){for(var e in d.info.sysIdIndex=-1,d.info.selectedSystemId=null,d.info.defaultEndCust.sys_ids)d.info.defaultEndCust.sys_ids[e].selected=!1},a.$watch("defaultFilterCtrl.info['defaultEndCust']",function(e,t){r.setDefaultEndCust(e)}),d.loadDashboardView=function(t,a){var e;"custom"==t.type?((e=t.view).view_name="Select View",s.applyView(e),s.setSelectedView(e),s.setSectionLoading(!1)):"savedView"==t.type&&s.getAllViews().then(function(e){e=l("filter")(e.data.Data,{view_name:t.view},!0)||[];1==e.length?(c=!0,d.loadView(e[0])):(s.setSectionLoading(!1),o.alertBox({msg:"View not found"}),c||d.loadDefaultView(a))},function(e){s.setSectionLoading(!1),o.alertBox({msg:"View not found"}),c||d.loadDefaultView(a)}),s.setLoadView(null)},d.loadView=function(t){s.loadView(t).then(function(e){s.setSectionLoading(!1),(e=e.data.Data[0])?(s.applyView(e),s.setSelectedView(t),g.standard_user_tracking(d.application,"Section View","Apply View","{'"+t.view_name+"'}").then(y,u)):(s.setSectionLoading(!1),o.alertBox({msg:"No Applied View"}))},u)},d.loadDefaultView=function(e){s.getSections(r.getDefaultObservation());c=!0,s.setSectionLoading(!1)};var c=!(d.getSysId2List=function(){return d.info.sid2=r.getSubSys(),d.info.sid2&&d.info.sid2.length&&0<d.info.sid2.length&&(r.getSysId2()||r.setSysId2(d.info.sid2[0])),d.info.sid2});r.getObsGroups().then(function(e){d.obsGroups=e.data.Data},function(e){d.obsGroups=e.data.Data,u(e)});function _(e){var t,a=new Date;a.getUTCDate(),a.getUTCHours(),a.getUTCMonth(),a.getUTCFullYear();switch(e){case"Last 2 Days":var n,i=l("utcDateTZ")(a);(n=new Date(a.setUTCDate(a.getUTCDate()-2))).setUTCHours(0),n.setUTCMinutes(0),n.setUTCSeconds(0),t=l("utcDateTZ")(n);break;case"This Month":i=l("utcDateTZ")(a),(n=new Date(a.setUTCDate(1))).setUTCHours(0),n.setUTCMinutes(0),n.setUTCSeconds(0),t=l("utcDateTZ")(n);break;case"This Week":i=l("utcDateTZ")(a);var o=new Date,s=o.getUTCDay();diff=o.getUTCDate()-s+(0==s?-6:1),(n=new Date(o.setUTCDate(diff))).setUTCHours(0),n.setUTCMinutes(0),n.setUTCSeconds(0),t=l("utcDateTZ")(n)}r.getObservationsTimeRange(d.info.defaultEndCust,d.info.defaultSysId,t,i).then(function(e){var t,a;if(Array.isArray(e.data.Data))for(a in e.data.Data){(t={}).obs_time=e.data.Data[a].obs_ts;for(var n=e.data.Data[a].bundle_name,i=(t.bundle_name=n,t.file_name=e.data.Data[a].file_name,!1),o=0;o<d.info.defaultSysId.observations.length;o++)if(d.info.defaultSysId.observations[o].bundle_name==t.bundle_name){i=!0;break}i||d.info.defaultSysId.observations.push(t)}},u)}d.changeEndCust=function(){r.setDefaultSysId(null),r.setDefaultObservation(null),d.info.defaultObservation=null,d.info.defaultSysId=null},d.getValue=function(e){return n.getVal(e)},d.getSysId2Tooltip=function(){var e=n.getVal("manufacturer"),t=n.getVal("systemId2");return t.customer.hasOwnProperty(e)?t.customer[e]:t.common},d.showSysid2DD=function(){return h.isSysid2Enable()},d.changeSysId=function(){d.sysfilter&&(d.sysfilter.sys_id=""),d.info.defaultObservation=null,void 0===d.info.defaultSysId.observations&&r.getObservations(d.info.defaultEndCust,d.info.defaultSysId).then(function(e){var t,a;for(a in d.info.defaultSysId.observations=[],e.data.Data){(t={}).obs_time=e.data.Data[a].obs_ts;var n=e.data.Data[a].bundle_name;t.bundle_name=n,t.file_name=e.data.Data[a].file_name,d.info.defaultSysId.observations.push(t)}_("This Month"),_("This Week"),_("Last 2 Days")},u),void 0===d.info.defaultSysId.lastNObservations&&r.getNObservations(d.info.defaultEndCust,d.info.defaultSysId,n.getVal("no_of_bundles")).then(function(e){var t;s.setReady(!0),d.info.defaultSysId.lastNObservations=[];for(var a=0;a<e.data.Data.length;a++){(t={}).obs_time=e.data.Data[a].obs_ts;var n=e.data.Data[a].bundle_name;t.obs_url=e.data.Data[a].bundle_name,t.bundle_name=n,d.info.defaultSysId.lastNObservations.push(t)}},u),r.setDefaultObservation(null),d.info.defaultObservation=null,r.setSelectedObservation(null)},d.setDefaultObservation=function(e){s.setAppliedView(null),d.info.defaultObservation=e,r.setDefaultObservation(e),r.setSelectedObservation(e),r.setDefaultObservation(d.info.defaultObservation)},d.getObservations=function(e){if(e){if(e=e.replace(/\s/g,""),"function"==typeof(e=v[e="get"+e+"Observations"]))return e();o.alertBox({msg:"Not function"})}},d.getSelectedSections=function(){return l("filter")(s.getSections(r.getDefaultObservation()),{selected:!0})},d.resetSections=function(){var t=s.getSections(r.getDefaultObservation());m.open({templateUrl:"partials/sectionview_reset_view.html",controller:"ResetViewController as resetViewCtrl"}).result.then(function(){for(var e in t)t[e].selected=!1,t[e].default=!1,t[e].visible=!0,s.resetFilter(t[e]);s.setSections(r.getDefaultObservation(),t),s.setAppliedView(null),s.setViewName("Select view"),g.standard_user_tracking(d.application,"Section View","Clear Filter","{}").then(y,u)})},a.hideNavigationModal=function(){a.modal.close()},d.showModal=function(){if(s.getViewsCount()>=n.getVal("max_views_limit"))o.alertBox({msgKey:"max_views_msg"});else if(b=s.getSections(r.getDefaultObservation()),d.getSelectedSections().length)if(function(){var e,t=l("filter")(s.getSections(r.getDefaultObservation()),{selected:!0}),a=[];for(e in t){var n=t[e];if(n.a_data){var i,o=n.columns;for(i in o)if(o[i].visible){a.push(n);break}}else a.push(n)}return a}().length){var e,t,a=!1;for(t in e=l("filter")(b,{selected:!0}))if(e[t].display_data){a=!0;break}a?m.open({templateUrl:"partials/save_view.html",controller:"SaveFilter as saveFilterCtrl",resolve:{items:function(){return{allSectionsDetails:b}}}}):o.alertBox({msg:"Please select a section with data"})}else o.alertBox({msg:"Please select at least one column in a section!"});else o.alertBox({msg:"Please select at least one section!"})};var v={getLastHourObservations:function(){var e,t,a=[];if(d.info.defaultSysId){for(t in(e=new Date).setHours(e.getHours()-1),d.info.defaultSysId.observations)e<i.parseDate(d.info.defaultSysId.observations[t].obs_time)&&a.push(d.info.defaultSysId.observations[t]);return a}},getLast12HourObservations:function(){var e,t,a=[];if(d.info.defaultSysId){for(t in(e=new Date).setHours(e.getHours()-12),d.info.defaultSysId.observations)e<i.parseDate(d.info.defaultSysId.observations[t].obs_time)&&a.push(d.info.defaultSysId.observations[t]);return a}},getYesterdayObservations:function(){var e,t,a=[];if(d.info.defaultSysId){for(t in(e=new Date).setDate(e.getDate()-1),d.info.defaultSysId.observations)e<i.parseDate(d.info.defaultSysId.observations[t].obs_time)&&a.push(d.info.defaultSysId.observations[t]);return a}},getLast2DaysObservations:function(){var e,t,a=[];if(d.info.defaultSysId){for(t in(e=new Date).setDate(e.getDate()-2),d.info.defaultSysId.observations)e<i.parseDate(d.info.defaultSysId.observations[t].obs_time)&&a.push(d.info.defaultSysId.observations[t]);return a}},getThisWeekObservations:function(){var e,t,a,n=[];if(d.info.defaultSysId){for(a in e=new Date,d.info.defaultSysId.observations)(t=i.parseDate(d.info.defaultSysId.observations[a].obs_time))&&t.getWeek()===e.getWeek()&&n.push(d.info.defaultSysId.observations[a]);return n}},getMostRecentObservations:function(){var e=[];if(d.info.defaultSysId&&d.info.defaultSysId.lastNObservations)return e.push(d.info.defaultSysId.lastNObservations[0]),e},getThisMonthObservations:function(){var e,t,a,n=[];if(d.info.defaultSysId){for(a in e=new Date,d.info.defaultSysId.observations)(t=i.parseDate(d.info.defaultSysId.observations[a].obs_time))&&t.getMonth()===e.getMonth()&&n.push(d.info.defaultSysId.observations[a]);return n}},getLastNObservations:function(){var e=[];if(d.info.defaultSysId&&d.info.defaultSysId.lastNObservations){for(obs in d.info.defaultSysId.lastNObservations)e.push(d.info.defaultSysId.lastNObservations[obs]);return e}}};function y(e){}function u(e){!d.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(d.info.sessionTimedOut=!0,o.sessionTimeout())}a.init()}]).controller("AnalyticsCtrl",["NavigationService","$sce","ErrorService",function(e,t,a){this.getUrl=function(){return e.getUrl()},this.renderHtml=function(e){return t.trustAsHtml(e)},this.getError=function(){return a.getErrors("analytics")},this.isSectionTab=function(){return"partials/sectionview.html"==e.getUrl()||(e.getUrl(),!1)}}]).controller("ShowSavedFilters",["$modal","metaDataService","AppService","ModalService","$cookies","SectionsMetaService","UserTrackingService","GlobalService","DefaultFilterService",function(a,e,c,n,u,i,o,t,f){var s=this,r=(s.meta={},s.meta.visible=!1,s.filterBtn="all",s.inlineSearch="",s.views=[],s.dataNotFound=!1,s.application=t.getVal("navLog"),!1);function l(e){!r&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(r=!0,n.sessionTimeout())}function d(e){}s.getCurrentViewName=function(){return i.getViewName()},s.loadSavedViews=function(){s.savedViewsLoading=!0,s.inlineSearch="",i.getAllSavedViews().then(function(e){s.savedViewsLoading=!1,s.views=e.data.Data,s.views.length?i.setViewsCount(s.views.length):i.setViewsCount(0),0,""==s.views||0==s.views.length?s.dataNotFound=!0:s.dataNotFound=!1},function(e){l(e),s.dataNotFound=!1})},s.loadView=function(t){s.meta.visible=!s.meta.visible,f.getSelectedObservation()?i.loadView(t).then(function(e){e=e.data.Data[0];angular.element(document.getElementById("sectionview-select-view-div")).removeClass("open"),e?(i.applyView(e),i.setSelectedView(t),o.standard_user_tracking(s.application,"Section View","Apply View","{'"+t.view_name+"'}").then(d,l)):n.alertBox({msg:"No Applied View"})},l):n.alertBox({msg:"Please select observation!"})},s.deleteView=function(e,t){a.open({templateUrl:"partials/delete_view.html",controller:"DeleteViewController as delCtrl",resolve:{deleteModal:function(){return e}}}).result.then(function(){s.loadSavedViews()})},s.setDefaultView=function(t,e){t.default?(t.view_name,i.resetDefault(t).then(function(e){s.loadSavedViews(),o.standard_user_tracking(s.application,"Section View","Reset Default View","{'"+t.view_name+"'}").then(d,l)},function(e){l(e),0})):(t.view_name,i.setDefault(t).then(function(e){s.loadSavedViews(),o.standard_user_tracking(s.application,"Section View","Set Default View","{'"+t.view_name+"'}").then(d,l)},function(e){l(e),0}))},s.setAccessibility=function(t,e){t.view_name,i.setAccessibility(t).then(function(e){s.loadSavedViews(),o.standard_user_tracking(s.application,"Section View",t.public?"Set View Private":"Set View Public","{'"+t.view_name+"'}").then(d,l)},function(e){l(e),0})},s.filterByScope=function(e){return"all"==s.filterBtn||("my"==s.filterBtn&&e.created_by==s.getLoggedInUserName()||"others"==s.filterBtn&&e.created_by!=s.getLoggedInUserName())},s.getLoggedInUserName=function(){return e.getUser().email}}]).controller("DeleteViewController",["$modalInstance","SectionsMetaService","UserTrackingService","ModalService","GlobalService","deleteModal",function(t,a,n,i,e,o){var s=this;function r(e){e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(t.dismiss("cancel"),i.sessionTimeout())}s.deleteModal=o,s.deleteModal.deleteOperation="initiated",s.deleteModal.deleteOperationMsg="",s.application=e.getVal("navLog"),s.hideDeleteModal=function(){t.close("ok")},s.deleteViewRequest=function(t){s.deleteModal.deleteOperation="progress",a.deleteView(t).then(function(e){a.setViewsCount(a.getViewsCount()-1),s.deleteModal.deleteOperation="success",s.deleteModal.deleteOperationMsg="Deleted successfully",n.standard_user_tracking(s.application,"Section View","Delete View","{'"+t.view_name+"'}").then(function(e){},r)},function(e){r(e),s.deleteModal.deleteOperation="error",s.deleteModal.deleteOperationMsg="Error : "+e.data.Msg})}}]).controller("SaveFilter",["$scope","$modalInstance","ModalService","AppService","GlobalService","SectionsMetaService","$filter","UserTrackingService","DefaultFilterService","items","$cookies","metaDataService",function(i,o,s,r,t,d,c,p,u,e,m,h){var l=this,a=[],f=[],n=(e.allSectionsDetails[0].columns,e.allSectionsDetails);function b(){for(var e=!1,t=0;t<a.length;t++)if(a[t].view_name==l.saveModal.name){if(a[t].created_by!=h.getUser().email){e=!0;break}l.saveModal.viewOverwrite=!0}e?l.form.saveViewModal.viewName.$setValidity("duplicate",!1):l.form.saveViewModal.viewName.$setValidity("duplicate",!0)}function g(e){!l.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(l.info.sessionTimedOut=!0,l.hideModal(),s.sessionTimeout())}l.saveModal={},l.saveModal.saveStatus="initiated",l.saveModal.message="",l.form={},l.info={},l.saveModal.viewOverwrite=!1,l.info.sessionTimedOut=!1,l.info.application=t.getVal("navLog"),l.form={type:e.allSectionsDetails[0].name},l.info.selected=c("filter")(n,{selected:!0})[0],d.getAllViews().then(function(e){a=e.data.Data,d.setViewsCount(a.length)},g),l.kbaseOnFocus=function(){""==l.saveModal.kbase&&(l.saveModal.kbase="http://")},l.kbaseOnBlur=function(){"http://"==l.saveModal.kbase&&(l.saveModal.kbase="")},l.getEmptySectionList=function(){return f},l.updateColumnAttributes=function(e){e&&function(e){0;for(var t=n.length,a=0;a<t;a++)if(n[a].name==e)return n[a]}(e).columns},l.hideModal=function(){o.close("OK")},l.getSelectedSectionsNew=function(){f=[];var e,t=c("filter")(d.getSections(u.getDefaultObservation()),{selected:!0}),a=[];for(e in t){var n=t[e];if(n.a_data){var i,o=n.columns;for(i in o)if(o[i].visible){a.push(n);break}}}for(var s=0;s<t.length;s++){for(var r=!1,l=0;l<a.length;l++)if(t[s].label==a[l].label){r=!0;break}r||f.push(t[s])}return a},l.checkViewName=function(){l.saveModal.viewOverwrite=!1,a&&a.length&&0<a.length?b():d.getAllViews().then(function(e){a=e.data.Data,b()},g)},l.getValue=function(e){return t.getVal(e)},l.saveFilter=function(){if(l.submitted=!0,l.form.saveViewModal.$valid){l.saveModal.saveStatus="progress";var e,t,a={},n={},i="",o="",s="",r=(a.name=l.saveModal.name,a.public="public"==l.saveModal.access,a.default=!1,n.desc=escape(l.saveModal.desc),n.kbase=l.saveModal.kbase,d.getSections(u.getDefaultObservation()));for(e in r){if(r[e].selected&&r[e].a_data)for(t in r[e].columns)r[e].columns[t].visible&&(i&&(i+=","),i+=r[e].table_name+":"+r[e].columns[t].field,r[e].columns[t].filter&&(s&&(s+=","),s+=r[e].table_name+":"+r[e].columns[t].title+":"+("string"===r[e].columns[t].type?"~":r[e].columns[t].filter.operator)+":"+r[e].columns[t].filter.value));o&&r[e].selected&&r[e].a_data&&(o+=","),r[e].selected&&r[e].a_data&&(o+=r[e].table_name+":"+(r[e].isTranspose||!1))}n.cols="{'"+i+"'}",n.transpose="{'"+o+"'}",n.filters="{'"+s+"'}",d.saveSelectedView(a,n).then(function(e){d.setViewsCount(d.getViewsCount()+1),l.saveModal.saveStatus="success",l.saveModal.message="View saved successfully.",p.standard_user_tracking(l.info.application,"Section View","Save View",n.cols).then(function(e){},g)},function(e){g(e),l.saveModal.saveStatus="error",l.saveModal.message="Error :"+(e.data&&e.data.hasOwnProperty("Msg")?e.data.Msg:"")})}}}]).controller("LogiCtrl",["$scope","$sce",function(e,t){e.sceURL=function(e){return t.trustAsResourceUrl(e)}}]).controller("ConfigCtrl",["$q","$scope","$modal","DefaultFilterService","ConfigDiffService","UtilService","$filter","GlobalService","AppService","ModalService","$cookies","UserTrackingService","InstanceHandler","$window","metaDataService","ExplorerService",function(e,o,g,r,s,p,c,i,n,u,t,l,m,h,b,_){var d=this;d.info={},d.supportEmail=i.getVal("supportEmail"),d.info.currentViewName="Select view",d.info.ready=!1,d.info.userrole=b.getUser().role,d.info.usertype=b.getUser().org_type,d.info.max_obs_limit=i.getVal("max_obs_limit"),d.info.min_obs_limit=i.getVal("min_obs_limit"),d.select={},d.select.selected=!0,d.defaultFilters=[],d.info.loaded=!1,d.info.sysIdIndex=-1,d.info.selectedSystemId=null,d.info.sysIdLimit=i.getVal("max_sysid_limit"),d.info.sessionTimedOut=!1,d.info.setObservationNull=!1,d.info.selectedObsGroup=null,d.info.application=i.getVal("navLog"),s.setSectionLoading(!0),d.resultLoading=!0,o.$watch("configCtrl.resultLoading",function(){d.resultLoading||n.hidePanelLoading()}),o.$on("AppLoadEvent-apps",function(e,t){d.resultLoading||n.hidePanelLoading(),t&&o.init()}),d.showSysid2DD=function(){return b.isSysid2Enable()},d.getCurrentViewName=function(){return s.getViewName()},d.getValue=function(e){return i.getVal(e)},d.getSysId2Tooltip=function(){var e=i.getVal("manufacturer"),t=i.getVal("systemId2");return t.customer.hasOwnProperty(e)?t.customer[e]:t.common},d.hasFilter=function(e){var t,a,n=!1;if(e.filter&&0!=(a=Object.keys(e.filter)).length)for(t in a)!e.filter[a[t]].value&&0!==e.filter[a[t]].value||(n=!0);return n},d.resetFilter=function(e){s.resetFilter(e),M()},s.getSavedViews().then(function(e){d.views=e.data.Data,s.setViewsCount(d.views.length)},f),o.init=function(){d.info.ready=!0,s.setSectionLoading(!1),d.resultLoading=!1,d.info.ready=!1,s.getAll().then(function(e){obs=d.info.defaultObservation,sorted_data=c("filter")(e.data.Data,{namespace_type:"!UNPARSED"}),sorted_data=c("filter")(sorted_data,{namespace_type:"!EVENT"}),sorted_data=c("orderBy")(sorted_data,"label"),sections=sorted_data,s.setSections(sections),s.getDefault().then(function(e){var t=s.getLoadView();t?d.loadDashboardView(t,e.data.Data,sections):(s.setSectionLoading(!1),d.loadDefaultView(e.data.Data,sections)),1==d.info.setObservationNull&&(d.info.setObservationNull=!1,d.info.defaultObservation=null,r.setDefaultObservation(null),r.setSelectedObservation(null)),d.info.ready=!0},f)},function(e){sections=e.data.Data,f(e)})},o.$on("LoadConfigDiffView",function(e){o.init()}),o.init(),d.moveThroughSysId=function(e){var t=d.info.defaultEndCust.sys_ids;if(d.sysfilter&&(t=c("filter")(d.info.defaultEndCust.sys_ids,d.sysfilter)),40==e.keyCode){for(var a in-1==d.info.sysIdIndex||d.info.sysIdIndex==t.length-1?d.info.sysIdIndex=0:d.info.sysIdIndex++,t)t[a].selected=!1;t[d.info.sysIdIndex].selected=!0,d.info.selectedSystemId=t[d.info.sysIdIndex]}else if(38==e.keyCode){for(var a in-1==d.info.sysIdIndex||0==d.info.sysIdIndex?d.info.sysIdIndex=t.length-1:d.info.sysIdIndex--,d.info.defaultEndCust.sys_ids)d.info.defaultEndCust.sys_ids[a].selected=!1;t[d.info.sysIdIndex].selected=!0,d.info.selectedSystemId=t[d.info.sysIdIndex]}else 13==e.keyCode?(d.info.defaultSysId=d.info.selectedSystemId,d.changeSysId(),d.resetMoveThroughSysId(),angular.element(".btn-group.open .dropdown-toggle").dropdown("toggle"),d.sysfilter&&(d.sysfilter.sys_id="")):d.resetMoveThroughSysId()},d.resetMoveThroughSysId=function(){for(var e in d.info.sysIdIndex=-1,d.info.selectedSystemId=null,d.info.defaultEndCust.sys_ids)d.info.defaultEndCust.sys_ids[e].selected=!1},d.getSectionsLoading=function(){return s.getSectionLoading()},d.selectObsGroup=function(e){d.info.selectedObsGroup=e,r.setSelectedObsGrp(e)},d.getSections=function(){return s.getSections()},d.changeShownAll=function(e){var t,a=!0,n=!0;for(t in e.keys)if(!e.keys[t].visible){a=!1;break}for(t in e.shownAll=a,e.keys)if(e.keys[t].visible){n=!1;break}var i="";for(t in e.keys)e.keys[t].visible&&(i+=""==i?e.keys[t].col_name:","+e.keys[t].col_name);e.no_cols=n,M(),l.standard_user_tracking(d.info.application,"Config Diff","Columns selected","{'"+e.label+"':'"+i+"'}").then(V,f)},d.removeSection=function(e){e.default=!1,e.selected=!1,M(),l.standard_user_tracking(d.info.application,"Config Diff","Remove Section","{'"+e.name+"'}").then(function(e){},f)},d.toggleAll=function(e){for(var t in e.keys)e.keys[t].visible=!!e.shownAll;var a="";for(t in e.keys)e.keys[t].visible&&(a+=""==a?e.keys[t].col_name:","+e.keys[t].col_name);e.shownAll?e.no_cols=!1:e.no_cols=!0,M(),l.standard_user_tracking(d.info.application,"Config Diff","Columns selected","{'"+e.label+"':'"+a+"'}").then(V,f)},d.getKbLink=function(){return s.getKbLink()},d.cancel=function(){d.visible=!1;var e,t=s.getSections();for(e in t)t[e].default=t[e].selected;s.setSections(t)},d.done=function(e){if(d.info.defaultObservation){var t,a="",n=s.getSections();if(null===d.info.defaultEndCust&&(a+="Please select End Customer.\n"),null===d.info.defaultSysId&&(a+="Please select System ID.\n"),0<a.length){for(t in d.visible=!1,n)1==n[t].selected?n[t].default=!0:n[t].default=!1;s.setSections(n)}else{var i="";for(t in n)1==n[t].default?(i+=""==i?n[t].label:","+n[t].label,n[t].selected||M(),n[t].selected||s.loadData(n[t],o,d.info.defaultEndCust,d.info.defaultSysId,d.info.defaultObservation),n[t].selected=!0):(1==n[t].selected&&M(),n[t].selected=!1);l.standard_user_tracking(d.info.application,"Config Diff","Sections Selected","{'"+i+"'}").then(function(e){},f),s.setSections(n),d.visible=!1}}else u.alertBox({msg:"Please select observation!"})},d.loadDashboardView=function(t,a,n){var e;"custom"==t.type?((e=t.view).view_name="Select View",s.applyView(e,o,n,d.info.defaultEndCust,d.info.defaultSysId,d.info.defaultObservation),d.info.currentViewName=e.view_name,s.setSectionLoading(!1)):"savedView"==t.type&&s.getAllViews().then(function(e){e=c("filter")(e.data.Data,{view_name:t.view},!0)||[];1==e.length?(v=!0,d.loadView(e[0])):(s.setSectionLoading(!1),u.alertBox({msg:"View not found"}),v||d.loadDefaultView(a,n))},function(e){s.setSectionLoading(!1),u.alertBox({msg:"View not found"}),v||d.loadDefaultView(a,n)}),s.setLoadView(null)},d.getSysId2=function(){return s.getSysId2()},d.getSysId2List=function(){return d.info.sid2=r.getSubSys(),d.info.sid2&&d.info.sid2.length&&0<d.info.sid2.length&&(s.getSysId2()||s.setSysId2(d.info.sid2[0])),d.info.sid2},d.changeSubSysId=function(e){if(s.getSysId2()!=e){s.setSysId2(e);var t=s.getSections(),a="";for(section in t)1==t[section].default?(a+=""==a?t[section].label:","+t[section].label,s.loadData(t[section],o,d.info.defaultEndCust,d.info.defaultSysId,d.info.defaultObservation),t[section].selected=!0):(1==t[section].selected&&M(),t[section].selected=!1);s.setSections(t)}};var v=!(d.loadDefaultView=function(e,t){v=!0});function y(e){var t,a=new Date;a.getUTCDate(),a.getUTCHours(),a.getUTCMonth(),a.getUTCFullYear();switch(e){case"Last 2 Days":var n,i=c("utcDateTZ")(a);(n=new Date(a.setUTCDate(a.getUTCDate()-2))).setUTCHours(0),n.setUTCMinutes(0),n.setUTCSeconds(0),t=c("utcDateTZ")(n);break;case"This Month":i=c("utcDateTZ")(a),(n=new Date(a.setUTCDate(1))).setUTCHours(0),n.setUTCMinutes(0),n.setUTCSeconds(0),t=c("utcDateTZ")(n);break;case"This Week":i=c("utcDateTZ")(a);var o=new Date,s=o.getUTCDay();diff=o.getUTCDate()-s+(0==s?-6:1),(n=new Date(o.setUTCDate(diff))).setUTCHours(0),n.setUTCMinutes(0),n.setUTCSeconds(0),t=c("utcDateTZ")(n)}r.getObservationsTimeRange(d.info.defaultEndCust,d.info.defaultSysId,t,i).then(function(e){var t,a;if(Array.isArray(e.data.Data))for(a in e.data.Data){(t={}).obs_time=e.data.Data[a].obs_ts;for(var n=e.data.Data[a].bundle_name,i=(t.bundle_name=n,t.file_name=e.data.Data[a].file_name,!1),o=0;o<d.info.defaultSysId.observations.length;o++)if(d.info.defaultSysId.observations[o].bundle_name==t.bundle_name){i=!0;break}i||d.info.defaultSysId.observations.push(t)}},f)}function S(){return c("filter")(s.getSections(),{selected:!0})}function D(){var e,t=c("filter")(s.getSections(),{selected:!0}),a=[];for(e in t){var n=t[e];if(n.data){var i,o=n.keys;for(i in o)if(o[i].visible){a.push(n);break}}else a.push(n)}return a}o.$watch("configCtrl.info['defaultObservation']",function(e,t){d.info.defaultObservation=r.getDefaultObservation()}),r.getObsGroups().then(function(e){d.obsGroups=e.data.Data},function(e){d.obsGroups=e.data.Data}),d.incObsCount=function(e){e.count<d.info.max_obs_limit&&(e.count=parseInt(e.count)+1,delete e.data,delete e.ref_data,s.loadData(e,o,d.info.defaultEndCust,d.info.defaultSysId,d.info.defaultObservation),l.standard_user_tracking(d.info.application,"Config Diff","Add Observation","{'"+e.name+"'}").then(function(e){},f))},d.decObsCount=function(e){e.count>d.info.min_obs_limit&&(--e.count,delete e.data,delete e.ref_data,s.loadData(e,o,d.info.defaultEndCust,d.info.defaultSysId,d.info.defaultObservation),l.standard_user_tracking(d.info.application,"Config Diff","Remove Observation","{'"+e.name+"'}").then(function(e){},f))},d.changeEndCust=function(){d.info.defaultObservation=null,d.info.defaultSysId=null,r.setDefaultEndCust(d.info.defaultEndCust)},d.changeSysId=function(){d.sysfilter&&(d.sysfilter.sys_id=""),void 0===d.info.defaultSysId.observations&&r.getObservations(d.info.defaultEndCust,d.info.defaultSysId).then(function(e){var t,a;for(a in d.info.defaultSysId.observations=[],e.data.Data){(t={}).obs_time=e.data.Data[a].obs_ts;var n=e.data.Data[a].bundle_name;t.obs_url=e.data.Data[a].bundle_name,t.bundle_name=n,t.file_name=e.data.Data[a].file_name,d.info.defaultSysId.observations.push(t)}y("This Month"),y("This Week"),y("Last 2 Days")},f),void 0===d.info.defaultSysId.lastNObservations&&r.getNObservations(d.info.defaultEndCust,d.info.defaultSysId,i.getVal("no_of_bundles")).then(function(e){var t;d.info.defaultSysId.lastNObservations=[];for(var a=0;a<e.data.Data.length;a++){(t={}).obs_time=e.data.Data[a].obs_ts;var n=e.data.Data[a].bundle_name;t.obs_url=e.data.Data[a].bundle_name,t.bundle_name=n,d.info.defaultSysId.lastNObservations.push(t)}},f),d.info.defaultObservation=null,r.setDefaultObservation(null),r.setSelectedObservation(null),r.setDefaultSysId(d.info.defaultSysId)},d.setDefaultObservation=function(e){s.setAppliedView(null),d.info.defaultObservation=e,r.setDefaultObservation(d.info.defaultObservation),r.setSelectedObservation(d.info.defaultObservation)},d.getObservations=function(e){if(e){if(e=e.replace(/\s/g,""),"function"==typeof(e=w[e="get"+e+"Observations"]))return e();u.alertBox({msg:"Not function"})}},d.exportAllPDF=function(){if(S().length)if(D().length){var e,t,l,d,a=c("filter")(s.getSections(),{selected:!0}),n=!1;for(e in a)if(a[e].data){n=!0;break}n?(t=S()||[],l=!1,d=new jsPDF("p","pt","a1"),angular.forEach(t,function(n){var i,a,e,t,o,s,r;Array.isArray(n.data)&&1<n.data.length&&(i=n.data.length,(a=c("filter")(n.keys,{visible:!0})||[]).length&&(e=!1,2250<d.autoTableEndPosY()&&(d.addPage(),e=!0),t=(l&&!e?d.autoTableEndPosY():0)+60,d.text(n.label,40,t-10),e=!1,o=[{title:"Observations ("+i+")",key:"obs"}],s=0,angular.forEach(n.data,function(e){o.push({title:e.obs,key:"col"+s}),s++}),r=[],angular.forEach(a,function(e){var t={};t.obs=e.col_name;for(var a=0;a<i;a++)t["col"+a]=n.data[a].data[e.key];r.push(t)}),d.autoTable(o,r,{startY:t,tableWidth:"auto",columnWidth:"auto",styles:{overflow:"linebreak"},createdCell:function(e,t){"obs"===t.column.dataKey&&(e.styles.textColor=[41,128,185]),"obs"!==t.column.dataKey&&"col0"!==t.column.dataKey&&n.ref_data[a[t.row.index].key].toString()!=e.text&&(t.row.cells[t.column.dataKey].styles.fillColor=t.row.index%2==0?[61,148,205]:[71,158,215],t.row.cells[t.column.dataKey].styles.textColor=255,t.row.cells.obs.styles.textColor=[0,87,144],t.row.cells.obs.styles.fontSize=11)}}),l=!0))}),l&&d.save("Sections.pdf")):u.alertBox({msg:"Please select a section with data"})}else u.alertBox({msg:"Please select at least one column in a section!"});else u.alertBox({msg:"Please select at least one section!"})},d.showSaveViewModal=function(){if(s.getViewsCount()>=i.getVal("max_views_limit"))u.alertBox({msgKey:"max_views_msg"});else{var e=D();if(S().length)if(D().length){var t,a=c("filter")(s.getSections(),{selected:!0}),n=!1;for(t in a)if(a[t].data){n=!0;break}n?g.open({templateUrl:"partials/config-diff-save-view.html",controller:"SaveConfigFilter as saveConfigCtrl",resolve:{items:function(){return{allSectionsDetails:e}}}}):u.alertBox({msg:"Please select a section with data"})}else u.alertBox({msg:"Please select at least one column in a section!"});else u.alertBox({msg:"Please select at least one section!"})}},d.getSavedViews=function(){d.views=[],d.v_loading=!0,s.getSavedViews().then(function(e){d.views=e.data.Data,s.setViewsCount(d.views.length),d.v_loading=!1,d.info.filterBtn="all"},function(e){d.v_loading=!1,f(e)})},d.filterByScope=function(e){return"all"==d.info.filterBtn||("my"==d.info.filterBtn&&e.created_by==d.getLoggedInUserName()||"others"==d.info.filterBtn&&e.created_by!=d.getLoggedInUserName())},d.getLoggedInUserName=function(){return b.getUser().email},d.setDefaultView=function(t,e){var a;t.default?(t.inProgress=!0,s.resetDefault(t).then(function(e){"Success"==e.data.Status&&(t.default=!1,l.standard_user_tracking(d.info.application,"Config Diff","Reset Default View","{'"+t.view_name+"'}").then(function(e){},f)),t.inProgress=!1},function(e){t.inProgress=!1,f(e)})):(t.inProgress=!0,s.setDefault(t).then(function(e){for(a in d.views)d.views[a].default=!1;"Success"==e.data.Status&&(t.default=!0,l.standard_user_tracking(d.info.application,"Config Diff","Set Default View","{'"+t.view_name+"'}").then(function(e){},f)),t.inProgress=!1},function(e){f(e)||u.alertBox({msg:"Failed to set as default. Kindly try after sometime."}),t.inProgress=!1}))},d.showDeleteView=function(e,t){g.open({templateUrl:"partials/delete_config_diff.html",controller:"DeleteConfigViewController as delConfigCtrl",resolve:{deleteConfigModal:function(){return e}}}).result.then(function(){d.getSavedViews(),e.view_name==d.info.currentViewName&&(d.info.currentViewName="Select view",s.setKbLink(null))})},d.setAccessibility=function(t){t.accessProgress=!0,t.public=!t.public,s.setAccessibility(t).then(function(e){"Success"!=e.data.Status&&(t.public=!t.public),t.accessProgress=!1,l.standard_user_tracking(d.info.application,"Config Diff",t.public?"Set View Public":"Set View Private","{'"+t.view_name+"'}").then(function(e){},f)},function(e){t.public=!t.public,t.accessProgress=!1,f(e)})},d.loadView=function(t){r.getSelectedObservation()?s.loadView(t).then(function(e){e=e.data.Data[0];angular.element(document.getElementById("configdiff-select-view-div")).removeClass("open"),s.setSectionLoading(!1),e?(s.applyView(e,o,s.getSections(),d.info.defaultEndCust,d.info.defaultSysId,d.info.defaultObservation),d.info.currentViewName=t.view_name,s.setViewName(t.view_name),d.info.currentView=t,l.standard_user_tracking(d.info.application,"Config Diff","Apply View","{'"+t.view_name+"'}").then(function(e){},f)):u.alertBox({msg:"No Applied View"})},function(e){s.setSectionLoading(!1),f(e)||u.alertBox({msg:"No view to apply."})},this):u.alertBox({msg:"Please select observation!"})},d.getSelectedSections=function(){return c("filter")(s.getSections(),{selected:!0})},d.resetSections=function(){var t=s.getSections();g.open({templateUrl:"partials/sectionview_reset_view.html",controller:"ResetViewController as resetViewCtrl"}).result.then(function(){for(var e in t)t[e].selected=!1,t[e].default=!1,t[e].count=2,s.resetFilter(t[e]);s.setSections(t),s.setAppliedView(null),s.setViewName("Select view"),d.info.currentViewName="Select view",l.standard_user_tracking(d.info.application,"Config Diff","Clear Filter","{}").then(V,f)})};var a={loading:!0,files:[],facets:[],disabled:!0},w=(s.setGoldenConfig(a),s.getGoldenConfigCategories().then(function(e){(a=s.getGoldenConfig()).category=e.data.Data.category,a.sub_category=e.data.Data.sub_category,"NA"!==a.category&&"NA"!==a.sub_category?a.disabled=!0:a.disabled=!1,d.info.loaded=!0,s.setGoldenConfig(a)},f),d.showGoldenConfig=function(){b.getUser().role==i.getVal("manufacturer")+"_admin"||b.getUser().org_type==i.getVal("gbUserOrgType")?g.open({templateUrl:"partials/golden_config.html",controller:"GoldenConfigController as goldenConfigCtrl"}):u.alertBox({msg:"Non admin"})},d.toggleGoldenConfigData=function(){d.hasGoldenConfigSection()?d.clearGoldenConfigData():d.loadGoldenConfigData()},d.loadGoldenConfigData=function(){var e,t=s.getSections();if(a=s.getGoldenConfig(),d.info.loaded)if(a.disabled)if(c("filter")(t,{selected:!0}).length){for(e in t)1==t[e].default?(t[e].selected=!0,s.loadGoldenConfigDiffData(t[e],o,d.info.defaultEndCust,d.info.defaultSysId,d.info.defaultObservation)):t[e].selected=!1;s.setSections(t),d.visible=!1}else u.alertBox({msgKey:"select_section"});else u.alertBox({msg:"Golden config not defined. Please contact "+d.supportEmail});else u.alertBox({msg:"Golden config not defined. Please contact "+d.supportEmail});s.setSections(t),d.visible=!1},d.hasGoldenConfigSection=function(){var e,t=s.getSections(),a=c("filter")(t,{selected:!0})||[];if(a.length)for(e in a)if(a[e].hasOwnProperty("data"))for(var n in a[e].data)if(/golden\s+config/i.test(a[e].data[n].obs))return!0;return!1},d.clearGoldenConfigData=function(){var e,t=s.getSections(),a=c("filter")(t,{default:!0})||[];if(a.length)for(e in a)if(1==a[e].selected){if(a[e].hasOwnProperty("data"))for(var n in a[e].data)if(/golden\s+config/i.test(a[e].data[n].obs)){s.loadData(a[e],o,d.info.defaultEndCust,d.info.defaultSysId,d.info.defaultObservation);break}}else a[e].selected=!1},d.generateRuleLogic=function(e,t){_.setRuleSection(e.name);var a=_.getRuleText();"STRING"==e.columnDesc[t.key]?a="{"+e.label+"."+t.col_name+"} LIKE '%"+a+"%'":"INTEGER"!=e.columnDesc[t.key]&&"REAL"!=e.columnDesc[t.key]||(a="{"+e.label+"."+t.col_name+"} = "+a),_.setRuleText(a)},o.showSectionDiff=function(e){var a,t,n;r.getDefaultObservation()?(n=r.getDefaultObservation().bundle_name,-1!=n.indexOf("/")&&(n=(t=n.split("/"))[t.length-1]),a={obs_url:r.getDefaultObservation().bundle_name,filename:n,namespace_id:n+"-0",namespace:e.name,obs_date:r.getDefaultObservation().obs_time.substring(0,19)+"Z",sysid:r.getDefaultSysId().sys_id},t=r.getBundleDetailForSectionDiff(),angular.forEach(t,function(e,t){a[t]||(a[t]=e)}),n={type:"section",title:"Section Diff",defaultTab:"changes",app:d.info.application,module:"Config Diff",data:{result:a,bundle:r.getDefaultObservation().bundle_name,sysId:r.getDefaultSysId().sys_id,instanceDisplay:r.getConfigDiffFields(),start_time:r.getDefaultObservation().obs_time.substring(0,19)+"Z",end_time:r.getDefaultObservation().obs_time.substring(0,19)+"Z",observation:r.getDefaultObservation().obs_time,observationStr:r.getDefaultObservation().obs_time}},m.addInstance(n)):u.alertBox({msg:"Please select observation"})},{getLastHourObservations:function(){var e,t,a=[];if(d.info.defaultSysId){for(t in(e=new Date).setHours(e.getHours()-1),d.info.defaultSysId.observations)e<p.parseDate(d.info.defaultSysId.observations[t].obs_time)&&a.push(d.info.defaultSysId.observations[t]);return a}},getLast12HourObservations:function(){var e,t,a=[];if(d.info.defaultSysId){for(t in(e=new Date).setHours(e.getHours()-12),d.info.defaultSysId.observations)e<p.parseDate(d.info.defaultSysId.observations[t].obs_time)&&a.push(d.info.defaultSysId.observations[t]);return a}},getYesterdayObservations:function(){var e,t,a=[];if(d.info.defaultSysId){for(t in(e=new Date).setDate(e.getDate()-1),d.info.defaultSysId.observations)e<p.parseDate(d.info.defaultSysId.observations[t].obs_time)&&a.push(d.info.defaultSysId.observations[t]);return a}},getLast2DaysObservations:function(){var e,t,a=[];if(d.info.defaultSysId){for(t in(e=new Date).setDate(e.getDate()-2),d.info.defaultSysId.observations)e<p.parseDate(d.info.defaultSysId.observations[t].obs_time)&&a.push(d.info.defaultSysId.observations[t]);return a}},getThisWeekObservations:function(){var e,t,a,n=[];if(d.info.defaultSysId){for(a in e=new Date,d.info.defaultSysId.observations)(t=p.parseDate(d.info.defaultSysId.observations[a].obs_time))&&t.getWeek()===e.getWeek()&&n.push(d.info.defaultSysId.observations[a]);return n}},getMostRecentObservations:function(){var e=[];if(d.info.defaultSysId&&d.info.defaultSysId.lastNObservations)return e.push(d.info.defaultSysId.lastNObservations[0]),e},getThisMonthObservations:function(){var e,t,a,n=[];if(d.info.defaultSysId){for(a in e=new Date,d.info.defaultSysId.observations)(t=p.parseDate(d.info.defaultSysId.observations[a].obs_time))&&t.getMonth()===e.getMonth()&&n.push(d.info.defaultSysId.observations[a]);return n}},getLastNObservations:function(){var e=[];if(d.info.defaultSysId&&d.info.defaultSysId.lastNObservations){for(obs in d.info.defaultSysId.lastNObservations)e.push(d.info.defaultSysId.lastNObservations[obs]);return e}}});function M(){"Select view"!=d.info.currentViewName&&(d.info.currentViewName="Select view",s.setKbLink(null))}function f(e){if(!d.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/))return d.info.sessionTimedOut=!0,u.sessionTimeout(),!0}function V(){}}]).controller("GoldenConfigController",["$scope","$modalInstance","ModalService","ConfigDiffService","FileUploader","GlobalService",function(c,i,o,t,e,a){var s=this,n=(s.info={},s.info.loading=!0,s.info.goldenConfig={loading:!0,files:[],facets:[],disabled:!0},s.info.goldenConfig.loading?t.getAllFacets().then(function(e){s.info.goldenConfig.facets=t.formatFacets(e.data.Data),t.getGoldenConfigCategories().then(function(t){s.info.loading=!1,s.info.goldenConfig.category=t.data.Data.category,s.info.goldenConfig.sub_category=t.data.Data.sub_category,"NA"!==s.info.goldenConfig.category&&"NA"!==s.info.goldenConfig.sub_category?(s.info.goldenConfig.disabled=!0,angular.forEach(s.info.goldenConfig.facets,function(e){e.name==t.data.Data.category&&(s.info.goldenConfig.category=e),e.name==t.data.Data.sub_category&&(s.info.goldenConfig.sub_category=e)})):(s.info.goldenConfig.disabled=!1,s.info.goldenConfig.category=s.info.goldenConfig.facets[0],s.info.goldenConfig.sub_category=s.info.goldenConfig.facets[0]),s.info.goldenConfig.loading=!1,l()},function(e){s.info.loading=!1,l(),d(e),console.error(e)})},function(e){s.info.loading=!1,l(),d(e),console.error(e)}):s.info.loading=!1,a.getVal("manufacturer")),r=a.getVal("product"),u=a.getVal("schema"),a=a.getVal("infoserverDomain");function l(){t.setGoldenConfig(s.info.goldenConfig)}function d(e){!s.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(s.info.sessionTimedOut=!0,i.dismiss("cancel"),o.sessionTimeout())}s.uploader=new e({url:a+"/fileupload/uploadfile/"+n+"/"+r+"/"+u,queueLimit:1,onBeforeUploadItem:function(e){e.url=e.url+"?category="+s.info.goldenConfig.category.name+"&subcategory="+s.info.goldenConfig.sub_category.name},onErrorItem:function(e,t,a,n){!s.info.sessionTimedOut&&t&&t.hasOwnProperty("Msg")&&t.Msg.match(/timeout/)&&(i.dismiss("cancel"),s.info.sessionTimedOut=!0,o.sessionTimeout())}}),s.beginUpload=function(){s.uploader.uploadAll()},s.hideModal=function(){i.dismiss("cancel")},s.changeCategory=function(){"all"==s.info.goldenConfig.category.name?s.info.goldenConfig.sub_category=angular.copy(s.info.goldenConfig.category):"all"==s.info.goldenConfig.sub_category.name&&(s.info.goldenConfig.sub_category={})},s.changeSubCategory=function(){"all"==s.info.goldenConfig.sub_category.name?s.info.goldenConfig.category=angular.copy(s.info.goldenConfig.sub_category):"all"==s.info.goldenConfig.category.name&&(s.info.goldenConfig.category={})}}]).controller("SaveConfigFilter",["$scope","$modalInstance","ModalService","AppService","GlobalService","ConfigDiffService","$filter","UserTrackingService","DefaultFilterService","items","$cookies","metaDataService",function(s,t,u,f,a,r,g,p,m,e,h,n){var l=this,i=[],d=[],o=(e.allSectionsDetails[0].columns,e.allSectionsDetails);function b(){r.getAllViews().then(function(e){i=e.data.Data;for(var t=!1,a=0;a<i.length;a++)if(i[a].view_name==l.saveModal.name){if(i[a].created_by!=n.getUser().email){t=!0;break}l.saveModal.viewOverwrite=!0}t?l.form.saveViewModal.viewName.$setValidity("duplicate",!1):l.form.saveViewModal.viewName.$setValidity("duplicate",!0)},c)}function c(e){!l.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(l.info.sessionTimedOut=!0,t.dismiss("cancel"),u.sessionTimeout())}l.saveModal={},l.saveModal.saveStatus="initiated",l.saveModal.message="",l.form={},l.info={},l.info.application=a.getVal("navLog"),l.saveModal.viewOverwrite=!1,l.info.sessionTimedOut=!1,l.form={visible:!0,message:""},l.selectedSections=function(){var e,t,a=[];for(t in d=[],e=g("filter")(r.getSections(),{selected:!0})){var n=e[t];n.data&&a.push(n)}for(var i=0;i<e.length;i++){for(var o=!1,s=0;s<a.length;s++)if(e[i].label==a[s].label){o=!0;break}o||d.push(e[i])}return a},l.kbaseOnFocus=function(){""==l.saveModal.kbase&&(l.saveModal.kbase="http://")},l.kbaseOnBlur=function(){"http://"==l.saveModal.kbase&&(l.saveModal.kbase="")},l.getEmptySectionList=function(){return d},l.updateColumnAttributes=function(e){e&&function(e){0;for(var t=o.length,a=0;a<t;a++)if(o[a].name==e)return o[a]}(e).columns},l.hideModal=function(){t.close("OK")},l.checkViewName=function(){if(l.saveModal.viewOverwrite=!1,i&&i.length&&0<i.length){for(var e=!1,t=0;t<i.length;t++)if(i[t].view_name==l.saveModal.name){if(i[t].created_by!=n.getUser().email){e=!0;break}l.saveModal.viewOverwrite=!0}e?l.form.saveViewModal.viewName.$setValidity("duplicate",!1):l.form.saveViewModal.viewName.$setValidity("duplicate",!0)}else b()},l.getValue=function(e){return a.getVal(e)},l.saveFilter=function(){if(l.submitted=!0,l.form.saveViewModal.$valid){l.saveModal.saveStatus="progress";var e,t,a={},n={},i="",o=(a.name=l.saveModal.name,a.public="public"==l.saveModal.access,a.default=!1,n.desc=escape(l.saveModal.desc),n.kbase=l.saveModal.kbase,""),s=r.getSections();for(e in s){if(s[e].selected&&s[e].data)for(t in s[e].keys)s[e].keys[t].visible&&(i&&(i+=","),i+=s[e].table_name+":"+s[e].keys[t].key);o&&s[e].selected&&s[e].data&&(o+=","),s[e].selected&&s[e].data&&(o+=s[e].table_name+":"+s[e].count)}n.cols="{'"+i+"'}",n.obs_ct="{'"+o+"'}",r.saveSelectedView(a,n).then(function(e){r.setViewsCount(r.getViewsCount()+1),l.saveModal.saveStatus="success",l.saveModal.message="View saved successfully.",b(),p.standard_user_tracking(l.info.application,"Config Diff","Save View",n.cols).then(function(e){},c)},function(e){c(e),l.saveModal.saveStatus="error",l.saveModal.message="Error :"+e.data.Msg})}}}]).controller("ResetViewController",["$modalInstance",function(e){this.msg="Are you sure to loose the current selection ??",this.resetViewConfirm=function(){e.close("ok")},this.hideNavigationModal=function(){e.dismiss("cancel")}}]).controller("DeleteConfigViewController",["$modalInstance","ConfigDiffService","UserTrackingService","ModalService","GlobalService","deleteConfigModal",function(t,a,n,i,e,o){var s=this;function r(e){e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(t.dismiss("cancel"),i.sessionTimeout())}s.deleteModal=o,s.deleteModal.status="initiated",s.deleteModal.deleteOperationMsg="",s.application=e.getVal("navLog"),s.hideDeleteView=function(){t.close("ok")},s.deleteView=function(t,e){s.deleteModal.status="progress",a.deleteView(t).then(function(e){a.setViewsCount(a.getViewsCount()-1),s.deleteModal.status="success",s.deleteModal.deleteOperationMsg="View deleted successfully.",a.setViewName("Select view"),n.standard_user_tracking(s.application,"Config Diff","Delete View","{'"+t.view_name+"'}").then(function(e){},r)},function(e){s.deleteModal.status="error",r(e),s.deleteModal.deleteOperationMsg="Unable to delete view. Try again later."})}}]),angular.module("gbApp.services.analytics",["ui.bootstrap","ui.unique"]).factory("MenuService",["$http","useLocal","GlobalService",function(e,t,a){return{getConfig:function(){a.getVal("infoserverDomain");return e.get("stat/menuconfig.json")},getCurrentLabel:function(){return this.currentLabel},setCurrentLabel:function(e){this.currentLabel=e},getAppsLoaded:function(){return this.appsLoaded},setAppsLoaded:function(){this.appsLoaded=!0}}}]),angular.module("gbApp.services.analytics").factory("DefaultFilterService",["$http","useLocal","GlobalService","metaDataService",function(o,e,s,t){var a,n,i;return{setLogVaultRec:function(e){i=e},getLogVaultRec:function(e){return i},setBundleDetailForSectionDiff:function(e){n=e},getBundleDetailForSectionDiff:function(e){return n},setConfigDiffFields:function(e){a=e},getConfigDiffFields:function(){return a},getDefaultEndCust:function(){return this.defaultEndCust},setDefaultEndCust:function(e){this.defaultEndCust=e},getDefaultSysId:function(){return this.defaultSysId},setDefaultSysId:function(e){this.defaultSysId=e},setSysId2:function(e){this.sid2=e},getSysId2:function(){return t.isSysid2Enable()?this.sid2:"NA"},setSubSys:function(e){this.subSys=e},getSubSys:function(){return this.subSys},getDefaultObservation:function(){return this.defaultObservation},setDefaultObservation:function(e){this.defaultObservation=e},getSelectedObservation:function(){return this.selectedObservation},setSelectedObservation:function(e){this.selectedObservation=e},getLoadPage:function(){return this.loadPage},setLoadPage:function(e){this.loadPage=e},getLoadSysId:function(){return this.loadSysId},setLoadSysId:function(e){this.loadSysId=e},getLoadObservation:function(){return this.loadObservation},setLoadObservation:function(e){this.loadObservation=e},getSelectedObsGrp:function(){return this.selectedObsGrp},setSelectedObsGrp:function(e){this.selectedObsGrp=e},getEC:function(){var e=s.getVal("infoserverDomain");return o.get(e+"/analytics/standard/ecs/"+s.getVal("manufacturer")+"/"+s.getVal("product")+"/"+s.getVal("schema"))},getSerialNum:function(e){var t=s.getVal("infoserverDomain");return o.get(t+"/analytics/standard/systems/"+s.getVal("manufacturer")+"/"+s.getVal("product")+"/"+s.getVal("schema")+"/"+e.ec_name)},getObservations:function(e,t,a){a=a||"NA",e=e||s.getVal("manufacturer");var n=s.getVal("infoserverDomain");return o({url:n+"/bundles/all/"+s.getVal("manufacturer")+"/"+s.getVal("product")+"/"+s.getVal("schema")+"/"+e+"/"+t.sys_id+"/"+a+"?orderby=obs_ts DESC&limit=1",method:"GET",cache:!0})},getAllObservations:function(e,t,a){a=a||"NA",e=e||s.getVal("manufacturer");var n=s.getVal("infoserverDomain");return o({url:n+"/bundles/all/"+s.getVal("manufacturer")+"/"+s.getVal("product")+"/"+s.getVal("schema")+"/"+e+"/"+t.sys_id+"/"+a+"?orderby=obs_ts DESC",method:"GET",cache:!0})},getNObservations:function(e,t,a){var n=s.getVal("infoserverDomain");return o({url:n+"/bundles/last_n/"+s.getVal("manufacturer")+"/"+s.getVal("product")+"/"+s.getVal("schema")+"/"+e.ec_name+"/"+t.sys_id+"/"+a,method:"GET",cache:!0})},getObservationsTimeRange:function(e,t,a,n){var i=s.getVal("infoserverDomain");return o({url:i+"/bundles/time_range/"+s.getVal("manufacturer")+"/"+s.getVal("product")+"/"+s.getVal("schema")+"/"+e.ec_name+"/"+t.sys_id+"/"+a+"/"+n,method:"GET",cache:!0})},getEcSys:function(){var e=s.getVal("infoserverDomain");return o({url:e+"/analytics/ec/cluster/all/list/"+s.getVal("manufacturer")+"/"+s.getVal("product")+"/"+s.getVal("schema"),method:"GET",cache:!0})},getDefaultFilterData:function(){var e=s.getVal("infoserverDomain");return o.get(e+"/analytics/standard/default_filters/"+s.getVal("manufacturer")+"/"+s.getVal("product")+"/"+s.getVal("schema"))},getObsGroups:function(){return o({url:"stat/obs_groups.json",method:"GET",cache:!0})}}}]),angular.module("gbApp.services.analytics").factory("SectionsMetaService",["$q","$http","useLocal","ngTableParams","$filter","DefaultFilterService","GlobalService","ModalService","$cookies","$window","UserTrackingService",function(v,u,e,s,a,h,b,_,r,l,c){var t,n,d,i,f,g,o={},p=!1,m="Select view",y=null;return{getLoadView:function(){return y},setLoadView:function(e){y=e},setSelectedView:function(e){g=e},getSelectedView:function(){return g},setSectionLoading:function(e){f=e},getSectionLoading:function(){return f},getAppliedView:function(){return t||!1},setAppliedView:function(e){t=e},setReady:function(e){p=e},isReady:function(){return p},getViewName:function(){return m},setViewName:function(e){m=e},setViewsCount:function(e){i=e},getViewsCount:function(){return i},getSections:function(e){return e?o[a("bundleName")(e.bundle_name)+e.obs_time]:n?o[n]:[]},setSections:function(e,t){e&&t&&(n=a("bundleName")(e.bundle_name)+e.obs_time,o[n]=t)},getKbLink:function(){return this.getAppliedView()?"NA"!=this.kbLink&&this.kbLink:null},setKbLink:function(e){this.kbLink=e},clearSectionView:function(){var e,t=this.getSections(h.getDefaultObservation());for(e in t)t[e].selected=!1,t[e].default=!1,t[e].visible=!0,this.resetFilter(t[e]);this.setSections(h.getDefaultObservation(),t),this.setAppliedView(null),this.setViewName("Select view")},resetFilter:function(e){for(var t in e.hasOwnProperty("isTranspose")&&(e.isTranspose=!1),e.columns)e.filter[e.columns[t].field]&&(e.filter[e.columns[t].field].value="",e.filter={},this.populateSectionData(e)),e.columns[t].value=null;e.info&&e.info.sorting&&(delete e.info.sorting,this.populateSectionData(e))},parseFilters:function(e){if(0!=e.filters.length){for(var t={},a=e.filters[0].split(","),n=0;n<a.length;n++){var i=a[n].split(":"),o="~"==i[2]?i[1]+i[2]+'"'+i[3]+'"':i[1]+i[2]+i[3];t[i[0]]?t[i[0]]+=" AND "+o:t[i[0]]=o}return t}},applyViewFromLogVault:function(t){var a=this;this.loadView(t).then(function(e){e=e.data.Data[0];angular.element(document.getElementById("sectionview-select-view-div"))&&angular.element(document.getElementById("sectionview-select-view-div")).removeClass("open"),e?(a.applyView(e),a.setSelectedView(t),c.standard_user_tracking(b.getVal("navLog"),"Section View","Apply View","{'"+t.view_name+"'}").then(function(e){},function(e){})):_.alertBox({msg:"No Applied View"})},function(e){console.log(e)},a)},applyView:function(e,c){var u,t,n,i,a,o,s,r,l,f,g,p,d=e.transpose[0],d=(d=(d=d.replace("{'","")).replace("'}",""),e.transpose[0]=d,e.filters[0]),d=(d=(d=d.replace("{'","")).replace("'}",""),e.filters[0]=d,e.cols[0]),m=(d=(d=d.replace("{'","")).replace("'}",""),e.cols[0]=d,[]);for(a in this.setKbLink(e.kbase),this.setAppliedView(e),i=this.getSections(h.getDefaultObservation()),u=this.parseSavedView(e),t=this.parseFilters(e),l=Object.keys(u),t&&(filter_keys=Object.keys(t)),i)i[a].selected=!1,i[a].default=!1,i[a].isTranspose=!1;for(a in g=e.transpose[0].split(","),i)for(o in l)if(i[a].table_name==l[o]){for(s in i[a].selected=!0,i[a].default=!0,filter_keys)i[a].table_name==filter_keys[s]&&(i[a].filters=t[filter_keys[s]]);t.hasOwnProperty(i[a].table_name)?i[a].filters=t[i[a].table_name]:i[a].filters=null,m[a]=v.defer(),this.loadData(i[a],c,m[a],a,o,!0),m[a].promise.then(function(e){var t=e.cols,a=e.index_i,e=e.index_j;for(s in n=u[l[e]],t)t[s].selected=!1,t[s].visible=!1;if(1==n.length&&"*"==n[0])for(r in t)"G"!=i[a].columnType[t[r].field]&&(t[r].selected=!0,t[r].visible=!0);else for(s in n)for(r in t)n[s]==t[r].field&&(t[r].selected=!0,t[r].visible=!0);for(s in f=!0,t)0==t[s].visible&&(f=!1);i[a].columns=t,i[a].meta.shownAll=f},function(e){console.error(e)})}for(a in i)for(o in g)p=g[o].split(":"),i[a].table_name==p[0]&&("false"==p[1]?i[a].isTranspose=!1:i[a].isTranspose=!0);this.setSections(h.getDefaultObservation(),i)},parseSavedView:function(e){var t,a,n,i={},e=e.cols[0];for(a in t=(e=(e=e.replace("{'","")).replace("'}","")).split(","))i[(n=t[a].split(":"))[0]]||(i[n[0]]=[]),i[n[0]].push(n[1]);return i},getColumnDefs:function(e){var t,a,n,i=[];for(t in Object.keys(e[0]))a=Object.keys(e[0])[t],n="number"==typeof e[0][a]?"number":"boolean"==typeof e[0][a]?"boolean":"string",i.push({title:a,field:a,visible:!0,selected:!0,type:n,operator:">"});return i},processData:function(e,t){var a,n,i,o,s=[];for(a in e.data[0].rows){for(n in i={},e.data[0].rows[a].columns)-1==(o=Object.keys(e.data[0].rows[a].columns[n])[0]).indexOf("obs")&&t[o]&&0<t[o].length&&(i[o]=e.data[0].rows[a].columns[n][o]);s.push(i)}return s},loadData:function(d,n,f,g,p,m){var c,u,r,l;if(d.no_cols=!1,void 0===d.visible&&(d.visible=!0),d.a_data){if(d.filters){d.filter={};for(var e,t,a,i=d.filters.split(" AND "),o=0;o<i.length;o++)for(var s in-1!=i[o].indexOf("~")?(e=i[o].split("~")[0],t=i[o].split("~")[1].replace(/\"/g,"")):-1!=i[o].indexOf("<")?(e=i[o].split("<")[0],t=parseInt(i[o].split("<")[1]),a="<"):-1!=i[o].indexOf(">")?(e=i[o].split(">")[0],t=parseInt(i[o].split(">")[1]),a=">"):-1!=i[o].indexOf("=")&&(e=i[o].split("=")[0],t=parseInt(i[o].split("=")[1]),a="="),d.columns)d.columns[s].field===e&&(d.columns[s].filter={},d.columns[s].filter.field=e,d.columns[s].filter.type=d.columns[s].type,"number"==d.columns[s].filter.type?(d.columns[s].filter.value=t,d.columns[s].value=t,d.columns[s].filter.operator=a,d.columns[s].operator=a):(d.columns[s].filter.value=t,d.columns[s].value=t,d.columns[s].filter.operator=d.columns[s].operator),d.filter[d.columns[s].field]=d.columns[s].filter);delete d.filters}else m&&(d.filter={});f&&((u={}).index_i=g,u.index_j=p,u.cols=d.columns,f.resolve(u)),m||(l=r=!1,angular.forEach(d.columns,function(e){"G"==d.columnType[e.title]?(e.selected=!1,e.visible=!1,r=!0):l=!0}),d.meta.shownAll=!r,l||(d.no_cols=!0)),this.populateSectionData(d)}else c=this,d.d_loading=!0,this.getColumns(d.table_name).then(function(e){var t,a;for(t in d.columnsMap={},d.columnType={},e.data.Data){for(a in e.data.Data[t]){e.data.Data[t][Object.keys(e.data.Data[t])[0]].column_name=a;break}d.columnsMap[e.data.Data[t][Object.keys(e.data.Data[t])[0]].column_name]=e.data.Data[t][Object.keys(e.data.Data[t])[0]].attribute_label,d.columnType[e.data.Data[t][Object.keys(e.data.Data[t])[0]].column_name]=e.data.Data[t][Object.keys(e.data.Data[t])[0]].solr_facet}c.getSectionData(d.name,d.table_name,0,b.getVal("rc_threshold")).then(function(e){if(d.tot_count=e.data.Data.row_count,d.d_loading=!1,d.tot_count,b.getVal("rc_threshold"),""!=e.data.Data.data){if(d.a_data=c.processData(e.data.Data,d.columnsMap),d.columns=c.getColumnDefs(d.a_data),d.meta={},d.filter={},d.filters){for(var t,a,n,i=d.filters.split(" AND "),o=0;o<i.length;o++)for(var s in-1!=i[o].indexOf("~")?(t=i[o].split("~")[0],a=i[o].split("~")[1].replace(/\"/g,"")):-1!=i[o].indexOf("<")?(t=i[o].split("<")[0],a=parseInt(i[o].split("<")[1]),n="<"):-1!=i[o].indexOf(">")?(t=i[o].split(">")[0],a=parseInt(i[o].split(">")[1]),n=">"):-1!=i[o].indexOf("=")&&(t=i[o].split("=")[0],a=parseInt(i[o].split("=")[1]),n="="),d.columns)d.columns[s].field===t&&(d.columns[s].filter={},d.columns[s].filter.field=t,d.columns[s].filter.type=d.columns[s].type,"number"==d.columns[s].filter.type?(d.columns[s].filter.value=a,d.columns[s].value=a,d.columns[s].filter.operator=n,d.columns[s].operator=n):(d.columns[s].filter.value=a,d.columns[s].value=a,d.columns[s].filter.operator=d.columns[s].operator),d.filter[d.columns[s].field]=d.columns[s].filter);delete d.filters}var r,l;d.count=10,m||(l=r=!1,angular.forEach(d.columns,function(e){"G"==d.columnType[e.title]?(e.selected=!1,e.visible=!1,r=!0):l=!0}),d.meta.shownAll=!r,l||(d.no_cols=!0)),f&&((u={}).index_i=g,u.index_j=p,u.cols=d.columns,f.resolve(u)),d.display_data?d.firstLoad=!0:(d.info={},d.info.page={total:0,current:1,pages:0,count:10}),c.populateSectionData(d)}else delete d.a_data,delete d.display_data,d.info={},d.info.page={total:0,current:1,pages:0,count:10},d.meta={},d.filter={},d.showlog=!1},function(e){!n.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(n.info.sessionTimedOut=!0,_.sessionTimeout())})},function(e){!n.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(n.info.sessionTimedOut=!0,_.sessionTimeout())}),d.r_loading=!0,this.getSectionRawData(d.name,d.table).then(function(e){d.r_loading=!1,e.data.Data[0]?(d.rawdata=e.data.Data[0].content,d.rawdataArr=d.rawdata.split("\n"),10<d.rawdataArr.length&&(d.rawdata=d.rawdataArr[0]+"<br>"+d.rawdataArr[1]+"<br>"+d.rawdataArr[2]+"<br>"+d.rawdataArr[3]+"<br>"+d.rawdataArr[4]+"<br>"+d.rawdataArr[5]+"<br>"+d.rawdataArr[6]+"<br>"+d.rawdataArr[7]+"<br>"+d.rawdataArr[8]+"<br>"+d.rawdataArr[9])):d.rawdata=b.getVal("no_data")},function(e){!(n&&n.info&&n.info.sessionTimedOut)&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(n.info.sessionTimedOut=!0,_.sessionTimeout()),d.r_loading=!1})},populateSectionData:function(e){var t=e.info.sorting?a("orderBy")(e.a_data,e.info.sorting.field,e.info.sorting.reverse):e.a_data,t=e.filter?a("numberFilter")(t,e.filter):t;e.info.page.total=t.length,e.info.page.pages=Math.ceil(e.info.page.total/e.info.page.count),0==e.info.page.pages?e.info.page.current=1:e.info.page.current>e.info.page.pages&&(e.info.page.current=e.info.page.pages),t=(e.export_data=t).slice((e.info.page.current-1)*e.info.page.count,e.info.page.current*e.info.page.count),e.display_data=t},getAll:function(){var e=b.getVal("infoserverDomain");return u({url:e+"/meta/sections/type/"+b.getVal("manufacturer")+"/"+b.getVal("product")+"/"+b.getVal("schema")+"/SECTION",method:"GET",cache:!0})},getSectionsFilteredByByndleType:function(e){var t=b.getVal("infoserverDomain");return u({url:t+"/meta/sections/btype/"+b.getVal("manufacturer")+"/"+b.getVal("product")+"/"+b.getVal("schema")+"/"+e,method:"GET",cache:!0})},getColumns:function(e){var t=b.getVal("infoserverDomain");return u({method:"GET",url:t+"/meta/columns/table_name/"+b.getVal("manufacturer")+"/"+b.getVal("product")+"/"+b.getVal("schema")+"/"+e,cache:!0})},getS2:function(e){var t=b.getVal("manufacturer"),a=(e=e||h.getDefaultSysId().sys_id,b.getVal("infoserverDomain"));return u({method:"GET",url:a+"/analytics/ec/cluster/sysid/all/list/"+b.getVal("manufacturer")+"/"+b.getVal("product")+"/"+b.getVal("schema")+"/"+t+"/"+e,cache:!0})},getSectionData:function(e,t,a,n,i,o){var s=h.getDefaultSysId().sys_id,r=(d=h.getSysId2(),sid3="NA",h.getDefaultObservation().obs_time),l=b.getVal("infoserverDomain");return o=o||b.getVal("manufacturer"),d=d||"NA",i=i?l+"/base/columns/system/ts/all/row_range/"+b.getVal("manufacturer")+"/"+b.getVal("product")+"/"+b.getVal("schema")+"/"+o+"/"+s+"/"+d+"/"+sid3+"/"+t+"/"+r+"/"+a+"/"+n+"?filter="+i:l+"/base/columns/system/ts/all/row_range/"+b.getVal("manufacturer")+"/"+b.getVal("product")+"/"+b.getVal("schema")+"/"+o+"/"+s+"/"+d+"/"+sid3+"/"+t+"/"+r+"/"+a+"/"+n,u({url:i,method:"GET",cache:!0})},getSectionParsedData:function(e,t,a,n,i,o,s,r,l,c){var d=b.getVal("infoserverDomain");return http_url=r?d+"/base/columns/system/ts/all/row_range/"+b.getVal("manufacturer")+"/"+b.getVal("product")+"/"+b.getVal("schema")+"/"+l+"/"+e+"/"+t+"/"+a+"/"+n+"/"+i+"/"+o+"/"+s+"?filter="+r:d+"/base/columns/system/ts/all/row_range/"+b.getVal("manufacturer")+"/"+b.getVal("product")+"/"+b.getVal("schema")+"/"+l+"/"+e+"/"+t+"/"+a+"/"+n+"/"+i+"/"+o+"/"+s,u({url:http_url,method:"GET",params:c,cache:!0})},getSectionRawData:function(e,t){var a=b.getVal("infoserverDomain");return u({url:a+"/explorer/nscontent/"+b.getVal("manufacturer")+"/"+b.getVal("product")+"/"+b.getVal("schema"),method:"GET",params:{bundle:h.getDefaultObservation().obs_url,ts:h.getDefaultObservation().obs_time,ns:e},cache:!0})},saveSelectedView:function(e,t){t.desc||(t.desc="NA"),t.kbase||(t.kbase="NA");e=b.getVal("infoserverDomain")+"/sectionview/add/"+b.getVal("manufacturer")+"/"+b.getVal("product")+"/"+b.getVal("schema")+"/"+e.public+"/"+e.name+"/"+e.default;return u.post(e,t)},getAllSavedViews:function(){var e=b.getVal("infoserverDomain");return u.get(e+"/sectionview/list/"+b.getVal("manufacturer")+"/"+b.getVal("product")+"/"+b.getVal("schema"))},getAllViews:function(){var e=b.getVal("infoserverDomain");return u.get(e+"/sectionview/list/all/"+b.getVal("manufacturer")+"/"+b.getVal("product")+"/"+b.getVal("schema"))},deleteView:function(e){this.getViewName()==e.view_name&&this.setViewName("Select view");var t=b.getVal("infoserverDomain");return u.post(t+"/sectionview/delete/"+b.getVal("manufacturer")+"/"+b.getVal("product")+"/"+b.getVal("schema")+"/"+e.view_name)},loadView:function(e){var t=b.getVal("infoserverDomain");return this.setViewName(e.view_name),u({method:"GET",url:t+"/sectionview/meta/"+b.getVal("manufacturer")+"/"+b.getVal("product")+"/"+b.getVal("schema")+"/"+e.view_name,params:{created_by:e.created_by},cache:!1})},setDefault:function(e){var t=b.getVal("infoserverDomain");return u.post(t+"/sectionview/setdefault/"+b.getVal("manufacturer")+"/"+b.getVal("product")+"/"+b.getVal("schema")+"/"+e.view_name)},resetDefault:function(e){var t=b.getVal("infoserverDomain");return u.post(t+"/sectionview/resetdefault/"+b.getVal("manufacturer")+"/"+b.getVal("product")+"/"+b.getVal("schema")+"/"+e.view_name)},setAccessibility:function(e){var t=b.getVal("infoserverDomain");return u.post(t+"/sectionview/setpublic/"+b.getVal("manufacturer")+"/"+b.getVal("product")+"/"+b.getVal("schema")+"/"+(0==e.public?"true":"false")+"/"+e.view_name)},getDefault:function(e){var t=b.getVal("infoserverDomain");return u.get(t+"/sectionview/getdefault/"+b.getVal("manufacturer")+"/"+b.getVal("product")+"/"+b.getVal("schema"))},exportXlsUrl:function(e){var t,a,n=b.getVal("infoserverDomain"),i="",o="";for(t in e.columns)""!=o&&(o+="&"),o+="col="+e.columns[t].field;for(t in a=Object.keys(e.filter))""!=i&&(i+="&"),i+="filter="+a[t],"number"==e.filter[a[t]].type?i+=e.filter[a[t]].operator:i+="=",i+=e.filter[a[t]].value;var s=b.getVal("manufacturer"),r=h.getDefaultSysId().sys_id;return d=h.getSysId2(),sid3="NA",d=d||"NA",sid3=sid3||"NA",n+"/base/export/system/ts/named/time_range/"+b.getVal("manufacturer")+"/"+b.getVal("product")+"/"+b.getVal("schema")+"/"+s+"/"+r+"/"+d+"/"+sid3+"/"+e.table_name+"/"+h.getDefaultObservation().obs_time.substr(0,19)+"/"+h.getDefaultObservation().obs_time.substr(0,19)+"?"+o}}}]),angular.module("gbApp.services.analytics").factory("Analytics",["$http","GlobalService",function(n,i){return{custom_x_gby_y:function(e){var t=i.getVal("infoserverDomain");return n.get(t+"/analytics/x_gby_y/"+i.getVal("manufacturer")+"/"+i.getVal("product")+"/"+i.getVal("schema")+"/all/model/system_count/"+e.dashboardId+"/"+e.id)},standard_user_tracking:function(e,t,a){e=i.getVal("infoserverDomain")+"/user_tracking/"+i.getVal("manufacturer")+"/"+i.getVal("product")+"/"+i.getVal("schema")+"/Analytics/"+e+"/"+t;return n.post(e,{details:a})},custom_user_tracking:function(e,t){var a=i.getVal("infoserverDomain");return n.get(a+"/user_tracking/"+i.getVal("manufacturer")+"/"+i.getVal("product")+"/"+i.getVal("schema")+"/"+e+"/"+t)}}}]),angular.module("gbApp.services.analytics").factory("NavigationService",["GlobalService","ErrorService","AppService",function(a,n,i){var o;return{getUrlByKey:function(e){return a.getVal(e)},setUrl:function(e,t){"#"!==e&&i.isAuthorized()&&i.isInfoServerUp()&&(o=a.getVal(e),n.setError(""))},getUrl:function(){if(i.isAuthorized()&&i.isInfoServerUp())return o=void 0===o?a.getVal(a.getVal("default_landing_page")):o}}}]),angular.module("gbApp.services.analytics").factory("ConfigDiffService",["$http","SectionsMetaService","GlobalService","DefaultFilterService","$q","$filter","ModalService","metaDataService",function(l,a,c,u,f,r,d,e){var t,n,i,o,s,g,p,m=[],h=null;return{getLoadView:function(){return h},setLoadView:function(e){h=e},getViewName:function(){return i},setViewName:function(e){i=e},setSectionLoading:function(e){s=e},getSectionLoading:function(){return s},setClusterId:function(e){p=e},getClusterId:function(){return p},setSysId2:function(e){this.sid2=e},getSysId2:function(){return e.isSysid2Enable()?this.sid2:"NA"},setGoldenConfig:function(e){g=e},getGoldenConfig:function(){return g},getAll:function(){return a.getAll()},getDefault:function(){var e=c.getVal("infoserverDomain");return l({method:"GET",url:e+"/configview/getdefault/"+c.getVal("manufacturer")+"/"+c.getVal("product")+"/"+c.getVal("schema")})},getAppliedView:function(){return t||!1},setAppliedView:function(e){t=e},getSections:function(e){return m},setSections:function(e){m=e},setViewsCount:function(e){o=e},getViewsCount:function(){return o},getKbLink:function(){return this.getAppliedView()?"NA"!=this.kbLink&&this.kbLink:null},setKbLink:function(e){this.kbLink=e},clearConfigDiff:function(){var e,t=this.getSections();for(e in t)t[e].selected=!1,t[e].default=!1,t[e].count=2;this.setSections(t),this.setAppliedView(null),this.setViewName("Select view")},resetFilter:function(e){e.no_cols=!1},setSelectedView:function(e){n=e},getSelectedView:function(){return n},applyViewFromLogVault:function(n){var i=this;this.loadView(n).then(function(e){var t,a,e=e.data.Data[0];i.setViewName(n.view_name),angular.element(document.getElementById("configdiff-select-view-div"))&&angular.element(document.getElementById("configdiff-select-view-div")).removeClass("open"),e?(t=i.getClusterId(),a=u.getDefaultEndCust(),i.applyView(e,null,i.getSections(),a,t,u.getDefaultObservation()),i.setSelectedView(n)):d.alertBox({msg:"No Applied View"})},function(e){console.log(e)},i)},applyView:function(e,t,a,n,c,u){var i=e.cols[0],i=(i=(i=i.replace("{'","")).replace("'}",""),e.cols[0]=i,e.obs_ct[0]);i=(i=i.replace("{'","")).replace("'}",""),e.obs_ct[0]=i;var o,s,r,l,d=[];e.obs_ct[0].split(",");for(s in this.setKbLink(e.kbase),this.setAppliedView(e),o=this.parseSavedView(e),a)o[a[s].table_name]?(a[s].default=!0,a[s].selected=!0,a[s].count=o[a[s].table_name].obs_cnt,a[s].no_cols=!1,d[s]=f.defer(),this.loadData(a[s],t,n,c,u,d[s]),d[s].promise.then(function(e){var t=!0,a=!0;for(r in e.keys)e.keys[r].visible=!1;for(r in e.keys)if(1==o[e.table_name].cols.length&&"*"==o[e.table_name].cols[0])"G"!=e.columnType[e.keys[r].key]&&(t=!(e.keys[r].visible=!0)),e.keys[r].visible||(a=!1);else{for(l in o[e.table_name].cols)e.keys[r].key==o[e.table_name].cols[l]&&(t=!(e.keys[r].visible=!0));e.keys[r].visible||(a=!1)}e.shownAll=a,e.no_cols=t},function(){console.error("Error")})):(a[s].default=!1,a[s].selected=!1)},parseSavedView:function(e){var t,a,n,i={},o=e.obs_ct[0].split(","),s=e.cols[0].split(",");for(t in s)i[(a=s[t].split(":"))[0]]||(i[a[0]]={},i[a[0]].cols=[]),i[a[0]].cols.push(a[1]);for(t in o)i[(n=o[t].split(":"))[0]]||(i[n[0]]={}),i[n[0]].obs_cnt=n[1];return i},parseData:function(t,e){var a,n,i,o,s,r,l=[];if(delete t.keys,null==t.keys)for(a in t.keys=[],e.data[0].rows[0].columns)(i={}).key=Object.keys(e.data[0].rows[0].columns[a])[0],i.col_name=t.columnsMap[Object.keys(e.data[0].rows[0].columns[a])[0]],i.visible=!0,i.changed=!1,-1==i.key.indexOf("obs")&&i.col_name&&t.keys.push(i);else for(a in t.keys)t.keys[a].changed=!1;for(a in r=e.data[0].rows[0].columns.filter(function(e){return-1==Object.keys(e)[0].indexOf("obs")&&t.columnsMap[Object.keys(e)[0]]}),e.data){for(o in(n={}).obs=e.data[a].time,n.data={},s=e.data[a].rows[0].columns.filter(function(e){return-1==Object.keys(e)[0].indexOf("obs")&&t.columnsMap[Object.keys(e)[0]]}))n.data[t.keys[o].key]=s[o][t.keys[o].key],0<a&&r[o][t.keys[o].key]!=s[o][t.keys[o].key]&&(t.keys[o].changed=!0);l.push(n)}t.data=l,t.ref_data=t.data[0].data},loadData:function(n,i,e,t,o,s){var r=this;n.data=null,(n.ref_data=null)==n.count&&(n.count=2),null==n.keys&&(n.no_cols=!1,n.shownAll=!0),n.loading=!0,a.getColumns(n.table_name).then(function(e){var t,a;for(t in n.columnsMap={},n.columnType={},n.columnDesc={},e.data.Data){for(a in e.data.Data[t]){e.data.Data[t][Object.keys(e.data.Data[t])[0]].column_name=a;break}n.columnsMap[e.data.Data[t][Object.keys(e.data.Data[t])[0]].column_name]=e.data.Data[t][Object.keys(e.data.Data[t])[0]].attribute_label,n.columnType[e.data.Data[t][Object.keys(e.data.Data[t])[0]].column_name]=e.data.Data[t][Object.keys(e.data.Data[t])[0]].solr_facet,n.columnDesc[e.data.Data[t][Object.keys(e.data.Data[t])[0]].column_name]=e.data.Data[t][Object.keys(e.data.Data[t])[0]].type}r.getDiffData(n.name,n.table_name,o.obs_time.substring(0,19),n.count).then(function(e){""==e.data.Data||0==e.data.Data.data.length?(n.data=null,n.ref_data=null):r.parseData(n,e.data.Data),s&&s.resolve(n);var t=!1,a=!1;angular.forEach(n.keys,function(e){"G"==n.columnType[e.key]?(e.visible=!1,t=!0):a=!0}),n.shownAll=!t,a||(n.no_cols=!0),n.loading=!1},function(e){n.loading=!1,!i.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(i.info.sessionTimedOut=!0,d.sessionTimeout())})},function(e){!i.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(i.info.sessionTimedOut=!0,d.sessionTimeout())}),n.visible=!0},getDiffData:function(e,t,a,n){var i=c.getVal("infoserverDomain"),o=c.getVal("manufacturer"),s=this.getSysId2(),r=(r=this.getClusterId())||"NA",s=s||"NA";return l({method:"GET",url:i+"/base/columns/system/ts/named/last_n/"+c.getVal("manufacturer")+"/"+c.getVal("product")+"/"+c.getVal("schema")+"/"+o+"/"+r+"/"+s+"/NA/"+t+"/"+a+"/"+n,cache:!0})},saveSelectedView:function(e,t){var a=c.getVal("infoserverDomain");return t.desc||(t.desc="NA"),t.kbase||(t.kbase="NA"),a=a+"/configview/add/"+c.getVal("manufacturer")+"/"+c.getVal("product")+"/"+c.getVal("schema")+"/"+e.public+"/"+e.name+"/"+e.default,l.post(a,t)},getSavedViews:function(){var e=c.getVal("infoserverDomain");return l({method:"GET",url:e+"/configview/list/"+c.getVal("manufacturer")+"/"+c.getVal("product")+"/"+c.getVal("schema")})},getAllViews:function(){var e=c.getVal("infoserverDomain");return l({method:"GET",cache:!0,url:e+"/configview/list/all/"+c.getVal("manufacturer")+"/"+c.getVal("product")+"/"+c.getVal("schema")})},setDefault:function(e){var t=c.getVal("infoserverDomain");return l({method:"POST",url:t+"/configview/setdefault/"+c.getVal("manufacturer")+"/"+c.getVal("product")+"/"+c.getVal("schema")+"/"+e.view_name})},resetDefault:function(e){var t=c.getVal("infoserverDomain");return l({method:"POST",url:t+"/configview/resetdefault/"+c.getVal("manufacturer")+"/"+c.getVal("product")+"/"+c.getVal("schema")+"/"+e.view_name})},deleteView:function(e){var t=c.getVal("infoserverDomain");return l({method:"POST",url:t+"/configview/delete/"+c.getVal("manufacturer")+"/"+c.getVal("product")+"/"+c.getVal("schema")+"/"+e.view_name})},setAccessibility:function(e){var t=c.getVal("infoserverDomain");return l({method:"POST",url:t+"/configview/setpublic/"+c.getVal("manufacturer")+"/"+c.getVal("product")+"/"+c.getVal("schema")+"/"+e.public+"/"+e.view_name})},loadView:function(e){var t=c.getVal("infoserverDomain");return l({method:"GET",url:t+"/configview/meta/"+c.getVal("manufacturer")+"/"+c.getVal("product")+"/"+c.getVal("schema")+"/"+e.view_name,params:{created_by:e.created_by}})},exportXlsUrl:function(e,d,t,a){var n,i="";for(n in a.keys)""!=i&&(i+="&"),i+="col="+a.keys[n].key;var o=c.getVal("infoserverDomain"),s=this.getClusterId(),r=(r=u.getSysId2())||"NA",l=(l="NA")||"NA";return e=e||c.getVal("manufacturer"),o+"/base/export/system/ts/all/last_n/"+c.getVal("manufacturer")+"/"+c.getVal("product")+"/"+c.getVal("schema")+"/"+e+"/"+s+"/"+r+"/"+l+"/"+a.table_name+"/"+t.obs_time.substr(0,19)+"/"+a.count+"?"+i},getAllFacets:function(){var e=c.getVal("infoserverDomain");return l({url:e+"/meta/columns/context/"+c.getVal("manufacturer")+"/"+c.getVal("product")+"/"+c.getVal("schema"),method:"GET",cache:!0})},getGoldenConfigCategories:function(){var e=c.getVal("infoserverDomain");return l({url:e+"/base/gconf/category/"+c.getVal("manufacturer")+"/"+c.getVal("product")+"/"+c.getVal("schema"),method:"GET",cache:!0})},getGoldenConfigDiffData:function(e,t,a,n,i,o){var s=c.getVal("infoserverDomain");return l({url:s+"/base/gconf/tbl/"+c.getVal("manufacturer")+"/"+c.getVal("product")+"/"+c.getVal("schema")+"/"+e+"/"+t+"/"+n+"/"+i,method:"GET"})},loadGoldenConfigDiffData:function(t,a,e,n,i,o){var s=this;t.data=null,(t.ref_data=null)==t.count&&(t.count=2),null==t.keys&&(t.no_cols=!1,t.shownAll=!0),t.loading=!0,this.getGoldenConfigDiffData(e.ec_name,n.sys_id,t.name,t.table_name,i.obs_time.substring(0,19),t.count).then(function(e){""==e.data.Data?(t.data=null,t.ref_data=null):s.parseData(t,e.data.Data),o&&o.resolve(t),t.loading=!1},function(e){t.loading=!1,!a.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(a.info.sessionTimedOut=!0,d.sessionTimeout())}),t.visible=!0},formatFacets:function(e){var a,n=[{label:"All",name:"all"}];return angular.forEach(e,function(e){angular.forEach(e,function(e,t){"S"==e.solr_facet&&e.attribute_label&&t&&0!=t.indexOf("obs_")&&((a={}).label=e.attribute_label,a.name=t,n.push(a))})}),r("unique")(n,"label")}}}]),angular.module("gbApp.controllers.dashboards",["gbApp.services.analytics","gbApp.globals"]).controller("DashboardsCtrl",["$scope","$sce","$filter","$interval","Dashboards","GlobalService","AppService","ErrorService","UserTrackingService","$timeout","InstanceHandler","WorkbenchService","ModalService","$window","$cookies","metaDataService","$modal","$location","x2js","$modalInstance","GBDashboardService","UtilService",function(p,a,s,e,m,h,r,l,d,c,n,o,b,u,f,_,t,g,S,D,v,w){var y=this,M=(y.gbAlDashboards=[],y.groupedData=[],p.showFilterPanel=!1,y.actionMessageFlag=!1,p.filterCount=0,y.info={},y.info.query="",y.currentSelected=0,y.showSelectNotify=!1,y.info.complete=!1,y.info.loggedRole=_.getUserRole(),y.tabSummaryFlag=!0,y.filterLoading=!1,y.repeatCall=!0,y.BulkOwnerDropElement=h.getVal("BulkOwnerDropElement"),y.visDisableInfo=h.getVal("visDisableInfo"),y.BulkVisibilityDropElement=h.getVal("BulkVisibilityDropElement"),y.bulkOwnerEmail=h.getVal("BulkOwnerDropElement"),y.bulkVisibility=y.BulkVisibilityDropElement[0].value,y.bulkEditConfMessage=h.getVal("bulkEditConfMessage"),y.dataSourcesList=[],y.dataSourcesListFlag=!1,y.NoUsersRoleFoundMsg=h.getVal("NoUsersRoleFoundMsg"),y.info.lastModifiedArray=h.getVal("lastModifiedArray"),y.scheduleFreq={enabled:!1,name:"hourly"},y.days=h.getVal("days"),y.internalDashCount=0,y.userCreatedDashCount=0,y.dataSourceSelMsg=h.getVal("dataSourceSelMsg"),y.dtypeSelMsg=h.getVal("dtypeSelMsg"),y.roleAssignTitle=h.getVal("roleAssignTitle"),y.scheduleFreq.scheduler_timeZone=(new Date).toTimeString().split("GMT")[1].substring(0,5),y.month=h.getVal("month"),y.schTimeHrs=h.getVal("schTimeHrs"),y.schTimeMin=h.getVal("schTimeMin"),y.changeOwnerErrorMsg=h.getVal("changeOwnerErrorMsg"),y.scheduleFreq.hrintvSele="1",y.scheduleFreq.weekDaySele="1",y.roles=[],y.scheduleFreq.monthDay="Sunday",y.allTags=[],y.scheduleFreq.YearDay="Sunday",y.scheduleFreq.YearMonth="Jan",y.info.assignRole="Select Roles",y.scheduleFreq.scheduler_recipients="",y.scheduleFreq.SelectedDays=[],y.allDashCount=0,y.selectAllFlag=!1,y.scheduleFreq.weekDay=h.getVal("weekDay"),y.schReportrecp=h.getVal("schReportrecp"),y.schReportDays=h.getVal("schReportDays"),y.scheduleFreq.hrintv=h.getVal("hrintv"),y.schReportTitle=h.getVal("schReportTitle"),y.freqTitle=h.getVal("freqTitle"),y.schReportOptions=h.getVal("schReportOptions"),y.noScheduling=h.getVal("noScheduling"),y.info.loadCount=0,y.info.dashboardSortOrder=!0,y.scheduleFreq.error=!1,y.info.dashboardSortOrderCB=!0,y.info.dashboardSortOrderType=!0,y.info.dashboardSortOrderDOFM=!0,y.info.orderByField="name",y.scheduleFreq.scheduler_time={},y.scheduleFreq.scheduler_time.hr="HH",y.scheduleFreq.scheduler_time.min="MM",y.logiOwnerSearch="",y.tableauOwnerSearch="",y.info.allDashboardsList=[],y.dashboardType=h.getVal("defaultDashboard"),y.dashboards=[],y.tableauDashboards=[],y.loaded=!1,y.defaultDashboard=[],y.info.currentView="list",y.info.currentBook=null,y.info.dType="allDashboards",y.info.typeDisplay="All",y.info.createdBy="All",y.info.lastModified="All",y.info.owner="All",y.info.datasource="All",y.info.dUserName=[],y.info.bookOwnerList=[],y.gAllDashboards=[],y.info.selectAll=!1,y.info.unSelectAll=!1,y.info.tags="",y.info.tagsFilter=[],y.info.loading=!1,y.info.selectedBooks="",y.info.workbenchApiRootDir="",y.info.tag_max_characters=h.getVal("tag_maxlimit"),y.info.tag_truncate_char_limit=h.getVal("tag_truncatelimit"),y.info.errMsg="",y.noDashboardFound=!1,y.scheduleExportFileTypeDefault=h.getVal("scheduleExportFileTypeDefault"),y.scheduleExportFileTypeCurrentVariable="",y.tableauExportFormat=h.getVal("tableauExportFormat"),y.logiExportFormat=h.getVal("logiExportFormat"),y.info.selected={},y.info.filter={},y.info.pageSize={total:0,count:h.getVal("dashboardListPageCount")},y.info.pagination=w.localPagination(),y.info.pagination.pageSize=h.getVal("dashboardListPageCount"),y.info.isTableauConfigured=!1,$.get("../config/constants/dashboard_constants.json",function(e,t){p.htmconstdata=e}),p.$watch(" dashCtrl.info.complete",function(){y.info.complete&&r.hidePanelLoading()}),p.$on("AppLoadEvent-dashboards",function(e,t){y.info.complete&&(r.hidePanelLoading(),0==y.defaultDashboard.length&&(y.setDashboard("summary"),y.info.loading=!0),p.showFilterPanel=!1,$("#gbDashboard-filter-panel-body .panel-collapse").collapse("hide"),p.clearAppliedFilters(),y.resetQuickFilter(),y.info.filterObj=[],y.hardReload(!0))}),{loading:!0,books:[]});function V(e){return s("filter")(o.getSubscriptionsList(),{content:{_id:e.id}})||[]}function L(e){}function T(e){if(!y.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/))return y.info.sessionTimedOut=!0,b.sessionTimeout(),!0}y.info.page={current:1,pageSize:10},y.info.filterObj=[],y.info.selectAllDashboard=!1,y.info.quickFilter=[{title:"All",columnName:"type_to_display",columnValue:"*",selected:!0},{title:"Internal",columnName:"type_to_display",columnValue:h.getVal("internalDashboards"),selected:!1},{title:"User Created",columnName:"type_to_display",columnValue:h.getVal("userCreatedDashboards"),selected:!1}],y.info.sortBy=null,y.info.columns=[{title:"Name",sorted:!1,columnName:"dname",class:"dnameNew"},{title:"Type",sorted:!1,columnName:"d_type",class:"dTypeNew"},{title:"Owner",sorted:!1,columnName:"gDOwner",class:"dOwnedNew"},{title:"Last modified",sorted:!1,columnName:"modified_ts",class:"dModifiedNew"}],y.info.sessionTimedOut=!1,y.setDashboard=function(e){var t=h.getVal("primaryDomain");document.cookie="dashboardType="+e+";domain="+t+";path=/",y.dashboardType=e,_.setDashboardType(e),getCookie("currentApp")},y.chkAdminFeature=function(){return!!_.getFeatures().admin},y.info.complete=!1,y.info.pagination.sortByColumn=function(a,e){return e.sort(function(e,t){e=e[a.columnName].toUpperCase(),t=t[a.columnName].toUpperCase();if(a.sorted){if(e<t)return-1;if(t<e)return 1}else{if(t<e)return-1;if(e<t)return 1}return 0}),e},y.hardReload=function(t){y.workbenchDown=!1,y.info.loading=!0,y.filterLoading=!0,y.info.selectAllDashboard=!1,setTimeout(function(){y.actionMessageFlag=!1},3e3),p.NameFilter={columnTitle:"Name"},y.loaded=!1,0!=y.defaultDashboard.length&&null!=y.defaultDashboard||(y.defaultDashboard=[]),o.checkIfTableauIsConfigured().then(function(e){y.info.isTableauConfigured=e.data.Data,y.info.isTableauConfigured?o.getTrustedAuthKey().then(function(e){y.info.securityToken=e.data.Data,v.getTableauInitialInfo().then(function(){0==y.defaultDashboard.length&&v.getSummaryDashObject(-1!=y.info.securityToken).then(function(e){if(""!=e.data.Data){if(y.defaultDashboard.push(e.data.Data),"Tableau"==y.defaultDashboard[0].typ)for(y.defaultDashboard[0].dname=y.defaultDashboard[0].name,y.defaultDashboard[0].thumbnailImgSrc=h.getVal("infoserverDomain")+"/"+y.defaultDashboard[0].reports[0].thumbnailImgSrc,y.defaultDashboard[0].type_to_display=h.getVal("userCreatedDashboards"),j=0;j<y.defaultDashboard[0].reports.length;j++)y.defaultDashboard[0].reports[j].hilighted=!1,y.defaultDashboard[0].reports[j].url="/t/"+v.getSiteName()+"/views/"+y.defaultDashboard[0].reports[j].url.replace("/sheets",""),y.defaultDashboard[0].reports[j].r_link=y.defaultDashboard[0].reports[j].url,y.defaultDashboard[0].reports[j].thumbnailImgSrc=h.getVal("infoserverDomain")+"/"+y.defaultDashboard[0].reports[j].thumbnailImgSrc,y.defaultDashboard[0].reports[j].rname=y.defaultDashboard[0].reports[j].name;else{for(y.defaultDashboard[0].thumbnailImgSrc=h.getVal("dashboard_img_logi_path")+"/"+y.defaultDashboard[0].reports[0].thumbnailImgSrc,""!=y.defaultDashboard[0].dashboardSecurityInfo.owner&&null!=y.defaultDashboard[0].dashboardSecurityInfo.owner||(y.defaultDashboard[0].dashboardSecurityInfo.owner=y.defaultDashboard[0].created_by),j=0;j<y.defaultDashboard[0].reports.length;j++)y.defaultDashboard[0].reports[j].hilighted=!1,y.defaultDashboard[0].reports[j].thumbnailImgSrc=h.getVal("dashboard_img_logi_path")+"/"+y.defaultDashboard[0].reports[j].thumbnailImgSrc;y.defaultDashboard[0].type_to_display=h.getVal("internalDashboards")}y.defaultDashboard[0].modified_ts_to_display=moment(y.defaultDashboard[0].modified_ts).format("YYYY-MM-DD HH:MM:SS"),y.defaultDashboard[0].created_ts_to_display=moment(y.defaultDashboard[0].created_ts).format("YYYY-MM-DD HH:MM:SS"),y.defaultDashboard[0].visibility=y.getVisibility(y.defaultDashboard[0]),y.defaultDashboard[0].expand=!1,y.defaultDashboard[0].selected=!1,y.defaultDashboard[0].gDOwner=y.getBookChangedOwnerName(y.defaultDashboard[0]),y.defaultDashboard=v.setpermissionsandroles(y.defaultDashboard,!1),0==y.defaultDashboard.length?y.setDashboard("other"):y.setUpSummaryDashboard()}else y.setDashboard("other")},function(e){}),-1!=y.info.securityToken?v.newgetAllDashboards(!0).then(function(e){y.processData(e,t,!0)},function(e){y.info.complete=!0,y.loaded=!0,y.gbAlDashboards=[],y.noDashboardFound=!0,y.setDashboard("other")}):v.newgetAllDashboards(!1).then(function(e){y.processData(e,t,!1)},function(e){y.info.complete=!0,y.loaded=!0,y.gbAlDashboards=[],y.noDashboardFound=!0,y.setDashboard("other")})})},function(e){y.info.securityToken="-1",0==y.defaultDashboard.length&&v.getSummaryDashObject(-1!=y.info.securityToken).then(function(e){if(""!=e.data.Data){if(y.defaultDashboard.push(e.data.Data),"Tableau"==y.defaultDashboard[0].typ)for(y.defaultDashboard[0].dname=y.defaultDashboard[0].name,y.defaultDashboard[0].thumbnailImgSrc=h.getVal("infoserverDomain")+"/"+y.defaultDashboard[0].reports[0].thumbnailImgSrc,y.defaultDashboard[0].type_to_display=h.getVal("userCreatedDashboards"),j=0;j<y.defaultDashboard[0].reports.length;j++)y.defaultDashboard[0].reports[j].hilighted=!1,y.defaultDashboard[0].reports[j].url="/t/"+v.getSiteName()+"/views/"+y.defaultDashboard[0].reports[j].url.replace("/sheets",""),y.defaultDashboard[0].reports[j].r_link=y.defaultDashboard[0].reports[j].url,y.defaultDashboard[0].reports[j].thumbnailImgSrc=h.getVal("infoserverDomain")+"/"+y.defaultDashboard[0].reports[j].thumbnailImgSrc,y.defaultDashboard[0].reports[j].rname=y.defaultDashboard[0].reports[j].name;else{for(y.defaultDashboard[0].thumbnailImgSrc=h.getVal("dashboard_img_logi_path")+"/"+y.defaultDashboard[0].reports[0].thumbnailImgSrc,""!=y.defaultDashboard[0].dashboardSecurityInfo.owner&&null!=y.defaultDashboard[0].dashboardSecurityInfo.owner||(y.defaultDashboard[0].dashboardSecurityInfo.owner=y.defaultDashboard[0].created_by),j=0;j<y.defaultDashboard[0].reports.length;j++)y.defaultDashboard[0].reports[j].hilighted=!1,y.defaultDashboard[0].reports[j].thumbnailImgSrc=h.getVal("dashboard_img_logi_path")+"/"+y.defaultDashboard[0].reports[j].thumbnailImgSrc;y.defaultDashboard[0].type_to_display=h.getVal("internalDashboards")}y.defaultDashboard[0].modified_ts_to_display=moment(y.defaultDashboard[0].modified_ts).format("YYYY-MM-DD HH:MM:SS"),y.defaultDashboard[0].created_ts_to_display=moment(y.defaultDashboard[0].created_ts).format("YYYY-MM-DD HH:MM:SS"),y.defaultDashboard[0].visibility=y.getVisibility(y.defaultDashboard[0]),y.defaultDashboard[0].expand=!1,y.defaultDashboard[0].selected=!1,y.defaultDashboard[0].gDOwner=y.getBookChangedOwnerName(y.defaultDashboard[0]),y.defaultDashboard=v.setpermissionsandroles(y.defaultDashboard,!1),0==y.defaultDashboard.length?y.setDashboard("other"):y.setUpSummaryDashboard()}else y.setDashboard("other")},function(e){}),v.newgetAllDashboards(!1).then(function(e){y.processData(e,t,!1)},function(e){y.info.complete=!0,y.loaded=!0,y.gbAlDashboards=[],y.noDashboardFound=!0,y.setDashboard("other")})}):(0==y.defaultDashboard.length&&v.getSummaryDashObject(!1).then(function(e){if(""!=e.data.Data){if(y.defaultDashboard.push(e.data.Data),"Tableau"==y.defaultDashboard[0].typ)for(y.defaultDashboard[0].dname=y.defaultDashboard[0].name,y.defaultDashboard[0].thumbnailImgSrc=h.getVal("infoserverDomain")+"/"+y.defaultDashboard[0].reports[0].thumbnailImgSrc,y.defaultDashboard[0].type_to_display=h.getVal("userCreatedDashboards"),j=0;j<y.defaultDashboard[0].reports.length;j++)y.defaultDashboard[0].reports[j].hilighted=!1,y.defaultDashboard[0].reports[j].url="/t/"+v.getSiteName()+"/views/"+y.defaultDashboard[0].reports[j].url.replace("/sheets",""),y.defaultDashboard[0].reports[j].r_link=y.defaultDashboard[0].reports[j].url,y.defaultDashboard[0].reports[j].thumbnailImgSrc=h.getVal("infoserverDomain")+"/"+y.defaultDashboard[0].reports[j].thumbnailImgSrc,y.defaultDashboard[0].reports[j].rname=y.defaultDashboard[0].reports[j].name;else{for(y.defaultDashboard[0].thumbnailImgSrc=h.getVal("dashboard_img_logi_path")+"/"+y.defaultDashboard[0].reports[0].thumbnailImgSrc,""!=y.defaultDashboard[0].dashboardSecurityInfo.owner&&null!=y.defaultDashboard[0].dashboardSecurityInfo.owner||(y.defaultDashboard[0].dashboardSecurityInfo.owner=y.defaultDashboard[0].created_by),j=0;j<y.defaultDashboard[0].reports.length;j++)y.defaultDashboard[0].reports[j].hilighted=!1,y.defaultDashboard[0].reports[j].thumbnailImgSrc=h.getVal("dashboard_img_logi_path")+"/"+y.defaultDashboard[0].reports[j].thumbnailImgSrc;y.defaultDashboard[0].type_to_display=h.getVal("internalDashboards")}y.defaultDashboard[0].modified_ts_to_display=moment(y.defaultDashboard[0].modified_ts).format("YYYY-MM-DD HH:MM:SS"),y.defaultDashboard[0].created_ts_to_display=moment(y.defaultDashboard[0].created_ts).format("YYYY-MM-DD HH:MM:SS"),y.defaultDashboard[0].visibility=y.getVisibility(y.defaultDashboard[0]),y.defaultDashboard[0].expand=!1,y.defaultDashboard[0].selected=!1,y.defaultDashboard[0].gDOwner=y.getBookChangedOwnerName(y.defaultDashboard[0]),y.defaultDashboard=v.setpermissionsandroles(y.defaultDashboard,!1),0==y.defaultDashboard.length?y.setDashboard("other"):y.setUpSummaryDashboard()}else y.setDashboard("other")},function(e){}),v.newgetAllDashboards(!1).then(function(e){y.processData(e,t,!1)},function(e){y.info.complete=!0,y.loaded=!0,y.gbAlDashboards=[],y.noDashboardFound=!0,y.setDashboard("other")}))})},y.processData=function(e,t,a){h.getVal("rLinkAffix");for(y.workbenchDown=!1,y.currentSelected=0,y.showSelectNotify=!1,y.dashgroup=[],y.allTableauDash=s("filter")(e.data.Data.dashboards,{typ:"Tableau"},!1)||[],y.allInternalDash=s("internalDashboards")(e.data.Data.dashboards),y.allTableauAdmins=e.data.Data.tOwnerList,y.allLogiAdmins=e.data.Data.lOwnerList,y.gbAlDashboards=y.allTableauDash.concat(y.allInternalDash),i=0;i<y.gbAlDashboards.length;i++){if("Tableau"==y.gbAlDashboards[i].typ)for(y.gbAlDashboards[i].dname=y.gbAlDashboards[i].name,y.gbAlDashboards[i].thumbnailImgSrc=h.getVal("infoserverDomain")+"/"+y.gbAlDashboards[i].reports[0].thumbnailImgSrc,y.gbAlDashboards[i].type_to_display=h.getVal("userCreatedDashboards"),j=0;j<y.gbAlDashboards[i].reports.length;j++)y.gbAlDashboards[i].reports[j].hilighted=!1,y.gbAlDashboards[i].reports[j].url="/t/"+v.getSiteName()+"/views/"+y.gbAlDashboards[i].reports[j].url.replace("/sheets",""),y.gbAlDashboards[i].reports[j].r_link=y.gbAlDashboards[i].reports[j].url,console.log(y.gbAlDashboards[i].reports[j].r_link),y.gbAlDashboards[i].reports[j].thumbnailImgSrc=h.getVal("infoserverDomain")+"/"+y.gbAlDashboards[i].reports[j].thumbnailImgSrc,y.gbAlDashboards[i].reports[j].rname=y.gbAlDashboards[i].reports[j].name;else{for(y.gbAlDashboards[i].thumbnailImgSrc=h.getVal("dashboard_img_logi_path")+"/"+y.gbAlDashboards[i].reports[0].thumbnailImgSrc,""!=y.gbAlDashboards[i].dashboardSecurityInfo.owner&&null!=y.gbAlDashboards[i].dashboardSecurityInfo.owner||(y.gbAlDashboards[i].dashboardSecurityInfo.owner=y.gbAlDashboards[i].created_by),j=0;j<y.gbAlDashboards[i].reports.length;j++)y.gbAlDashboards[i].reports[j].hilighted=!1,y.gbAlDashboards[i].reports[j].thumbnailImgSrc=h.getVal("dashboard_img_logi_path")+"/"+y.gbAlDashboards[i].reports[j].thumbnailImgSrc;y.gbAlDashboards[i].type_to_display=h.getVal("internalDashboards")}y.gbAlDashboards[i].modified_ts_to_display=moment(y.gbAlDashboards[i].modified_ts).format("YYYY-MM-DD HH:MM:SS"),y.gbAlDashboards[i].created_ts_to_display=moment(y.gbAlDashboards[i].created_ts).format("YYYY-MM-DD HH:MM:SS"),y.gbAlDashboards[i].visibility=y.getVisibility(y.gbAlDashboards[i]),y.gbAlDashboards[i].expand=!1,y.gbAlDashboards[i].selected=!1,y.gbAlDashboards[i].gDOwner=y.getBookChangedOwnerName(y.gbAlDashboards[i]),"NA"!=y.gbAlDashboards[i].group_type&&y.gbAlDashboards[i].group_type&&(y.dashgroup.push(y.gbAlDashboards[i].group_type),y.dashgroup=y.unique(y.dashgroup))}if(y.gbAlDashboards=v.setpermissionsandroles(y.gbAlDashboards,!0),y.dashboards=angular.copy(y.gbAlDashboards),y.gbAlDashboards=y.info.applyFilter(y.gbAlDashboards,y.info.filterObj),"summary"!=y.dashboardType&&"other"!=y.dashboardType&&(y.gbAlDashboards=y.gbAlDashboards.filter(function(e){return e.group_type==y.dashboardType})),!y.gbAlDashboards||!y.gbAlDashboards.length||0==y.gbAlDashboards.length)return y.info.complete=!0,y.info.loading=!1,y.loaded=!0,void(y.noDashboardFound=!0);y.info.pageSize.total=y.dashboards.length;var n=y.dashboards;for(i=0;i<n.length;i++)"Tableau"==n[i].typ?y.userCreatedDashCount++:y.internalDashCount++;y.noDashboardFound=!1,y.info.sortBy={title:"Last modified",sorted:!1,columnName:"modified_ts"},y.gbAlDashboards=y.info.pagination.sortByColumn(y.info.sortBy,y.gbAlDashboards),y.gbAlDashboardsFiltered=y.gbAlDashboards,y.info.pagination.init(angular.copy(y.gbAlDashboards)),y.gbAlDashboards=y.info.pagination.currentRecordsSet,y.info.loading=!1,y.loaded=!0,y.openDashboardInstanceViewerByDefault(),y.groupedData=[],a?y.appendDataSources(!0):y.appendDataSources(!1),y.info.complete=!0},y.hardReload(!0),y.reloadData=function(e){for(y.info.selectedBooks=[],"fromSearch"!=e&&(y.currentSelected=0,y.showSelectNotify=!1,y.info.selectAllDashboard=!1),y.userCreatedDashCount=0,y.internalDashCount=0,y.hideModal(),i=0;i<y.dashboards.length;i++)"fromSearch"!=e&&(y.dashboards[i].selected=!1),y.dashboards[i].visibility=y.getVisibility(y.dashboards[i]),y.dashboards[i].gDOwner=y.getBookChangedOwnerName(y.dashboards[i]);for(y.groupedData=[],y.dashboards=v.setpermissionsandroles(y.dashboards,!0),y.gbAlDashboards=angular.copy(y.dashboards),y.groupedData=v.groupbyColumn(y.dashboards),i=0;i<y.groupedData[0].data.length;i++)for(j=0;j<y.info.quickFilter.length;j++)y.groupedData[0].data[i].name==y.info.quickFilter[j].columnValue&&y.info.quickFilter[j].selected&&(y.groupedData[0].data[i].selected=!0,y.groupedData[0].appliedFilterFirstItem=y.groupedData[0].data[i].name,y.groupedData[0].appliedFilterCount=1);v.setGroupedData(y.groupedData),y.gbAlDashboards=v.setpermissionsandroles(y.gbAlDashboards,!0),y.gbAlDashboards=y.info.applyFilter(y.gbAlDashboards,y.info.filterObj),"summary"!=y.dashboardType&&"other"!=y.dashboardType&&(y.gbAlDashboards=y.gbAlDashboards.filter(function(e){return e.group_type==y.dashboardType}));var t=y.dashboards;for(i=0;i<t.length;i++)"Tableau"==t[i].typ?y.userCreatedDashCount++:y.internalDashCount++;y.info.pageSize.total=y.dashboards.length,y.noDashboardFound=!1,y.info.sortBy={title:"Last modified",sorted:!1,columnName:"modified_ts"},y.gbAlDashboards=y.info.pagination.sortByColumn(y.info.sortBy,y.gbAlDashboards),y.gbAlDashboardsFiltered=y.gbAlDashboards,y.info.pagination.init(angular.copy(y.gbAlDashboards)),y.gbAlDashboards=y.info.pagination.currentRecordsSet,y.info.loading=!1,y.loaded=!0,setTimeout(function(){y.actionMessageFlag=!1},3e3)},y.appendDataSources=function(e){e?v.getDashboardDatasourcesList().then(function(e){for(i=0;i<y.dashboards.length;i++)for(j=0;j<e.data.Data.length;j++)y.dashboards[i].d_id==e.data.Data[j].d_id&&(y.dashboards[i].datasource=e.data.Data[j].datasource);y.groupedData=v.groupbyColumn(y.dashboards),v.setGroupedData(y.groupedData),y.filterLoading=!1}):(y.groupedData=v.groupbyColumn(y.dashboards),v.setGroupedData(y.groupedData),y.filterLoading=!1)},y.getGroupDashLength=function(t){return y.dashboards.filter(function(e){return e.group_type==t}).length},y.setUpSummaryDashboard=function(e){var t,a;0!=y.defaultDashboard.length&&(t=y.defaultDashboard[0].role_access.join(","),a=_.getUser(),y.ifGlassbeamUser()||-1!=t.indexOf(a.role)||_.getFeatures().admin||(y.defaultDashboard=[])),y.defaultDashboard.length&&!e?(y.setDashboard("summary"),instances=n.getInstances(),angular.element("#gb-summary-dashboard-iframe").height("100%")):y.setDashboard("other"),0<y.defaultDashboard.length&&(y.dashboards,"Tableau"==y.defaultDashboard[0].typ&&y.loadTableauSummary(y.defaultDashboard[0],y.defaultDashboard[0].reports[0].r_id))},y.openDashboardInstanceViewerByDefault=function(){var e=v.getAllDashboardsWithoutFilter();if(0!=e.length&&"true"==sessionStorage.getItem("dash_mode")){var t=!1,a=localStorage.getItem("did").split(","),n=localStorage.getItem("rid").split(",");for(i=0;i<a.length;i++){var o=n[i],u=a[i];for(j=0;j<a.length;j++)o==n[j]&&i!=j&&u==a[j]&&(a.splice(j,1),j--)}var s=[],r=[],l=e;for(y.setDashboard("other"),i=0;i<l.length;i++)if(l[i].dname)for(k=0;k<a.length;k++)if(a[k]==l[i].d_id)for(j=0;j<l[i].reports.length;j++)if(l[i].reports[j].r_id==n[k]){if(s.push(a[k]),r.push(n[k]),a.splice(k,1),n.splice(k,1),y.showDashBoard(l[i],"dashLevel")){var d,c=l[i].reports[j];sessionStorage.getItem("rdreport")&&(d=new RegExp("([?&])rdReport=.*?(&|$)","i"),c.r_link.indexOf("?"),c.r_link=c.r_link.replace(d,"$1rdReport="+sessionStorage.getItem("rdreport")+"$2")),"Tableau"!=l[i].d_type?y.openDashboardIninstanceViewerOnloadOfPage(c):y.addTabInstance(c),y.logActivity("summary"==y.dashboardType?"Summary Dashboard":"Other Dashboards","InstanceViewer","{'"+c.rname+"'}"),0==a.length&&(t=!0,sessionStorage.setItem("dash_mode","false")),document.getElementById("gb-full-page-loader").style.display="none";break}0==a.length&&(t=!0),sessionStorage.setItem("dash_mode","false"),y.info.dashModeErrorMsg=h.getVal("dashModePermissionError"),b.alertBox({msg:y.info.dashModeErrorMsg})}for(i=0;i<a.length;i++)y.defaultDashboard[0]&&a[i]==y.defaultDashboard[0].d_id&&n[i]==y.defaultDashboard[0].reports[0].r_id&&(s.push(a[i]),r.push(n[i]),a.splice(i,1),n.splice(i,1),i--,c=y.defaultDashboard[0].reports[0],y.openDashboardIninstanceViewerOnloadOfPage(c),y.logActivity("summary"==y.dashboardType?"Summary Dashboard":"Other Dashboards","InstanceViewer","{'"+c.rname+"'}"),0==a&&(sessionStorage.setItem("dash_mode","false"),t=!0),document.getElementById("gb-full-page-loader").style.display="none");t||(sessionStorage.setItem("dash_mode","false"),y.info.dashModeErrorMsg=h.getVal("dashModeError"),b.alertBox({msg:y.info.dashModeErrorMsg})),localStorage.setItem("did",s.toString()),localStorage.setItem("rid",r.toString())}},y.getQuickFilterDisable=function(e){return!!y.filterLoading||("Internal"==e.title&&0==y.internalDashCount||"User Created"==e.title&&0==y.userCreatedDashCount)},y.reloadDashboards=function(t){y.info.loading=!0,v.reloadDashboard(y.info.filterObj,y.info.sortBy,y.info.query,t,y.info.pageSize.count).then(function(e){if(y.gbAlDashboards=e,!(y.dashboards=e)||!e.length||0==e.length)return y.info.loading=!1,y.info.pagination=null,void(y.noDashboardFound=!0);y.noDashboardFound=!1;e=v.getGroupedData();y.updateColumnGroups(e),y.info.loading=!1,y.info.datasource=v.getDataSources(),y.info.selectAllDashboard=!1,t&&(y.info.pagination=v.pagination,y.defaultDashboard=v.getSummaryDashboard(),y.setUpSummaryDashboard(!0)),y.info.loading=!1},function(e){y.info.complete=!0,y.info.loading=!1,y.noDashboardFound=!0,y.gbAlDashboards=[],y.setDashboard("other")})},y.updateColumnGroups=function(e){e.map(function(e){for(var n,a,t=!0,i=0;i<y.groupedData.length;i++)e.columnName==y.groupedData[i].columnName&&(t=!1,n=e.data,a=y.groupedData[i].data,Array.isArray(n)&&n.map(function(e){for(var t=0;t<a.length;t++)a[t].name==e.name&&a[t].selected&&(e.selected=a[t].selected)}),a.length>n.length&&a.forEach(function(t){var a=!1;n.forEach(function(e){t.name===e.name&&(a=!0)}),a||n.push(t)}),y.groupedData[i].data=n);t&&y.groupedData.push(e)})},y.getSortedFilteredPaginatedData=function(){y.gbAlDashboards=y.info.applyFilter(y.dashboards,y.info.filterObj),"summary"!=y.dashboardType&&"other"!=y.dashboardType&&(y.gbAlDashboards=y.gbAlDashboards.filter(function(e){return e.group_type==y.dashboardType})),y.gbAlDashboards=y.info.pagination.sortByColumn(y.info.sortBy,y.gbAlDashboards),y.gbAlDashboardsFiltered=y.gbAlDashboards,y.info.pagination.init(angular.copy(y.gbAlDashboards));var e=v.groupbyColumn(y.gbAlDashboards);y.gbAlDashboards=y.info.pagination.currentRecordsSet;y.groupedData.forEach(function(i){e.forEach(function(e){var t,a,n;i.lastUpdatedFilter||i.columnName==e.columnName&&(t=i.data,a=e.data,n=!1,t.forEach(function(t){n=!1,a.forEach(function(e){t.name===e.name&&(n=!0,t.count=e.count,t.disabled=!1)}),n||(t.disabled=!0,t.count=0)}))})})},y.changePages=function(){y.gbAlDashboards=y.info.changePage(y.info.filterObj,y.info.sortBy,y.info.query)},y.changePageSize=function(){y.gbAlDashboards=y.info.changePageSize(y.info.filterObj,y.info.sortBy,y.info.pagination.pageSize)},y.updateDataFilter=function(e,t,a,n,i,o){y.filterLoading=!1;function s(e){var t=[];return Array.isArray(e)?(e.map(function(e){e.selected&&t.push(e.name)}),t):[]}var r=[];"type_to_display"===e&&"Internal dashboards"===t&&y.groupedData.map(function(e){"datasource"===e.columnName&&e.data.map(function(e){e.selected=!1})});!n&&a&&Array.isArray(i)&&i.map(function(e){t===e.name?e.selected=!0:e.selected=!1}),y.groupedData.map(function(e){s(e.data).length?(r.push({columnName:e.columnName,columnValue:s(e.data)}),e.appliedFilterCount=s(e.data).length,e.appliedFilterFirstItem=s(e.data)[0]):(e.appliedFilterCount=0,e.appliedFilterFirstItem="")}),r.length?(y.info.filterObj=r,y.groupedData.map(function(e){e.columnName===o.columnName?e.lastUpdatedFilter=!0:e.lastUpdatedFilter=!1}),y.logActivity("Other Dashboards","local filter",t),y.getSortedFilteredPaginatedData(),"type_to_display"===e&&(y.info.quickFilter.map(function(e){e.columnValue===t?e.selected=a:e.selected=!1}),a||y.info.quickFilter.map(function(e){"All"==e.title?e.selected=!0:e.selected=!1}))):y.clearLocalFilter()},y.getClearFilterDisable=function(){return!y.info.filterObj.length&&0==y.info.query.length},y.clearLocalFilter=function(){y.info.query="",y.groupedData.map(function(e){if(e.appliedFilterCount=0,e.appliedFilterFirstItem="",e.expand=!1,e.lastUpdatedFilter=!1,Array.isArray(e.data))e.data.map(function(e){e.selected=!1});else for(var t in e.data)e.data[t].selected=!1}),y.info.filterObj=[],y.resetQuickFilter(),y.getSortedFilteredPaginatedData()},y.enableBulkEdit=function(){var e=y.dashboards,t=0,a=0;for(i=0;i<e.length;i++)e[i].selected&&(e[i].type_to_display==h.getVal("internalDashboards")?t++:a++);for(i=0;i<y.info.quickFilter.length;i++)if(y.info.quickFilter[i].selected)return!(y.info.quickFilter[i].columnValue==h.getVal("internalDashboards")&&0<t)&&!(y.info.quickFilter[i].columnValue==h.getVal("userCreatedDashboards")&&0<a)},y.getBulkVisDisablity=function(){var e=y.gbAlDashboards,t=!1;for(i=0;i<e.length;i++)e[i].selected&&"Summary"==e[i].d_type&&(t=!0);return t},y.getBulkEditTitle=function(){var e=y.dashboards,t=0,a=0;for(i=0;i<e.length;i++)e[i].selected&&(e[i].type_to_display==h.getVal("internalDashboards")?t++:a++);for(i=0;i<y.info.quickFilter.length;i++)if(y.info.quickFilter[i].selected)return"*"==y.info.quickFilter[i].columnValue?h.getVal("quickDashFilterTitleBulkEdit"):y.info.quickFilter[i].columnValue==h.getVal("internalDashboards")&&0<t?"Edit "+t+" dashboards":y.info.quickFilter[i].columnValue==h.getVal("userCreatedDashboards")&&0<a?"Edit "+a+" dashboards":h.getVal("NoMultiSelectTitleBulkEdit")},y.getBulkEditText=function(){var e=y.gbAlDashboards,t=0;for(i=0;i<e.length;i++)e[i].selected&&t++;for(i=0;i<y.info.quickFilter.length;i++)if(y.info.quickFilter[i].selected)return"*"!=y.info.quickFilter[i].columnValue&&2<=t?"Edit "+t+" dashboards":"Bulk Edit"},y.bulkEditDash=function(){p.modalInstance=b.openModal("partials/dashboards/bulk_edit_dash.html",p,"gb-dash-bulk-edit-modal",!0,"static"),y.bulkOwnerEmail=h.getVal("BulkOwnerDropElement"),y.bulkVisibility=y.BulkVisibilityDropElement[0].name},y.getBulkOwnerList=function(){for(i=0;i<y.info.quickFilter.length;i++){var e;y.info.quickFilter[i].selected&&(e=y.info.quickFilter[i].columnValue)}if("*"!=e)return e==h.getVal("internalDashboards")?y.allLogiAdmins:y.allTableauAdmins},y.bulkEditApply=function(){for(y.info.loading=!0,i=0;i<y.info.quickFilter.length;i++){var e;y.info.quickFilter[i].selected&&(e=y.info.quickFilter[i].columnValue)}var t,a=y.dashboards,n=[],o={},s=[];for(i=0;i<a.length;i++)e==h.getVal("internalDashboards")?a[i].selected&&a[i].type_to_display==h.getVal("internalDashboards")&&n.push(a[i]):a[i].selected&&a[i].type_to_display==h.getVal("userCreatedDashboards")&&n.push(a[i]);for(j=0;j<n.length;j++)for(i=0;i<n[j].reports.length;i++)(o={}).did=n[j].d_id,o.rids=n[j].reports[i].r_id,s.push(o);for(i=0;i<y.info.quickFilter.length;i++)y.info.quickFilter[i].selected&&(t=y.info.quickFilter[i].columnValue);if(y.bulkOwnerEmail!=h.getVal("BulkOwnerDropElement"))if(t==h.getVal("userCreatedDashboards")){var r="",l=[],u=(d=JSON.parse(y.bulkOwnerEmail)).email,f=v.getSiteId(),g=_.getUserEmail();for(i=0;i<n.length;i++)l.push(n[i].ownerId);v.getUsersAPI().then(function(e){var t=S.xml_str2json(e.data).tsResponse.users.user;if(Array.isArray(t))for(var a in t)t[a]._name==u&&(r=t[a]._id);else b.alertBox({msg:y.changeOwnerErrorMsg});e={ownership:{drids:s,owner:d.email,role:d.role,isTableau:!0,siteId:f,userId:l,userName:g,newOwnerId:r}};m.updateOwner(e).then(function(e){y.logActivity("Other Dashboards","Change Owner for multiple dashboard","{'"+s+"'}");var t=new Date;if(0<=e.data.Msg.search("ERROR"))b.alertBox({msg:y.changeOwnerErrorMsg});else{for(y.filterLoading=!1,a=0;a<y.dashboards.length;a++)for(j=0;j<n.length;j++)y.dashboards[a].d_id==n[j].d_id&&(y.dashboards[a].modified_ts=t.toISOString(),y.dashboards[a].modified_ts_to_display=moment(y.dashboards[a].modified_ts).format("YYYY-MM-DD HH:MM:SS"),y.dashboards[a].dashboardSecurityInfo.owner=JSON.parse(y.bulkOwnerEmail).email,-1==y.dashboards[a].role_access.indexOf(JSON.parse(y.bulkOwnerEmail).role)&&y.dashboards[a].role_access.push(JSON.parse(y.bulkOwnerEmail).role));p.modalInstance.close(),y.actionMessage="Updated "+n.length+" dashboards.",y.actionMessageFlag=!0,p.showFilterPanel=!1,y.reloadData()}},function(e){b.alertBox({msg:y.changeOwnerErrorMsg})})})}else{var d=JSON.parse(y.bulkOwnerEmail),c={ownership:{drids:s,owner:d.email,role:d.role,isTableau:!1}};m.updateOwner(c).then(function(e){y.logActivity("Other Dashboards","Change Owner for multiple dashboard","{'"+s+"'}");var t=new Date;for(i=0;i<y.dashboards.length;i++)for(j=0;j<n.length;j++)y.dashboards[i].d_id==n[j].d_id&&(y.dashboards[i].modified_ts=t.toISOString(),y.dashboards[i].modified_ts_to_display=moment(y.dashboards[i].modified_ts).format("YYYY-MM-DD HH:MM:SS"),y.dashboards[i].dashboardSecurityInfo.owner=JSON.parse(y.bulkOwnerEmail).email,-1==y.dashboards[i].role_access.indexOf(JSON.parse(y.bulkOwnerEmail).role)&&y.dashboards[i].role_access.push(JSON.parse(y.bulkOwnerEmail).role));y.filterLoading=!1,p.modalInstance.close(),y.actionMessage="Updated "+n.length+" dashboards.",y.actionMessageFlag=!0,p.showFilterPanel=!1,y.reloadData()},function(e){})}y.bulkVisibility!=y.BulkVisibilityDropElement[0].name&&(c=t==h.getVal("userCreatedDashboards")?{visibility:{drids:s,isPublic:JSON.parse(y.bulkVisibility),isTableau:!0,siteId:f,userId:"",userName:g}}:{visibility:{drids:s,isPublic:JSON.parse(y.bulkVisibility),isTableau:!1}},m.changeVisibility(c).then(function(e){y.logActivity("Other Dashboards","Change Visibility multiple dashboard","{'"+s+"'}");var t=new Date;for(y.filterLoading=!1,i=0;i<y.dashboards.length;i++)for(j=0;j<n.length;j++)y.dashboards[i].d_id==n[j].d_id&&(y.dashboards[i].modified_ts=t.toISOString(),y.dashboards[i].modified_ts_to_display=moment(y.dashboards[i].modified_ts).format("YYYY-MM-DD HH:MM:SS"),y.dashboards[i].visibility=JSON.parse(y.bulkVisibility),y.dashboards[i].dashboardSecurityInfo.is_public=JSON.parse(y.bulkVisibility),y.bulkOwnerEmail!=h.getVal("BulkOwnerDropElement")&&-1==y.dashboards[i].role_access.indexOf(JSON.parse(y.bulkOwnerEmail).role)&&y.dashboards[i].role_access.push(JSON.parse(y.bulkOwnerEmail).role));y.actionMessage="Updated "+n.length+" dashboards.",y.actionMessageFlag=!0,p.modalInstance.close(),p.showFilterPanel=!1,y.reloadData()},function(e){}))},y.applyQuickFilter=function(a){var e,n;a.selected||(a.selected=!a.selected,e={"User created dashboards":{count:11,selected:!1},"Internal dashboards":{count:7,selected:!1}},y.info.quickFilter.map(function(e){a.title!=e.title&&(e.selected=!1)}),n=null,y.groupedData.map(function(e){if(e.columnName===a.columnName)for(var t in(n=e).data)e.data[t].name===a.columnValue?e.data[t].selected=!0:e.data[t].selected=!1}),y.updateDataFilter(a.columnName,a.columnValue,a.selected,!1,e,n))},y.resetQuickFilter=function(){y.info.quickFilter.map(function(e){"All"==e.title?e.selected=!0:e.selected=!1})},y.columnSorting=function(e){for(var t=0;t<y.info.columns.length;t++)y.info.columns[t].title!=e.title&&(y.info.columns[t].sorted=!1);e.sorted=!e.sorted,y.info.sortBy=e,y.changePages()},y.serachDashboardsAndTags=function(){y.reloadData("fromSearch")},y.closeModal=function(){y.resetModal(),p.modalInstance.close()},y.expandField=function(e,t,a){t="ext"==t?"dashRowExt"+e:"dashRowInt"+e,"role"==a?($(".gbDashboardTable #"+t+" td.dRolesNew").css("white-space","inherit"),$(".gbDashboardTable #"+t+" td.dRolesNew .shrinkAllLink").show(),$(".gbDashboardTable #"+t+" td.dRolesNew .showAllLink").hide()):($(".gbDashboardTable #"+t+" td.dTagNew").css("white-space","inherit"),$(".gbDashboardTable #"+t+" td.dTagNew .shrinkAllLink").show(),$(".gbDashboardTable #"+t+" td.dTagNew .showAllLink").hide())},y.shrinkField=function(e,t,a){t="ext"==t?"dashRowExt"+e:"dashRowInt"+e,"role"==a?($(".gbDashboardTable #"+t+" td.dRolesNew").css("white-space","nowrap"),$(".gbDashboardTable #"+t+" td.dRolesNew .shrinkAllLink").hide(),$(".gbDashboardTable #"+t+" td.dRolesNew .showAllLink").show()):($(".gbDashboardTable #"+t+" td.dTagNew").css("white-space","nowrap"),$(".gbDashboardTable #"+t+" td.dTagNew .shrinkAllLink").hide(),$(".gbDashboardTable #"+t+" td.dTagNew .showAllLink").show())},y.resetModal=function(){y.scheduleFreq.enabled=!1,y.scheduleFreq.error=!1,y.scheduleFreq.name="hourly",y.scheduleFreq.scheduler_recipients="",y.scheduleFreq.hrintvSele="1",y.scheduleFreq.weekDaySele="1",y.scheduleFreq.monthDay="Sunday",y.scheduleFreq.yearDay="Sunday",y.scheduleFreq.YearMonth="Jan",y.scheduleFreq.scheduler_time.hr="HH",y.scheduleFreq.scheduler_time.min="MM"},y.setSummaryDashConf=function(e,t){"Summary"!=e.reports[t].d_type&&(p.setSummaryDashData=e,p.setSummaryDashIndex=t,p.modal1=b.openModal("partials/dashboard_summary_conf.html",p,!1,!0))},y.setSummaryDash=function(){var e,t,a=p.setSummaryDashData,n=p.setSummaryDashIndex;y.loaded=!1,a.dname&&(e=a.d_id,t=a.reports[n].r_id),m.setSummaryDash(e,t).then(function(e){y.info.loading=!0,y.info.complete=!1,y.actionMessage=e.data.Msg,y.actionMessageFlag=!0,y.defaultDashboard=[],document.getElementById("gb-summary-dashboard-iframe").setAttribute("src","about:blank"),document.getElementById("tableauSummaryDash").setAttribute("src","about:blank"),y.hardReload(!0)})},y.openScheduling=function(e,s){var t;y.scheduleFreq.SelectedDays=[],p.selectedIndex=s,y.bookItem=e,t=(y.bookItem.typ,y.scheduleItem=y.bookItem.reports[s],e=y.bookItem.d_id,y.scheduleItem.r_id),y.scheduleItem.scheduler_enabled?m.getSchedulingData(e,t).then(function(e){y.scheduleItem.export_format=e.data.Data.export_format;for(var t,a=0;a<y.logiExportFormat.length;a++)y.logiExportFormat[a].enabled=!1;if(y.scheduleExportFileTypeCurrentVariable="",t=("Tableau"!=y.bookItem.typ&&(n=y.bookItem.reports[s].supported_export_format),y.scheduleItem.export_format),e.data.Data.is_tableau_reprt)y.scheduleExportFileTypes=y.tableauExportFormat,"NA"==t||""==t||null==t||null==t?(y.scheduleExportFileTypeCurrentVariable="",y.tableauCurrentVariable=""):(y.scheduleExportFileTypeCurrentVariable=t,y.tableauCurrentVariable=t);else if("NA"!=n&&""!=n&&null!=n&&null!=n){y.scheduleExportFileTypeCurrentVariable="";for(var n=n.split(","),i=0;i<n.length;i++)for(a=0;a<y.logiExportFormat.length;a++)n[i]==y.logiExportFormat[a].name&&(y.logiExportFormat[a].enabled=!0);y.exporFormatCount=y.logiExportFormat.filter(function(e){return e.enabled}).length,y.scheduleExportFileTypes=y.logiExportFormat,"NA"!=t&&""!=t&&null!=t&&null!=t&&-1!=n.indexOf(t)?y.scheduleExportFileTypeCurrentVariable=t:y.scheduleExportFileTypeCurrentVariable=""}else y.scheduleExportFileTypes=y.logiExportFormat,y.scheduleExportFileTypeCurrentVariable="";if(y.scheduleFreq.enabled=!0,y.scheduleFreq.frequency=e.data.Data.scheduler_freq,y.scheduleFreq.scheduler_recipients=e.data.Data.scheduler_recipients,y.scheduleFreq.name=y.scheduleItem.scheduler_period,y.scheduleFreq.scheduler_time.hr=y.scheduleItem.scheduler_time.split(":")[0],y.scheduleFreq.scheduler_time.min=y.scheduleItem.scheduler_time.split(":")[1],"weekly"==y.scheduleFreq.name){for(var o=y.scheduleItem.scheduler_freq.substring(5).split(","),i=0;i<o.length;i++)o[i]=o[i].charAt(0).toUpperCase()+o[i].slice(1);y.scheduleFreq.SelectedDays=o}else if("monthly"==y.scheduleFreq.name){for(a=0;a<y.scheduleFreq.weekDay.length;a++)y.scheduleFreq.weekDay[a].key==e.data.Data.scheduler_freq.split(":")[1].substring(4)&&(y.scheduleFreq.weekDaySele=y.scheduleFreq.weekDay[a].key);y.scheduleFreq.monthDay=e.data.Data.scheduler_freq.split(":")[0].substring(5).charAt(0).toUpperCase()+e.data.Data.scheduler_freq.split(":")[0].substring(5).slice(1),y.scheduleFreq.yearDay="Sunday"}else if("yearly"==y.scheduleFreq.name){for(a=0;a<y.scheduleFreq.weekDay.length;a++)y.scheduleFreq.weekDay[a].key==e.data.Data.scheduler_freq.split(":")[2].substring(4)&&(y.scheduleFreq.weekDaySele=y.scheduleFreq.weekDay[a].key);y.scheduleFreq.YearMonth=e.data.Data.scheduler_freq.split(":")[0].substring(6).charAt(0).toUpperCase()+e.data.Data.scheduler_freq.split(":")[0].substring(6).slice(1),y.scheduleFreq.yearDay=e.data.Data.scheduler_freq.split(":")[1].substring(5).charAt(0).toUpperCase()+e.data.Data.scheduler_freq.split(":")[1].substring(5).slice(1)}else"hourly"==y.scheduleFreq.name&&(y.scheduleFreq.hrintvSele=y.scheduleFreq.frequency.slice(5));p.modalInstance=b.openModal("partials/dashboards/schedulingpopup.html",p)}):m.getSchedulingData(e,t).then(function(e){var t;y.scheduleItem.export_format=e.data.Data.export_format,"Tableau"!=y.bookItem.typ?(n=y.bookItem.reports[s].supported_export_format,t=y.scheduleItem.export_format):y.scheduleItem.export_format&&(t=y.scheduleItem.export_format);for(var a=0;a<y.logiExportFormat.length;a++)y.logiExportFormat[a].enabled=!1;if(y.scheduleExportFileTypeCurrentVariable="",y.exporFormatCount=0,p.modalInstance=b.openModal("partials/dashboards/schedulingpopup.html",p),"Tableau"!=y.bookItem.typ)if("NA"!=n&&""!=n&&null!=n&&null!=n){y.scheduleExportFileTypeCurrentVariable="";for(var n=n.split(","),i=0;i<n.length;i++)for(a=0;a<y.logiExportFormat.length;a++)n[i]==y.logiExportFormat[a].name&&(y.logiExportFormat[a].enabled=!0);y.exporFormatCount=y.logiExportFormat.filter(function(e){return e.enabled}).length,y.scheduleExportFileTypes=y.logiExportFormat,"NA"!=t&&""!=t&&null!=t&&null!=t&&-1!=n.indexOf(t)?y.scheduleExportFileTypeCurrentVariable=t:y.scheduleExportFileTypeCurrentVariable=""}else y.scheduleExportFileTypes=y.logiExportFormat,y.scheduleExportFileTypeCurrentVariable="";else y.scheduleExportFileTypes=y.tableauExportFormat,"NA"==t||""==t||null==t||null==t?(y.scheduleExportFileTypeCurrentVariable="",y.tableauCurrentVariable=""):(y.scheduleExportFileTypeCurrentVariable=t,y.tableauCurrentVariable=t)},function(e){var t;"Tableau"!=y.bookItem.typ?(n=y.bookItem.reports[s].supported_export_format,t=y.scheduleItem.export_format):y.scheduleItem.export_format&&(t=y.scheduleItem.export_format);for(var a=0;a<y.logiExportFormat.length;a++)y.logiExportFormat[a].enabled=!1;if(y.scheduleExportFileTypeCurrentVariable="",p.modalInstance=b.openModal("partials/dashboards/schedulingpopup.html",p),"Tableau"!=y.bookItem.typ)if("NA"!=n&&""!=n&&null!=n&&null!=n){y.scheduleExportFileTypeCurrentVariable="";for(var n=n.split(","),i=0;i<n.length;i++)for(a=0;a<y.logiExportFormat.length;a++)n[i]==y.logiExportFormat[a].name&&(y.logiExportFormat[a].enabled=!0);y.exporFormatCount=y.logiExportFormat.filter(function(e){return e.enabled}).length,y.scheduleExportFileTypes=y.logiExportFormat,"NA"!=t&&""!=t&&null!=t&&null!=t&&-1!=n.indexOf(t)?y.scheduleExportFileTypeCurrentVariable=t:y.scheduleExportFileTypeCurrentVariable=""}else y.scheduleExportFileTypes=y.logiExportFormat,y.scheduleExportFileTypeCurrentVariable="";else y.scheduleExportFileTypes=y.tableauExportFormat,"NA"==t||""==t||null==t||null==t?(y.scheduleExportFileTypeCurrentVariable="",y.tableauCurrentVariable=""):(y.scheduleExportFileTypeCurrentVariable=t,y.tableauCurrentVariable=t)})},y.doneScheduling=function(e){y.info.loading=!0;var t={};if(e){if(""==y.scheduleFreq.scheduler_recipients||!/^(?:[\w\d\.\-]+@[\w\d\.\-]+\s*,\s*)*(?:[\w\d\.\-]+@[\w\d\.\-]+)?$/g.test(y.scheduleFreq.scheduler_recipients))return y.scheduleError=h.getVal("noEmailError"),y.scheduleFreq.error=!0,void(y.info.loading=!1);if("HH"==y.scheduleFreq.scheduler_time.hr||"MM"==y.scheduleFreq.scheduler_time.min)return y.scheduleError=h.getVal("timeSchError"),y.scheduleFreq.error=!0,void(y.info.loading=!1);if("Tableau"!=y.bookItem.typ){if(""==y.scheduleExportFileTypeCurrentVariable&&0<y.exporFormatCount)return y.scheduleError=h.getVal("noExportFormatError"),y.scheduleFreq.error=!0,void(y.info.loading=!1);if(""==y.scheduleExportFileTypeCurrentVariable&&0==y.exporFormatCount)return y.scheduleError=h.getVal("reportNotConfigured"),y.scheduleFreq.error=!0,void(y.info.loading=!1)}else if(""==y.scheduleExportFileTypeCurrentVariable)return y.scheduleError=h.getVal("noExportFormatError"),y.scheduleFreq.error=!0,void(y.info.loading=!1)}var a=y.bookItem.d_id,n=y.scheduleItem.r_id;if("hourly"==y.scheduleFreq.name)t={d_id:a,r_id:n,scheduler_period:y.scheduleFreq.name,scheduler_time:y.scheduleFreq.scheduler_time.hr+":"+y.scheduleFreq.scheduler_time.min,scheduler_recipients:y.scheduleFreq.scheduler_recipients,scheduler_enabled:e,scheduler_freq:"hour-"+y.scheduleFreq.hrintvSele,scheduler_timezone:y.scheduleFreq.scheduler_timeZone,tableau_wb_name:"Internal"==y.bookItem.typ||"Summary"==y.bookItem.typ?"":y.bookItem.name,site_id:v.getSiteId(),wb_sheet_name:"Internal"==y.bookItem.typ||"Summary"==y.bookItem.typ?"":y.scheduleItem.name,content_sheet_url:"Internal"==y.bookItem.typ||"Summary"==y.bookItem.typ?"":y.scheduleItem.url,is_tableau_reprt:"Internal"!=y.bookItem.typ&&"Summary"!=y.bookItem.typ};else if("daily"==y.scheduleFreq.name)t={d_id:a,r_id:n,scheduler_period:y.scheduleFreq.name,scheduler_time:y.scheduleFreq.scheduler_time.hr+":"+y.scheduleFreq.scheduler_time.min,scheduler_recipients:y.scheduleFreq.scheduler_recipients,scheduler_enabled:e,scheduler_freq:"days-monday,tuesday,wednesday,thursday,friday,saturday,sunday",scheduler_timezone:y.scheduleFreq.scheduler_timeZone,tableau_wb_name:"Internal"==y.bookItem.typ||"Summary"==y.bookItem.typ?"":y.bookItem.name,site_id:v.getSiteId(),wb_sheet_name:"Internal"==y.bookItem.typ||"Summary"==y.bookItem.typ?"":y.scheduleItem.name,content_sheet_url:"Internal"==y.bookItem.typ||"Summary"==y.bookItem.typ?"":y.scheduleItem.url,is_tableau_reprt:"Internal"!=y.bookItem.typ&&"Summary"!=y.bookItem.typ};else if("weekly"==y.scheduleFreq.name){if(0==y.scheduleFreq.SelectedDays.length)return y.scheduleError=h.getVal("weekError"),y.scheduleFreq.error=!0,void(y.info.loading=!1);t={d_id:a,r_id:n,scheduler_period:y.scheduleFreq.name,scheduler_time:y.scheduleFreq.scheduler_time.hr+":"+y.scheduleFreq.scheduler_time.min,scheduler_recipients:y.scheduleFreq.scheduler_recipients,scheduler_enabled:e,scheduler_freq:"days-"+y.scheduleFreq.SelectedDays.toString().toLowerCase(),scheduler_timezone:y.scheduleFreq.scheduler_timeZone,tableau_wb_name:"Internal"==y.bookItem.typ||"Summary"==y.bookItem.typ?"":y.bookItem.name,site_id:v.getSiteId(),wb_sheet_name:"Internal"==y.bookItem.typ||"Summary"==y.bookItem.typ?"":y.scheduleItem.name,content_sheet_url:"Internal"==y.bookItem.typ||"Summary"==y.bookItem.typ?"":y.scheduleItem.url,is_tableau_reprt:"Internal"!=y.bookItem.typ&&"Summary"!=y.bookItem.typ}}else"monthly"==y.scheduleFreq.name?t={d_id:a,r_id:n,scheduler_period:y.scheduleFreq.name,scheduler_time:y.scheduleFreq.scheduler_time.hr+":"+y.scheduleFreq.scheduler_time.min,scheduler_recipients:y.scheduleFreq.scheduler_recipients,scheduler_enabled:e,scheduler_freq:"day-"+y.scheduleFreq.weekDaySele+":days-"+y.scheduleFreq.monthDay.toLowerCase(),scheduler_timezone:y.scheduleFreq.scheduler_timeZone,tableau_wb_name:"Internal"==y.bookItem.typ||"Summary"==y.bookItem.typ?"":y.bookItem.name,site_id:v.getSiteId(),wb_sheet_name:"Internal"==y.bookItem.typ||"Summary"==y.bookItem.typ?"":y.scheduleItem.name,content_sheet_url:"Internal"==y.bookItem.typ||"Summary"==y.bookItem.typ?"":y.scheduleItem.url,is_tableau_reprt:"Internal"!=y.bookItem.typ&&"Summary"!=y.bookItem.typ}:"yearly"==y.scheduleFreq.name&&(t={d_id:a,r_id:n,scheduler_period:y.scheduleFreq.name,scheduler_time:y.scheduleFreq.scheduler_time.hr+":"+y.scheduleFreq.scheduler_time.min,scheduler_recipients:y.scheduleFreq.scheduler_recipients,scheduler_enabled:e,scheduler_freq:"day-"+y.scheduleFreq.weekDaySele+":days-"+y.scheduleFreq.yearDay.toLowerCase()+":month-"+y.scheduleFreq.YearMonth.toLowerCase(),scheduler_timezone:y.scheduleFreq.scheduler_timeZone,tableau_wb_name:"Internal"==y.bookItem.typ||"Summary"==y.bookItem.typ?"":y.bookItem.name,site_id:v.getSiteId(),wb_sheet_name:"Internal"==y.bookItem.typ||"Summary"==y.bookItem.typ?"":y.scheduleItem.name,content_sheet_url:"Internal"==y.bookItem.typ||"Summary"==y.bookItem.typ?"":y.scheduleItem.url,is_tableau_reprt:"Internal"!=y.bookItem.typ&&"Summary"!=y.bookItem.typ});t.export_format=y.scheduleExportFileTypeCurrentVariable,y.apiUpdateScheduling(t)},y.apiUpdateScheduling=function(t){m.updateSceduling(t).then(function(e){y.info.loading=!0,y.bookItem.visibility=!y.bookItem.visibility,y.changeVisibility(y.bookItem,!0),y.bookItem.visibility=!y.bookItem.visibility,y.info.loading=!1,y.closeModal(),t.scheduler_enabled?y.actionMessage=e.data.Msg:y.actionMessage="Dashboard Report unscheduled successfully",y.actionMessageFlag=!0,y.hardReload()},function(e){})},y.changeVisibility=function(a,n){if("Tableau"==a.typ){var e=v.getSiteId(),t=_.getUserEmail(),o=(y.info.loading=!0,[]),s={};for(i=0;i<a.reports.length;i++)s.did=a.d_id,s.rids=a.reports[i].r_id,o.push(s);a.visibility=!a.visibility;e={visibility:{drids:o,isPublic:a.visibility,isTableau:!0,siteId:e,userId:a.ownerId,userName:t}};m.changeVisibility(e).then(function(e){y.logActivity("Other Dashboards","Change Visibility","{'"+a.name+"'}"),y.info.loading=!1;var t=new Date;for(i=0;i<y.dashboards.length;i++)y.dashboards[i].d_id==a.d_id&&(y.dashboards[i].visibility=a.visibility,y.dashboards[i].modified_ts=t.toISOString(),y.dashboards[i].modified_ts_to_display=moment(y.dashboards[i].modified_ts).format("YYYY-MM-DD HH:MM:SS"),y.dashboards[i].dashboardSecurityInfo.is_public=a.visibility,n||(y.actionMessage=e.data.Msg,y.actionMessageFlag=!0),y.reloadData())},function(e){})}else{y.info.loading=!0;o=[],s={};for(i=0;i<a.reports.length;i++)s.did=a.d_id,s.rids=a.reports[i].r_id,o.push(s);a.visibility=!a.visibility;e={visibility:{drids:o,isPublic:a.visibility,isTableau:!1}};m.changeVisibility(e).then(function(e){y.info.loading=!1,y.logActivity("Other Dashboards","Change Visibility","{'"+a.dname+"'}");var t=new Date;for(i=0;i<y.dashboards.length;i++)if(y.dashboards[i].d_id==a.d_id){y.dashboards[i].visibility=a.visibility,y.dashboards[i].modified_ts=t.toISOString(),y.dashboards[i].modified_ts_to_display=moment(y.dashboards[i].modified_ts).format("YYYY-MM-DD HH:MM:SS"),y.dashboards[i].dashboardSecurityInfo.is_public=a.visibility,n||(y.actionMessage=e.data.Msg,y.actionMessageFlag=!0),y.reloadData();break}},function(e){})}},y.updateOwnerConf=function(e,t){p.ownerName=e.email,p.userUpdate=e,p.bookUpdate=t,p.modal1=b.openModal("partials/dashboard_owner_conf.html",p,!1,!0)},y.addRoleConf=function(){var e=[];for(i=0;i<y.roles.length;i++)y.roles[i].selected&&e.push(y.roles[i].name);p.roles=e.length,p.modal1=b.openModal("partials/dashboard_add_role_conf.html",p,!1,!0)},y.removeRoleConf=function(e){p.roleEditBook=e;var t=[];for(i=0;i<e.role_access_dis.length;i++)e.role_access_dis[i].selected&&t.push(e.role_access_dis[i].name);p.roleName=t.length,p.modal1=b.openModal("partials/dashboard_remove_role_conf.html",p,!1,!0)},y.copyLink=function(e,t){var a=getCookie("landingPageUrl"),a=(a=a.slice(0,a.indexOf("#")))+"#?dash_mode=true&did="+e.d_id+"&rid="+e.reports[t].r_id,e=document.createElement("span"),t=(e.appendChild(document.createTextNode(a)),e.id="tempCopyToClipboard",$("body").append(e),document.createRange());t.selectNode(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(t),document.execCommand("copy"),window.getSelection().removeAllRanges(),e.remove(),y.copiedLink=a,$(".copyMsg").show(),setTimeout(function(){$(".copyMsg").hide()},3e3)},y.emailLink=function(e,t){var a=getCookie("landingPageUrl"),a=(a=a.slice(0,a.indexOf("#")))+"#?dash_mode=true%26did="+e.d_id+"%26rid="+e.reports[t].r_id,n=h.getVal("emailLinkSub")+e.reports[t].rname,a=h.getVal("emailLinkMsg")+"<a href='"+a+"'>"+e.reports[t].rname+"</a></b>"+h.getVal("emailLinkFooter");u.open("mailto:?subject="+n+"&body="+a,"_self")},y.updateOwner=function(n,o){if(y.info.loading=!0,"Tableau"===o.typ){var s=[],e={},r="",l=n.email,d=v.getSiteId(),c=_.getUserEmail();for(i=0;i<o.reports.length;i++)e.did=o.d_id,e.rids=o.reports[i].r_id,s.push(e);v.getUsersAPI().then(function(e){var t=S.xml_str2json(e.data).tsResponse.users.user;if(Array.isArray(t))for(var a in t)t[a]._name==l&&(r=t[a]._id);else b.alertBox({msg:y.changeOwnerErrorMsg});e={ownership:{drids:s,owner:n.email,role:n.role,isTableau:!0,siteId:d,userId:[o.ownerId],userName:c,newOwnerId:r}};m.updateOwner(e).then(function(e){y.logActivity("Other Dashboards","Change Owner","{'"+o.name+"'}"),y.actionMessage=e.data.Msg,y.actionMessageFlag=!0;var t=new Date;if(0<=e.data.Msg.search("ERROR"))b.alertBox({msg:y.changeOwnerErrorMsg}),y.info.loading=!1;else{for(a=0;a<y.dashboards.length;a++)y.dashboards[a].d_id==o.d_id&&(y.dashboards[a].dashboardSecurityInfo.owner=n.email,y.dashboards[a].modified_ts=t.toISOString(),y.dashboards[a].modified_ts_to_display=moment(y.dashboards[a].modified_ts).format("YYYY-MM-DD HH:MM:SS"),y.dashboards[a].role_access_dis=[],-1==y.dashboards[a].role_access.indexOf(n.role)&&y.dashboards[a].role_access.push(n.role));y.info.loading=!1,y.clearLocalFilter(),p.showFilterPanel=!1,y.reloadData()}},function(e){b.alertBox({msg:y.changeOwnerErrorMsg})})})}else{s=[],e={};for(i=0;i<o.reports.length;i++)e.did=o.d_id,e.rids=o.reports[i].r_id,s.push(e);var t={ownership:{drids:s,owner:n.email,role:n.role,isTableau:!1}};m.updateOwner(t).then(function(e){y.logActivity("Other Dashboards","Change Owner","{'"+o.dname+"'}");var t=new Date;for(i=0;i<y.dashboards.length;i++)y.dashboards[i].d_id==o.d_id&&(y.dashboards[i].dashboardSecurityInfo.owner=n.email,y.dashboards[i].modified_ts=t.toISOString(),y.dashboards[i].modified_ts_to_display=moment(y.dashboards[i].modified_ts).format("YYYY-MM-DD HH:MM:SS"),y.dashboards[i].role_access_dis=[],-1==y.dashboards[i].role_access.indexOf(n.role)&&y.dashboards[i].role_access.push(n.role));y.info.loading=!1,y.actionMessage=e.data.Msg,y.actionMessageFlag=!0,y.clearLocalFilter(),p.showFilterPanel=!1,y.reloadData()},function(e){})}},y.toggleSelection=function(e){var t=y.scheduleFreq.SelectedDays.indexOf(e);-1<t?y.scheduleFreq.SelectedDays.splice(t,1):y.scheduleFreq.SelectedDays.push(e)},l.getErrors("gbApp").length&&(y.info.complete=!0),y.isFeatureEnable=function(e){return h.getVal("features")[e]},y.ifGlassbeamUser=function(){return _.getUserOrgType()==h.getVal("gbUserOrgType")},y.ifWbDemoUser=function(){for(var e=_.getUserOrgType(),t=h.getVal("wbUserOrgType"),a=h.getVal("gb_demo_apps_realms"),n=0;n<a.length;n++)if(h.getVal("role_details").mps_uidomain[a[n]]==g.host()&&e==t)return!0;return!1},y.isSubscribed=function(e){return 1<=(s("filter")(o.getSubscriptionsList(),{content:{_id:e.id}})||[]).length},y.getWorkbenchApiRootDir=function(e){return""!=y.info.workbenchApiRootDir&&y.info.workbenchApiRootDir||(y.info.workbenchApiRootDir=v.getWorkbenchApiRoot()),y.info.workbenchApiRootDir},y.getSheetThumbnailImage=function(e,t){if(!e||""==e)return"";y.getWorkbenchApiRootDir();var a="",n="";return"Tableau"!=e.d_type?(a=e.d_id,h.getVal("dashboard_img_logi_path")+"/"+a+".png"):(e.id&&(a=e.id),t?(e.d_id?n=t.r_id:e.id&&(n=t.id),y.info.workbenchApiRootDir):e.d_id&&e.reports&&(n=e.reports[0].r_id),y.info.workbenchApiRootDir+"/"+a+"/"+n)},d.getAllConfig().then(function(e){y.info.tempSchFlag=e.data.Data.config.dashboard_scheduling}),m.getRoles().then(function(e){var t,a,n=e.data.Data;for(i=0;i<n.length;i++)""!=n[i]&&(t={},3<(a=n[i].split("_")).length?t.name=a.splice(3,3).join("_"):t.name=n[i],t.realName=n[i],t.selected=!1,y.roles.push(t))}),y.getSummaryFlag=function(e){var t=!1;for(i=0;i<e.reports.length;i++)"Summary"==e.reports[i].d_type&&(t=!0);return t},y.getExpandedRowId=function(e,t,a){return"Tableau"==e.typ?"dashRowExt"+t+"_report"+a:"dashRowInt"+t+"_report"+a},y.getRowId=function(e,t){return"Tableau"==e.typ?"dashRowExt"+t:"dashRowInt"+t},y.loadTableauSummary=function(s,r){console.log(s),y.info.isTableauConfigured&&v.getTrustedAuthKey().then(function(e){var a,e=e.data.Data,t=angular.copy(s),n=(s.reports.map(function(e,t){e.r_id===r&&(a=t)}),document.getElementById("tableauSummaryDash")),i={width:"100%",height:"100%",hideTabs:!0,hideToolbar:!0,toolbarPosition:"top",onFirstInteractive:function(){}},o=(y.tableauSummaryName=t.name,v.getTableauDomain()+"/trusted/"+e+t.reports[a].url);console.log(o),p.viz&&p.viz.dispose(),setTimeout(function(){p.viz=new tableau.Viz(n,o,i)},1500)})},y.getAllDeatils=function(){y.info.loading=!0,y.reloadDashboards(!0)},u.loadingDone=function(){y.info.loadCount++,c(function(){y.loaded=!0,angular.element("#content-loader")&&angular.element("#content-loader").addClass("gb-hide"),angular.element("#dashboard-iframe-div")&&angular.element("#dashboard-iframe-div").removeClass("gb-hide")},5e3)},y.getSysErrors=function(){return l.getErrors("gbApp")},y.addInstance=function(e,t,a){"Internal"!=e.typ&&"Summary"!=e.d_type||"Tableau"==e.typ?"Tableau"==e.typ&&y.addTabInstance(t,a):(e={type:"dashboard",name:t.rname,data:{report:t}},a=JSON.parse(angular.toJson(e)),n.addInstance(a,y))},y.openDashboardIninstanceViewerOnloadOfPage=function(e){e={type:"dashboard",name:e.rname,data:{report:e}};instance=JSON.parse(angular.toJson(e)),n.addInstance(instance,y)},y.isInstanceViewerVisible=function(){return!n.isVisible()&&0<n.getNumberOfInstances()},y.logActivity=function(e,t,a){d.standard_user_tracking(h.getVal("navDashboards"),e,t,a).then(L,T)},y.search=function(){return{rdesc:y.info.query}},y.toggleDashboard=function(e){e.expand=!e.expand,m.updateDashboards(y.gAllDashboards)},y.toggleRoleSelect=function(e){var t=[];for(i=0;i<y.roles.length;i++)y.roles[i].selected&&t.push(y.roles[i].name);0!=t.length?y.info.assignRole=t.toString():y.info.assignRole="Select Roles"},y.toggleRoleRemoveSelect=function(e){y.info.loggedRole!=e.realName&&(e.selected=!e.selected)},y.selectAllRole=function(){var e=[];for(i=0;i<y.roles.length;i++)y.roles[i].selected=!0,e.push(y.roles[i].name);y.info.assignRole=e.toString()},y.selectAllRoleRemove=function(e){for(i=0;i<e.role_access_dis.length;i++)e.role_access_dis[i].realName!=y.info.loggedRole?e.role_access_dis[i].selected=!0:e.role_access_dis[i].selected=!1},y.clearAllRole=function(){for(i=0;i<y.roles.length;i++)y.roles[i].selected=!1,y.info.assignRole="Select Roles"},y.clearAllRoleRemove=function(e){for(i=0;i<e.role_access_dis.length;i++)e.role_access_dis[i].selected=!1},y.checkRoleSubmit=function(){var e=[];for(i=0;i<y.roles.length;i++)y.roles[i].selected&&e.push(y.roles[i].name);return 0==e.length||!y.showAddTagsDd()},y.checkRoleRemoveSubmit=function(e){var t=[];for(i=0;i<e.role_access_dis.length;i++)e.role_access_dis[i].selected&&t.push(e.role_access_dis.name);return 0==t.length},y.addRoleSubmit=function(){for(var a=[],n=0;n<y.roles.length;n++)y.roles[n].selected&&a.push(y.roles[n].realName);var e=a.toString(),t=y.getAllDashboards();y.info.selectedBooks=[];for(var n=0;n<t.length;n++)(t[n].selected&&t[n].d_id||t[n].selected)&&y.info.selectedBooks.push(t[n]);var i=[],o=[];for(n=0;n<y.info.selectedBooks.length;n++){if(y.info.selectedBooks[n].d_id){for(i[n]={},i[n].did=y.info.selectedBooks[n].d_id,i[n].rids=[],j=0;j<y.info.selectedBooks[n].reports.length;j++)o.push(y.info.selectedBooks[n].reports[j].r_id);i[n].rids=o.join(",")}o=[]}e={roleaccess:{drids:i,roles:e}};y.info.loading=!0,m.addRolesToDashboards(e).then(function(e){var t=new Date;for(n=0;n<y.dashboards.length;n++)for(j=0;j<y.info.selectedBooks.length;j++)if(y.dashboards[n].d_id==y.info.selectedBooks[j].d_id)for(y.dashboards[n].modified_ts=t.toISOString(),y.dashboards[n].modified_ts_to_display=moment(y.dashboards[n].modified_ts).format("YYYY-MM-DD HH:MM:SS"),k=0;k<a.length;k++)-1==y.dashboards[n].role_access.indexOf(a[k])&&y.dashboards[n].role_access.push(a[k]);for(y.actionMessage=e.data.Msg,y.actionMessageFlag=!0,y.reloadData(),y.info.selectedBooks="",y.info.tags="",n=0;n<y.roles.length;n++)y.roles[n].selected=!1;y.info.assignRole="Select Roles"},function(e){y.info.selectedBooks="",y.info.tags="",y.info.loading=!1})},y.getCheckboxStatus=function(e){for(i=0;i<y.gbAlDashboards.length;i++)if(!y.gbAlDashboards[i].selected)return!1;return!0},y.getSelectAllChkDisable=function(){var t=0;return y.gbAlDashboards.map(function(e){for(i=0;i<y.dashboards.length;i++)e.d_id==y.dashboards[i].d_id&&y.dashboards[i].permissionTags&&t++}),0!==t},y.toggleSelectAll=function(e){y.currentSelected=0,y.info.selectAllDashboard?y.gbAlDashboards.map(function(e){for(e.selected=!0,i=0;i<y.dashboards.length;i++)e.d_id==y.dashboards[i].d_id&&y.dashboards[i].permissionTags&&(y.dashboards[i].selected=!0)}):y.gbAlDashboards.map(function(e){for(e.selected=!1,i=0;i<y.dashboards.length;i++)e.d_id==y.dashboards[i].d_id&&y.dashboards[i].permissionTags&&(y.dashboards[i].selected=!1)}),y.dashboards.map(function(e){e.selected&&y.currentSelected++}),0==y.currentSelected?y.showSelectNotify=!1:y.showSelectNotify=!0},y.checkdash=function(t,a){y.filterLoading=!1,y.currentSelected=0,y.gbAlDashboards.map(function(e){t.d_id==e.d_id&&(e.selected=a)}),y.dashboards.map(function(e){t.d_id==e.d_id&&(e.selected=a)}),y.dashboards.map(function(e){e.selected&&y.currentSelected++}),0==y.currentSelected?y.showSelectNotify=!1:y.showSelectNotify=!0},y.checkSelectAll=function(){for(y.currentSelected=0,i=0;i<y.gbAlDashboardsFiltered.length;i++)for(j=0;j<y.dashboards.length;j++)y.dashboards[j].d_id==y.gbAlDashboardsFiltered[i].d_id&&(y.dashboards[j].selected=!0,y.currentSelected++)},y.clearselected=function(){y.currentSelected=0,y.gbAlDashboards.map(function(e){e.selected=!1}),y.dashboards.map(function(e){e.selected=!1}),y.showSelectNotify=!1},y.filterResult=function(){var e,t=!0;if(y.info.complete&&y.getError()&&!y.getError().length){for(e in y.gbAlDashboards)null!=y.gbAlDashboards[e].reports&&y.dashboards[e].reports.length&&(t=!1);return t}return!1},y.getError=function(){return l.getFeatureErrors("dashboards")},y.getMessage=function(e){return h.getVal(e)},y.sceURL=function(e){return a.trustAsResourceUrl(e)},y.sceHTML=function(e){return a.trustAsHtml(e)},y.expandBook=function(e){e.expand=!e.expand,m.updateDashboards(y.gAllDashboards)},y.filterTableau=function(){var e,t=y.getAllDashboards();for(e in t)if(s("filter")(t[e].views,{tags:y.info.query}).length)return!0;return!1},y.userPermitted=function(){var e=_.getUser(),t=_.getFeatures();return!!(t.workbench||e.org_type==h.getVal("gbUserOrgType")||e.org_type==h.getVal("studioUserOrgType")&&r.isGbStudioApp()||y.ifWbDemoUser())||!(e.org_type==h.getVal("gbUserOrgType")&&!y.chkAdminFeature()&&t.dashboard_admin)&&(!(e.org_type==h.getVal("gbUserOrgType")||y.chkAdminFeature()||!t.dashboard_admin)||!(e.org_type==h.getVal("gbUserOrgType")||!y.chkAdminFeature()||!t.dashboard_admin))},y.checkCurrentRole=function(e,t){return _.getUser().role!=e.realName||!!y.chkAdminFeature()},y.isPowerUser=function(){return o.isPowerUser()},y.subscribe=function(e){t.open({templateUrl:"partials/tableau_subscribe.html",controller:"SubscribeController as subscribeCtrl",resolve:{content:function(){return e},schedules:function(){return o.getSchedulesList()}}})},y.showUsers=function(){y.roleListLoading=!0,y.modalInstance=t.open({templateUrl:"partials/dashboard_user_role_list.html",scope:p}),m.showUsers().then(function(e){var t=e.data.Data,a=[],n={};for(y.roleUserList=[],i=0;i<t.length;i++)n.name=t[i].first_name+" "+t[i].last_name,n.email=t[i].email,3<t[i].role.split("_").length?n.role=t[i].role.split("_").splice(3,3).join("_"):n.role=t[i].role,a.push(n),n={};y.roleUserList=a,y.roleListLoading=!1})},y.updateSubscription=function(e){t.open({templateUrl:"partials/tableau_update_subscription.html",controller:"UpdateSubscriptionController as subscribeCtrl",resolve:{content:function(){return e},schedules:function(){return o.getSchedulesList()},subscription:function(){return V(e)}}})},y.unsubscribe=function(e){t.open({templateUrl:"partials/tableau_unsubscribe.html",controller:"UnsubscribeController as unsubscribeCtrl",resolve:{content:function(){return e},subscription:function(){return V(e)}}})},y.userPermitted()?y.info.addDeleteTag=!0:y.info.addDeleteTag=!1,y.addTabInstance=function(e,t){var e={type:"tableau",name:e.name,data:{view:e,mode:"viewer"},owner:t},e=JSON.parse(angular.toJson(e)),a=h.getVal("primaryDomain");document.cookie="gb_hide_options=1;domain="+a+";path=/",n.addInstance(e,y,t)},y.addTagToWorkbook=function(e){t.open({templateUrl:"partials/dashboards_add_tag_workbook.html",controller:"AddTagController as addTagCtrl",resolve:{workbook:function(){return e}}})},y.removeTagFromWorkbook=function(a,n){y.info.loading=!0;var e=a.d_id;m.removeTag(e,n).then(function(e){y.logActivity("Other Dashboards","Remove Tag","{'"+n+"'}");var t=new Date;for(i=0;i<y.dashboards.length;i++)y.dashboards[i].d_id==a.d_id&&(y.dashboards[i].modified_ts=t.toISOString(),y.dashboards[i].modified_ts_to_display=moment(y.dashboards[i].modified_ts).format("YYYY-MM-DD HH:MM:SS"),y.dashboards[i].tag.splice(y.dashboards[i].tag.indexOf(n),1));y.actionMessage=e.data.Msg,y.actionMessageFlag=!0,y.reloadData()},function(e){y.reloadData(),y.info.loading=!1})},y.removeRoleFromWorkbook=function(e,t){y.info.loading=!0;var a=e.d_id,n=[],o=[];for(i=0;i<e.role_access_dis.length;i++)e.role_access_dis[i].selected&&n.push(e.role_access_dis[i].realName);for(i=0;i<n.length;i++)m.removeRole(a,n[i]).then(function(e){y.logActivity("Other Dashboards","Remove Role","{'"+n[i]+"'}"),o.push(n[i]);var t=new Date;if(o.length==n.length){for(k=0;k<y.dashboards.length;k++)if(y.dashboards[k].d_id==a)for(y.dashboards[k].modified_ts=t.toISOString(),y.dashboards[k].modified_ts_to_display=moment(y.dashboards[k].modified_ts).format("YYYY-MM-DD HH:MM:SS"),j=0;j<n.length;j++)y.dashboards[k].role_access.splice(y.dashboards[k].role_access.indexOf(n[j]),1);y.actionMessage=e.data.Msg,y.actionMessageFlag=!0,y.reloadData()}})},y.updateWorkbook=function(e){t.open({templateUrl:"partials/dashboards_update_workbook.html",controller:"UpdateWorkbookController as updateWorkbookCtrl",resolve:{workbook:function(){return e}}})},y.deleteWorkbookModal=function(e){y.selectedDashboard=e,y.msg="Are you sure you want to delete the report <b>"+y.selectedDashboard.name+"</b>",y.modalInstance=t.open({templateUrl:"partials/dashboards_delete_workbook.html",scope:p})},y.checkOwner=function(e){return e.owner==o.getUserId()},y.addTabbedTabInstance=function(e){var t={type:"tableau",name:e.name,data:{book:e,mode:"viewer"},owner:e.owner},t=JSON.parse(angular.toJson(t));n.addInstance(t,y,e.owner)},y.addManageInstance=function(){var e={type:"permissions",name:"Manage Reports",data:{}},e=JSON.parse(angular.toJson(e));n.addInstance(e,y)},y.getWorkbooks=function(){var e=o.getWorkbooksLocal();return M.books=e.books,M.loading=e.loading,M.error=e.error,M.userUnauthorized=e.userUnauthorized,M},y.isLoadingOtherDashboard=function(){return y.info.loading},y.getTagsForTableau=function(e){var t=y.tableauDashboards;if(t&&0<t.length)for(var a=0;a<t.length;a++)if(t[a].d_id===e)return t[a].tag;return[]},y.getSchForTableau=function(e){var t=y.tableauDashboards;if(t&&0<t.length)for(var a=0;a<t.length;a++)if(t[a].d_id===e)return t[a].reports;return[]},y.isNoDashboards=function(){var e=[],e=y.gbAlDashboards,t=o.getWorkbooksLocal();return!(0<(e=t&&t.books&&t.books.length&&0<t.books.length?e.concat(t.books):e).length)},y.getAllDashboards=function(){return y.gbAlDashboards},y.updateCreatorName=function(e){y.info.dUserName=[];for(var t=0;t<e.length;t++)y.isDuplicateArrayObject(y.info.dUserName,e[t].gDUser)||y.info.dUserName.push(e[t].gDUser)},y.getDCreatorName=function(){return y.info.dUserName},y.updateOwnerName=function(e){y.info.dOwnerName=[];for(var t=0;t<e.length;t++)y.isDuplicateArrayObject(y.info.dOwnerName,e[t].gDOwner)||y.info.dOwnerName.push(e[t].gDOwner)},y.getDOwnerName=function(){return y.info.dOwnerName},y.getDlastModified=function(){return y.info.lastModifiedArray},y.isDuplicateArrayObject=function(e,t){for(var a=0;a<e.length;a++)if(e[a]==t)return!0;return!1},y.getAllTagsName=function(){for(var e=[],t=[],a=0;a<y.info.allDashboardsList.length;a++){t=[],y.info.allDashboardsList[a].tags&&(t=y.info.allDashboardsList[a].tags),y.info.allDashboardsList[a].tag&&(t=y.info.allDashboardsList[a].tag);for(var n=0;n<t.length;n++)e.push(t[n])}return(e=y.unique(e)).sort(),e},y.getAllTagsNameOfSelectedDashboards=function(){var e=[],t=[],a=[];for(allDash=y.getAllDashboards(),n=0;n<allDash.length;n++)allDash[n].selected&&a.push(allDash[n]);for(var n=0;n<a.length;n++){t=[],a[n].selected&&a[n].tags&&(t=a[n].tags),a[n].selected&&a[n].tag&&(t=a[n].tag);for(var i=0;i<t.length;i++)e.push(t[i])}return e=y.unique(e)},y.unique=function(e){for(var t=[],a=0;a<e.length;a++)t.indexOf(e[a])<0&&t.push(e[a]);return t},y.addExistingTag=function(e){y.processMultipleTags(),-1==y.info.tags.split(",").indexOf(e)&&(""==y.info.tags?y.info.tags=e:y.info.tags=y.info.tags+","+e,y.isAlphaNumeric())},y.getBookOwnerName=function(e){if(e.name){if(y.info.bookOwnerList&&0<y.info.bookOwnerList.length)for(var t=0;t<y.info.bookOwnerList.length;t++)if(y.info.bookOwnerList[t]._id==e.owner)return y.info.bookOwnerList[t]._name}else if(e.dname)return e.created_by;return""},y.getVisibility=function(e){return e.dashboardSecurityInfo.is_public},y.getRoleAccessField=function(e){if(e.name){var t=y.tableauDashboards,a=o.getWorkbooksLocal();if(t&&0<t.length)for(var n=0;n<a.books.length;n++)if(a.books[n].id===e.id)for(j=0;j<t.length;j++)if(t[j].d_id===e.id)return t[j].role_access}else if(e.dname)return e.dashboardSecurityInfo.is_public},y.checkOwnerButton=function(e,t){t="glassBeam"==t;if(e.name){if(e.gDOwner!=_.getUserEmail())return!t||!y.ifGlassbeamUser()&&!y.ifWbDemoUser()}else if(e.dname)return"NA"!=e.dashboardSecurityInfo.owner&&""!=e.dashboardSecurityInfo.owner?(e.dashboardSecurityInfo.owner,_.getUserEmail(),!t||!y.ifGlassbeamUser()&&!y.ifWbDemoUser()):_.getDashAdmin()?void 0:!t||!y.ifGlassbeamUser()&&!y.ifWbDemoUser()},y.showDashBoard=function(e,t){if("Internal"==e.typ&&"delete"==t)return!1;if("delete"==t&&(t="tags"),"Internal"==e.typ&&"tabs"==t)return!1;if("tabs"==t&&(t="tags"),y.chkAdminFeature())switch(t){case"dashLevel":case"tags":case"changeOwner":return!0;case"public":return!e.visibility;case"private":return!!e.visibility}else if(e.gDOwner!=_.getUserEmail())if(y.ifGlassbeamUser())if(y.chkAdminFeature())switch(t){case"dashLevel":return!0;case"tags":return!1;case"changeOwner":return!0;case"public":case"private":return!1}else switch(t){case"dashLevel":return!!e.visibility;case"tags":case"changeOwner":case"public":case"private":return!1}else if(y.ifWbDemoUser())switch(t){case"dashLevel":case"tags":case"changeOwner":case"public":case"private":return!0}else if(y.isPowerUser())switch(t){case"dashLevel":return!0;case"tags":case"changeOwner":case"public":case"private":return!1}else switch(t){case"dashLevel":var a=_.getUser();return!!e.role_access&&!(!e.visibility||-1==e.role_access.indexOf(a.role));case"tags":case"changeOwner":case"public":case"private":return!1}else if(e.gDOwner==_.getUserEmail())switch(t){case"dashLevel":a=_.getUser();return-1!=e.role_access.indexOf(a.role);case"tags":case"changeOwner":return!0;case"public":return!e.visibility;case"private":return!!e.visibility}},y.getTitle=function(e,t){if(e.name)switch(t){case"changeOwner":return y.showDashBoard(e,t)?"Change Owner":"Admin Feature";case"public":return e.visibility,e.gDOwner==_.getUserEmail()||y.chkAdminFeature()?"Public":"Admin Feature";case"private":return e.visibility,e.gDOwner==_.getUserEmail()||y.chkAdminFeature()?"Private":"Admin Feature"}},y.checkAvailableAdmins=function(e){if(e.name){if(y.dashOwnerListTableau)return 1==y.dashOwnerListTableau.length&&y.dashOwnerListTableau[0]==e.gDOwner}else if(e.dname&&y.dashOwnerListLogi)return 1==y.dashOwnerListLogi.length&&y.dashOwnerListLogi[0]==e.gDOwner},y.logout=function(){"1"==getCookie("dashModeLogin")&&0==n.getInstances().length?r.logoutSessionTimeout():(y.modalInstance.close(),sessionStorage.setItem("dash_mode","false"),document.getElementById("gb-full-page-loader").style.display="none")},y.getBookChangedOwnerName=function(e){return e.dashboardSecurityInfo.owner},y.chkDashSchedulingFeature=function(){return!!y.info.tempSchFlag},y.filterOnType=function(e){for(var t=[],a=0;a<e.length;a++)"internalDashboards"==y.info.dType?e[a].dname&&t.push(e[a]):"userCreatedDashboards"==y.info.dType&&e[a].name&&t.push(e[a]);return t},y.filterOnCreator=function(e){for(var t=[],a=0;a<e.length;a++)"All"!=y.info.createdBy&&y.info.createdBy&&e[a].gDUser==y.info.createdBy&&t.push(e[a]);return t},y.filterOnOwner=function(e){var t=[];for(j=0;j<y.info.ownerFilter.length;j++)for(var a=0;a<e.length;a++)-1!=e[a].gDOwner.indexOf(y.info.ownerFilter[j])&&t.push(e[a]);return t},y.filterOnLastModified=function(e){for(var t=[],a=0;a<e.length;a++)if("All"!=y.info.lastModified&&y.info.lastModified){var n=new Date,i=new Date(e[a].modified_ts);switch(y.info.lastModified){case"24hrs":y.date_diff_indays(i,n)<=1&&t.push(e[a]);break;case"week":y.date_diff_indays(i,n)<=7&&t.push(e[a]);break;case"month":y.date_diff_indays(i,n)<=30&&t.push(e[a]);break;case"6month":y.date_diff_indays(i,n)<=180&&t.push(e[a])}}return t},y.date_diff_indays=function(e,t){return dt1=new Date(e),dt2=new Date(t),Math.floor((Date.UTC(dt2.getFullYear(),dt2.getMonth(),dt2.getDate())-Date.UTC(dt1.getFullYear(),dt1.getMonth(),dt1.getDate()))/864e5)},y.filterOnDatasource=function(e){var t=[];for(j=0;j<y.info.datasourceFilter.length;j++)for(var a=0;a<e.length;a++)if(e[a].datasource&&-1!=e[a].datasource[0].name.indexOf(y.info.datasourceFilter[j])){t.push(e[a]);break}return t},y.filterOnTags=function(e){var t=[];for(j=0;j<y.info.tagsFilter.length;j++)for(var a=0;a<e.length;a++)if(-1!=e[a].tag.indexOf(y.info.tagsFilter[j])){t.push(e[a]);break}return t=y.unique(t)},y.getNameOfDashboard=function(e,t){var a="";return e.name?a=t&&e.name.length>t?e.name.substr(0,t)+"...":e.name:e.dname&&(a=t&&e.dname.length>t?e.dname.substr(0,t)+"...":e.dname),a=a.toLowerCase()},y.localFilter=function(){},y.changeView=function(e){y.info.currentView=e,y.info.currentBook=null},y.addTagInternalDashboards=function(e){y.info.selectedBooks=e.d_id,y.modalInstance=t.open({templateUrl:"partials/dashboards_internal_add_tag_workbook.html",scope:p})},y.hideModal=function(){y.info.tags="",y.modalInstance&&y.modalInstance.close("ok")},y.addTagSingle=function(){if(y.info.tags&&y.info.selectedBooks){var e=[],t=[];for(i=0;i<y.info.selectedBooks.length;i++){if(y.info.selectedBooks[i].d_id){for(e[i].did=y.info.selectedBooks[i].d_id,e[i].rids=[],j=0;j<y.info.selectedBooks[i].reports.length;j++)t.push(y.info.selectedBooks[i].reports[j].r_id);e[i].rids=t.join(",")}t=[]}var a={tagging:{drids:e,tags:y.info.tags}};y.info.loading=!0,m.addTagsToDashboards(a).then(function(e){y.getAllDeatils(),y.hideModal(),y.info.selectedBooks="",y.info.tags="",y.info.loading=!1},function(e){y.hideModal(),y.info.selectedBooks="",y.info.tags="",y.info.loading=!1})}},y.showAddTagsDd=function(){for(var e=y.dashboards,t=0;t<e.length;t++)if(e[t].selected)return!0;return!1},y.showMsg=function(){return""!=y.info.errMsg},y.isAlphaNumeric=function(){var e=y.info.tags.split(/,|\s/),t=[],a=!1;if(""!=y.info.tags){for(var n=y.getAllTagsNameOfSelectedDashboards(),i=0;i<e.length;i++){var o=e[i];if(""!=o){if(o.length>y.info.tag_max_characters)return a=!0,void(y.info.errMsg=h.getVal("dashboard_tagname_max_len"));if(!o.match(/^[0-9a-zA-Z]+$/))return a=!0,void(y.info.errMsg=h.getVal("dashboard_tagname_special_char"));for(var s=0;s<n.length;s++)n[s]==o&&(a=!0,t.push(o))}}0<t.length?y.info.errMsg=h.getVal("dashboard_tagbname_duplicate")+t.join(", "):a||(y.info.errMsg="")}else y.info.errMsg=""},y.addTagsMultiple=function(){var e=y.getAllDashboards();y.processMultipleTags(),y.info.selectedBooks=[];for(var i=0;i<e.length;i++)e[i].selected&&e[i].d_id&&y.info.selectedBooks.push(e[i]);if(y.info.tags&&0<y.info.selectedBooks.length){for(var t=[],a=[],i=0;i<y.info.selectedBooks.length;i++){if(y.info.selectedBooks[i].d_id){for(t[i]={},t[i].did=y.info.selectedBooks[i].d_id,t[i].rids=[],j=0;j<y.info.selectedBooks[i].reports.length;j++)a.push(y.info.selectedBooks[i].reports[j].r_id);t[i].rids=a.join(",")}a=[]}var n={tagging:{drids:t,tags:y.info.tags}};y.info.loading=!0,m.addTagsToDashboards(n).then(function(e){y.logActivity("Other Dashboards","Add Tags","{'"+y.info.tags+"'}");var t=0,a=new Date,n=y.info.tags.split(",");for(i=0;i<y.dashboards.length;i++){for(j=0;j<y.info.selectedBooks.length;j++)y.dashboards[i].d_id==y.info.selectedBooks[j].d_id&&(y.dashboards[i].modified_ts=a.toISOString(),y.dashboards[i].modified_ts_to_display=moment(y.dashboards[i].modified_ts).format("YYYY-MM-DD HH:MM:SS"),y.dashboards[i].tag=y.dashboards[i].tag.concat(n),t++);t==y.info.selectedBooks.length&&(y.actionMessage=e.data.Msg,y.actionMessageFlag=!0,y.reloadData())}},function(e){y.hideModal(),y.info.selectedBooks=[],y.info.tags="",y.info.loading=!1})}$("#gb-add-tag-dd-container .dropdown-toggle").dropdown("toggle")},y.processMultipleTags=function(){y.info.tags=y.info.tags.trim(),y.info.tags=y.info.tags.replace(/ {1,}/g," "),y.info.tags=y.info.tags.replace(/ /g,","),y.info.tags=y.info.tags.replace(/,{1,}/g,","),y.info.tags=y.info.tags.replace(/^,/,""),y.info.tags=y.info.tags.replace(/,$/,"")},y.showDashboardTileFrame=function(e){!e.visibility&&y.checkOwnerButton(e)||(y.info.currentView="frames",y.info.currentBook=e)},y.getReportList=function(){var e=y.info.currentBook;return list=e.reports?e.reports:list},y.internalDashboards=function(){return!!(book=y.info.currentBook).reports},y.getReportName=function(e){return e.rname||e.name||void 0},y.openSettingsMenu=function(e){e=$(e.currentTarget);e.hasClass("open")?e.removeClass("open"):e.addClass("open")},y.changeDateFormate=function(e){if(!e)return"";e=new Date(e);return e?y.makeTwoDigit(e.getMonth()+1)+"-"+y.makeTwoDigit(e.getDate())+"-"+y.makeTwoDigit(e.getFullYear())+" "+y.makeTwoDigit(e.getHours())+":"+y.makeTwoDigit(e.getMinutes())+":"+y.makeTwoDigit(e.getSeconds()):""},y.makeTwoDigit=function(e){return e=(e=parseInt(e,10))<10?"0"+e:e},p.$watch('dashCtrl.info.page["total"]',function(e,t,a){e!=t&&(y.selectAllFlag=!1)}),p.$watch("dashCtrl.info.page.current",function(e,t,a){if(e!=t)for(j=0;j<y.gAllDashboards.length;j++)y.gAllDashboards[j].selected=!1}),y.showCheckTag=function(e){for(i=0;i<y.info.tagsFilter.length;i++)if(e==y.info.tagsFilter[i])return!0;return!1},y.showCheckOwner=function(e){for(i=0;i<y.info.ownerFilter.length;i++)if(e==y.info.ownerFilter[i])return!0;return!1},y.showCheckDatasource=function(e){for(i=0;i<y.info.datasourceFilter.length;i++)if(e==y.info.datasourceFilter[i])return!0;return!1},y.getValue=function(e){return h.getVal(e)},y.deleteWorkbook=function(){y.info.loading=!0,v.deleteWorkbook(y.selectedDashboard).then(function(e){for(y.logActivity("Other Dashboards","Delete Workbook","{'"+y.selectedDashboard.dname+"'}"),i=0;i<y.dashboards.length;i++)if(y.selectedDashboard.d_id==y.dashboards[i].d_id){y.dashboards.splice(i,1);break}y.actionMessage=e.data.Msg,y.actionMessageFlag=!0,y.reloadData(),y.modalInstance.close(),y.modalInstance,y.selectedDashboard=""},function(e){y.info.loading=!1,y.modalInstance.close(),y.selectedDashboard=""})},y.renderHtml=function(e){return a.trustAsHtml(e)},r.hidePanelLoading(),p.clearMessage=function(){y.workbenchDown=!1},p.showPanel=function(){p.showFilterPanel=!p.showFilterPanel,$("#gbDashboard-filter-panel-body .panel-collapse").collapse("hide")};p.updateFilter=function(e){y.logActivity(e.dashboardType,e.filterType,e.filterName)},p.showFilterCount=function(){p.filterCount=Object.keys(y.info.filter).length},p.checkAppliedFilters=function(){if(y.info.filter)return 0!=Object.keys(y.info.filter).length},p.clearAppliedFilters=function(){y.info.dType="allDashboards",y.info.createdBy="All",y.info.owner="All",y.info.datasource="All",y.info.lastModified="All",y.info.tagsFilter=[],y.info.filter={},p.filterApplied=!1},y.info.changePage=function(e,t){var a=angular.copy(y.dashboards);return(a=y.info.applyFilter(a,e)).length?(groupedData=y.info.groupbyColumn(a),t&&(a=y.info.pagination.sortByColumn(t,a)),y.info.pagination.data=a,y.info.pagination.process(),y.info.pagination.currentRecordsSet):[]},y.info.changePageSize=function(e,t,a){var n=angular.copy(y.dashboards);if(!(n=e&&e.length?y.info.applyFilter(n,e):n).length)return[];groupedData=y.info.groupbyColumn(n),a>(n=t?y.info.pagination.sortByColumn(t,n):n).length?y.info.pagination.endIndex=n.length:y.info.pagination.endIndex=a;return y.info.pagination.init(angular.copy(n)),y.info.pagination.currentRecordsSet},y.info.applyFilter=function(e,s){e=v.filterDashboardsNameTags(e,y.info.query);return e.filter(function(e){for(var t=0;t<s.length;t++){var a=!1,n=s[t].columnName,i=s[t].columnValue;if("modified_ts"===n)i&&i[0]&&(!function(e,t){var a=(new Date).getTime(),n=864e5;switch(e){case"Last 24 Hrs":var i=new Date(a-n),o=new Date;break;case"Last Week":i=new Date(a-7*n),o=new Date;break;case"Last Month":i=new Date(a-30*n),o=new Date;break;case"Last 6 Month":i=new Date(a-180*n),o=new Date}e=new Date(t);return!!moment(e).isBetween(i,o)}(i[0],e[n])||(a=!0));else if("datasource"===n)for(var o=0;o<i.length;o++)e[n]&&e[n][0]&&e[n][0].name==i[o]&&(a=!0);else if("tag"===n)for(o=0;o<i.length;o++)e[n]&&e[n].length&&-1!=e[n].indexOf(i[o])&&(a=!0);else for(o=0;o<i.length;o++)e[n]==i[o]&&(a=!0);if(!a)return!1}return!0})},y.info.groupbyColumn=function(e){function n(e,t){var a=!1;if(0==e.length)e.push(t);else{for(var n=0;n<e.length;n++)if(e[n].name==t.name){e[n].count+=1,a=!0;break}a||e.push(t)}}var i=[{columnName:"type_to_display",columnTitle:"Type",customSelect:!1,multiselect:!1,data:[]},{columnName:"modified_ts",columnTitle:"Last Modified",customSelect:!0,multiselect:!1,data:h.getVal("lastModifiedArray")},{columnName:"gDOwner",columnTitle:"Owner",customSelect:!1,multiselect:!0,data:[]},{columnName:"datasource",columnTitle:"Data Sources",customSelect:!1,multiselect:!0,data:[]},{columnName:"tag",columnTitle:"Tags",customSelect:!1,multiselect:!0,data:[]}],o={};return e.map(function(e){if(e.type_to_display&&(o={name:e.type_to_display,count:1,selected:!1},n(i[0].data,o)),e.gDOwner&&(o={name:e.gDOwner,count:1,selected:!1},n(i[2].data,o)),e.tag)for(var t=e.tag,a=0;a<t.length;a++)o={name:t[a],count:1,selected:!1},n(i[4].data,o)}),i}}]).controller("SubscribeController",["$scope","content","schedules","$modalInstance","WorkbenchService","ModalService","x2js",function(e,t,a,n,i,o,s){var r=this;function l(e){var t=i.getWorkbooksLocal();t.loading=e,i.setWorkbooksLocal(t)}r.schedules=a,r.schedule=a[0],r.content=t,r.emailSubject=t.name,r.hideModal=function(){n.close("ok")},r.subscribe=function(){var e={subject:r.emailSubject,content_type:t.hasOwnProperty("views")?"Workbook":"View",content_id:t.id,schedule_id:r.schedule._id};l(!0),i.createSubscription(e).then(function(e){l(!1);var t,e=s.xml_str2json(e.data).tsResponse;e.hasOwnProperty("subscription")?((t=i.getSubscriptionsList()).push(e.subscription),i.setSubscriptionsList(t),o.alertBox({msg:"Subscribed successfully"})):o.alertBox({msg:"Unable to subscribe"})},function(e){l(!1),o.alertBox({msg:"Unable to subscribe"})}),r.hideModal()}}]).controller("UpdateSubscriptionController",["$scope","content","schedules","subscription","$modalInstance","WorkbenchService","ModalService","x2js",function(c,e,t,i,a,o,s,r){var n=this;if(n.hideModal=function(){a.close("ok")},!Array.isArray(i)||1!=i.length)return n.hideModal(),void s.alertBox({msg:"Subscription not found"});i=i[0],n.schedules=t,n.content=e,n.emailSubject=i._subject;for(var l=0;l<t.length;l++)t[l]._id==i.schedule._id&&(n.schedule=t[l]);function d(e){var t=o.getWorkbooksLocal();t.loading=e,o.setWorkbooksLocal(t)}n.updateSubscription=function(){var e={new_subject:n.emailSubject,new_schedule_id:n.schedule._id};d(!0),o.updateSubscription(i._id,e).then(function(e){d(!1);var t=r.xml_str2json(e.data).tsResponse;if(t.hasOwnProperty("subscription")){for(var a=o.getSubscriptionsList(),n=0;n<a.length;n++)if(a[n]._id==i._id){a[n]=t.subscription;break}o.setSubscriptionsList(a),s.alertBox({msg:"Updated subscription successfully"})}else s.alertBox({msg:"Unable to update subscription"})},function(e){d(!1),s.alertBox({msg:"Unable to update subscription"})}),n.hideModal()}}]).controller("UnsubscribeController",["$scope","content","subscription","$modalInstance","WorkbenchService","ModalService","x2js",function(e,t,i,a,o,s,n){var r=this;if(r.hideModal=function(){a.close("ok")},!Array.isArray(i)||1!=i.length)return r.hideModal(),void s.alertBox({msg:"Subscription not found"});function l(e){var t=o.getWorkbooksLocal();t.loading=e,o.setWorkbooksLocal(t)}i=i[0],r.content=t,r.unsubscribe=function(){l(!0),o.deleteSubscription(i._id).then(function(e){if(l(!1),e.data)s.alertBox({msg:"Unable to unsubscribe"});else{for(var t=o.getSubscriptionsList(),a=0,n=0;n<t.length;n++)if(t[n]._id==i._id){a=n;break}t.splice(a,1),o.setSubscriptionsList(t),s.alertBox({msg:"Unsubscribed successfully"})}},function(e){l(!1),s.alertBox({msg:"Unable to unsubscribe"})}),r.hideModal()}}]).controller("AddTagController",["$scope","workbook","$modalInstance","WorkbenchService","ModalService","Dashboards",function(e,t,a,n,i,o){var s=this;function r(e){var t=n.getWorkbooksLocal();t.loading=e,n.setWorkbooksLocal(t)}s.info={},s.workbook=t,s.tagList=[{tagName:""}],s.addTagRow=function(){s.tagList.push({tagName:""})},s.hideModal=function(){a.close("ok")},s.addTagToWorkbook=function(){var t=[];angular.forEach(s.tagList,function(e){e.tagName.length&&t.push(e.tagName)}),t.length&&(r(!0),n.addTagsToWorkbook(s.workbook.id,t).then(function(e){r(!1),n.updateWorkbooks()},function(e){r(!1),e=e,!s.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(s.info.sessionTimedOut=!0,s.hideModal(),i.sessionTimeout())})),s.hideModal()}}]).controller("UpdateWorkbookController",["$scope","workbook","$modalInstance","WorkbenchService","metaDataService","x2js","ModalService",function(e,t,a,n,d,i,o){var s=this;function r(e){var t=n.getWorkbooksLocal();t.loading=e,n.setWorkbooksLocal(t)}function l(e){!s.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(s.info.sessionTimedOut=!0,s.hideModal(),o.sessionTimeout())}s.workbook=t,s.info={},s.info.usersLoading=!0,s.info.showTabs=1==s.workbook.tabs,n.getUsers().then(function(e){s.info.usersLoading=!1;var t=i.xml_str2json(e.data).tsResponse.users.user;if(Array.isArray(t)){for(var a in s.info.supportedUsers=[],t)t[a]._name!=n.getTableauUser()&&"ServerAdministrator"!=t[a]._siteRole&&s.info.supportedUsers.push(t[a]);s.info.supportedUsers.length?(s.info.changeOwner=!0,s.info.changedOwner=""):s.info.changeOwner=!1}else s.info.changeOwner=!1},function(e){s.info.usersLoading=!1,l(e)}),s.hideModal=function(){a.close("ok")},s.updateWorkbook=function(){var e={bookId:s.workbook.id,showTabs:s.info.showTabs};s.info.changeOwner&&s.info.changedOwner&&(e.newOwnerId=s.info.changedOwner._id),r(!0),n.updateWorkbook(e).then(function(e){r(!1),n.updateWorkbooks()},function(e){r(!1),l(e)}),s.hideModal()}}]).controller("DeleteWorkbookController",["$scope","workbook","$modalInstance","WorkbenchService","$sce","ModalService","UserTrackingService",function(c,e,t,a,n,i,o){var s=this;function r(e){}function l(e){if(!s.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/))return s.info.sessionTimedOut=!0,i.sessionTimeout(),!0}function d(e){var t=a.getWorkbooksLocal();t.loading=e,a.setWorkbooksLocal(t)}function l(e){!s.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(s.info.sessionTimedOut=!0,s.hideModal(),i.sessionTimeout())}s.info={},s.workbook=e,s.msg="Are you sure you want to delete the report <b>"+s.workbook.name+"</b>",s.hideModal=function(){t.close("ok")},s.logActivity=function(e,t){o.standard_user_tracking("Dashboard","Other Dashboard",e,t).then(r,l)},s.deleteWorkbook=function(){d(!0),a.deleteWorkbook(s.workbook).then(function(e){d(!1),s.logActivity("Delete Workbook",JSON.stringify(s.workbook)),a.updateWorkbooks()},function(e){d(!1),l(e)}),s.hideModal()},s.renderHtml=function(e){return n.trustAsHtml(e)}}]).controller("LogiCtrl",["$scope","$sce",function(e,t){e.sceURL=function(e){return t.trustAsResourceUrl(e)}}]).controller("HealthCheckDashboardsCtrl",["$scope","$sce","$modal","$filter","Dashboards","GlobalService","AppService","ErrorService","UserTrackingService","$timeout","$window","$cookies","$location","InstanceHandler","ModalService","metaDataService","UtilService",function(r,o,e,l,d,c,a,u,n,t,s,h,b,v,f,g,y){var p=this;p.supportEmaill=c.getVal("supportEmail"),p.info={};var S,D;p.info.page={total:0,current:0,pages:0,count:5,selectAll:[],unSelectAll:[]},p.dashboardType="summary",p.summaryDash=[],p.flatMenuList=[],p.currentSelectedDashboardObj={},p.mainSelectedCategory="",p.roleAssignTitle=c.getVal("roleAssignTitle"),p.info.currentView="list",p.info.complete=!1,p.info.listViewError=!1,p.info.currentView="list",p.info.noSummary=!1,p.roles=[],p.loaded=!1,p.info.loadCount=0,p.info.createdBy="All",p.info.show_category=c.getVal("show_category"),p.info.sessionTimedOut=!1,p.info.internalLogin=!1,p.health_check_dashboards=[],p.info.securityToken="",p.endcustomers=[],p.info.application=c.getVal("navHealth"),p.endcustomerObjArray=[],healthcheck_dashboard_url="",end_cust_label="",end_cust_value="",p.info.dashboardSortOrder=!0,p.info.dashboardSortOrderCB=!0,p.info.dashboardSortOrderOB=!0,p.info.dashboardSortOrderDOFM=!0,p.info.tag_max_characters=c.getVal("tag_maxlimit"),p.menuList=[],p.healthcheckModules=c.getVal("healthcheckModules"),r.orderProperty="dname";function w(e){for(var t=0;t<e.length;t++){var a=p.endcustomerObjArray.map(function(e){return e.label}),n={};n.label=e[t],n.value=e[t],-1==a.indexOf(e[t])&&p.endcustomerObjArray.push(n),p.info.ec_group_map[e[t]]&&p.info.ec_group_map[e[t]].length&&w(p.info.ec_group_map[e[t]])}}function M(e){}function V(e){if(!p.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/))return p.info.sessionTimedOut=!0,f.sessionTimeout(),!0}$.get("../config/constants/healthcheck_constants.json",function(e,t){r.htmconstdata=e}),a.getClinsightUrl().then(function(e){c.setVal("clinsightReportUrl",e.data.Data),c.setVal("clinsightFlag",0<e.data.Data.length),p.info.clinsightFlag=c.getVal("clinsightFlag")||!1,p.getMenuList(),d.getNotificationList(0,c.getVal("notification_page_size"),!1).then(function(e){e=e.data.Count;p.info.unreadCount=999<e?"999+":e,p.info.unreadCount_actual=999<e?e:p.info.unreadCount},function(e){console.error("Unable to load templates"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(c.logError(Object.values(c.getVal("errorMsgs"))[1]),r.info.addRuleMsg={type:"failure",msg:c.getVal("rulesMsgs").h2_down_msg})})},function(e){"true"==sessionStorage.getItem("clin_mode")&&sessionStorage.setItem("clin_mode","false"),console.error("Unable to load templates"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(c.logError(Object.values(c.getVal("errorMsgs"))[1]),r.info.addRuleMsg={type:"failure",msg:c.getVal("rulesMsgs").h2_down_msg})}),p.loadUnreadCountNotification=function(){d.getNotificationList(0,c.getVal("notification_page_size"),!1).then(function(e){e=e.data.Count;p.info.unreadCount=999<e?"999+":e,p.info.unreadCount_actual=999<e?e:p.info.unreadCount},function(e){console.error("Unable to load templates"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(c.logError(Object.values(c.getVal("errorMsgs"))[1]),r.info.addRuleMsg={type:"failure",msg:c.getVal("rulesMsgs").h2_down_msg})})},p.closeModal=function(){r.modalInstance.close()},d.getSecurityToken().then(function(e){p.info.securityToken=e.data.Data}),p.logout=function(){a.logoutSessionTimeout()},p.checkRoleSubmit=function(){var e=[];for(i=0;i<p.roles.length;i++)p.roles[i].selected&&e.push(p.roles[i].name);return 0==e.length||!p.showAddTagsDd()},p.checkCurrentRole=function(e){return g.getUser().role!=e.realName||!!p.chkAdminFeature()},p.addRoleConf=function(){var e=[];for(i=0;i<p.roles.length;i++)p.roles[i].selected&&e.push(p.roles[i].name);r.roles=e.length,r.modal1=f.openModal("partials/healthChk_add_role_conf.html",r,!1,!0)},p.addRoleSubmit=function(){for(var e=[],t=0;t<p.roles.length;t++)p.roles[t].selected&&e.push(p.roles[t].realName);for(var a=e.toString(),n=p.getAllDashboards(),t=(p.info.selectedBooks=[],0);t<n.length;t++)(n[t].selected&&n[t].d_id||n[t].selected)&&p.info.selectedBooks.push(n[t]);var i=[],o=[];for(t=0;t<p.info.selectedBooks.length;t++){if(p.info.selectedBooks[t].d_id){for(i[t]={},i[t].did=p.info.selectedBooks[t].d_id,i[t].rids=[],j=0;j<p.info.selectedBooks[t].f_reports.length;j++)o.push(p.info.selectedBooks[t].f_reports[j].r_id);i[t].rids=o.join(",")}else{for(i[t]={},i[t].did=p.info.selectedBooks[t].id,i[t].rids=[],j=0;j<p.info.selectedBooks[t].f_views.length;j++)o.push(p.info.selectedBooks[t].f_views[j].id);i[t].rids=o.join(",")}o=[]}d.addRolesToDashboards({roleaccess:{drids:i,roles:a}}).then(function(e){for(p.getDetails(),p.info.selectedBooks="",p.info.tags="",p.info.loading=!1,t=0;t<p.roles.length;t++)p.roles[t].selected=!1;p.info.assignRole="Select Roles"},function(e){p.info.selectedBooks="",p.info.tags="",p.info.loading=!1})},p.showUsers=function(){p.roleListLoading=!0,p.modalInstance=e.open({templateUrl:"partials/healtchk_user_role_list.html",scope:r}),d.showUsers().then(function(e){var t=e.data.Data,a=[],n={};for(p.roleUserList=[],i=0;i<t.length;i++)n.name=t[i].first_name+" "+t[i].last_name,n.email=t[i].email,3<t[i].role.split("_").length?n.role=t[i].role.split("_").splice(3,3).join("_"):n.role=t[i].role,a.push(n),n={};var o=[];for(i=0;i<p.roles.length;i++)o.push(p.roles[i].name);for(j=0;j<a.length;j++)-1==o.indexOf(a[j].role)&&(a.splice(j,1),j--);p.roleUserList=a,p.roleListLoading=!1})},p.getNameOfDashboard=function(e,t){var a="";return a=(a=e.dname?t&&e.dname.length>t?e.dname.substr(0,t)+"...":e.dname:a).toLowerCase()},p.getAllTagsName=function(){var e=[],t=[];if(null!=p.health_check_dashboardsDuplicate){for(var a=0;a<p.health_check_dashboardsDuplicate.length;a++){t=[],p.health_check_dashboardsDuplicate[a].tags&&(t=p.health_check_dashboardsDuplicate[a].tags),p.health_check_dashboardsDuplicate[a].tag&&(t=p.health_check_dashboardsDuplicate[a].tag);for(var n=0;n<t.length;n++)e.push(t[n])}return e=p.unique(e)}},p.unique=function(e){for(var t=[],a=0;a<e.length;a++)t.indexOf(e[a])<0&&t.push(e[a]);return t},p.getSheetThumbnailImage=function(e,t){if(!e||""==e)return"";var a="";return e.d_id?(a=e.d_id,c.getVal("dashboard_img_logi_path")+"/"+a+".png"):(e.id&&(a=e.id),p.info.workbenchApiRootDir+"/"+a+"/")},p.removeTagFromWorkbook=function(e,t){p.loaded=!1;e=e.d_id||e.id;d.removeTag(e,t).then(function(e){p.logActivity("Other Dashboards","Remove Tag","{'"+t+"'}"),p.getDetails(),p.loaded=!0},function(e){p.getDetails(),p.loaded=!0})},p.processMultipleTags=function(){p.info.tags=p.info.tags.trim(),p.info.tags=p.info.tags.replace(/ {1,}/g," "),p.info.tags=p.info.tags.replace(/ /g,","),p.info.tags=p.info.tags.replace(/,{1,}/g,","),p.info.tags=p.info.tags.replace(/^,/,""),p.info.tags=p.info.tags.replace(/,$/,"")},p.addTagsMultiple=function(){var e=p.getAllDashboards();p.processMultipleTags(),p.info.selectedBooks=[];for(var t=0;t<e.length;t++)e[t].selected&&p.info.selectedBooks.push(e[t]);if(p.info.tags&&0<p.info.selectedBooks.length)for(var a=[],n=[],t=0;t<p.info.selectedBooks.length;t++){for(a[t]={},a[t].did=p.info.selectedBooks[t].d_id,a[t].rids=[],j=0;j<p.info.selectedBooks[t].f_reports.length;j++)n.push(p.info.selectedBooks[t].f_reports[j].r_id);a[t].rids=n.join(","),n=[]}var i={tagging:{drids:a,tags:p.info.tags}};for(p.info.loadinaddTagsMultipleg=!0,t=0;t<p.info.selectedBooks.length;t++)p.info.selectedBooks[t].visibility=!p.info.selectedBooks[t].visibility,p.changeVisibility(p.info.selectedBooks[t]),p.info.selectedBooks[t].visibility=!p.info.selectedBooks[t].visibility;d.addTagsToDashboards(i).then(function(e){p.logActivity("Other Healthcheck Dashboards","Add Tags","{'"+p.info.tags+"'}"),p.getDetails(),p.hideModal(),p.info.selectedBooks=[],p.info.tags="",p.info.loading=!1},function(e){p.hideModal(),p.info.selectedBooks=[],p.info.tags="",p.info.loading=!1})},p.changeVisibility=function(t){p.info.loading=!0;var e=[],a={};for(t.visibility=!t.visibility,i=0;i<t.f_reports.length;i++)a.did=t.d_id,a.rids=t.f_reports[i].r_id,e.push(a);var n={visibility:{drids:e,isPublic:t.visibility,isTableau:!1}};t.visibility=!t.visibility,d.changeVisibility(n).then(function(e){p.info.loading=!1,p.logActivity("Other Dashboards","Change Visibility","{'"+t.dname+"'}"),p.getDetails()},function(e){})},p.addExistingTag=function(e){p.processMultipleTags(),-1==p.info.tags.split(",").indexOf(e)&&(""==p.info.tags?p.info.tags=e:p.info.tags=p.info.tags+","+e,p.isAlphaNumeric())},p.toggleSelectAll=function(e){if("all"==e){for(i=0;i<p.info.page.selectAll.length;i++)i!=p.info.page.current&&(p.info.page.selectAll[i]=!1,p.info.page.unSelectAll[i]=!1);p.info.page.selectAll[p.info.page.current]?p.info.page.unSelectAll[p.info.page.current]=!1:p.info.page.unSelectAll[p.info.page.current]=!0}else p.info.page.unSelectAll[p.info.page.current]=!1,p.info.page.selectAll[p.info.page.current]=!1;var t=p.getAllDashboards(),a=[];for(i=0;i<t.length;i++)t[i].selected&&a.push(t[i]);p.formatData()},p.localFilter=function(){0<p.info.page.current&&p.firstPage(),p.formatData()},p.showAddTagsDd=function(){for(var e=p.getAllDashboards(),t=0;t<e.length;t++)if(e[t].selected)return!0;return!1},p.changeView=function(e){p.info.currentView=e,p.info.currentBook=null,"list"==p.info.currentView?p.info.page.count=15:"thumbnail"==p.info.currentView&&(p.info.page.count=50),0<p.info.page.current&&p.firstPage()},p.userPermitted=function(){var e=g.getUser();return!!(g.getFeatures().workbench||1e3==e.org_type||100==e.org_type&&a.isGbStudioApp())},p.chkAdminFeature=function(){return!!g.getFeatures().admin},p.ifGlassbeamUser=function(){return g.getUserOrgType()==c.getVal("gbUserOrgType")},p.getBookOwnerName=function(e){return e.created_by},p.changeDateFormate=function(e){if(!e)return"";e=new Date(e);return e?p.makeTwoDigit(e.getMonth()+1)+"-"+p.makeTwoDigit(e.getDate())+"-"+p.makeTwoDigit(e.getFullYear())+" "+p.makeTwoDigit(e.getHours())+":"+p.makeTwoDigit(e.getMinutes())+":"+p.makeTwoDigit(e.getSeconds()):""},p.makeTwoDigit=function(e){return e=(e=parseInt(e,10))<10?"0"+e:e},p.getBookChangedOwnerName=function(e){return e.dashboardSecurityInfo.owner||e.created_by},p.showDashBoard=function(e,t){if(e.dname)if(p.chkAdminFeature())switch(t){case"dashLevel":case"tags":case"changeOwner":return!0;case"public":return!e.visibility;case"private":return!!e.visibility}else if(e.gDOwner==g.getUserEmail())switch(t){case"dashLevel":var a=g.getUser();return-1!=e.role_access.indexOf(a.role);case"tags":case"changeOwner":return!0;case"public":return!e.visibility;case"private":return!!e.visibility}else if(p.gDOwner!=g.getUserEmail())if(p.ifGlassbeamUser())if(p.chkAdminFeature())switch(t){case"dashLevel":return!0;case"tags":return!1;case"changeOwner":return!0;case"public":case"private":return!1}else switch(t){case"dashLevel":return!!e.visibility;case"tags":case"changeOwner":case"public":case"private":return!1}else if(e.visibility)switch(t){case"dashLevel":return!(!e.admin_dashboard||!g.getDashAdmin())||!e.admin_dashboard&&(a=g.getUser(),-1!=e.role_access.indexOf(a.role));case"tags":case"changeOwner":case"public":case"private":return!1}else switch(t){case"dashLevel":case"tags":case"changeOwner":case"public":case"private":return!1}else if(p.ifGlassbeamUser())switch(t){case"dashLevel":return!0;case"tags":return!1;case"changeOwner":return!0;case"public":case"private":return!1}else switch(t){case"dashLevel":case"tags":case"changeOwner":case"public":case"private":return!1}},p.userPermitted()?p.info.addDeleteTag=!0:p.info.addDeleteTag=!1,p.getAllDashboards=function(){return p.health_check_dashboards},p.updateOwnerConf=function(e,t){r.ownerName=e.email,r.userUpdate=e,r.bookUpdate=t,r.modal1=f.openModal("partials/healthcheck_owner_conf.html",r,!1,!0)},p.updateOwner=function(e,t){p.loaded=!1;var a=[],n={};for(i=0;i<t.f_reports.length;i++)n.did=t.d_id,n.rids=t.f_reports[i].r_id,a.push(n);g.getUser();e={ownership:{drids:a,owner:e.email,role:r.userUpdate.role,isTableau:!1}};d.updateOwner(e).then(function(e){p.logActivity("Other Dashboards","Change Owner","{'"+t.dname+"'}"),p.loaded=!0,p.getDetails()},function(e){})},p.healthDashboardLoading=function(){p.info.loadCount++,t(function(){p.hideLoadingMsg()}),(p.info.loadCount%2==0&&(navigator.userAgent.match(/Chrome/)||navigator.userAgent.match(/Safari/))||navigator.userAgent.match(/Firefox/)||navigator.userAgent.match(/Edge/))&&(angular.element("#content-loader-health-dboard")&&angular.element("#content-loader-health-dboard").addClass("gb-hide"),angular.element("#health-dashboard-iframe-div")&&angular.element("#health-dashboard-iframe-div").removeClass("gb-hide"))},p.sceURL=function(e){if(null!=e&&null!=p.endcustomers[0])return p.endcustomersobj=p.endcustomers[0],p.info.endcustlabel=p.endcustomersobj,p.info.endcustvalue=p.endcustomersobj,p.info.internalLogin&&(p.info.endcustlabel="None",p.info.endcustvalue="None"),o.trustAsResourceUrl(e)},p.sceHTML=function(e){return o.trustAsHtml(e)},r.$watch("healthCtrl.info.complete",function(){p.info.complete&&a.hidePanelLoading()}),r.$on("AppLoadEvent-healthcheck",function(e,t){console.log("tab active"),p.info.complete&&(a.hidePanelLoading(),p.showLoadingMsg(),p.setDashboard("summary"),p.info.createdBy="All",p.getDetails(),c.getVal("clinsightFlag")&&p.loadUnreadCountNotification())}),u.getErrors("gbApp")&&(p.info.complete=!0),p.showEndCustomerList=function(){return 1<p.endcustomers.length&&0<p.health_check_dashboards.length||!!(1<p.health_check_dashboards.length||p.info.internalLogin)},p.showDashboardList=function(){return 1<p.health_check_dashboards.length||1<p.endcustomers.length&&0<p.health_check_dashboards.length},p.showSingleDashboard=function(){return 1<=p.endcustomers.length&&1==p.health_check_dashboards.length},p.setDashboard=function(e){p.dashboardType=e},p.updateCreatorName=function(e){p.info.dUserName=[];for(var t=0;t<e.length;t++)p.isDuplicateArrayObject(p.info.dUserName,e[t].created_by)||p.info.dUserName.push(e[t].created_by)},p.getDCreatorName=function(){return p.info.dUserName},p.isDuplicateArrayObject=function(e,t){for(var a=0;a<e.length;a++)if(e[a]==t)return!0;return!1},p.addInstance=function(e){healthcheck_dashboard_url=e.r_link,p.info.selectedItem&&""!=p.info.selectedItem?(end_cust_label=p.info.selectedItem.label,end_cust_value=p.info.selectedItem.value,e={type:"dashboard",healthCheck:!0,name:e.rname,data:{report:e}},v.addInstance(e,r)):f.alertBox({msg:"Please select customer!"})},p.formatData=function(){var e=l("filterBooks")(p.health_check_dashboardsDuplicate,p.info.query);if(!e.length)return p.info.page.pages=0,p.health_check_dashboards=[],[];var t=e.length,a=t;if(p.info.page.total=a,p.info.page.pages=Math.ceil(p.info.page.total/p.info.page.count),!p.selectAllFlag){for(i=0;i<p.info.page.pages;i++)p.info.page.selectAll[i]=!1,p.info.page.unSelectAll[i]=!1;p.selectAllFlag=!0}for(var a=p.info.page.current*p.info.page.count,n=a+p.info.page.count,o=(t<=n&&(n=t),[]),s=a;s<n;s++)p.info.page.selectAll[p.info.page.current]&&p.showDashBoard(e[s],"tags")&&(e[s].selected=!0),p.info.page.unSelectAll[p.info.page.current]&&(e[s].selected=!1),o.push(e[s]);p.health_check_dashboards=o,p.health_check_dashboards.length&&0!=p.health_check_dashboards.length||(p.info.page.pages=0)},p.nextPage=function(){p.info.page.current<p.info.page.pages-1&&(p.info.page.current+=1,p.getDetails())},p.prevPage=function(){0<p.info.page.current&&(--p.info.page.current,p.getDetails())},p.firstPage=function(){0!=p.info.page.current&&(p.info.page.current=0,p.getDetails())},p.lastPage=function(){p.info.page.current!=p.info.page.pages-1&&(p.info.page.current=p.info.page.pages-1,p.getDetails())},p.getDetails=function(){null==p.dashOwnerListLogi&&d.getLogiAdmin().then(function(e){p.dashOwnerListLogi=e.data.Data}),d.allDetails().then(function(e){d.getRolesHealthChk().then(function(e){var t,a,n=e.data.Data;for(p.roles=[],i=0;i<n.length;i++)""!=n[i]&&(t={},3<(a=n[i].split("_")).length?t.name=a.splice(3,3).join("_"):t.name=n[i],t.realName=n[i],t.selected=!1,p.roles.push(t))});var n,t,a=g.getUser();for(p.info.internalLogin=!!a&&!a.is_external,"true"==sessionStorage.getItem("clin_mode")?c.getVal("clinsightReportUrl").length?(a=new URL(c.getVal("clinsightReportUrl")),t=new URLSearchParams(a.search),n={},t.forEach(function(e,t){n[t]="rdReport"==t?c.getVal("healthcheck_rd_report"):e}),Object.keys(sessionStorage).forEach(function(e){"clin_mode"==e&&"mps"==e&&"notificationId"==e||(n[e]=sessionStorage.getItem(e))}),t=Object.keys(n).reduce(function(e,t){var a=n[t];return e="rdReport"==t?e+t+"="+a:e+"&"+t+"="+a},"?"),a.search=t,p.summaryDash=l("filter")(e.data.Data.dashboards,{d_type:c.getVal("HealthCheckSummary")}),0<p.summaryDash.length&&(p.summaryDash[0].reports[0].r_link=a.href),console.log(a.href),sessionStorage.setItem("clin_mode","false"),sessionStorage.getItem("notificationId")&&(t={notificationIds:[sessionStorage.getItem("notificationId")]},p.markReadNotification(t,!0),p.logActivity("Push Notification clicked",JSON.stringify(t)))):(sessionStorage.setItem("clin_mode","false"),p.summaryDash=l("filter")(e.data.Data.dashboards,{d_type:c.getVal("HealthCheckSummary")})):p.summaryDash=l("filter")(e.data.Data.dashboards,{d_type:c.getVal("HealthCheckSummary")}),p.health_check_dashboards=l("filter")(e.data.Data.dashboards,{d_type:"External"}),p.summaryDash.length&&p.health_check_dashboards.push(p.summaryDash[0]),p.health_check_dashboardsDuplicate=p.health_check_dashboards,p.updateCreatorName(p.health_check_dashboards),p.copyOfDashBoards=angular.copy(p.health_check_dashboards),0!=p.summaryDash.length&&null!=p.summaryDash||(p.setDashboard("other"),p.info.noSummary=!0),console.log(p.summaryDash),i=0;i<p.health_check_dashboards.length;i++){p.health_check_dashboards[i].gDUser=p.getBookOwnerName(p.health_check_dashboards[i]),p.health_check_dashboards[i].visibility=p.health_check_dashboards[i].dashboardSecurityInfo.is_public,p.health_check_dashboards[i].gDOwner=p.getBookChangedOwnerName(p.health_check_dashboards[i]),p.health_check_dashboards[i].gDTs=p.changeDateFormate(p.health_check_dashboards[i].modified_ts);var o=[],s={};if(p.health_check_dashboards[i].role_access){for(m=0;m<p.health_check_dashboards[i].role_access.length;m++)(s={}).realName=p.health_check_dashboards[i].role_access[m],3<p.health_check_dashboards[i].role_access[m].split("_").length?s.name=p.health_check_dashboards[i].role_access[m].split("_").splice(3,3).join("_"):s.name=p.health_check_dashboards[i].role_access[m],o.push(s);p.health_check_dashboards[i].role_access_dis=o}else p.health_check_dashboards[i].role_access=[]}d.getEndCustomers().then(function(e){if(p.endcustomers=e.data.Data,p.endcustomersobj=g.getUserEndCustomer(),p.info.internalLogin){if(!p.endcustomers||!p.endcustomers.length||p.endcustomers.length<1)return p.hideLoadingMsg(),u.setError(p.info.application,c.getVal("no_end_customer")),p.info.listViewError=!0,p.info.listViewErrorMsg="End customer list is missing, please contact "+c.getVal("dashmodeadminemail"),!1;if(""===p.endcustomersobj||"NA"===p.endcustomersobj){for(var t=["All"],a=0;a<p.endcustomers.length;a++)t.push(p.endcustomers[a].endcustomer_name);t=t.filter(function(e,t,a){return a.indexOf(e)==t}),p.endcustomerObjArray=[];for(a=0;a<t.length;a++)S=t[a],D=t[a],(tempObj={}).label=S,tempObj.value=D,p.endcustomerObjArray.push(tempObj);p.endcustomers=p.endcustomerObjArray,p.info.selectedItem=p.endcustomerObjArray[0],p.setCustomerName(),p.formatData()}else{p.endcustomersobj=g.getUserEndCustomer(),p.info.endcustlabel=p.endcustomersobj,p.info.endcustvalue=p.endcustomersobj,p.info.selectedItem={};var n={label:p.info.endcustlabel,value:p.info.endcustvalue},i=(p.endcustomerObjArray.push(n),p.info.selectedItem=p.endcustomerObjArray[0],p.endcustomers.filter(function(e){return e.endcustomer_name===p.info.endcustlabel}));p.info.ec_group_map={},p.endcustomers.map(function(e){e.group_name.length&&(p.info.ec_group_map[e.endcustomer_name]=e.group_name)}),w(i[0].group_name),p.setCustomerName(),p.formatData(),p.hideLoadingMsg()}}else{if("NA"==p.endcustomers||null==p.endcustomers)return p.hideLoadingMsg(),p.noUserEndCustomerError=c.getVal("noUserEndCustomerError"),p.supportEmail=c.getVal("supportEmail"),r.modal1=f.openModal("partials/noUserEndcustomerPopup.html",r,!1,!0),!1;p.endcustomerObjArray=[],p.endcustomersobj=g.getUserEndCustomer(),p.info.endcustlabel=p.endcustomersobj,p.info.endcustvalue=p.endcustomersobj,p.info.selectedItem={};n={label:p.info.endcustlabel,value:p.info.endcustvalue},i=(p.endcustomerObjArray.push(n),p.info.selectedItem=p.endcustomerObjArray[0],p.endcustomers.filter(function(e){return e.endcustomer_name===p.info.endcustlabel}));p.info.ec_group_map={},p.endcustomers.map(function(e){e.group_name.length&&(p.info.ec_group_map[e.endcustomer_name]=e.group_name)}),w(i[0].group_name),p.setCustomerName(),p.hideLoadingMsg()}p.hideLoadingMsg()},function(e){p.apiFailed(e)})},function(e){p.apiFailed(e)})},p.getDetails(),p.apiFailed=function(e){p.hideLoadingMsg(),p.health_check_dashboards.length=0,V(e)||u.setError(p.info.application,c.getVal("data_fail"))},p.loadSingleDashboard=function(){t(function(){p.loaded=!0},5e3),p.r_link=p.health_check_dashboards[0].reports[0].r_link,p.r_name=p.health_check_dashboards[0].reports[0].rname,p.d_name=p.health_check_dashboards[0].dname,p.logActivity("Default Load","{'"+p.r_name+"'}")},p.hideLoadingMsg=function(){p.loaded=!0},p.showLoadingMsg=function(){p.loaded=!1},p.logActivity=function(e,t){n.standard_user_tracking(p.info.application,p.info.application,e,t).then(M,V)},p.logClinsightsActivity=function(e,t,a){n.standard_user_tracking("clinsights Web",e,t,a).then(M,V)},p.search=function(){return{rdesc:p.info.query}},p.setCustomerName=function(){var e,t=p.info.selectedItem,a=v.getInstances(),t=(end_cust_label=t.label,end_cust_value=t.value,c.getVal("primaryDomain")),n="";for(p.summaryDash.length&&(n=p.summaryDash[0].reports[0].r_link),document.cookie=c.getVal("dashboard_link_endcustomer_label")+"="+end_cust_label+";domain=."+t+";path=/",document.cookie=c.getVal("dashboard_link_endcustomer_value")+"="+end_cust_value+";domain=."+t+";path=/",i=0;i<a.length;i++)a[i].healthCheck&&((e=document.getElementsByClassName("idashboard-"+a[i].md5))[0].src=e[0].src);""!=n&&document.getElementById("health-dashboardiframe").contentWindow.location.replace(n)},p.toggleDashboard=function(e){e.expand=!e.expand},p.filterResult=function(){var e,t=!0;if(p.info.complete&&p.getError()&&!p.getError().length){for(e in p.health_check_dashboards)null!=p.health_check_dashboards[e].f_reports&&p.health_check_dashboards[e].f_reports.length&&(t=!1);return t}return!1},p.removeRoleConf=function(e,t){r.roleToRemove=t,r.roleEditBook=e,r.roleName=t.name,r.modal1=f.openModal("partials/dashboard_remove_role_conf_healthChk.html",r,!1,!0)},p.removeRoleFromWorkbook=function(e,t){p.showLoadingMsg();e=e.d_id||e.id;d.removeRole(e,t.realName).then(function(e){p.logActivity("Healthchk Dashboards","Remove Role","{'"+t+"'}"),p.getDetails(),p.hideLoadingMsg()},function(e){p.getDetails(),p.hideLoadingMsg()})},p.getError=function(){return u.getErrors(p.info.application)},p.getMessage=function(){return c.getVal("filter_fail")},p.renderHtml=function(e){return o.trustAsHtml(e)},p.sortItems=function(e){r.orderProperty===e?r.orderProperty="-"+e:(r.orderProperty,r.orderProperty=e)},p.filterByHealthCheckCreator=function(e,t){var a=angular.copy(p.copyOfDashBoards);for(p.health_check_dashboards="All"===e?a:l("filterArrayItems")(a,e,t),i=0;i<p.health_check_dashboards.length;i++)p.health_check_dashboards[i].gDUser=p.getBookOwnerName(p.health_check_dashboards[i]),p.health_check_dashboards[i].visibility=p.health_check_dashboards[i].dashboardSecurityInfo.is_public,p.health_check_dashboards[i].gDOwner=p.getBookChangedOwnerName(p.health_check_dashboards[i]),p.health_check_dashboards[i].gDTs=p.changeDateFormate(p.health_check_dashboards[i].modified_ts)},p.hideModal=function(){p.info.tags="",p.modalInstance&&p.modalInstance.close("ok")},p.selectAllRole=function(){var e=[];for(i=0;i<p.roles.length;i++)p.roles[i].selected=!0,e.push(p.roles[i].name);p.info.assignRole=e.toString()},p.clearAllRole=function(){for(i=0;i<p.roles.length;i++)p.roles[i].selected=!1,p.info.assignRole="Select Roles"},p.showMsg=function(){return""!=p.info.errMsg},p.getHealthDashLength=function(){for(var e=0,t=0;t<p.health_check_dashboards.length;t++)p.showDashBoard(p.health_check_dashboards[t],"dashLevel")&&e++;return e},p.getAllTagsNameOfSelectedDashboards=function(){for(var e=[],t=[],a=p.getAllDashboards(),n=0;n<a.length;n++){t=[],a[n].selected&&a[n].tags&&(t=a[n].tags),a[n].selected&&a[n].tag&&(t=a[n].tag);for(var i=0;i<t.length;i++)e.push(t[i])}return e=p.unique(e)},p.isAlphaNumeric=function(){var e=p.info.tags.split(/,|\s/),t=[],a=!1;if(""!=p.info.tags){for(var n=p.getAllTagsNameOfSelectedDashboards(),i=0;i<e.length;i++){var o=e[i];if(""!=o){if(o.length>p.info.tag_max_characters)return a=!0,void(p.info.errMsg=c.getVal("dashboard_tagname_max_len"));if(!o.match(/^[0-9a-zA-Z]+$/))return a=!0,void(p.info.errMsg=c.getVal("dashboard_tagname_special_char"));for(var s=0;s<n.length;s++)n[s]==o&&(a=!0,t.push(o))}}0<t.length?p.info.errMsg=c.getVal("dashboard_tagbname_duplicate")+t.join(", "):a||(p.info.errMsg="")}else p.info.errMsg=""},p.openTagSubscription=function(){p.info.tagLoading=!0,p.info.allTagaSelected=!1,p.info.tagUnsubscribeBtn=!0,p.info.tagSubscribeBtn=!0,r.modalInstance=f.openModal("partials/dashboards/tagSubscription.html",r,"gb-tag-subscription-modal",!0,"static"),d.getPredefinedTagList().then(function(e){p.info.pretagList=_.sortBy(e.data.Data,"tag_name").map(function(e,t){return e.selected=!1,e}),p.info.tagLoading=!1},function(e){p.info.pretagList=[],p.info.tagLoading=!1,console.error("Unable to load templates"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(c.logError(Object.values(c.getVal("errorMsgs"))[1]),r.info.addRuleMsg={type:"failure",msg:c.getVal("rulesMsgs").h2_down_msg})})},p.reloadTags=function(){d.getPredefinedTagList().then(function(e){p.info.pretagList=e.data.Data.map(function(e){return e.selected=!1,e}),p.info.tagLoading=!1},function(e){p.info.pretagList=[],p.info.tagLoading=!1,console.error("Unable to load templates"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(c.logError(Object.values(c.getVal("errorMsgs"))[1]),r.info.addRuleMsg={type:"failure",msg:c.getVal("rulesMsgs").h2_down_msg})})},p.selectAllTags=function(){p.info.allTagaSelected?p.info.pretagList.forEach(function(e){e.selected=!0}):p.info.pretagList.forEach(function(e){e.selected=!1}),p.updateBtnStatus()},p.subscribeTag=function(e,t,a){var n;p.info.tagLoading=!0,n=a?{tag_ids:p.getBulkTagId(t),emailId:g.getUserEmail()}:{tag_ids:[e.tag_id],emailId:g.getUserEmail()},d.subscribeUnsubscribeTag(n,t).then(function(e){p.info.addTemplateMsg={type:"success",msg:t?"subscribed successfully":"unsubscribed successfully"},setTimeout(function(){p.clearMessage()},3e3),p.reloadTags(),p.logClinsightsActivity(p.healthcheckModules.subscription,t?"Subscribe Tag":"Unsubscribe Tag",JSON.stringify(n))},function(e){console.error("Unable to subscribe"),p.info.addTemplateMsg={type:"failure",msg:t?"failed to subscribe":"failed to Unsubscribe"},p.info.tagLoading=!1,setTimeout(function(){p.clearMessage()},3e3),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(c.logError(Object.values(c.getVal("errorMsgs"))[1]),r.info.addRuleMsg={type:"failure",msg:c.getVal("rulesMsgs").h2_down_msg})})},p.getBulkTagId=function(e){return e?p.info.pretagList.filter(function(e){return(0===e.rules_subscribed&&0<e.enabled_rules||e.enabled_rules>e.rules_subscribed&&0!=e.rules_subscribed)&&e.selected}).map(function(e){return e.tag_id}):p.info.pretagList.filter(function(e){return(e.rules_subscribed===e.enabled_rules&&0!=e.enabled_rules||e.enabled_rules>e.rules_subscribed&&0!=e.rules_subscribed)&&e.selected}).map(function(e){return e.tag_id})},p.updateBtnStatus=function(){0<p.info.pretagList.filter(function(e){return(0===e.rules_subscribed&&0<e.enabled_rules||e.enabled_rules>e.rules_subscribed&&0!=e.rules_subscribed)&&e.selected}).length?p.info.tagSubscribeBtn=!1:p.info.tagSubscribeBtn=!0,0<p.info.pretagList.filter(function(e){return(e.rules_subscribed===e.enabled_rules&&0!=e.enabled_rules||e.enabled_rules>e.rules_subscribed&&0!=e.rules_subscribed)&&e.selected}).length?p.info.tagUnsubscribeBtn=!1:p.info.tagUnsubscribeBtn=!0},r.initNotification=function(){p.info.noti_pagination={},p.info.noti_pagination.pageSize=c.getVal("notification_page_size"),p.info.noti_pagination.startIndex=0,p.info.noti_pagination.endIndex=p.info.noti_pagination.pageSize,p.info.noti_pagination.total=0,p.info.noti_pagination.paginationText="showing "+(p.info.noti_pagination.startIndex+1)+" to "+p.info.noti_pagination.endIndex+" of "+p.info.noti_pagination.total,p.info.noti_pagination.unreadFilter=!0,p.info.noti_pagination.readFilter=!1,p.info.noti_pagination.allFilter=!1,p.info.scrollPosition=0,p.info.unreadCount_actual=0},p.info.unreadCount=0,p.info.noti_filter={unread:!1,read:!1,all:!0},p.updateUnreadCount=function(e){p.info.noti_filter.unread&&(e=e.data.Count,p.info.unreadCount=999<e?"999+":e,p.info.unreadCount_actual=999<e?e:p.info.unreadCount),(p.info.noti_filter.all||p.info.noti_filter.read)&&d.getNotificationList(0,c.getVal("notification_page_size"),!1).then(function(e){e=e.data.Count;p.info.unreadCount=999<e?"999+":e,p.info.unreadCount_actual=999<e?e:p.info.unreadCount},function(e){console.error("Unable to load templates"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(c.logError(Object.values(c.getVal("errorMsgs"))[1]),r.info.addRuleMsg={type:"failure",msg:c.getVal("rulesMsgs").h2_down_msg})})},p.setNotificationTime=function(e){e=new Date(e);return(new Date).getDate()==e.getDate()&&(new Date).getMonth()+1==e.getMonth()+1?"Today at "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds():e.getDate()+"-"+(e.getMonth()+1)+"-"+e.getFullYear()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},p.fetchNotification=function(t,a){t||r.initNotification(),p.info.notificationLoading=!0,p.info.deletebtnStatus=!0,p.info.readbtnStatus=!0,p.info.allNotificationSelected=!1,p.info.selectedTagsCount=0,p.info.notificationList=[];var e=p.info.noti_pagination.startIndex,n=p.info.noti_pagination.endIndex,i=null;p.info.noti_filter.unread?i=!1:p.info.noti_filter.read&&(i=!0),p.notiMapFn=function(e){return e.selected=!1,e.display_time=p.setNotificationTime(e.sent_time),e.alert_filter=e.alert_filter.length?JSON.parse(e.alert_filter):{},e.readLessText=o.trustAsHtml(e.body.substring(0,115)+"..."),e.moreBtn=!0,e.lessBtn=!1,e.details=o.trustAsHtml(e.body+" <br />  "+e.details.replace(/\n/g," <br />  ")),e},d.getNotificationList(e,n,i).then(function(e){t?(p.info.notificationList=[],p.info.notificationList=e.data.Data.map(p.notiMapFn)):p.info.notificationList=p.info.notificationList.map(function(e){return e.selected=!1,e}).concat(e.data.Data.map(p.notiMapFn)),p.info.noti_pagination.total=e.data.Count,p.updatePageinationText(),p.updateUnreadCount(e),p.showHideNotiLoading(!1),a&&a(),setTimeout(function(){t&&p.setScrollPosition()})},function(e){p.showHideNotiLoading(!1),p.showFail(),p.info.notificationList=[],console.error("Unable to load templates"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(c.logError(Object.values(c.getVal("errorMsgs"))[1]),r.info.addRuleMsg={type:"failure",msg:c.getVal("rulesMsgs").h2_down_msg})})},p.getSelectedNotification=function(){return p.info.notificationList.filter(function(e){return e.selected})},p.selectallNotification=function(){p.info.allNotificationSelected?p.info.notificationList.forEach(function(e){e.selected=!0}):p.info.notificationList.forEach(function(e){e.selected=!1}),p.updateNotificationSelectedCount()},p.getMarkRadPayload=function(){return{notificationIds:p.info.notificationList.filter(function(e){return e.selected&&!e.read}).map(function(e){return e.notification_id})}},p.singleMarkRead=function(e){var t={notificationIds:[e.notification_id]};p.info.notificationLoading=!0,d.markReadNotification(t,!0).then(function(e){p.resetPagination(),p.fetchNotification(!1,p.showSuccess),p.logClinsightsActivity(p.healthcheckModules.notification,"Mark read Notification",JSON.stringify(t))},function(e){p.showHideNotiLoading(!1),p.showFail(),console.error("Unable to mark notification as read"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(c.logError(Object.values(c.getVal("errorMsgs"))[1]),r.info.addRuleMsg={type:"failure",msg:c.getVal("rulesMsgs").h2_down_msg})})},p.markReadNotification=function(t,e){var a;e?d.markReadNotification(t,!0).then(function(e){p.logClinsightsActivity(p.healthcheckModules.notification,"Mark read Notification",JSON.stringify(t))},function(e){console.error("Unable to mark notification as read"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(c.logError(Object.values(c.getVal("errorMsgs"))[1]),r.info.addRuleMsg={type:"failure",msg:c.getVal("rulesMsgs").h2_down_msg})}):(p.info.notificationLoading=!0,a=p.getMarkRadPayload(),d.markReadNotification(a,!0).then(function(e){p.resetPagination(),p.fetchNotification(!1,p.showSuccess),p.logClinsightsActivity(p.healthcheckModules.notification,"Mark read Notification",JSON.stringify(a))},function(e){p.showHideNotiLoading(!1),p.showFail(),console.error("Unable to mark notification as read"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(c.logError(Object.values(c.getVal("errorMsgs"))[1]),r.info.addRuleMsg={type:"failure",msg:c.getVal("rulesMsgs").h2_down_msg})}))},p.singleDelete=function(e){e={notificationIds:[e.notification_id]};p.deleteNotification(e)},p.deleteNotification=function(e){var t;p.info.notificationLoading=!0,t=e||{notificationIds:p.getSelectedNotification().map(function(e){return e.notification_id})},d.deleteNotification(t,!0).then(function(e){p.resetPagination(),p.fetchNotification(!1,p.showSuccess),p.logClinsightsActivity(p.healthcheckModules.notification,"Notification Deleted",JSON.stringify(t))},function(e){p.showHideNotiLoading(!1),p.showFail(),console.error("Unable to load templates"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(c.logError(Object.values(c.getVal("errorMsgs"))[1]),r.info.addRuleMsg={type:"failure",msg:c.getVal("rulesMsgs").h2_down_msg})})},p.updateNotificationSelectedCount=function(){p.info.selectedNotificationCount=p.info.notificationList.filter(function(e){return e.selected}).length,0<p.info.selectedNotificationCount?(p.info.deletebtnStatus=!1,p.info.readbtnStatus=!(0<p.info.notificationList.filter(function(e){return e.selected&&!e.read}).length)):(p.info.deletebtnStatus=!0,p.info.readbtnStatus=!0)},p.clearMessage=function(){p.info.successMsg="",p.info.errorMsg="",p.info.addTemplateMsg={}},p.notificationClick=function(t){t.read||(t.read=!0,e={notificationIds:[t.notification_id]},p.markReadNotification(e,!0),p.loadUnreadCountNotification()),p.saveScrollPosition(),p.info.notificationLoading=!0,p.showLoadingMsg(),console.log(t);var e=new URL(c.getVal("clinsightReportUrl")),a=new URLSearchParams(e.search),n={},a=(a.forEach(function(e,t){n[t]="rdReport"==t?c.getVal("healthcheck_rd_report"):e}),Object.keys(t.alert_filter).forEach(function(e){n[e]=t.alert_filter[e]}),Object.keys(n).reduce(function(e,t){var a=n[t];return e="rdReport"==t?e+t+"="+a:e+"&"+t+"="+a},"?"));e.search=a,0<p.summaryDash.length?(console.log(e.href),p.summaryDash[0].reports[0].r_link=e.href,document.getElementById("health-dashboardiframe").contentWindow.location.replace(e.href)):console.lg("error: no summary /clinsights dasboard available"),setTimeout(function(){p.hideLoadingMsg()},3e3),p.info.notificationLoading=!1,p.logClinsightsActivity(p.healthcheckModules.notification,"Notification clicked",JSON.stringify(t))},p.notificationFilterChange=function(e,t){for(var a in p.info.noti_filter)p.info.noti_filter[a]=a===e&&t;Math.max.apply(null,Object.values(p.info.noti_filter))||(p.info.noti_filter.unread=!0),p.resetPagination(),p.fetchNotification(),p.logClinsightsActivity(p.healthcheckModules.notification,"Notification filter changed",JSON.stringify(p.info.noti_filter))},p.showMore=function(){p.saveScrollPosition(),p.info.noti_pagination.endIndex=p.getPageEndIndex(),p.updatePageinationText(),p.fetchNotification(!0)},p.resetPagination=function(){p.info.noti_pagination.startIndex=0,p.info.noti_pagination.endIndex=c.getVal("notification_page_size")},p.getPageEndIndex=function(){return p.info.noti_pagination.endIndex+p.info.noti_pagination.pageSize>p.info.noti_pagination.total?p.info.noti_pagination.total:p.info.noti_pagination.endIndex+p.info.noti_pagination.pageSize},p.saveScrollPosition=function(){var e=document.getElementsByClassName("notification-main-container");p.info.scrollPosition=e[0].scrollTop},p.setScrollPosition=function(){document.getElementsByClassName("notification-main-container")[0].scrollTop=p.info.scrollPosition},p.resetScrollPosition=function(){document.getElementsByClassName("notification-main-container")[0].scrollTop=0},p.updatePageinationText=function(){p.info.noti_pagination.paginationText="showing "+(p.info.noti_pagination.startIndex+1)+" to "+(p.info.noti_pagination.endIndex<p.info.notificationList.length?p.info.noti_pagination.endIndex:p.info.notificationList.length)+" of "+p.info.noti_pagination.total},p.backToTop=function(){p.resetScrollPosition()},p.showHideNotiLoading=function(e){p.info.notificationLoading=e},r.$on("updateUnreadCount",function(){p.loadUnreadCountNotification()}),p.showSuccess=function(){p.info.notiSuccess=!0,setTimeout(function(){p.info.notiSuccess=!1},1900)},p.showFail=function(){p.info.notifail=!0,setTimeout(function(){p.info.notifail=!1},1900)},p.logShowDetails=function(e){p.logClinsightsActivity(p.healthcheckModules.notification,"Notification show details",JSON.stringify(e))},p.getMenuList=function(){d.getMenuList().then(function(e){var t=e.data.Data.clinsights_landing_page_report_url;p.menuList=e.data.Data.clinsights_menu,p.flatMenuList=flat(p.menuList),p.info.clinsights_base_url=e.data.Data.clinsights_base_url,p.info.clinsights_alert_msg=e.data.Data.clinsights_alert_msg,p.menuList.map(function(e){recurse(e)}),getParentNode(t)})},recurse=function(e){for(var t=0,a=e.children.length;t<a;t++)e.expanded=!1,recurse(e.children[t])},flat=function(e){var t=[];return e.forEach(function(e){t.push(e),Array.isArray(e.children)&&(t=t.concat(this.flat(e.children)))},this),t},getParentNode=function(t){p.flatMenuList.map(function(e){t===e.report_url&&(p.currentSelectedDashboardObj=e)})},p.showSubMenu=function(e,t){e.disable?f.alertBox({msg:p.info.clinsights_alert_msg}):(e.children.length&&(e.expanded=!e.expanded),e.report_url&&(getParentNode(e.report_url),e.parent_node_id===t.id&&(p.mainSelectedCategory=t),t=p.info.clinsights_base_url,e=e.report_url,t.includes("?cust_name=")?p.summaryDash[0].reports[0].r_link=t+"&rdReport="+e:p.summaryDash[0].reports[0].r_link=t+"?rdReport="+e))}}]),angular.module("gbApp.services.dashboards",[]).factory("Dashboards",["$http","GlobalService","metaDataService",function(s,r,l){var a=[];return{setDashboard:function(e,t){a=e,t&&t.length&&(a=a.concat(t))},updateDashboards:function(e){a=e},getDashboards:function(){return a},getRoles:function(){var e=r.getVal("umsDomain");return s.get(e+"/admin/role/names/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),{cache:!1})},setSummaryDash:function(e,t){e=r.getVal("infoserverDomain")+"/dashboards/set/summary/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e+"/"+t;return s.post(e)},getRolesHealthChk:function(){var e=r.getVal("umsDomain");return s.get(e+"/admin/role/healthcheck/names/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),{cache:!1})},allDetails:function(){var e=r.getVal("infoserverDomain"),t=l.getUser().email.toLowerCase();return s.get(e+"/dashboards/all/details/merged/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/NA/"+t+"/NA?tableau=false",{cache:!1})},showUsers:function(){var e=r.getVal("infoserverDomain");return s.get(e+"/dashboards/users/list/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),{cache:!1})},getTableauAdmin:function(){var e=r.getVal("umsDomain");return s.get(e+"/user/tableauadmin/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),{cache:!1})},getLogiAdmin:function(){var e=r.getVal("umsDomain");return s.get(e+"/user/dashboardadmin/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),{cache:!1})},getSchedulingData:function(e,t){var a=r.getVal("infoserverDomain");return s.get(a+"/dashboards/details/scheduling/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e+"/"+t,{cache:!1})},updateSceduling:function(e){var t=r.getVal("infoserverDomain")+"/dashboards/add/scheduling/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e.d_id+"/"+e.r_id;return s.post(t,e)},changeVisibility:function(e){var t=r.getVal("infoserverDomain")+"/dashboards/update/visbility/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema");return s.post(t,e)},updateOwner:function(e){var t=r.getVal("infoserverDomain")+"/dashboards/update/owner/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema");return s.post(t,e)},getEndCustomers:function(e){var t=r.getVal("umsDomain");return s.get(t+"/healthcheck/ec/details/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"?fnCallSrcOpt=ADMIN_CONSOLE",{cache:!0})},addRolesToDashboards:function(e){var t=r.getVal("infoserverDomain")+"/dashboards/add/role/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema");return s.post(t,e)},addTagsToDashboards:function(e){var t=r.getVal("infoserverDomain")+"/dashboards/add/tag/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema");return s.post(t,e)},removeRole:function(e,t){var a=r.getVal("infoserverDomain");return s.post(a+"/dashboards/remove/role/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e+"/"+t)},removeTag:function(e,t){var a=r.getVal("infoserverDomain");return s.post(a+"/dashboards/remove/tag/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e+"/"+t)},getSecurityToken:function(){var e=r.getVal("infoserverDomain");return s.get(e+"/dashboards/trusted/ticket/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),{cache:!1})},getPredefinedTagList:function(){var e=l.getUser().email.toLowerCase(),e=r.getVal("infoserverDomain")+"/rules/tags/rules/list/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e;return s.get(e)},subscribeUnsubscribeTag:function(e,t){t=r.getVal("infoserverDomain")+"/tags/subscription/bulk_tags_subscription/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+t;return s.post(t,e)},getNotificationList:function(e,t,a){var n=l.getUser().email.toLowerCase(),i=r.getVal("umsDomain"),o="&deleted=false";return i=null==a?i+"/notification/list/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+n+"/"+e+"/"+t+"?"+o:i+"/notification/list/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+n+"/"+e+"/"+t+"?read="+a+o,s.get(i)},markReadNotification:function(e,t){var a=l.getUser().email.toLowerCase(),a=r.getVal("umsDomain")+"/notification/bulk_update/read/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+a+"/"+t;return s.post(a,e)},deleteNotification:function(e,t){var a=l.getUser().email.toLowerCase(),a=r.getVal("umsDomain")+"/notification/bulk_update/delete/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+a+"/"+t;return s.post(a,e)},getMenuList:function(){var e=l.getUser().email.toLowerCase(),e=r.getVal("umsDomain")+"/cs/mps/menu/tree/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"?user="+e;return s.get(e)}}}]),angular.module("gbApp.controllers.logvault",["gbApp.services.logvault","gbApp.services.analytics","gbApp.globals","ngTable"]).controller("LogVaultCtrl",["$scope","metaDataService","$filter","InstanceHandler","UserTrackingService","LogVaultService","Dashboards","ngTableParams","GlobalService","AppService","ModalService","$cookies","$window","$timeout","$interval","ExplorerService","NavigationService","MenuService","DefaultFilterService","SectionsMetaService","ConfigDiffService","RulesService","RulesTestWithLogvault","$sce",function(c,u,s,m,l,r,e,t,d,h,f,a,b,_,v,y,S,D,o,w,n,M,V,L){c.d3Data=[],c.todayDate=u.getTodayDate(),c.enableFacetStats=d.getVal("enableFacetStats"),c.d3Attr={height:180,width:800};function g(e){!c.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(c.info.sessionTimedOut=!0,f.sessionTimeout())}$.get("../config/constants/logvault_constants.json",function(e,t){c.htmconstdata=e}),c.reloadGraph=function(e){var t=[],a="";if(e&&e.obs_date&&e.obs_date.counts&&0!=e.obs_date.counts.length){if(0<=e.obs_date.gap.indexOf("YEAR"))for(a="Year View (UTC)",i=0;i<e.obs_date.counts.length/2;++i)t_data={},t_date=new Date(e.obs_date.counts[2*i].replace(/-/g,"/").replace("T"," ").substring(0,19)),t_data.name=t_date.getFullYear().toString(),t_data.value=e.obs_date.counts[2*i+1],t_data.link="j-drillDown-"+e.obs_date.counts[2*i],t_data.title=a,t.push(t_data);else if(0<=e.obs_date.gap.indexOf("MONTH"))for(a="Month View (UTC)",i=0;i<e.obs_date.counts.length/2;++i)t_data={},t_date=new Date(e.obs_date.counts[2*i].replace(/-/g,"/").replace("T"," ").substring(0,19)),t_data.name=t_date.getFullYear()+"-"+t_date.getMonthName().substring(0,3),t_data.value=e.obs_date.counts[2*i+1],t_data.link="j-drillDown-"+e.obs_date.counts[2*i],t_data.title=a,t.push(t_data);else if(0<=e.obs_date.gap.indexOf("DAY"))for(a="Day of Month View (UTC)",i=0;i<e.obs_date.counts.length/2;++i)t_data={},t_date=new Date(e.obs_date.counts[2*i].replace(/-/g,"/").replace("T"," ").substring(0,19)),t_data.name=(9<t_date.getDate()?t_date.getDate():"0"+t_date.getDate())+" "+t_date.getMonthName().substring(0,3),t_data.value=e.obs_date.counts[2*i+1],t_data.link="j-drillDown-"+e.obs_date.counts[2*i],t_data.title=a,t.push(t_data);else if(0<=e.obs_date.gap.indexOf("HOUR"))for(a="Hours View (UTC) (HH:MM Month-Date)",i=0;i<e.obs_date.counts.length/2;++i){t_data={};var n=e.obs_date.counts[2*i].replace(/-/g,"/").replace("T"," ").replace("Z","");t_date=new Date(n),t_data.name=(9<t_date.getHours()?t_date.getHours():"0"+t_date.getHours())+":"+(9<t_date.getMinutes()?t_date.getMinutes():"0"+t_date.getMinutes())+" "+t_date.getMonthName().substring(0,3)+" "+t_date.getDate(),t_data.value=e.obs_date.counts[2*i+1],t_data.link="j-drillDown-"+e.obs_date.counts[2*i],t_data.title=a,t.push(t_data)}else if(0<=e.obs_date.gap.indexOf("MINUTES"))for(a="Minutes View (UTC) (HH:MM)",i=0;i<e.obs_date.counts.length/2;++i){t_data={};var n=e.obs_date.counts[2*i].replace(/-/g,"/").replace("T"," ").replace("Z",""),o=(9<(t_date=new Date(n)).getHours()?t_date.getHours():"0"+t_date.getHours())+":"+(9<t_date.getMinutes()?t_date.getMinutes():"0"+t_date.getMinutes());t_data.name=o,t_data.value=e.obs_date.counts[2*i+1],t_data.link="j-drillDown-"+e.obs_date.counts[2*i],t_data.title=a,t.push(t_data)}else if(0<=e.obs_date.gap.indexOf("SECONDS"))for(a="Seconds View (UTC) (MM:SS)",i=0;i<e.obs_date.counts.length/2;++i){t_data={};n=e.obs_date.counts[2*i].replace(/-/g,"/").replace("T"," ").replace("Z",""),o=9<(t_date=new Date(n)).getSeconds()?t_date.getSeconds():"0"+t_date.getSeconds();t_data.name=o,t_data.value=e.obs_date.counts[2*i+1],t_data.title=a,t.push(t_data)}else for(a="Year View (UTC)",i=0;i<e.obs_date.counts.length/2;++i)t_data={},t_date=new Date(e.obs_date.counts[2*i].replace(/-/g,"/").replace("T"," ").substring(0,19)),t_data.name=t_date,t_data.value=e.obs_date.counts[2*i+1],t_data.link="j-drillDown-"+e.obs_date.counts[2*i],t_data.title=a,t.push(t_data);t.reverse(),c.d3Data=t;var s=v(function(){d3.select(".d3-chart-container").node().getBoundingClientRect().height&&(v.cancel(s),c.d3BarRender())},100);b.onresize=function(){return c.svg.selectAll("rect").remove(),c.d3BarRender()}}else c.d3Data=[]},c.d3BarRender=function(){var e=c.d3Data;y.getDrillDown()&&c.svg.selectAll("rect").remove(),void 0===c.svg&&(d3v4.selectAll(".d3-chart-container svg").remove(),c.d3margin={top:30,right:30,bottom:20,left:80},c.d3width=d3v4.select(".d3-chart-container").node().getBoundingClientRect().width-c.d3margin.left-c.d3margin.right,c.d3height=d3v4.select(".d3-chart-container").node().getBoundingClientRect().height-c.d3margin.bottom-c.d3margin.top,c.svg=d3v4.select(".d3-chart-container").append("svg").attr("width",c.d3width+c.d3margin.left+c.d3margin.right).attr("height",c.d3height+c.d3margin.top+c.d3margin.bottom).append("g").attr("transform","translate("+c.d3margin.left+","+c.d3margin.top+")"),c.x=d3v4.scaleBand().range([0,c.d3width]).padding(.2),c.xAxis=c.svg.append("g").attr("transform","translate(0,"+c.d3height+")").attr("class","myXaxis"),c.svg.append("text").attr("text-anchor","end").attr("transform","rotate(-90)").attr("y",15-c.d3margin.left).attr("x",-c.d3margin.top).text("Count").style("font-size","10px"),c.y=d3v4.scaleLinear().range([c.d3height,0]),c.yAxis=c.svg.append("g").attr("class","myYaxis")),0==e.length?(d3v4.selectAll(".d3-chart-container svg").remove(),c.svg=void 0,d3v4.select(".d3-chart-container").append("svg").attr("width",c.d3width+c.d3margin.left+c.d3margin.right).attr("height",c.d3height+c.d3margin.top+c.d3margin.bottom).append("g").attr("transform","translate("+c.d3margin.left+","+c.d3margin.top+")").append("text").attr("x",c.d3width/2).attr("y",c.d3height/2).style("font-size","12px").text("No Data Found")):c.updateGraphData(e)},c.updateGraphData=function(e){var t=d3v4.max(e,function(e){return e.value}),e=(void 0===c.graphtooltip&&(c.graphtooltip=d3.select("body").append("div").attr("class","graphtoolTip")),d3v4.selectAll(".chartTitleLog").remove(),c.svg.attr("class","chartlevel-"+c.info.chartLevel),c.x.domain(e.map(function(e){return e.name})),(c.x.domain().length<=10?c.xAxis.call(d3v4.axisBottom(c.x)):10<c.x.domain().length&&c.x.domain().length<50?c.xAxis.call(d3v4.axisBottom(c.x).tickValues(c.x.domain().filter(function(e,t){return!(t%3)}))):c.xAxis.call(d3v4.axisBottom(c.x).tickValues(c.x.domain().filter(function(e,t){return!(t%10)})))).selectAll("text").attr("x","0"),c.y.domain([-.02*t,d3v4.max(e,function(e){return e.value})]),c.yAxis.transition().duration(1e3).call(d3v4.axisLeft(c.y).tickValues([0,d3v4.max(e,function(e){return e.value})-.6666*d3v4.max(e,function(e){return e.value}),d3v4.max(e,function(e){return e.value})-.3333*d3v4.max(e,function(e){return e.value}),d3v4.max(e,function(e){return e.value})])),c.svg.append("text").attr("x",c.d3width/2).attr("y",0-c.d3margin.top/2).attr("class","chartTitleLog").style("font-size","12px").text(e[0].title),c.svg.selectAll("rect").data(e));e.enter().append("rect").on("click",function(e){"SECONDS"!=c.info.chartLevel&&(c.graphtooltip.remove(),c.graphtooltip=void 0,drillDown(e.link))}).merge(e).on("mousemove",function(e){c.graphtooltip.style("left",d3v4.event.pageX-50+"px").style("top",d3v4.event.pageY-70+"px").style("display","inline-block").html("<small>"+e.name+"</small><br><b>"+e.value+"</b>")}).on("mouseout",function(e){c.graphtooltip.style("display","none")}).attr("x",function(e){return-1*(c.x.bandwidth()+c.x(e.name))}).attr("transform","rotate(180)").attr("y",-1*c.y(-.02*t)).attr("title",function(e){return e.value}).transition().duration(1e3).attr("width",c.x.bandwidth()).attr("height",function(e){return 0===e.value?0:c.d3height-c.y(e.value)}).attr("fill","#0079c1"),e.exit().remove(),c.svg.selectAll("rect").attr("class","cursor-pointer"),c.svg.selectAll("circle").attr("class","cursor-pointer")},c.timelineGraphDrilDown=[],c.customDateFilter=!0,c.customDateFilterApplied=!0,c.dateRangeFilterName=d.getVal("customdate"),c.selectedFacets={},c.selectedFacetsList=[],c.bundleList=[],c.appliedFacets={},c.info={},c.info.init=!1,c.info.no_result=!1,c.info.uploaded_by=null,c.info.fileLists=[],c.info.pristine=!0,c.info.changedFilter=!1,c.info.defaultFilterInfo={},c.info.nsr_enabled=u.getDomain().nsr_enabled,c.info.resultLoading=!0,c.info.facetLoading=!0,c.info.dataLoading=!0,c.info.quick=null,c.info.showOTime=!1,c.info.fromDate=null,c.info.fromTime={},c.info.toDate=null,c.info.toTime={},c.info.fData=[],c.info.allConfigLoading=!0,c.info.default_days=0,c.info.fields=[],c.info.chartLevel="YEAR",c.info.defaultLevel="YEAR",c.info.refCount=0,c.info.dashboardsLoadCount=0,c.info.defaultFilterSelected=!1,c.info.defaultState=!0,c.info.currentViewID=null,c.info.facetLimit=d.getVal("facets_limit"),c.info.initialLoading=!1,c.info.dashboardsLoaded=!1,c.info.firstDataLoaded=!1,c.info.application=d.getVal("navLog"),c.info.logvault_to_explorer=!1,c.toggleChartCnt=!0,c.info.toggleTimeline=!0,c.fromRulesTestPage=V,c.testBundleMsg="Select Bundles",c.showMessageToSelectBundleToUploadModal=null,c.selectBundleToUploadForTest=d.getVal("select_bundle_to_upload_for_test"),c.showTestRuleIcon=!1,c.selectBundleNotification=!1,c.info.response={docs:[],numFound:0},c.info.selectedFilterName="Select View",c.info.page={total:0,current:0,pages:0,count:10},c.info.facetCharts=[],c.info.sort_order={label:"Latest",val:"desc"},c.info.NSRReportUrl="",c.info.sessionTimedOut=!1,c.openFacetStatsPopup=function(e,t){c.facetStats=e.label;var a=[],n=0,o=c.meanFacetValue=0;for(i=0;i<e.data.length;i++)a.push(e.data[i]),n+=e.data[i].value;for(c.facetValueSum=n,c.meanFacetValue=n/e.data.length,i=0;i<a.length;i++)a[i].perc=(100*a[i].value/n).toFixed(2),a[i].stdDev=(a[i].value-c.meanFacetValue)*(a[i].value-c.meanFacetValue);var s=(c.facetData=a).sort(function(e,t){return e.value<t.value?1:-1}).slice(0,10),r=a.sort(function(e,t){return e.value>t.value?1:-1}).slice(0,10);for(i=0;i<a.length;i++)o=Math.floor(o+a[i].stdDev);c.stdDevValue=Math.sqrt(o/a.length),c.top10facet=s.sort(function(e,t){return d3.descending(e.value,t.value)}),c.bottom10facet=r.sort(function(e,t){return d3.descending(e.value,t.value)}),c.maxFacetValue=c.top10facet[0].value,c.minFacetValue=c.bottom10facet[0].value,c.modalInstance=f.openModal("partials/explorer/facetstats.html",c),l.standard_user_tracking(c.info.application,c.info.events?"Event":"Section","Open facet stats popup",JSON.stringify(e)).then(p,g)},c.updateBreadCrumb=function(e,t){var a;c.customDateFilterApplied=!1,c.customDateFilter=!0,c.dateRangeFilterName=d.getVal("customdate"),c.info.changedFilter=!1,c.info.drillDown=!0,c.info.uploaded_by=null,0==c.timelineGraphDrilDown.length&&(a=new Date(c.info.fromDate.getFullYear(),c.info.fromDate.getMonth(),c.info.fromDate.getDate(),c.info.fromTime.hr,c.info.fromTime.min,c.info.fromTime.sec),e=moment(a),e=new Date(e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second()),a=new Date(c.info.toDate.getFullYear(),c.info.toDate.getMonth(),c.info.toDate.getDate(),c.info.toTime.hr,c.info.toTime.min,c.info.toTime.sec),t=moment(a),t=new Date(t.year(),t.month(),t.date(),t.hour(),t.minute(),t.second())),c.timelineGraphDrilDown.push({ts:c.info.chartLevel,from:e,to:t,st:(new Date).getTime(),isQuicktimeFilter:!!c.info.quick,quicktimeFilter:c.info.quick,quicktimeFilterName:c.dateRangeFilterName}),c.info.quick=0},c.isShowBreadCrumb=function(){return c.timelineGraphDrilDown.length},c.changeBreadCrumb=function(){var e=c.timelineGraphDrilDown.pop();c.loadDataForBreadCrumb(e)},c.breadCrumbHistoryAction=function(e,t){for(var a=0;a<c.timelineGraphDrilDown.length;a++)if(c.timelineGraphDrilDown[a].ts==e.ts){t=a;break}c.timelineGraphDrilDown.splice(t,1),c.loadDataForBreadCrumb(e)},c.loadDataForBreadCrumb=function(e){var t,a;if(c.info.currentFacet=null,c.info.drillDown=!0,c.customDateFilterApplied=!1,c.customDateFilter=!0,c.info.changedFilter=!1,c.dateRangeFilterName=d.getVal("customdate"),c.info.uploaded_by=null,c.info.quick=0,e.isQuicktimeFilter&&e.quicktimeFilter&&(1==e.quicktimeFilter||5==e.quicktimeFilter||10==e.quicktimeFilter))switch(c.info.quick=e.quicktimeFilter,c.customDateFilter=!1,c.info.drillDown=!1,e.quicktimeFilter){case 1:c.dateRangeFilterName=d.getVal("mostrecent");break;case 5:c.dateRangeFilterName=d.getVal("last5");break;case 10:c.dateRangeFilterName=d.getVal("last10")}var n=e.ts;if(0!=c.timelineGraphDrilDown.length)switch(t=new Date(e.from),a=new Date(e.to),n){case"YEAR":c.setFromTo(t,a);break;case"MONTH":t.setMonth(0),t.setDate(1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),a.setMonth(12),a.setDate(0),a.setHours(23),a.setMinutes(59),a.setSeconds(59),c.setFromTo(t,a);break;case"DAY":t.setDate(1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),a.setMonth(a.getMonth()+1),a.setDate(0),a.setHours(23),a.setMinutes(59),a.setSeconds(59),c.setFromTo(t,a);break;case"HOUR":t.setHours(0),t.setMinutes(0),t.setSeconds(0),a.setHours(23),a.setMinutes(59),a.setSeconds(59),c.setFromTo(t,a);break;case"MINUTES":t.setMinutes(0),t.setSeconds(0),a.setMinutes(59),a.setSeconds(59),c.setFromTo(t,a)}else c.setFromTo(e.from,e.to)},c.setFromTo=function(e,t,a){isDate(e)||(e=new Date(e)),isDate(t)||(t=new Date(t)),c.info.fromDate=e,c.info.fromTime.hr=e.getHours(),c.info.fromTime.min=e.getMinutes(),c.info.fromTime.sec=e.getSeconds(),c.info.toDate=t,c.info.toTime.hr=t.getHours(),c.info.toTime.min=t.getMinutes(),c.info.toTime.sec=t.getSeconds(),a||c.tableParams.reload()},c.getNSRReportURl=function(e){var t,a,n="",i=d.getVal("nsrParams"),o=0;for(t in i)"obs_date"!=t?(0==o?n=i[t]+"="+e[t]:n+="&"+i[t]+"="+e[t],o++):(a=s("toTimeStr")(e[t]),0==o?n=i[t]+"="+a:n+="&"+i[t]+"="+a,o++);return c.info.NSRReportUrl+"&"+n},c.loadBundleData=function(e){c.$parent.changeCurrentPage("apps",e)},c.openNSRInstanceViewer=function(e){""!=c.info.NSRReportUrl?(e=c.getNSRReportURl(e),c.addInstance({rname:"NSR",r_link:e})):f.alertBox({msgKey:"nsr_alert_msg"})},c.addInstance=function(e){var t={type:"nsr",name:e.rname,data:{report:e}},t=JSON.parse(angular.toJson(t));m.addInstance(t,c),dashboard_url=e.r_link,details=dashboard_url.split("?"),dashboard_details=details[1].split("&"),dashboard_str=dashboard_details[0],arr_dashboard_name=dashboard_str.split("="),dashboard_name=arr_dashboard_name.pop(),(pattern=/\./g).test(dashboard_name)&&(dashboard_name=(dashboard_name=(arr_dashboard_name=dashboard_name.split(".")).pop()).replace(/\_/g," ")),l.standard_user_tracking(c.info.application,c.info.application,"Open NSR","{'"+dashboard_name+"'}").then(function(e){},g)},c.getValue=function(e){return d.getVal(e)},c.changeFilterAccessibility=function(n){c.savedFiltersListLoading=!0,r.changeFilterAccessibility(n).then(function(e){c.getSavedFilters();var t=n.public?"Set View Private":"Set View Public",a={"View Name":n.view_name};l.standard_user_tracking(c.info.application,c.info.application,t,JSON.stringify(a)).then(p,g)},function(e){c.savedFiltersListNotFound=!0,c.savedFiltersListLoading=!1,g(e)})},c.changeDefaultFilter=function(n,e){c.savedFiltersListLoading=!0,e||r.setResetDefaultFilter(n).then(function(e){n.default=!n.default;var t="",t=n.default?"Set Default View":(n.view_name==c.info.selectedFilterName&&(c.selectedFacets={},c.info.defaultFilterInfo={}),"Reset Default View"),a={"View Name":n.view_name};l.standard_user_tracking(c.info.application,c.info.application,t,JSON.stringify(a)).then(p,g),c.getSavedFilters()},function(e){c.savedFiltersListLoading=!1,g(e)})},c.dateRangeFilterName=d.getVal("customdate"),c.changeQuickFilter=function(e){var t,a;if(c.info.defaultState=!1,c.info.pristine=!1,c.info.changedFilter=!1,c.info.drillDown=!1,t=u.getTodayDate(),a=u.getTodayDate(),"customdate"!=e)switch(c.customDateFilter=!1,c.dateRangeFilterName=d.getVal(e),c.info.quick=0,c.info.uploaded_by=null,c.info.quickFilter=!0,e){case"lasthour":case d.getVal("lasthour"):t.setHours(t.getHours()-1),c.info.currentFacet=null,c.setFromTo(t,a),c.dateRangeFilterName=d.getVal("lasthour");break;case"today":case d.getVal("today"):t.setHours(0),t.setMinutes(0),t.setSeconds(0),c.info.currentFacet=null,c.setFromTo(t,a),c.dateRangeFilterName=d.getVal("today");break;case"yesterday":case d.getVal("yesterday"):t.setDate(t.getDate()-1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),a.setDate(a.getDate()-1),a.setHours(23),a.setMinutes(59),a.setSeconds(59),c.info.currentFacet=null,c.setFromTo(t,a),c.dateRangeFilterName=d.getVal("yesterday");break;case"thisweek":case d.getVal("thisweek"):t.setDate(t.getDate()-t.getDay()+1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),c.info.currentFacet=null,c.setFromTo(t,a),c.dateRangeFilterName=d.getVal("thisweek");break;case"thismonth":case d.getVal("thismonth"):t.setDate(1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),c.info.currentFacet=null,c.setFromTo(t,a),c.dateRangeFilterName=d.getVal("thismonth");break;case"last2days":case d.getVal("last2days"):t.setDate(t.getDate()-2),t.setHours(0),t.setMinutes(0),t.setSeconds(0),c.info.currentFacet=null,c.setFromTo(t,a),c.dateRangeFilterName=d.getVal("last2days");break;case"last7days":case d.getVal("last7days"):t.setDate(t.getDate()-7),t.setHours(0),t.setMinutes(0),t.setSeconds(0),c.info.currentFacet=null,c.setFromTo(t,a),c.dateRangeFilterName=d.getVal("last7days");break;case"last30days":case d.getVal("last30days"):t.setDate(t.getDate()-30),t.setHours(0),t.setMinutes(0),t.setSeconds(0),c.info.currentFacet=null,c.setFromTo(t,a),c.dateRangeFilterName=d.getVal("last30days");break;case"mostrecent":case d.getVal("mostrecent"):c.info.quick=1,c.info.max_days_allowed?t.setDate(t.getDate()-c.info.max_days_allowed):t.setFullYear(t.getFullYear()-10),c.info.currentFacet=null,c.setFromTo(t,a),c.dateRangeFilterName=d.getVal("mostrecent");break;case"last5":case d.getVal("last5"):c.info.quick=5,c.info.max_days_allowed?t.setDate(t.getDate()-c.info.max_days_allowed):t.setFullYear(t.getFullYear()-10),c.info.currentFacet=null,c.setFromTo(t,a),c.dateRangeFilterName=d.getVal("last5");break;case"last10":case d.getVal("last10"):c.info.quick=10,c.info.max_days_allowed?t.setDate(t.getDate()-c.info.max_days_allowed):t.setFullYear(t.getFullYear()-10),c.info.currentFacet=null,c.setFromTo(t,a),c.dateRangeFilterName=d.getVal("last10");break;default:f.alertBox({msg:"Nothing"}),c.dateRangeFilterName=d.getVal("customdate")}else c.customDateFilter=!0,c.customDateFilterApplied=!0,c.info.quick=0,c.info.uploaded_by=null,c.dateRangeFilterName=d.getVal(e)},r.getAllConfig().then(function(e){c.facets=[],(responseData=e.data.Data)&&responseData.ec_sysid_map&&""==responseData.ec_sysid_map.sysid1&&(responseData.ec_sysid_map.sysid1="sysid1"),h.isGbStudioApp()&&(responseData.config=responseData.default_config||responseData.config),u.setGbConfig(responseData.config),angular.forEach(responseData.facet_label_map,function(e){angular.forEach(e,function(e,t){var a;"namespace"!==t&&((a={}).key=t,a.label=e,a.data=[],a.expanded=!1,c.facets.push(a),c.selectedFacets[t]=[])})}),c.info.default_days=responseData.config.LOGVAULT_DEFAULT_PERIOD_IN_SEC,c.info.max_days_allowed=responseData.config.LOGVAULT_MAX_DAY_RANGE_ALLOWED,c.info.MinDate=new Date(u.getTodayDate()),c.info.MinDate.setDate(u.getTodayDate().getDate()-c.info.max_days_allowed),c.info.default_days&&(c.info.default_days=1e3*c.info.default_days),u.getFeatures().explorer&&(c.info.logvault_to_explorer=responseData.config.lv_to_exp),c.info.appsFeatureEnabled=responseData.config.lv_to_apps,c.info.logvault_to_viewer=responseData.config.lv_to_iviewer;var t,a,n=Object.keys(responseData.sections_content);n.sort();for(var i=0;i<n.length;i++)if("SECTION"==responseData.sections_content[n[i]].nsType){c.info.ivSection=n[i];break}for(i in c.info.allConfigLoading=!1,c.loadDefaultFilter(),t=Object.keys(responseData.config.fields))(a={}).key=t[i],a.label=responseData.config.fields[t[i]],c.info.fields.push(a);o.setConfigDiffFields(c.info.fields),c.info.sysId=responseData.ec_sysid_map.sysid1;e=u.getTodayDate();u.getTodayDate();c.info.default_days?e.setTime(e.getTime()-c.info.default_days):e.setFullYear(e.getFullYear()-10)},function(e){g(e),console.error(e)}),c.addAppsInstance=function(e){e.namespace="random.namespace.by.apps",e.currentNS="random.namespace.by.apps",e.namespace_id=s("bundleName")(e.obs_url)+"-0",e.serial_num=e[c.info.sysId];var t={type:"apps",title:"View section/config diff",name:s("bundleName")(e.obs_url),module:c.info.application,data:{result:e,bundle:s("bundleName")(e.obs_url),sysId:e[c.info.sysId],sysId2:null,instanceDisplay:c.info.fields,start_time:c.getFrom(),end_time:c.getTo(),observation:e.obs_date,observationStr:e.obs_date_str}};e.sysid2&&(t.data.sysId2=e.sysid2),m.addInstance(t),l.standard_user_tracking(c.info.application,"Apps","Table View",JSON.stringify(e)).then(p,g)},c.toggleTimelineGraph=function(){c.toggleChartCnt=!c.toggleChartCnt,c.logToggleTimeline(c.toggleChartCnt),c.info.toggleTimeline=!c.info.toggleTimeline},c.setInitialViewSectionViewer=function(n){o.setDefaultSysId({sys_id:n.data.sysId});var e=n.data.result.filename,t=n.data.result.obs_date,a=n.data.result.obs_url;o.setSelectedObservation({bundle_name:e,obs_time:t,obs_url:a}),o.setDefaultObservation({bundle_name:e,obs_time:t,obs_url:a}),_(function(){S.setUrl("sectionview"),D.setCurrentLabel("Section View"),m.addInstance(n),_(function(){w.getS2().then(function(e){o.setSubSys(e.data.Data),w.getDefault().then(function(e){var t=e.data.Data,a=!1;w.getAll().then(function(e){o.getDefaultObservation();e=s("filter")(e.data.Data,{namespace_type:"!EVENT"}),e=s("filter")(e,{namespace_type:"!UNPARSED"});e=s("orderBy")(e,"label"),w.setSections(o.getDefaultObservation(),e),t&&(w.applyViewFromLogVault(t),a=!0),a||w.clearSectionView(),c.setInitialViewConfigDiff(n)},function(e){},this)},function(e){})},function(e){o.setSubSys([])})},500,c)},100,c)},c.setInitialViewConfigDiff=function(e){e=e.data.sysId;o.getDefaultEndCust();n.setClusterId(e),n.getAll().then(function(e){sorted_data=s("filter")(e.data.Data,{namespace_type:"!UNPARSED"}),sorted_data=s("filter")(sorted_data,{namespace_type:"!EVENT"}),sorted_data=s("orderBy")(sorted_data,"label"),sections=sorted_data,n.setSections(sections),n.getDefault().then(function(e){var e=e.data.Data,t=!1;e&&(n.applyViewFromLogVault(e),t=!0),t||n.clearConfigDiff()},function(e){})},function(e){})},c.getFrom=function(){var e=new Date(c.info.fromDate.getFullYear(),c.info.fromDate.getMonth(),c.info.fromDate.getDate(),c.info.fromTime.hr,c.info.fromTime.min,c.info.fromTime.sec);return(c.info.fromDate=e).getFullYear()+"-"+c.makeT2DigitValue(parseInt(e.getMonth()+1))+"-"+c.makeT2DigitValue(e.getDate())+"T"+c.makeT2DigitValue(c.info.fromTime.hr)+":"+c.makeT2DigitValue(c.info.fromTime.min)+":"+c.makeT2DigitValue(c.info.fromTime.sec)+"Z"},c.makeT2DigitValue=function(e){return parseInt(e)<10?"0"+e:e},c.$watch("info.toDate",function(){var e=u.getTodayDate();e<c.info.toDate&&(c.info.toDate=e,c.info.toTime.hr=c.info.toDate.getHours(),c.info.toTime.min=c.info.toDate.getMinutes(),c.info.toTime.sec=c.info.toDate.getSeconds())}),c.$watch("info.resultLoading",function(){c.info.resultLoading||h.hidePanelLoading()}),c.$on("AppLoadEvent-logvault",function(e,t){c.info.resultLoading||h.hidePanelLoading(),t&&!c.info.allConfigLoading&&c.loadDefaultFilter(),c.updateWhetherToShowUploadBundleToTest()}),c.getTo=function(){var e=u.getTodayDate(),t=new Date(c.info.toDate.getFullYear(),c.info.toDate.getMonth(),c.info.toDate.getDate(),c.info.toTime.hr,c.info.toTime.min,c.info.toTime.sec);return e<t&&(c.info.toTime.hr=(t=e).getHours(),c.info.toTime.min=t.getMinutes(),c.info.toTime.sec=t.getSeconds()),(c.info.toDate=t).getFullYear()+"-"+c.makeT2DigitValue(parseInt(t.getMonth()+1))+"-"+c.makeT2DigitValue(t.getDate())+"T"+c.makeT2DigitValue(c.info.toTime.hr)+":"+c.makeT2DigitValue(c.info.toTime.min)+":"+c.makeT2DigitValue(c.info.toTime.sec)+"Z"},c.done=function(){$(".gb-datetime.open").removeClass("open"),c.tableParams.reload()},c.cancel=function(){$(".gb-datetime.open").removeClass("open")},c.tableParams=new t({page:1,count:10},{total:c.info.response.numFound,getData:function(e,t){c.info.allConfigLoading?e.resolve([]):c.refresh(e)}}),c.paginator=function(e){c.info.page.total=e,c.info.page.pages=Math.ceil(c.info.page.total/c.info.page.count),c.info.page.current>=c.info.page.pages&&(c.info.page.current=c.info.page.pages-1,c.info.page.current<0&&(c.info.page.current=0),c.tableParams.page(c.info.page.current+1))},c.changePageSize=function(){c.info.page.count=parseInt(c.info.page.count),c.info.page.pages=Math.ceil(c.info.page.total/c.info.page.count),c.info.page.current=0,c.tableParams.count(c.info.page.count),c.info.changePageSize=!0,c.tableParams.page(c.info.page.current+1),c.refresh()},c.nextPage=function(){c.info.page.current<c.info.page.pages-1&&(c.info.page.current+=1,c.info.paginate=!0,c.tableParams.page(c.info.page.current+1))},c.prevPage=function(){0<c.info.page.current&&(--c.info.page.current,c.info.paginate=!0,c.tableParams.page(c.info.page.current+1))},c.firstPage=function(){0!=c.info.page.current&&(c.info.page.current=0,c.info.paginate=!0,c.tableParams.page(c.info.page.current+1))},c.lastPage=function(){c.info.page.current!=c.info.page.pages-1&&(c.info.page.current=c.info.page.pages-1,c.info.paginate=!0,c.tableParams.page(c.info.page.current+1))},c.searchFromUI=function(){var e;c.customDateFilter&&(c.info.drillDown=!1,e=new Date(c.info.fromDate.getFullYear(),c.info.fromDate.getMonth(),c.info.fromDate.getDate(),c.info.fromTime.hr,c.info.fromTime.min,c.info.fromTime.sec),c.info.fromDate=e,e=new Date(c.info.toDate.getFullYear(),c.info.toDate.getMonth(),c.info.toDate.getDate(),c.info.toTime.hr,c.info.toTime.min,c.info.toTime.sec),c.info.toDate=e,c.tableParams.reload())},c.getFacetName=function(e){for(var t=0;t<c.facets.length;t++)if(c.facets[t].key==e)return c.facets[t].label},c.getFacet=function(e){for(var t=0;t<c.facets.length;t++)if(c.facets[t].key==e)return c.facets[t]},c.sortRawData=function(){c.info.drillDown=!1,c.tableParams.reload()},c.refresh=function(o){if(c.info.fromDate&&c.info.toDate){c.info.refCount++;var e,t,s={},a=Object.keys(c.selectedFacets);for(e in c.listSelectedFacets(),c.info.dataLoading=!0,a){for(t in c.selectedFacets[a[e]])Array.isArray(s[a[e]])||(s[a[e]]=[]),s[a[e]].push(c.selectedFacets[a[e]][t].label.replace(/\?/g,"%3F"));Array.isArray(s[a[e]])||(s[a[e]]=[])}c.info.toDate&&c.info.fromDate&&(c.info.viewLoad?c.info.viewLoad=!1:c.info.selectedFilterName="Select View",r.getData(c.tableParams.page(),c.tableParams.count(),s,c.getFrom(c.info.drillDown),c.getTo(c.info.drillDown),c.info.sort_order.val,0,c.info.quick,c.info.uploaded_by,c.dateRangeFilterName,c.info.drillDown).then(function(e){var a,t={},n=(c.testBundleMsg="Select Bundles",t.data=e.data.Data,t.Msg=e.data.Msg,e=t,c.info.firstDataLoaded=!0,c.info.resultLoading=!1,c.info.sorting||c.info.drillDown||(c.timelineGraphDrilDown=[]),{});if(c.info.clearFilter||c.info.sorting||c.info.changePageSize?c.info.changePageSize&&(n.Count=c.tableParams.count()):(a={},angular.forEach(s,function(e,t){e.length&&angular.forEach(e,function(e){a.hasOwnProperty(t)||(a[t]=[]),a[t].push(e)})}),Object.keys(a).length&&(n["Facets Selected"]=a),c.dateRangeFilterName&&(n["Quick Filter"]=c.dateRangeFilterName),n["Date Range"]=c.getFrom()+" - "+c.getTo(),n["Sort Order"]="desc"==c.info.sort_order.val?"Descending":"Ascending"),1==c.info.drillDown?c.info.drillDown=!(i="Drill Down"):1==c.info.clearFilter?c.info.clearFilter=!(i="Clear Filter"):1==c.info.sorting?(i="Sort "+("desc"==c.info.sort_order.val?"Descending":"Ascending"),c.info.sorting=!1):1==c.info.changePageSize?c.info.changePageSize=!(i="Change Page Count"):1==c.info.quickFilter?(i=c.dateRangeFilterName,c.info.quickFilter=!1):i="filter",1==c.info.paginate?c.info.paginate=!1:l.standard_user_tracking(c.info.application,c.info.application,i,JSON.stringify(n),t.data.solr_query).then(function(e){},g),e.data&&e.data.response&&0==e.data.response.numFound)c.info.no_result=!0,c.info.dataLoading=!1,c.info.facetLoading=!1,c.info.response=null,c.reloadGraph(null),c.tableParams.total(0),c.resetFacetsData(),o&&o.resolve([]);else if(e.data&&e.data.hasOwnProperty("gb_error"))"ERR_0"==e.data.gb_error?b.location.href=d.getVal("redirect_login_url"):(c.info.no_result=!0,c.info.dataLoading=!1,c.info.facetLoading=!1,c.info.response=null,c.reloadGraph(null),c.tableParams.total(0),c.d3BarRender(),c.resetFacetsData(),o&&o.resolve([]));else{if(!e.data)return;c.info.response=e.data.response,c.info.no_result=!1,c.info.dataLoading=!1,c.info.facetLoading=!1;var i=e.data.facet_counts.facet_ranges.obs_date.start,n=e.data.facet_counts.facet_ranges.obs_date.end;i&&(i=(i=i.replace("T"," ")).replace("Z",""),c.info.fromDate=u.getStringToDate(i)),n&&(n=(n=n.replace("T"," ")).replace("Z",""),c.info.toDate=u.getStringToDate(n)),c.info.fromTime.hr=c.info.fromDate.getHours(),c.info.fromTime.min=c.info.fromDate.getMinutes(),c.info.fromTime.sec=c.info.fromDate.getSeconds(),c.info.toTime.hr=c.info.toDate.getHours(),c.info.toTime.min=c.info.toDate.getMinutes(),c.info.toTime.sec=c.info.toDate.getSeconds(),c.reloadGraph(e.data.facet_counts.facet_ranges),c.tableParams.total(c.info.response.numFound),c.paginator(c.info.response.numFound),c.info.chartLevel=e.data.facet_counts.facet_ranges.obs_date.gap.split("/")[1],o&&o.resolve(c.info.response.docs),c.info.response.numFound&&c.updateFacets(e),c.info.init=!0}t=angular.element(document.getElementById("expandElement"));t.hasClass("open")&&t.removeClass("open")},function(e){c.info.no_result=!0,c.info.dataLoading=!1,c.info.resultLoading=!1,c.info.facetLoading=!1,c.info.response=null,c.info.drillDown=!1,c.info.clearFilter=!1,c.info.sorting=!1,c.info.changePageSize=!1,c.info.paginate=!1,c.reloadGraph(null),c.tableParams.total(0),c.resetFacetsData(),o.resolve([]),g(e)}))}},c.resetFacetsData=function(){for(var e in c.facets)c.facets[e].data=[]},c.closeModal=function(){c.modalInstance.close(),null!=c.events_export_limit&&0!=c.events_export_limit||(c.csvpage.noOfRecordsCsv=1)},c.isFacetsData=function(){for(var e in c.facets)if(0<c.facets[e].data.length)return!0;return!1},c.updateFacets=function(e){var t,a,n,i;for(t in c.facets){if(c.info.currentFacet)if(c.facets[t].key!=c.info.currentFacet.key){if(c.facets[t].data=[],e.data.facet_counts.facet_fields[c.facets[t].key])for(a=0;a<e.data.facet_counts.facet_fields[c.facets[t].key].length/2;++a)if((i={}).title=c.facets[t].label,i.label=e.data.facet_counts.facet_fields[c.facets[t].key][2*a],i.value=e.data.facet_counts.facet_fields[c.facets[t].key][parseInt(2*a+1)],c.selectedFacets[c.facets[t].key]&&c.selectedFacets[c.facets[t].key].length){for(n in c.selectedFacets[c.facets[t].key])if(c.selectedFacets[c.facets[t].key][n].label==i.label){c.selectedFacets[c.facets[t].key][n].value=i.value,c.facets[t].data.push(c.selectedFacets[c.facets[t].key][n]);break}n>=c.selectedFacets[c.facets[t].key].length&&(i.selected=!1,c.facets[t].data.push(i))}else i.selected=!1,c.facets[t].data.push(i);c.facets[t].expanded=!1}else c.facets[t].expanded=null!=c.facets[t].expanded&&c.facets[t].expanded;else{if(c.facets[t].data=[],e.data.facet_counts.facet_fields[c.facets[t].key])for(a=0;a<e.data.facet_counts.facet_fields[c.facets[t].key].length/2;++a)if((i={}).title=c.facets[t].label,i.label=e.data.facet_counts.facet_fields[c.facets[t].key][2*a],i.value=e.data.facet_counts.facet_fields[c.facets[t].key][parseInt(2*a+1)],c.selectedFacets[c.facets[t].key]&&c.selectedFacets[c.facets[t].key].length){for(n in c.selectedFacets[c.facets[t].key])if(c.selectedFacets[c.facets[t].key][n].label==i.label){c.selectedFacets[c.facets[t].key][n].value=i.value,c.facets[t].data.push(c.selectedFacets[c.facets[t].key][n]);break}n>=c.selectedFacets[c.facets[t].key].length&&(i.selected=!1,c.facets[t].data.push(i))}else i.selected=!1,c.facets[t].data.push(i);c.facets[t].expanded=!1}if(c.selectedFacets[c.facets[t].key]&&c.selectedFacets[c.facets[t].key].length)for(n in c.selectedFacets[c.facets[t].key]){for(a=0;a<c.facets[t].data.length&&c.selectedFacets[c.facets[t].key][n].label!=c.facets[t].data[a].label;a++);a>=c.facets[t].data.length&&c.facets[t].data.push(c.selectedFacets[c.facets[t].key][n])}}},c.checkChange=function(e,t){c.info.defaultState=!1,c.info.changedFilter=!1,c.info.pristine=!1,c.info.drillDown=!1,t.selected?c.addSelected(e,t):c.removeSelected(e,t)},c.isNoFilteredFacetFound=function(e){var t=e.filter;return!!t&&!(0<e.data.filter(function(e){return!!e.label&&-1!=e.label.toLowerCase().indexOf(t.toLowerCase())}).length)},c.facetSelectAll=function(e){var t=e.data,a=e.filter;t.map(function(e){if(!e.label)return!1;-1!=e.label.toLowerCase().indexOf(a.toLowerCase())?e.selected=!0:e.selected=!1}),c.facetApplyMultiple(e)},c.getSelectedFacetData=function(e){return c.facets[e]},c.facetApplyMultiple=function(e){for(var t,a=e.data.filter(function(e){return!!e.selected}),n=0;n<a.length;n++)t=a[n],c.addSelected(e,t,!0);c.info.defaultState=!1,c.info.changedFilter=!1,c.info.currentFacet=e,c.info.pristine=!1,c.tableParams.page(1),c.tableParams.reload()},c.facetApplyFromMoreWindow=function(e,a,t){c.facets[t].data.map(function(e){e.selected=!1;for(var t=0;t<a.length;t++)if(a[t].label==e.label){e.selected=!0;break}}),c.selectedFacets[e.key]&&(c.selectedFacets[e.key]=[]);for(var n=0;n<a.length;n++)c.addSelected(e,a[n],!0);c.info.defaultState=!1,c.info.changedFilter=!1,c.info.currentFacet=e,c.info.pristine=!1,c.tableParams.page(1),c.tableParams.reload()},c.addSelected=function(e,t,a){c.info.defaultState=!1,c.info.changedFilter=!1,c.info.currentFacet=e,c.selectedFacets[e.key]||(c.selectedFacets[e.key]=[]),c.isCheckSelectedFacetExist(c.selectedFacets[e.key],t)||c.selectedFacets[e.key].push(t),a||(c.info.pristine=!1,c.tableParams.page(1),c.tableParams.reload())},c.isCheckSelectedFacetExist=function(e,t){for(var a=0;a<e.length;a++)if(e[a].label==t.label)return!0;return!1},c.removeSelected=function(e,t){c.info.defaultState=!1,c.info.changedFilter=!1,c.info.currentFacet=e,c.info.drillDown=!1,c.selectedFacets[e.key].splice(c.selectedFacets[e.key].indexOf(t),1);var a,n=!1;for(a in c.selectedFacets)for(var i=0;i<c.selectedFacets[a].length;i++)if(!c.selectedFacets[a][i].disabled){n=!0;break}n||!c.customDateFilter?c.info.pristine=!1:(c.info.pristine=!0,c.info.currentFacet=null),c.tableParams.page(1),c.tableParams.reload()},c.listSelectedFacets=function(){var e,t,a,n=Object.keys(c.selectedFacets);for(e in c.selectedFacetsList.length=0,n)for(t in c.selectedFacets[n[e]])(a={}).f_data=c.selectedFacets[n[e]][t],a.key=n[e],c.selectedFacetsList.push(a)},c.removeFacet=function(e,t){c.info.defaultState=!1,c.info.changedFilter=!1,c.info.page.current=0,c.info.pristine=!1,c.info.drillDown=!1,t.selected=!1,c.info.currentFacet=c.getFacet(e);for(var a=0;a<c.info.currentFacet.data.length;a++)t.label===c.info.currentFacet.data[a].label&&(c.info.currentFacet.data[a].selected=!1);var n,i=!1;for(n in c.selectedFacets[e].splice(c.selectedFacets[e].indexOf(t),1),0==c.selectedFacets[e].length&&(c.selectedFacets[e]=[]),c.selectedFacets)for(var o=0;o<c.selectedFacets[n].length;o++)if(!c.selectedFacets[n][o].disabled){i=!0;break}i||!c.customDateFilter?c.info.pristine=!1:c.info.pristine=!0,c.tableParams.page(1),c.tableParams.reload()},c.removeFacetGroup=function(e,t){c.info.defaultState=!1,c.info.currentFacet=null,c.info.pristine=!1;for(var a,n=t.selected=!1,i=c.selectedFacets[e].length,a=0;a<i;a++)c.selectedFacets[e].splice(c.selectedFacets[e].indexOf(c.selectedFacets[e][a]),1);for(a in 0==c.selectedFacets[e].length&&(c.selectedFacets[e]=[]),c.selectedFacets)for(var o=0;o<c.selectedFacets[a].length;o++)if(!c.selectedFacets[a][o].disabled){n=!0;break}n||!c.customDateFilter?c.info.pristine=!1:c.info.pristine=!0,c.tableParams.page(1),c.tableParams.reload()},c.resetAll=function(){var e,t,a,n;for(e in c.facets)for(t in Array.isArray(c.selectedFacets[c.facets[e].key])&&(c.selectedFacets[c.facets[e].key].length=0),c.facets[e].data)c.facets[e].data[t].selected=!1;c.customDateFilter=!0,c.dateRangeFilterName=d.getVal("customdate"),a=u.getTodayDate(),n=u.getTodayDate(),c.info.default_days?a.setTime(a.getTime()-c.info.default_days):a.setFullYear(a.getFullYear()-10),c.setFromTo(a,n),c.info.pristine=!0},c.reset=function(){var e,t,a,n;for(a in c.info.quick=0,c.info.uploaded_by=null,c.info.disable_time=!1,c.info.selectedFilterName="Select View",c.facets){for(n in Array.isArray(c.selectedFacets[c.facets[a].key])&&(c.selectedFacets[c.facets[a].key].length=0),c.facets[a].data)c.facets[a].data[n].selected=!1,c.facets[a].expanded=!1;c.facets[a].filter&&(c.facets[a].filter="")}c.customDateFilter=!0,c.dateRangeFilterName=d.getVal("customdate"),e=u.getTodayDate(),t=u.getTodayDate(),c.info.max_days_allowed?e.setTime(e.getTime()-c.info.default_days):e.setFullYear(e.getFullYear()-10),c.setFromTo(e,t),c.info.pristine=!0},c.resetFromUI=function(){c.info.selectedFilterName="Select View",c.info.currentFacet=null,c.info.clearFilter=!0,c.customDateFilter=!0,c.info.uploaded_by=null,c.customDateFilterApplied=!0,c.info.page.current=0,c.reset()},c.loadView=function(e){c.info.defaultState=!1,c.info.drillDown=!1,c.info.selectedFilterName="OUTOFBOX"!=e.search_type?e.view_name:c.getValue("last"+e.last_n_log_by_user+"byme"),c.applyView(c.parseView(e));e={"View Name":c.info.selectedFilterName};l.standard_user_tracking(c.info.application,c.info.application,"Apply View",JSON.stringify(e)).then(p,g)},c.removeOutOfBox=function(){c.info.defaultState=!1,c.info.changedFilter=!1,c.info.quick=0,c.info.disable_time=!1,c.info.uploaded_by=null,c.info.defaultFilterSelected=!1,c.info.pristine=!0,c.info.selectedFilterName="Select View",c.tableParams.reload(),c.refresh()},c.trackLogBundle=function(e){e={"Bundle Name":s("bundleName")(e)};l.standard_user_tracking(c.info.application,c.info.application,"Search Log Bundle",JSON.stringify(e)).then(function(e){},g)},c.parseView=function(e){var t,a,n,i={};if("NA"!=e.facet_filters[0])for(t in i.facets={},i.facetKeys={},a=e.facet_filters[0].match(/`([^`]+)`/g))a[t]=a[t].replace(/`/g,""),i.facets.hasOwnProperty(a[t].split("^")[0])||(i.facets[a[t].split("^")[0]]=[]),"namespace"==a[t].split("^")[0]||"events"==a[t].split("^")[0]?(i.facets[a[t].split("^")[0]].push(a[t].split("^")[1]),i.facetKeys[a[t].split("^")[1]]=a[t].split("^")[2]):i.facets[a[t].split("^")[0]].push(a[t].split("^")[1]);return e.extraFacets&&(n=!1,angular.forEach(e.extraFacets,function(e,t){i.facets[t]?angular.forEach(e,function(e){"namespace"!=(t="namespace"==t&&"EVENT"==c.sectionsContent[e].nsType?"events":t)&&"events"!=t||-1!=i.facets[t].indexOf(c.sectionsContent[e].description)?"namespace"!=t&&"events"!=t&&-1==i.facets[t].indexOf(e)&&(i.facets[t].push(e),n=!0):(i.facets[t].push(c.sectionsContent[e].description),i.facetKeys[c.sectionsContent[e].description]=e,n=!0)}):(i.facets[t]=[],angular.forEach(e,function(e){"namespace"==t&&"EVENT"==c.sectionsContent[e].nsType&&(t="events"),n=("namespace"==t||"events"==t?(i.facets[t].push(c.sectionsContent[e].description),i.facetKeys[c.sectionsContent[e].description]=e):i.facets[t].push(e),!0)}))}),n&&(c.info.selectedFilterName="Select View")),i.start_time=e.start_ts,i.out_of_box="OUTOFBOX"==e.search_type,i.end_time=e.end_ts,i.lastn=e.last_n_log,i.lastnbyme=e.last_n_log_by_user,i.default=e.default,i},c.applyView=function(e){var t,a,n,i,o,s,r,l,d=[];if(c.info.viewLoad=!0,e.out_of_box)c.loadLogsByMe(e.lastnbyme,!0);else{for(t in e.facets&&(d=Object.keys(e.facets)),c.resetFacets(),c.info.disable_time=!1,c.info.pristine=!1,c.info.quick=0,c.info.uploadedBy=null,d)for(a in c.facets)if("relativetimefilter"!=d[t]&&d[t]===c.facets[a].key)for(Array.isArray(c.selectedFacets[d[t]])||(c.selectedFacets[d[t]]=[]),n=0;n<e.facets[d[t]].length;n++){for(i=0;i<c.facets[a].data.length;++i)if(e.facets[d[t]][n]==c.facets[a].data[i].label){if(c.selectedFacets[d[t]]&&c.selectedFacets[d[t]].length){for(o=0;o<c.selectedFacets[d[t]].length;++o)if(c.facets[a].data[i].label==c.selectedFacets[d[t]][o].label){c.facets[a].data[i].disabled=!0,c.selectedFacets[d[t]][o].disabled=!0;break}o>=c.selectedFacets[d[t]].length&&(c.facets[a].data[i].selected=!0,c.facets[a].data[i].disabled=!1,c.selectedFacets[d[t]].push(c.facets[a].data[i]))}else c.facets[a].data[i].selected=!0,c.facets[a].data[i].disabled=!1,c.selectedFacets[d[t]].push(c.facets[a].data[i]);break}i>=c.facets[a].data.length&&((s={}).label=e.facets[d[t]][n],e.facetKeys.hasOwnProperty(e.facets[d[t]][n])&&(s.key=e.facetKeys[e.facets[d[t]][n]]),s.value=0,s.selected=!0,s.disabled=!1,c.facets[a].data.push(s),c.selectedFacets[d[t]].push(s))}-1!=d.indexOf("relativetimefilter")?c.changeQuickFilter(e.facets.relativetimefilter[0]):(c.customDateFilter=!0,c.customDateFilterApplied=!0,r=(r=e.start_time.replace("T"," ")).replace("Z",""),l=(l=e.end_time.replace("T"," ")).replace("Z",""),r=u.getStringToDate(r),l=u.getStringToDate(l),c.setFromTo(r,l))}},c.checkDisabled=function(e,t){for(var a in c.selectedFacets[e.key])if(c.selectedFacets[e.key][a].label===t.label&&c.selectedFacets[e.key][a].disabled)return t.disabled=!0;return!1},c.resetFacets=function(){var e,t;for(e in c.facets)for(t in Array.isArray(c.selectedFacets[c.facets[e].key])&&(c.selectedFacets[c.facets[e].key].length=0),c.facets[e].data)1==c.facets[e].data[t].selected&&(c.facets[e].data[t].selected=!1)},c.saveModal={},c.form={},c.showSaveFilterModal=function(){if(c.savedFiltersList.length>=d.getVal("max_views_limit"))f.alertBox({msgKey:"max_views_msg"});else{c.saveModal={},c.saveModal.saveStatus="initiated",c.saveModal.message="",c.saveModal.filters="",c.saveModal.filtersString="",c.saveModal.searchQuery=c.info.filterSuggest,c.saveModal.timeRange=c.getFrom(!0).replace(/T|Z/g," ")+"To "+c.getTo(!0).replace(/T|Z/g," ");0==c.customDateFilter&&(c.saveModal.timeRange=c.dateRangeFilterName,c.saveModal.filtersString+="`relativetimefilter^"+c.dateRangeFilterName+"`");var e,t=Object.keys(c.selectedFacets);for(e in t)for(var a in c.selectedFacets[t[e]])c.saveModal.filtersString&&(c.saveModal.filtersString+=","),c.saveModal.filtersString+="`"+t[e]+"^"+c.selectedFacets[t[e]][a].label+(c.selectedFacets[t[e]][a].hasOwnProperty("key")?"^"+c.selectedFacets[t[e]][a].key:"")+"`",""!=c.saveModal.filters?c.saveModal.filters=c.saveModal.filters+", "+c.selectedFacets[t[e]][a].label:c.saveModal.filters=c.selectedFacets[t[e]][a].label;c.modal=f.openModal("partials/logvault-save-filter.html",c,!1,!0),c.form={visible:!0,message:""}}},c.saveModal.viewOverwrite=!1,c.saveModal.viewOverwriteIsDefault=!1,c.checkViewName=function(){if(c.saveModal.viewOverwrite=!1,c.saveModal.viewOverwriteIsDefault=!1,c.savedFiltersList&&c.savedFiltersList.length&&0<c.savedFiltersList.length){for(var e=!1,t=0;t<c.savedFiltersList.length;t++)if(c.savedFiltersList[t].view_name==c.saveModal.filterName){if(!c.savedFiltersList[t].currentUser){e=!0;break}c.saveModal.viewOverwrite=!0,c.savedFiltersList[t].default&&(c.saveModal.viewOverwriteIsDefault=!0)}e?c.form.saveViewModal.viewName.$setValidity("duplicate",!1):c.form.saveViewModal.viewName.$setValidity("duplicate",!0)}else c.getSavedFilters()},c.saveFilter=function(){c.form.saveViewModal.$valid&&c.callSaveViewAPI()},c.callSaveViewAPI=function(){var e={last_n_log:1<c.info.quick?c.info.quick:0,last_n_log_uploaded_by_me:1==c.info.quick?c.info.quick:0,facet_string:c.saveModal.filtersString,start_time:c.getFrom(),end_time:c.getTo(),search_name:c.saveModal.filterName,search_desc:escape(c.saveModal.desc),is_public:"public"==c.saveModal.access,is_default:c.info.defaultFilterInfo.view_name==c.saveModal.filterName};c.saveModal.saveStatus="progress",r.saveFilter(e).then(function(e){var t={"View Name":c.saveModal.filterName,"Facet String":c.saveModal.filtersString,"Time Range":c.getFrom()+"--"+c.getTo()};l.standard_user_tracking(c.info.application,c.info.application,"Save View","{'"+JSON.stringify(t)+"'}").then(p,g),c.saveModal.saveStatus="success",c.saveModal.message="View saved successfully.",c.getSavedFilters()},function(e){c.saveModal.saveStatus="error",c.saveModal.message="Oops! Something went wrong!",g(e)})},c.hideModal=function(){c.modal.close()},c.savedFiltersList=[],c.savedFiltersListNotFound=!1,c.allUsersInfo=[],c.currentUserId=null,c.savedFiltersListLoading=!0,c.getSavedFilters=function(o){c.savedFiltersListLoading=!0,r.getSavedFilters().then(function(e){var t=o;c.savedFiltersList=[],c.allFilterList=e.data.Data,angular.forEach(c.allFilterList,function(e){"OUTOFBOX"!=e.search_type&&c.savedFiltersList.push(e)}),e=s("filter")(c.allFilterList,{created_by:c.getLoggedInUserName(),default:!0})||[],c.info.defaultFilterInfo=e.length?e[0]:{},c.savedFiltersListLoading=!1,c.savedFiltersList&&0<c.savedFiltersList.length?c.savedFiltersListNotFound=!1:c.savedFiltersListNotFound=!0;for(var a=[],n=0;n<c.savedFiltersList.length;n++)c.savedFiltersList[n].currentUser=c.savedFiltersList[n].created_by==c.getLoggedInUserName(),a.push(c.savedFiltersList[n].view_name);if(t&&(e={"Name of views":a},l.standard_user_tracking(c.info.application,c.info.application,"List view",JSON.stringify(e)).then(p,g)),c.saveModal.filterName&&c.form.saveViewModal){for(var i=!1,n=0;n<c.savedFiltersList.length;n++)if(c.savedFiltersList[n].view_name==c.saveModal.filterName){if(!c.savedFiltersList[n].currentUser){i=!0;break}c.saveModal.viewOverwrite=!0}i&&c.form.saveViewModal.viewName?c.form.saveViewModal.viewName.$setValidity("duplicate",!1):c.form.saveViewModal.viewName.$setValidity("duplicate",!0)}},function(e){g(e),c.savedFiltersListLoading=!1,c.savedFiltersListNotFound=!0})},c.getViewCreaterName=function(e){for(var t=0;t<c.allUsersInfo.length;t++)if(c.allUsersInfo[t][0]==e)return c.allUsersInfo[t][2]+" "+c.allUsersInfo[t][3]},c.getViewCreatedByEmail=function(e){for(var t=0;t<c.allUsersInfo.length;t++)if(c.allUsersInfo[t][0]==e)return c.allUsersInfo[t][1]},c.getLoggedInUserName=function(){return u.getUser().email},c.info.filterBtn="all",c.getFilterScope=function(e){return"all"==c.info.filterBtn?e.currentUser||!e.currentUser&&e.public:"my"==c.info.filterBtn?e.currentUser:!e.currentUser&&e.public},c.getFilterOtherScope=function(e){return!e.currentUser&&e.public},c.info.setDefaultFilterOperation={filterId:null,statusCode:0},c.hideLeftMenu=!1,c.hideFacets=function(e){e?$(".gb-data-contrainer").addClass("gb-fullscreen"):$(".gb-data-contrainer").removeClass("gb-fullscreen"),_(function(){c.d3BarRender()},500)},c.deleteSavedFilter=function(e,t){c.modal=f.openModal("partials/logvault_delete_filter.html",c,!1,!0),c.deleteModal={},c.deleteModal.filter={},c.deleteModal.filter.name=e.view_name,c.deleteModal.filter.desc=decodeURIComponent(e.desc),c.deleteModal.filter.id=e.view_name,c.deleteModal.filter.isDefault=e.default,c.deleteModal.status="initiated",c.deleteModal.deleteOperationMsg=""},c.deleteFilterRequest=function(a){c.deleteModal.status="progress",r.deleteSavedFilter(a).then(function(e){c.deleteModal.status="success",c.info.selectedFilterName==a&&(c.info.selectedFilterName="Select View"),c.deleteModal.deleteOperationMsg="Deleted successfully";var t={"View Name":c.deleteModal.filter.name};l.standard_user_tracking(c.info.application,c.info.application,"Delete View","{'"+JSON.stringify(t)+"'}").then(p,g),c.deleteModal.filter.isDefault&&(c.info.defaultFilterInfo="",c.resetFromUI()),c.getSavedFilters()},function(e){c.deleteModal.status="error",c.deleteModal.deleteOperationMsg="Error : "+e.data.msg,c.savedFiltersListNotFound=!0,g(e)})},c.openFacetChart=function(e,t){var a="Time Range: "+c.facetSubCaptionDateFormat(c.info.fromDate)+" TO "+c.facetSubCaptionDateFormat(c.info.toDate),n={};n.cData=e,n.cType="bar2d",n.facetChartMax=!1,n.exportImage=0,n.exportPdf=0,n.facetLabel=t||"",n.dateRange=a,c.info.facetCharts.push(n)},c.closeFacetChart=function(e){c.info.facetCharts.splice(c.info.facetCharts.indexOf(e),1)},c.exportAsImage=function(e){e.exportImage=parseInt(e.exportImage+1)},c.exportAsPDF=function(e){e.exportPdf=parseInt(e.exportPdf+1)},c.addRemoveBundle=function(e){for(var t=c.tableParams.data.length,a=0,n=0;n<t;n++)c.tableParams.data[n].selected&&a++;c.testBundleMsg=0<a?"Upload "+a+" Bundles":"Select Bundles"},c.listFiles=function(e){var t=c.info.fileLists.length,a=e.obs_url,n=e[c.info.sysId],i=e.obs_date;c.info.fileLists[t]={loading:!0},r.getFileList(a,n,e.obs_date).then(function(e){"Success"==e.data.Status&&(e.data.Data.bundles.sys_id=n,e.data.Data.bundles.obs_date=i,c.info.fileLists[t]=e.data.Data.bundles)},function(e){g(e),console.error(e)})},c.closeFileList=function(e){c.info.fileLists.splice(c.info.fileLists.indexOf(e),1)},c.showDownloadList=function(){for(var e in c.bundleList=[],c.tableParams.data)c.tableParams.data[e].selected&&c.bundleList.push(c.tableParams.data[e]);c.bundleList.length?c.modal=f.openModal("custom/download_list",c,!1,!0):f.alertBox({msg:"Please select one or more bundle to start the download."})},c.getTotalSize=function(){var e,t=0;for(e in c.bundleList)t+=parseInt(c.bundleList[e].obs_size);return t},c.generateUrlForFile=function(e,t){var a={},n={};return n.bundle_name=e.bundle_name,n.files=[],n.obs_date=e.obs_date,n.files.push(t),a.bundles=[],a.bundles.push(n),a.download_type="files",JSON.stringify(a)},c.generateUrlForBundle=function(){var e,t,a="";if(arguments.length)a+="obs_url="+arguments[0].obs_url;else for(e in c.bundleList)""!=a&&(a+="&"),t=c.bundleList[e].sysid2,a+="obs_url="+c.bundleList[e].obs_url+"#-#"+c.bundleList[e].sysid1+"#-#"+(t=t||"NA")+"#-#"+c.bundleList[e].obs_date;return a},c.generateUrlForBundleGroup=function(){var e=c.getTotalSize();if(d.getVal("download_max_limit")<e)return c.info.dataLoading=!1,c.info.resultLoading=!1,c.info.facetLoading=!1,e=f.alertBox({msgKey:"download_message"},!1),c.info.fadeModal=!0,void(e.close=function(){c.info.fadeModal=!1,this.dismiss()});var t,a,n="";if(arguments.length)n+="obs_url="+arguments[0].bundle_name;else for(t in c.bundleList)""!=n&&(n+="&"),a=c.bundleList[t].sysid2,n+="obs_url="+c.bundleList[t].obs_url+"#-#"+c.bundleList[t].sysid1+"#-#"+(a=a||"NA")+"#-#"+c.bundleList[t].obs_date+"#-#"+c.bundleList[t].bundle_id;return n};var T=!(c.facetSubCaptionDateFormat=function(e){var e=new Date(e),t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()],a=""+e.getDate(),e=e.getFullYear();return[a=a.length<2?"0"+a:a,t,e].join("-")});function p(e){}c.loadDefaultFilter=function(){var e,a,t=r.getLoadView();t&&("custom"==t.type?((e=t.view).view_name="Select View",a="",angular.forEach(e.facet_filters,function(e,t){angular.forEach(e,function(e){a+=(a.length?",":"")+("`"+t+"^"+e+"`")})}),e.facet_filters=[a],T=!0,c.loadView(e)):"savedView"==t.type&&(c.info.dataLoading=!0,c.info.facetsLoading=!0,r.getSavedFilters().then(function(e){c.info.dataLoading=!1,c.info.facetsLoading=!1;e=s("filter")(e.data.Data,{view_name:t.view},!0)||[];1==e.length?(t.facets&&(e[0].extraFacets=t.facets),c.loadView(e[0])):(f.alertBox({msg:"View not found"}),T?T=!0:(r.setLoadView(null),c.loadDefaultFilter()))},function(e){})),r.setLoadView(null)),r.getDefaultFilterInfo().then(function(e){c.info.defaultFilterInfo=e.data.Data,""==c.info.defaultFilterInfo?(c.info.defaultFilterInfo={},t?t.source&&"test_rule"==t.source&&(T=!0,c.resetAll(),c.updateWhetherToShowUploadBundleToTest()):(T=!0,c.resetAll())):"object"==typeof c.info.defaultFilterInfo&&(t?t.source&&"test_rule"==t.source&&(T=!0,c.loadView(c.info.defaultFilterInfo),c.updateWhetherToShowUploadBundleToTest()):(T=!0,c.loadView(c.info.defaultFilterInfo)))},function(e){console.error("Unable to fetch default filter."),g(e)})},c.logShowTime=function(){var e=(c.info.showOTime?"Show":"Hide")+" Original Time";l.standard_user_tracking(c.info.application,c.info.application,e,JSON.stringify({})).then(function(e){},g)},c.logToggleTimeline=function(e){var t={};t.Timeline=e?"Show Timeline":"Hide Timeline";l.standard_user_tracking(c.info.application,c.info.application,"Toggle Timeline",JSON.stringify(t)).then(function(e){},g)},c.redirectSearchPage=function(e){var t=e.obs_url,a=e.obs_url,e=e.bundle_id,n={};n["Log Bundle"]=t,n.bundlename=a,n.bundle_id=e,y.setBundleData(n),c.$emit("changePageEvent","explorer")},c.showMoreOption=function(e){return e.length>c.info.facetLimit},c.openRulesTestPage=function(){for(var e in c.bundleList=[],c.tableParams.data)c.tableParams.data[e].selected&&c.bundleList.push(c.tableParams.data[e]);0!=c.bundleList.length?(M.setLogBundle(c.bundleList),b.moveToApplication({app:"rules_and_alerts"})):f.alertBox({msg:"Please select one or more bundle to test."})},c.updateWhetherToShowUploadBundleToTest=function(){if(c.fromRulesTestPage.page&&"test_rule_history"==c.fromRulesTestPage.page&&c.fromRulesTestPage.rules&&0<c.fromRulesTestPage.rules.length)return c.showTestRuleIcon=!0,void(c.selectBundleNotification=!0);c.showTestRuleIcon=!1,c.selectBundleNotification=!1},c.renderHtml=function(e){return L.trustAsHtml(e)}}]),angular.module("gbApp.services.logvault",[]).factory("LogVaultService",["$http","$location","UserTrackingService","GlobalService",function(m,e,t,h){var a=null;return{getLoadView:function(){return a},setLoadView:function(e){a=e},getAllConfig:function(){return t.getAllConfig()},getData:function(e,t,a,c,u,n,f,i,o,g,p){(e=(e-1)*t)<0&&(e=0);var s={},r=(o&&(s.uploaded_by=o),i&&(s.quick_filter=i),n&&(s.sortby="obs_date "+n),p&&(s.drill_down=p),"");if(a)for(var l in a)if(a[l]&&a[l].length&&0<a[l].length){for(var d=0;d<a[l].length;d++)0==d?(""==r?r=l:r+=" ~||~ "+l,r+='="'+a[l][d]):r+="~"+a[l][d];r+='"'}r&&(s.filter=r);o=h.getVal("infoserverDomain")+"/logvault/"+h.getVal("manufacturer")+"/"+h.getVal("product")+"/"+h.getVal("schema")+"/"+c+"/"+u+"/"+e+"/"+t,i=angular.copy(s),n=angular.copy(s);return delete n.filter,m.post(o,{filter:i.filter},{params:n})},saveFilter:function(e){var t=h.getVal("infoserverDomain")+"/logvault/view/add/"+h.getVal("manufacturer")+"/"+h.getVal("product")+"/"+h.getVal("schema")+"/"+e.is_public+"/"+e.search_name+"/"+e.is_default,e={desc:e.search_desc,start_time:e.start_time,end_time:e.end_time,facet_filters:e.facet_string,search_type:e.search_type,last_n_log:e.last_n_log,last_n_log_by_me:e.last_n_log_uploaded_by_me};return m.post(t,e)},getSavedFilters:function(){var e=h.getVal("infoserverDomain");return m.get(e+"/logvault/view/list/all/"+h.getVal("manufacturer")+"/"+h.getVal("product")+"/"+h.getVal("schema"))},setResetDefaultFilter:function(e){e=h.getVal("infoserverDomain")+"/logvault/view/"+(e.default?"resetdefault":"setdefault")+"/"+h.getVal("manufacturer")+"/"+h.getVal("product")+"/"+h.getVal("schema")+"/"+e.view_name;return m.post(e)},deleteSavedFilter:function(e){var t=h.getVal("infoserverDomain");return m.post(t+"/logvault/view/delete/"+h.getVal("manufacturer")+"/"+h.getVal("product")+"/"+h.getVal("schema")+"/"+e)},changeFilterAccessibility:function(e){var t=h.getVal("infoserverDomain");return m.post(t+"/logvault/view/setpublic/"+h.getVal("manufacturer")+"/"+h.getVal("product")+"/"+h.getVal("schema")+"/"+!e.public+"/"+e.view_name)},getDefaultFilterInfo:function(e){var t=h.getVal("infoserverDomain");return m.get(t+"/logvault/view/getdefault/"+h.getVal("manufacturer")+"/"+h.getVal("product")+"/"+h.getVal("schema"))},getFileList:function(e,t,a){var n=h.getVal("infoserverDomain");return m({url:n+"/bundles/files/named/"+h.getVal("manufacturer")+"/"+h.getVal("product")+"/"+h.getVal("schema")+"/"+h.getVal("manufacturer")+"/"+t+"/"+a,method:"GET",params:{obs_url:e}})},getDownloadUrl:function(e){var t=h.getVal("infoserverDomain");return m.post(t+"/logvault/download/bundles/"+h.getVal("manufacturer")+"/"+h.getVal("product")+"/"+h.getVal("schema"),{download:JSON.parse(e)},{headers:{"Content-Type":"application/json"}})}}}]),function(e){var t,a,n,i,o=[],s="",r={chart:{animation:"1",bgcolor:"FFFFFF",canvasbgColor:"FAFAFA",canvasbgAlpha:"100",bgAlpha:"100",canvasBorderColor:"000000",canvasBorderThickness:"0.1",paletteColors:"#51BBFD",plotGradientColor:"4682B4",plotFillAlpha:"95,100",plotFillRatio:"20,80",plotBorderColor:"51BBFD",plotSpacePercent:"40",caption:"",xaxisname:"",yaxisname:"Log Count",showvalues:"0",decimals:"0",formatnumberscale:"0",numDivLines:"0",toolTipSepChar:" : ",baseFontSize:"9",baseFontColor:"286594",chartLeftMargin:"5",chartBottomMargin:"3",chartTopMargin:"5",captionPadding:"3",labelDisplay:"ROTATE",labelPadding:"10",rotatelabels:"1",slantlabels:"1"}};if(e)if(0<=e.obs_date.gap.indexOf("YEAR")){for(r.chart.caption=s="Year View (UTC)",r.chart.rotatelabels=0,r.chart.slantlabels=0,r.chart.labelDisplay="auto",t=0;t<e.obs_date.counts.length/2;++t)n={},i=new Date(e.obs_date.counts[2*t].replace(/-/g,"/").replace("T"," ").substring(0,19)),n.label=i.getFullYear().toString(),n.value=e.obs_date.counts[2*t+1],n.link="j-drillDown-"+e.obs_date.counts[2*t],o.push(n);FusionCharts("myOwnChart")?(FusionCharts("myOwnChart").setJSONData({chart:r.chart,data:o}),FusionCharts("myOwnChart").render("fchart")):new FusionCharts({type:"column2d",renderAt:"fchart",width:"100%",id:"myOwnChart",height:"100%",dataFormat:"json",dataSource:{chart:r.chart,data:o}}).render("fchart")}else if(0<=e.obs_date.gap.indexOf("MONTH")){for(r.chart.caption=s="Month View (UTC)",r.chart.rotatelabels=0,r.chart.slantlabels=0,r.chart.labelDisplay="auto",t=0;t<e.obs_date.counts.length/2;++t)n={},i=new Date(e.obs_date.counts[2*t].replace(/-/g,"/").replace("T"," ").substring(0,19)),n.label=i.getFullYear()+"-"+i.getMonthName().substring(0,3),n.value=e.obs_date.counts[2*t+1],n.link="j-drillDown-"+e.obs_date.counts[2*t],n.color="0099FF",o.push(n);FusionCharts("myOwnChart")?(FusionCharts("myOwnChart").setJSONData({chart:r.chart,data:o}),FusionCharts("myOwnChart").render("fchart")):new FusionCharts({type:"column2d",renderAt:"fchart",width:"100%",id:"myOwnChart",height:"100%",dataFormat:"json",dataSource:{chart:r.chart,data:o}}).render("fchart")}else if(0<=e.obs_date.gap.indexOf("DAY")){for(r.chart.caption=s="Day of Month View (UTC)",t=0;t<e.obs_date.counts.length/2;++t)n={},i=new Date(e.obs_date.counts[2*t].replace(/-/g,"/").replace("T"," ").substring(0,19)),n.label=(9<i.getDate()?i.getDate():"0"+i.getDate())+" "+i.getMonthName().substring(0,3),n.value=e.obs_date.counts[2*t+1],n.link="j-drillDown-"+e.obs_date.counts[2*t],n.color="0099FF",o.push(n);FusionCharts("myOwnChart")?(FusionCharts("myOwnChart").setJSONData({chart:r.chart,data:o}),FusionCharts("myOwnChart").render("fchart")):new FusionCharts({type:"column2d",renderAt:"fchart",width:"100%",id:"myOwnChart",height:"100%",dataFormat:"json",dataSource:{chart:r.chart,data:o}}).render("fchart")}else if(0<=e.obs_date.gap.indexOf("HOUR")){for(r.chart.caption=s="Hours View (UTC) (HH:MM Month-Date)",r.chart.rotatelabels=0,r.chart.slantlabels=0,r.chart.labelDisplay="wrap",t=0;t<e.obs_date.counts.length/2;++t)n={},i=new Date(e.obs_date.counts[2*t].replace(/-/g,"/").replace("T"," ").substring(0,19)),n.label=(9<i.getHours()?i.getHours():"0"+i.getHours())+":"+(9<i.getMinutes()?i.getMinutes():"0"+i.getMinutes())+" "+i.getMonthName().substring(0,3)+" "+i.getDate(),n.value=e.obs_date.counts[2*t+1],n.link="j-drillDown-"+e.obs_date.counts[2*t],n.color="0099FF",o.push(n);FusionCharts("myOwnChart")?(FusionCharts("myOwnChart").setJSONData({chart:r.chart,data:o}),FusionCharts("myOwnChart").render("fchart")):new FusionCharts({type:"column2d",renderAt:"fchart",width:"100%",id:"myOwnChart",height:"100%",dataFormat:"json",dataSource:{chart:r.chart,data:o}}).render("fchart")}else if(0<=e.obs_date.gap.indexOf("MINUTES")){for(r.chart.caption=s="Minutes View (UTC) (HH:MM)",a=0;a<60;++a){for(t=0;t<e.obs_date.counts.length/2&&(i=new Date(e.obs_date.counts[2*t].replace(/-/g,"/").replace("T"," ").substring(0,19))).getMinutes()!=a;++t);n={},t<e.obs_date.counts.length/2?n.value=e.obs_date.counts[2*t+1]:n.value=0,n.label=(9<i.getHours()?i.getHours():"0"+i.getHours())+":"+(9<a?a:"0"+a),n.link="j-drillDown-"+e.obs_date.counts[2*t],n.color="0099FF",o.push(n)}FusionCharts("myOwnChart")?(FusionCharts("myOwnChart").setJSONData({chart:r.chart,data:o}),FusionCharts("myOwnChart").render("fchart")):new FusionCharts({type:"column2d",renderAt:"fchart",width:"100%",id:"myOwnChart",height:"100%",dataFormat:"json",dataSource:{chart:r.chart,data:o}}).render("fchart")}else if(0<=e.obs_date.gap.indexOf("SECONDS")){for(r.chart.caption=s="Seconds View (UTC) (MM:SS)",a=0;a<60;++a){for(t=0;t<e.obs_date.counts.length/2&&(i=new Date(e.obs_date.counts[2*t].replace(/-/g,"/").replace("T"," ").substring(0,19))).getSeconds()!=a;++t);n={},t<e.obs_date.counts.length/2?n.value=e.obs_date.counts[2*t+1]:n.value=0,n.label=(9<i.getSeconds()?i.getSeconds():"0"+i.getSeconds())+":"+(9<a?a:"0"+a),n.color="0099FF",o.push(n)}FusionCharts("myOwnChart")?(FusionCharts("myOwnChart").setJSONData({chart:r.chart,data:o}),FusionCharts("myOwnChart").render("fchart")):new FusionCharts({type:"column2d",renderAt:"fchart",width:"100%",id:"myOwnChart",height:"100%",dataFormat:"json",dataSource:{chart:r.chart,data:o}}).render("fchart")}else{for(r.chart.caption=s="Year View (UTC)",t=0;t<e.obs_date.counts.length/2;++t)n={},i=new Date(e.obs_date.counts[2*t].replace(/-/g,"/").replace("T"," ").substring(0,19)),n.label=i,n.value=e.obs_date.counts[2*t+1],n.link="j-drillDown-"+e.obs_date.counts[2*t],n.color="0099FF",o.push(n);FusionCharts("myOwnChart")?(FusionCharts("myOwnChart").setJSONData({chart:r.chart,data:o}),FusionCharts("myOwnChart").render("fchart")):new FusionCharts({type:"column2d",renderAt:"fchart",width:"100%",id:"myOwnChart",height:"100%",dataFormat:"json",dataSource:{chart:r.chart,data:o}}).render("fchart")}else FusionCharts("myOwnChart")?(FusionCharts("myOwnChart").setJSONData({chart:{caption:s,canvasBgColor:"F6F6F6",showBorder:1,yAxisName:"Log Count",theme:"zune"},data:[]}),FusionCharts("myOwnChart").render("fchart")):new FusionCharts({type:"column2d",renderAt:"fchart",width:"100%",id:"myOwnChart",height:"100%",dataFormat:"json",dataSource:{chart:{caption:s,canvasBgColor:"F6F6F6",showBorder:1,yAxisName:"Log Count",theme:"zune"},data:[]}}).render("fchart")}),drillDown=function(e){var t=new Date(e.replace("j-drillDown-","").replace(/-/g,"/").replace("T"," ").substring(0,19)),a=new Date(e.replace("j-drillDown-","").replace(/-/g,"/").replace("T"," ").substring(0,19));switch(angular.element(".gb-logvault").scope().customDateFilterApplied=!1,angular.element(".gb-logvault").scope().getUTCTime=!1,angular.element(".gb-logvault").scope().info.currentFacet=null,angular.element(".gb-logvault").scope().info.drillDown=!0,angular.element(".gb-logvault").scope().info.changedFilter=!1,angular.element(".gb-logvault").scope().info.uploaded_by=null,angular.element(".gb-logvault").scope().info.chartLevel){case"YEAR":t.setMonth(0),t.setDate(1),a.setMonth(12),a.setDate(0),a.setHours(23),a.setMinutes(59),a.setSeconds(59);break;case"MONTH":t.setDate(1),a.setMonth(a.getMonth()+1),a.setDate(0),a.setHours(23),a.setMinutes(59),a.setSeconds(59);break;case"DAY":a.setHours(23),a.setMinutes(59),a.setSeconds(59);break;case"HOUR":a.setMinutes(59),a.setSeconds(59);break;case"MINUTES":a.setSeconds(59)}angular.element(".gb-logvault").scope().updateBreadCrumb(t,a),angular.element(".gb-logvault").scope().setFromTo(t,a)},facetChart=function(){var e=$('<div class="gb-facet-chart-window"><div class="gb-facet-chart-window-title"><label class="radio-inline pull-left gb-modal-toolbar-radio-label"><input type="radio" name="facetChartType" value="bar"> Bar Chart </label><label class="radio-inline pull-left gb-modal-toolbar-radio-label"><input type="radio" name="facetChartType" value="line"> Line Chart</label><span class="icon-file-pdf gb-modal-toolbar-icon gb-modal-toolbar-icon-sendToPFD pull-left" title="Export As PDF"></span><span class="icon-image2 gb-modal-toolbar-icon pull-left" title="Export As Image"></span><span class="icon-close2 pull-right gb-modal-toolbar-controller gb-modal-toolbar-icon-close" title="close window"></span><span class="pull-right gb-modal-toolbar-controller" title="maximize window"></span>\t</div><div class="gb-facet-chart-window-body"><div class="chart"></div>\t</div></div>');$("body").append(e)};angular.module("gbApp.controllers.rules",["gbApp","gbApp.controllers","ngTable","ngDraggable"]).controller("RulesCtrl",["$scope","$sce","GlobalService","ErrorService","ModalService","RulesService","AppService","InstanceHandler","metaDataService","$rootScope",function(a,t,n,e,i,o,s,r,l,d){o.getRulesConstants().then(function(e){a.rulesconstants=e.data},function(e){}),a.info={},a.info.current="rules_list",a.info.sessionTimedOut=!1,a.info.pagesList=n.getVal("rulesPages")[a.info.current],l.setRaACurrentPage(a.info.current),a.getRulesUrl=function(){return n.getVal(a.info.current)},a.instanceViewerFullscreen=function(){return r.isVisible()},a.isThereInstanceViewer=function(){return r.getNumberOfInstances()},a.loadHelpMessage=function(e,t){$("#"+e).load(t+"#main")},a.changeCurrentPage=function(e){if(l.setRaACurrentPage(e),"api_admin_config"==e&&a.$broadcast("broadPageChange",e),"test_rule_history"==a.info.current&&o.getLogMoving())i.alertBox({msg:"Please wait till the log is being moved to the parser"});else{if(!("rules_list"==e&&o.getRuleSavedStatus()||"add_edit_template"==a.info.current&&o.getTemplateSavedStatus()||"add_edit_API_template"==a.info.current&&o.getAPITemplateSavedStatus()))return"rules_list"==a.info.current&&"manage_template"==e||"add_edit_template"==a.info.current&&a.isFromListPage("manage_template")&&"rules_list"!=e?(a.info.current=e,void(a.info.pagesList=n.getVal("rulesPages").manage_email_template_from_list_page)):"rules_list"==a.info.current&&"manage_API_template"==e||"add_edit_API_template"==a.info.current&&a.isFromListPage("manage_API_template")&&"rules_list"!=e?(a.info.current=e,void(a.info.pagesList=n.getVal("rulesPages").manage_API_template_from_list_page)):"rules_list"==a.info.current&&"add_category"==e?(a.info.current=e,void(a.info.pagesList=n.getVal("rulesPages").add_category_from_list_page)):"add_edit_template"==e&&a.isFromListPage("manage_template")?(a.info.current=e,void(a.info.pagesList=n.getVal("rulesPages").add_edit_template_from_list_page)):"add_edit_API_template"==e&&a.isFromListPage("manage_API_template")?(a.info.current=e,void(a.info.pagesList=n.getVal("rulesPages").add_edit_API_template_from_list_page)):(a.info.current=e,void(a.info.pagesList=n.getVal("rulesPages")[a.info.current]));a.info.targetPage=e,a.title="add_edit_template"==a.info.current?"Navigate from Add/Edit Template page":"Navigate from Add/Edit Rule page",a.msg=n.getVal("rulesMsgs").add_rule_navigate,a.modal=i.openModal("partials/rules-and-alerts/navigate_add_rule.html",a,!1,"static")}},a.isFromListPage=function(e){var t;return"manage_template"==e?a.info.pagesList[0].name==(t=[{name:"rules_list",label:"Rules List"},{name:"manage_template",label:"Manage Templates"}])[0].name&&a.info.pagesList[1].name==t[1].name:"manage_API_template"==e?a.info.pagesList[0].name==(t=[{name:"rules_list",label:"Rules List"},{name:"manage_API_template",label:"Manage API Templates"}])[0].name&&a.info.pagesList[1].name==t[1].name:void 0},a.changeCurrentPageConfirm=function(){o.setTemplateSavedStatus(!1),o.setAPITemplateSavedStatus(!1),"rules_list"==a.info.targetPage&&o.setRuleSavedStatus(!1),"rules_list"==a.info.current&&"manage_template"==a.info.targetPage||"add_edit_template"==a.info.current&&a.isFromListPage("manage_template")&&"rules_list"!=a.info.targetPage?(a.info.current=a.info.targetPage,a.info.pagesList=n.getVal("rulesPages").manage_email_template_from_list_page):"rules_list"==a.info.current&&"manage_API_template"==a.info.targetPage||"add_edit_API_template"==a.info.current&&a.isFromListPage("manage_API_template")&&"rules_list"!=a.info.targetPage?(a.info.current=a.info.targetPage,a.info.pagesList=n.getVal("rulesPages").manage_API_template_from_list_page):(a.info.current=a.info.targetPage,a.info.pagesList=n.getVal("rulesPages")[a.info.current])},a.$on("AppLoadEvent-rules_and_alerts",function(e,t){s.hidePanelLoading(),o.getloadExplorerRules()&&(o.setRuleSavedStatus(!1),o.setRuleMode("new"),a.info.targetPage="add_rule",a.$broadcast("loadExplorerRulesEvent"),a.changeCurrentPageConfirm())}),a.getError=function(){return e.getErrors("gbApp")},a.renderHtml=function(e){return t.trustAsHtml(e)}}]).controller("ManageTemplateCtrl",["$scope","$sce","$timeout","$filter","ngTableParams","RulesService","GlobalService","ModalService","UserTrackingService","AppService",function(n,t,a,i,e,o,s,r,l,c){for(var u in n.info={},n.info.application=s.getVal("navRules"),n.info.filter={},n.info.successMsg="",n.info.errorMsg="",n.info.sessionTimedOut=!1,n.columns=i("filter")(s.getVal("templatesColumns"),{enabled:!0}),n.info.initialSortField=s.getVal("templatesSortField"),n.columns)n.info[n.columns[u].field]="";function d(e){!n.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(n.info.sessionTimedOut=!0,r.sessionTimeout())}n.info.initialSorting={},n.info.initialSorting[n.info.initialSortField]="desc",n.info.page={total:0,current:1,pages:0,count:10,sortField:n.info.initialSortField+"desc"},n.info.templatesLoading=!0,n.populateTable=function(){n.tableParams=new e({page:1,count:n.info.page.count,sorting:n.info.initialSorting},{total:n.templatesList.length,getData:function(e,t){var a=t.sorting()?i("orderBy")(n.templatesList,t.orderBy()):n.templatesList,a=i("filterTemplates")(a,n.info.filter);t.total(a.length),n.info.page.total=a.length,n.info.page.pages=Math.ceil(n.info.page.total/n.info.page.count),e.resolve(a.slice((t.page()-1)*t.count(),t.page()*t.count()))}})},n.reloadTemplates=function(){o.getTemplates().then(function(e){var t=e.data.Data;if(t.length)for(var a=0;a<t.length;a++)t[a].subject=t[a].subject.replace(/\{[^\.]+\./g,"{");n.templatesList=t,n.clearAppliedFilters(),n.info.page.current=1,n.tableParams.reload(),n.tableParams.page(1),n.info.templatesLoading=!1,o.setTemplatesList(e.data.Data),n.info.rulesList=o.getRulesList(),n.setTemplatesLabelMap()},function(e){n.templatesList="",n.clearAppliedFilters(),n.info.page.current=1,n.tableParams.reload(),n.tableParams.page(1),n.info.templatesLoading=!1,e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(s.logError(Object.values(s.getVal("errorMsgs"))[1]),n.info.errorMsg=s.getVal("rulesMsgs").h2_down_msg):""==n.info.errorMsg?n.info.errorMsg=s.getVal("rulesMsgs").temp_load_failed:n.info.errorMsg+="<br>"+s.getVal("rulesMsgs").temp_load_failed,d(e)})},n.clearMessage=function(){n.info.templatesLoading||(n.info.successMsg="",n.info.errorMsg="")},o.getTemplates().then(function(e){var t=e.data.Data;if(t.length)for(var a=0;a<t.length;a++)t[a].subject=t[a].subject.replace(/\{[^\.]+\./g,"{");n.templatesList=t,n.populateTable(),n.info.templatesLoading=!1,o.setTemplatesList(e.data.Data),n.info.rulesList=o.getRulesList(),n.setTemplatesLabelMap()},function(e){n.templatesList="",n.populateTable(),n.info.templatesLoading=!1,console.error("Error loading templates list"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(s.logError(Object.values(s.getVal("errorMsgs"))[1]),n.info.errorMsg=s.getVal("rulesMsgs").h2_down_msg):""==n.info.errorMsg?n.info.errorMsg=s.getVal("rulesMsgs").temp_load_failed:n.info.errorMsg+="<br>"+s.getVal("rulesMsgs").temp_load_failed,d(e)}),n.setTemplatesLabelMap=function(){for(var e={},t=0;t<n.templatesList.length;t++)e[n.templatesList[t].template_name]=!0;o.setTemplatesLabelMap(e)},n.changePageSize=function(){n.info.page.count=parseInt(n.info.page.count),n.tableParams.count(n.info.page.count),n.info.page.pages=Math.ceil(n.info.page.total/n.info.page.count),n.info.page.current>n.info.page.pages&&(n.info.page.current=n.info.page.pages,n.tableParams.page(n.info.page.current))},n.nextPage=function(){n.info.page.current<n.info.page.pages&&(n.info.page.current+=1,n.tableParams.page(n.info.page.current))},n.prevPage=function(){1<n.info.page.current&&(--n.info.page.current,n.tableParams.page(n.info.page.current))},n.firstPage=function(){1!=n.info.page.current&&(n.info.page.current=1,n.tableParams.page(n.info.page.current))},n.lastPage=function(){n.info.page.current!=n.info.page.pages&&(n.info.page.current=n.info.page.pages,n.tableParams.page(n.info.page.current))},n.checkTemplatesSelection=function(){for(var e in n.templatesList)if(!n.templatesList[e].selected)return void(n.info.selectAll=!1);n.info.selectAll=!0},n.checkSelectAll=function(){if(n.info.selectAll)for(var e=0;e<n.templatesList.length;e++)n.templatesList[e].selected=!0;else for(e=0;e<n.templatesList.length;e++)delete n.templatesList[e].selected},n.checkTemplateSelected=function(){if(n.tableParams&&i("filter")(n.tableParams.data,{selected:!0}).length)return!0;return!1},n.addNewTemplate=function(){o.setTemplateMode("new"),n.$parent.changeCurrentPage("add_edit_template")},n.editTemplate=function(e){o.setTemplateMode("edit",e),n.$parent.changeCurrentPage("add_edit_template")},n.deleteTemplate=function(e){for(var t=0;t<n.info.rulesList.length;t++)if(n.info.rulesList[t].email_template_id&&e.template_id==parseInt(n.info.rulesList[t].email_template_id))return void r.alertBox({msg:s.getVal("rulesMsgs").temp_rule_associated});n.delTemplate=e,n.msg=s.getVal("rulesMsgs").temp_del_single[0]+e.template_name+s.getVal("rulesMsgs").temp_del_single[1],n.modal=r.openModal("partials/rules-and-alerts/delete_template.html",n,!1,"static")},n.deleteTemplateConfirm=function(){var t=n.delTemplate;n.info.templatesLoading=!0,o.deleteTemplate(t.template_id).then(function(e){l.standard_user_tracking(n.info.application,"Manage Template","delete",t.template_name).then(function(e){},d),n.reloadTemplates(),""==n.info.successMsg?n.info.successMsg=s.getVal("rulesMsgs").temp_del_success[0]+t.template_name+s.getVal("rulesMsgs").temp_del_success[1]:n.info.successMsg+="<br>"+s.getVal("rulesMsgs").temp_del_success[0]+t.template_name+s.getVal("rulesMsgs").temp_del_success[1]},function(e){console.error("Unable to delete "+t.template_name),n.info.templatesLoading=!1,e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(s.logError(Object.values(s.getVal("errorMsgs"))[1]),n.info.errorMsg=s.getVal("rulesMsgs").h2_down_msg):""==n.info.errorMsg?n.info.errorMsg=s.getVal("rulesMsgs").temp_del_failed[0]+t.template_name+s.getVal("rulesMsgs").temp_del_failed[1]:n.info.errorMsg+="<br>"+s.getVal("rulesMsgs").temp_del_failed[0]+t.template_name+s.getVal("rulesMsgs").temp_del_failed[1],d(e)})},n.deleteSelectedTemplates=function(){n.selectedTemplates=i("filter")(n.tableParams.data,{selected:!0});n.rulesList.map(function(e){if(0<e.email_template_id){for(var t=0;t<n.selectedTemplates.length;t++)n.selectedTemplates[t].template_id==e.email_template_id&&n.selectedTemplates.splice(t,1);return e.email_template_id}});0!=n.selectedTemplates.length?(n.msg=s.getVal("rulesMsgs").temp_del_multiple,n.modal=r.openModal("partials/rules-and-alerts/delete_email_template_multiple.html",n,!1,"static")):r.alertBox({msg:s.getVal("rulesMsgs").map_temp_multiple_Del_none})},n.deleteSelectedTemplatesConfirm=function(){n.info.doneDeletions=0,n.info.delFailed=0,n.info.deletedTemplates=[],n.selectedTemplates=i("filter")(n.tableParams.data,{selected:!0}),0<n.selectedTemplates.length&&(n.info.templatesLoading=!0);for(var e=0;e<n.selectedTemplates.length;e++)n.callDeleteTemplate(n.selectedTemplates[e],n.selectedTemplates.length),n.info.delFailed++;n.info.delFailed==n.selectedTemplates.length&&(n.info.templatesLoading=!1)},n.printErrorRuleAssociation=function(e){a(function(){""==n.info.errorMsg?n.info.errorMsg=s.getVal("rulesMsgs").temp_del_rule_associated[0]+e+s.getVal("rulesMsgs").temp_del_rule_associated[1]:n.info.errorMsg+="<br>"+s.getVal("rulesMsgs").temp_del_rule_associated[0]+e+s.getVal("rulesMsgs").temp_del_rule_associated[1]},700)},n.callDeleteTemplate=function(t,a){o.deleteTemplate(t.template_id).then(function(e){n.info.doneDeletions++,n.info.deletedTemplates.push(t.template_name),n.info.doneDeletions==a&&(l.standard_user_tracking(n.info.application,"Manage Template","multiple delete","["+n.info.deletedTemplates.toString()+"]").then(function(e){},d),n.reloadTemplates()),""==n.info.successMsg?n.info.successMsg=s.getVal("rulesMsgs").temp_del_success[0]+t.template_name+s.getVal("rulesMsgs").temp_del_success[1]:n.info.successMsg+="<br>"+s.getVal("rulesMsgs").temp_del_success[0]+t.template_name+s.getVal("rulesMsgs").temp_del_success[1]},function(e){console.error("Unable to delete"),n.info.doneDeletions++,n.info.doneDeletions==a&&(n.info.deletedTemplates.length&&l.standard_user_tracking(n.info.application,"Manage Template","multiple delete","["+n.info.deletedTemplates.toString()+"]").then(function(e){},function(e){}),n.reloadTemplates()),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(s.logError(Object.values(s.getVal("errorMsgs"))[1]),n.info.errorMsg=s.getVal("rulesMsgs").h2_down_msg):""==n.info.errorMsg?n.info.errorMsg=s.getVal("rulesMsgs").temp_del_failed[0]+t.template_name+s.getVal("rulesMsgs").temp_del_failed[1]:n.info.errorMsg+="<br>"+s.getVal("rulesMsgs").temp_del_failed[0]+t.template_name+s.getVal("rulesMsgs").temp_del_failed[1],d(e)})},n.searchTemplate=function(e){""!=n.info[e]?n.info.filter[e]=n.info[e]:n.info.filter[e]&&delete n.info.filter[e],n.tableParams.reload(),n.info.page.current>n.info.page.pages&&(0==n.info.page.pages?n.info.page.current=1:n.info.page.current=n.info.page.pages,n.tableParams.page(n.info.page.current))},n.sortColumn=function(e){"INPUT"!=document.activeElement.tagName&&"BUTTON"!=document.activeElement.tagName&&(n.tableParams.sorting(e,n.tableParams.isSortBy(e,"asc")?"desc":"asc"),n.info.page.sortField=e+(n.tableParams.isSortBy(e,"asc")?"asc":"desc"))},n.clearAppliedFilters=function(){if(0!=Object.keys(n.info.filter).length){for(var e in n.columns)delete n.columns[e].filterString;for(var e in n.columns)n.info[n.columns[e].field]="";n.info.filter={},n.tableParams.reload(),n.info.page.current=1,n.tableParams.page(n.info.page.current)}n.info.page.sortField!=n.info.initialSortField+"desc"&&(n.tableParams.sorting(n.info.initialSortField,"desc"),n.info.page.sortField=n.info.initialSortField+"desc")},n.checkAppliedFilters=function(){var e=!1;return!(!(e=0!=Object.keys(n.info.filter).length||e)&&n.info.page.sortField==n.info.initialSortField+"desc")},n.rulesList=o.getRulesList(),n.renderHtml=function(e){return t.trustAsHtml(e)}}]).controller("AddEditTemplateCtrl",["$scope","$sce","$timeout","$filter","ModalService","RulesService","GlobalService","UserTrackingService","AppService",function(o,t,n,e,s,r,l,i,c){o.info={},o.info.application=l.getVal("navRules"),o.info.pageLoading=!1,o.info.templateAdded=!1,o.info.addTemplateMsg={},o.info.sessionTimedOut=!1;var a=l.getVal("manufacturer");l.getVal("product"),l.getVal("schema");function d(e){!o.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(o.info.sessionTimedOut=!0,s.sessionTimeout())}o.info.commonConstants=e("filter")(l.getVal("templateConstants").common,{enabled:!0}),o.info.customerConstants=e("filter")(l.getVal("templateConstants").customer[a],{enabled:!0}),o.info.templateConstants=[],o.info.templateConstants.push.apply(o.info.templateConstants,o.info.commonConstants),o.info.templateConstants.push.apply(o.info.templateConstants,o.info.customerConstants),r.getTemplatesList()||(o.info.pageLoading=!0,r.getTemplates().then(function(e){o.templatesList=e.data.Data,r.setTemplatesList(o.templatesList),o.setTemplatesLabelMap(),o.info.pageLoading=!1},function(e){o.info.pageLoading=!1,e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(l.logError(Object.values(l.getVal("errorMsgs"))[1]),o.info.addTemplateMsg={type:"failure",msg:l.getVal("rulesMsgs").h2_down_msg}):o.info.addTemplateMsg={type:"failure",msg:l.getVal("rulesMsgs").temp_load_failed},d(e)})),o.clearMessage=function(){o.info.pageLoading||(o.info.addTemplateMsg={})},o.setTemplatesLabelMap=function(){for(var e={},t=0;t<o.templatesList.length;t++)e[o.templatesList[t].template_name]=!0;r.setTemplatesLabelMap(e)},o.populateAddTemplate=function(){o.info.pageLabel="Add New Template",o.info.templateName="",o.info.initialTemplateName=null,o.info.toAddress="",o.info.cc="",o.info.bcc="",o.info.subject="",o.info.body="",o.info.alertPerRow="TRUE",o.setSavedMode()},o.populateEditTemplate=function(){o.info.pageLabel="Edit Template - "+r.getTemplateMode().data.template_name,o.info.templateID=r.getTemplateMode().data.template_id,o.info.templateName=r.getTemplateMode().data.template_name,o.info.initialTemplateName=r.getTemplateMode().data.template_name,o.info.toAddress=r.getTemplateMode().data.to,o.info.cc=r.getTemplateMode().data.cc,o.info.bcc=r.getTemplateMode().data.bcc,o.info.subject=r.getTemplateMode().data.subject.replace(/\{[^\.]+\./g,"{"),o.info.body=r.getTemplateMode().data.body.replace(/\{[^\.]+\./g,"{"),o.info.alertPerRow=r.getTemplateMode().data.alertperrow,o.setSavedMode()},o.setSavedMode=function(){r.setTemplateSavedStatus(!1)},o.setUnsavedMode=function(){r.setTemplateSavedStatus(!0)},r.getTemplateMode()&&"edit"==r.getTemplateMode().mode?o.populateEditTemplate():o.populateAddTemplate(),o.addNewTemplate=function(){r.setTemplateMode("new"),o.info.templateAdded=!1,o.info.addTemplateMsg={},o.populateAddTemplate()},o.saveTemplate=function(){if(o.validateTemplate()){o.info.pageLoading=!0;for(var a=o.info.subject,n=o.info.body,e=0;e<o.info.commonConstants.length;e++)-1!=a.indexOf(o.info.commonConstants[e].value)&&(a=a.replace(o.info.commonConstants[e].value,"{rule."+o.info.commonConstants[e].value.substring(1,o.info.commonConstants[e].value.length-1)+"}")),-1!=n.indexOf(o.info.commonConstants[e].value)&&(n=n.replace(o.info.commonConstants[e].value,"{rule."+o.info.commonConstants[e].value.substring(1,o.info.commonConstants[e].value.length-1)+"}"));if(Array.isArray(o.info.customerConstants))for(e=0;e<o.info.customerConstants.length;e++)-1!=a.indexOf(o.info.customerConstants[e].value)&&(a=a.replace(o.info.customerConstants[e].value,"{context."+o.info.customerConstants[e].value.substring(1,o.info.customerConstants[e].value.length-1)+"}")),-1!=n.indexOf(o.info.customerConstants[e].value)&&(n=n.replace(o.info.customerConstants[e].value,"{context."+o.info.customerConstants[e].value.substring(1,o.info.customerConstants[e].value.length-1)+"}"));r.getTemplateMode()&&"edit"==r.getTemplateMode().mode?r.editTemplate(o.info.templateID,o.info.templateName.replace(/\'/g,"''").replace(/^\s+|\s+$/g,""),a.replace(/\'/g,"''").replace(/^\s+|\s+$/g,""),n.replace(/\'/g,"''").replace(/^\s+|\s+$/g,""),o.info.alertPerRow).then(function(e){o.info.addTemplateMsg={type:"success",msg:l.getVal("rulesMsgs").add_template_success},t=o.info.initialTemplateName!=o.info.templateName?((t={}).old=o.info.initialTemplateName,t.new=o.info.templateName,JSON.stringify(t)):o.info.templateName,i.standard_user_tracking(o.info.application,"Add_Edit template","edit",t).then(function(e){},d),o.info.templateAdded=!0,o.info.pageLoading=!1;var t={template_id:e.data.Data,template_name:o.info.templateName.replace(/^\s+|\s+$/g,""),to:o.info.toAddress.replace(/^\s+|\s+$/g,""),cc:o.info.cc.replace(/^\s+|\s+$/g,""),bcc:o.info.bcc.replace(/^\s+|\s+$/g,""),subject:a.replace(/^\s+|\s+$/g,""),body:n.replace(/^\s+|\s+$/g,""),alertperrow:o.info.alertPerRow};o.info.initialTemplateName!=o.info.templateName&&(delete(e=r.getTemplatesLabelMap())[o.info.initialTemplateName],e[o.info.templateName.replace(/^\s+|\s+$/g,"")]=!0,r.setTemplatesLabelMap(e)),r.setTemplateMode("edit",t),o.populateEditTemplate()},function(e){e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(l.logError(Object.values(l.getVal("errorMsgs"))[1]),o.info.addTemplateMsg={type:"failure",msg:l.getVal("rulesMsgs").h2_down_msg}):o.info.addTemplateMsg={type:"failure",msg:l.getVal("rulesMsgs").add_template_fail},o.info.templateAdded=!1,o.info.pageLoading=!1,d(e)}):r.addTemplate(o.info.templateName.replace(/\'/g,"''").replace(/^\s+|\s+$/g,""),a.replace(/\'/g,"''").replace(/^\s+|\s+$/g,""),n.replace(/\'/g,"''").replace(/^\s+|\s+$/g,""),o.info.alertPerRow).then(function(e){o.info.addTemplateMsg={type:"success",msg:l.getVal("rulesMsgs").add_template_success},i.standard_user_tracking(o.info.application,"Add_Edit template","add",o.info.templateName).then(function(e){},d),o.info.templateAdded=!0,o.info.pageLoading=!1;var e={template_id:e.data.Data,template_name:o.info.templateName.replace(/^\s+|\s+$/g,""),to:o.info.toAddress.replace(/^\s+|\s+$/g,""),cc:o.info.cc.replace(/^\s+|\s+$/g,""),bcc:o.info.bcc.replace(/^\s+|\s+$/g,""),subject:a.replace(/^\s+|\s+$/g,""),body:n.replace(/^\s+|\s+$/g,""),alertperrow:o.info.alertPerRow},t=r.getTemplatesLabelMap();t[o.info.templateName]=!0,r.setTemplatesLabelMap(t),r.setTemplateMode("edit",e),o.populateEditTemplate()},function(e){e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(l.logError(Object.values(l.getVal("errorMsgs"))[1]),o.info.addTemplateMsg={type:"failure",msg:l.getVal("rulesMsgs").h2_down_msg}):o.info.addTemplateMsg={type:"failure",msg:l.getVal("rulesMsgs").add_template_fail},o.info.templateAdded=!1,o.info.pageLoading=!1,d(e)})}},o.validateTemplate=function(){if(/^\s*$/.test(o.info.templateName))s.alertBox({msg:"Template Name"+l.getVal("rulesMsgs").temp_field_blank});else{var e=r.getTemplatesLabelMap();if(o.info.initialTemplateName){if(o.info.templateName!=o.info.initialTemplateName&&e.hasOwnProperty(o.info.templateName))return void s.alertBox({msg:l.getVal("rulesMsgs").temp_exists[0]+o.info.templateName+l.getVal("rulesMsgs").temp_exists[1]})}else if(e.hasOwnProperty(o.info.templateName))return void s.alertBox({msg:l.getVal("rulesMsgs").temp_exists[0]+o.info.templateName+l.getVal("rulesMsgs").temp_exists[1]});l.getVal("templateSupportedDomains");if(/^\s*$/.test(o.info.subject))s.alertBox({msg:"Subject"+l.getVal("rulesMsgs").temp_field_blank});else{var t=o.info.subject.match(/\{[^\}]+\}/g);if(t)for(var a=0;a<t.length;a++){var n=!1;if("{alert_msg}"==t[a])return void s.alertBox({msg:t[a]+" is allowed only in template body"});for(var i=0;i<o.info.templateConstants.length;i++)if(t[a]==o.info.templateConstants[i].value){n=!0;break}if(!n)return void s.alertBox({msg:t[a]+l.getVal("rulesMsgs").temp_invalid_constant})}if(!/^\s*$/.test(o.info.body)){if(t=o.info.body.match(/\{[^\}]+\}/g))for(a=0;a<t.length;a++){for(n=!1,i=0;i<o.info.templateConstants.length;i++)if(t[a]==o.info.templateConstants[i].value){n=!0;break}if(!n)return void s.alertBox({msg:t[a]+l.getVal("rulesMsgs").temp_invalid_constant})}return!0}s.alertBox({msg:"Body"+l.getVal("rulesMsgs").temp_field_blank})}}},o.renderHtml=function(e){return t.trustAsHtml(e)}}]).controller("RulesListCtrl",["$scope","$q","$sce","GlobalService","$window","$filter","$timeout","ngTableParams","RulesService","ModalService","UserTrackingService","AppService","metaDataService","RulesTestWithLogvault","$cookies","$document","UtilService",function(s,t,n,r,g,l,p,m,d,o,h,c,e,a,u,b,v){function f(e){!s.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(s.info.sessionTimedOut=!0,o.sessionTimeout())}s.supportEmail=r.getVal("supportEmail"),d.getInfoData()?s.info=d.getInfoData():s.info={},s.info.application=r.getVal("navRules"),s.info.filter={},s.rulesList=[],s.filterCount=0,s.info.rulesLoading=!0,s.info.rulesPageLoading=!0,s.info.sessionTimedOut=!1,s.columns=l("filter")(r.getVal("rulesColumns"),{enabled:!0}),s.columnsToExport=l("filter")(r.getVal("rulesColumnsForExport"),{enabled:!0}),s.info.initialSortField=r.getVal("rulesSortField"),s.info.rulesListMsg={},s.info.recursionDone=0,s.info.recursionLimit=r.getVal("rescursionLimit"),s.hasAccessToUnsupportedRules=r.getVal("hasAccessToUnsupportedRules"),s.multipleRulesDeleteReq=[],s.showColumnFilterPanel=!1,s.showColumnFilterPanelLoading=!1,s.showAnalyticsDashboards=!1,s.availableRulesOwnerList=[],s.info.supportedStatus=r.getVal("rulesSupportedStatus"),s.info.rulesHistoryTypesOfChanges=r.getVal("rulesHistoryTypesOfChanges"),s.info.initialSorting={},s.info.initialSorting[s.info.initialSortField]="desc",s.currentRule="",s.currentOwner="",s.amIAdmin=e.getFeatures()&&e.getFeatures().admin||!1,s.amIRuleCreator=!!e.getFeatures()&&e.getFeatures()[r.getVal("ruleCreatorFielName")],s.myEmail=e.getUser().email,s.selectedRuleForRuleLabelAnalytics={},s.multipleRuleOwnerChange=[],s.multipleRuleOwnerChangeRuleIds=[],s.multipleRulesSelectedOwner=null,s.multipleRulesOernerFilter="",s.selectedRuleName="",s.info.enableRuleComments="",s.info.enableRuleCommentsLimitMin=r.getVal("ruleStatusChangeCommentMinLen"),s.info.enableRuleCommentsLimitMax=r.getVal("ruleStatusChangeCommentMaxLen"),s.info.ruleHistoryTableExpandAll=!1,s.changeDetails=[],s.timefilter=r.getVal("ruleListTimeFilter"),s.showSelectNotify=!1,s.info.actionMessageFlag=!1,s.info.clinsightFlag=r.getVal("clinsightFlag")||!1,d.getPriorities().then(function(e){s.info.priorities=e.data.Data},function(e){s.info.priorities=[],e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.addRuleMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}),f(e)}),d.getSeverities().then(function(e){s.info.severities=e.data.Data,d.setSeveritiesList(s.info.severities)},function(e){s.info.severities=[],e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.addRuleMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}),f(e)}),d.getCategories().then(function(e){s.info.categories=e.data.Data},function(e){s.info.categories=[],e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.addRuleMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}),console.error("Unable to load categories"),f(e)}),s.info.page={total:0,current:1,pages:0,count:10,sortField:s.info.initialSortField+"desc"},d.getPageState()&&(s.info.page.current=d.getPageState()),s.rulesTypeSelected=d.getRuleType(),s.rulesType=[{label:"supported",selected:!0},{label:"unsupported",selected:!1}],s.isInSupportedRuleListPage=function(){return"supported"==s.rulesTypeSelected},s.resettofirst=!1,s.rulesTypeChange=function(e){s.rulesTypeSelected!=e.label&&(d.setStateGroupData(void 0),s.showColumnFilterPanel=!1,d.setFilterState(void 0),d.setPageState(void 0),s.clearAppliedFilters(),s.showFilterCount(),s.rulesTypeSelected=e.label,d.setRuleType(s.rulesTypeSelected),s.reloadRules())},s.clearMessage=function(){s.info.rulesLoading||(s.info.rulesListMsg={})},s.ruleAnalyticsConfig=r.getVal("ruleAnalyticsConfig"),s.$watch("info.rulesPageLoading",function(){s.info.rulesPageLoading||c.hidePanelLoading()}),s.populateTable=function(){s.tableParams=new m({page:s.resettofirst?1:s.info.page.current,count:s.info.page.count,sorting:s.info.initialSorting},{total:s.rulesList.length,getData:function(e,a){orderedData=a.sorting()&&a.sorting()[s.info.initialSortField]?s.rulesList.sort(function(e,t){e=(e=new Date(e[s.info.initialSortField]+"").getTime()).toString(),t=(t=new Date(t[s.info.initialSortField]+"").getTime()).toString();return a.orderBy()!="+"+s.info.initialSortField&&a.orderBy()=="-"+s.info.initialSortField?-1*e.localeCompare(t):e.localeCompare(t)}):a.sorting()&&a.sorting().created_ts?s.rulesList.sort(function(e,t){e=(e=new Date(e.created_ts+"").getTime()).toString(),t=(t=new Date(t.created_ts+"").getTime()).toString();return"+created_ts"!=a.orderBy()&&"-created_ts"==a.orderBy()?-1*e.localeCompare(t):e.localeCompare(t)}):a.sorting()?l("orderBy")(s.rulesList,a.orderBy()):s.rulesList,orderedData=s.getFilterredRules(orderedData),s.orderedData=orderedData,a.total(orderedData.length),s.info.page.total=orderedData.length,s.info.page.pages=Math.ceil(s.info.page.total/s.info.page.count),d.getPageState()?d.getPageState()>s.info.page.pages?s.info.page.current=s.info.page.pages:s.info.page.current=d.getPageState():s.info.page.current=1,1==s.resettofirst&&(s.info.page.current=1),s.currentSelected=orderedData.filter(function(e,t){return e.selected}).length,s.currentRuleList=orderedData,s.CurrentPageList=orderedData.slice((s.info.page.current-1)*a.count(),s.info.page.current*a.count()),s.CurrentPageList.filter(function(e,t){return e.selected}).length==s.info.page.count?s.info.selectAllCurrentPage=!0:s.info.selectAllCurrentPage=!1,s.showSelectNotify=0<s.currentSelected,e.resolve(orderedData.slice((s.info.page.current-1)*a.count(),s.info.page.current*a.count())),s.resettofirst=!1}})},d.getFilterState()&&(s.info.filter=d.getFilterState()),s.getFilterredRules=function(e){return l("filterRules")(e,s.info.filter)},s.$watch("info",function(e,t){d.setInfoData(e)},!0),s.loadRules=function(){d.getFilterState()?s.showColumnFilterPanel=!!Object.keys(d.getFilterState()).length:s.showColumnFilterPanel=!1,d.getAllConfig().then(function(e){e.data.Data.config.api_template_feature||(s.showAlertApiFeature=!1);var t,a,n,o,e=e.data.Data;c.isGbStudioApp()&&(e.config=e.default_config||e.config,e.file_upload_config=e.default_file_upload_config||e.file_upload_config),d.getStagingDomain()&&d.getStagingKeyspace()||(d.setStagingDomain(e.config.is_stage_domain),d.setStagingKeyspace(e.config.is_stage_keyspace),a=r.getVal("infoserverDomain"),t=r.getVal("umsDomain"),e=e.config.is_stage_domain,a&&t&&(n=(a=a.split("/")).pop(),(o={})[a.join("/")]="/"+n+"/xproxy",n=(a=t.split("/")).pop(),o[a.join("/")]="/"+n+"/xproxy",e&&(n=(a=e.split("/")).pop(),o[a.join("/")]="/"+n+"/xproxy"),xdomain.slaves(o))),d.getAllRules(s.rulesTypeSelected).then(function(e){if(!e.data.hasOwnProperty("Data")&&s.info.recursionDone<s.info.recursionLimit)return s.info.recursionDone++,s.info.recursionDone==s.info.recursionLimit?(s.rulesList="",void(s.info.rulesLoading=!1)):void s.loadRules();var n;s.rulesList=l("filterMultiples")(e.data.Data,{status:[s.info.supportedStatus.Enabled,s.info.supportedStatus.Disabled,s.info.supportedStatus.Draft]})||[],s.FilterRulesBasedOnUserRoleAndPermission(),s.populateTable(),d.getloadExplorerRules()||(s.info.rulesLoading=!1,s.info.rulesPageLoading=!1),d.setRulesList(s.rulesList),s.setRulesLabelMap(),s.setAllRulesMap(),303==e.status&&(s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").rules_load_failed}),s.rulesList.forEach(function(e,t){var a;0<e.email_template_id&&(a=e.subscribed_users,e.subscribed_users=a.length&&","==a[a.length-1]?a.substring(0,a.length-1):a,e.subscriberCount=e.subscribed_users.length?e.subscribed_users.split(",").filter(Boolean).length:0,e.subscriptionEmailList=e.subscribed_users.length?e.subscribed_users.split(",").filter(Boolean):[],"ENABLED"==e.status&&(0==e.subscription_enabled?e.subscriptionEmailList.includes(u.username)&&(e.subscribeIcon=!1,e.mySubscriedRule=e.subscriptionEmailList.includes(u.username)?"My Subscribed Rules":"Subscribable Rules"):1==e.subscription_enabled&&(e.subscribeIcon=!e.subscriptionEmailList.includes(u.username),e.mySubscriedRule=e.subscriptionEmailList.includes(u.username)?"My Subscribed Rules":"Subscribable Rules"))),e.tags.length&&e.tags.forEach(function(e){e.label=e.tag_name})}),d.getStateGroupData()?(s.groupedFilterData=d.getgroupdata(s.rulesList),s.info=d.getInfoData(),s.showAlertApiFeature||s.groupedFilterData.forEach(function(e){"api_template_name"==e.field&&(e.enabled=!1)}),s.groupedFilterData.forEach(function(e){if(e.multiselect&&(e.data.length?e.enabled=!0:(delete s.info.filter[e.field],e.enabled=!1,e.expanded=!1,e.selected=!1)),"label_display"==e.field||"description"==e.field||"author"==e.field||"rule_name"==e.field)for(var t in s.info.filter)t==[e.field]&&(s.info[e.field]=s.info.filter[e.field])}),n=Object.keys(s.info.filter),s.groupedFilterData.forEach(function(e){if(e.multiselect&&-1!=n.indexOf(e.field)){var t=s.info.filter[e.field],a=[];for(e.data.forEach(function(e){a.push(e.label)}),i=0;i<t.length;i++)-1==a.indexOf(t[i])&&t.splice(i,1);(s.info.filter[e.field]=t).length||delete s.info.filter[e.field]}})):(s.groupedFilterData=d.getgroupdata(s.rulesList),s.showAlertApiFeature||s.groupedFilterData.forEach(function(e){"api_template_name"==e.field&&(e.enabled=!1)}),s.groupedFilterData.forEach(function(e){e.multiselect&&e.data.length&&(e.enabled=!0),e.expanded=!1}))},function(e){s.rulesList="",s.populateTable(),d.getloadExplorerRules()||(s.info.rulesLoading=!1,s.info.rulesPageLoading=!1),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}):s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").rules_load_failed},f(e),console.error("Unable to load Rules List"),s.clearAppliedFilters()})},function(e){s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").rules_load_failed},f(e)}),h.getAllConfig().then(function(e){e&&e.data.Data&&e.data.Data.config.col_ver_name&&(s.info.addRuleVersionFields=r.setVal("addRuleVersionFields",e.data.Data.config.col_ver_name.split(",")))},function(e){})},s.loadRules(),s.loadFilterPanelData=function(){s.showColumnFilterPanel=!0,d.setStateGroupData(s.groupedFilterData)},s.reloadFilterPanelData=function(){s.rulesList.forEach(function(t){s.showAlertApiFeature||s.groupedFilterData.filter(function(e){"api_template_name"==e.field&&(e.enabled=!1)}),s.groupedFilterData.forEach(function(e){"label_display"==e.field&&"description"==e.field&&"author"==e.field&&"rule_name"==e.field&&"created_ts"==e.field&&"modified_ts"==e.field&&"rule_owner"==e.field||(e.data?t[e.field]&&""!=t[e.field].trim()&&t[e.field]&&null!=t[e.field].trim()&&-1==e.data.indexOf(t[e.field])&&e.data.push(t[e.field]):e.data=[])})}),s.showColumnFilterPanelLoading=!1},s.countListBasedOnStatus=function(a){return s.rulesList&&s.rulesList.length?s.orderedData?s.orderedData.reduce(function(e,t){return t.status.toLowerCase()===a.toLowerCase()?e+1:e},0):void 0:0},s.filterListBasedOnStatus=function(e){var t=s.groupedFilterData.filter(function(e){if("status"==e.field)return!0}),a=s.info.status,n=t[0].data;Object.keys(a).forEach(function(t){n.forEach(function(e){e.label===t&&(e.selected=a[t])})}),s.changeFilter({field:"status"},e)},s.setRulesLabelMap=function(){for(var e={},t=0;t<s.rulesList.length;t++)e[s.rulesList[t].label]=!0;d.setRulesLabelMap(e)},s.setAllRulesMap=function(){d.getRulesLabelsList().then(function(e){if(Array.isArray(e.data.Data)){for(var t={},a=0;a<e.data.Data.length;a++)t[e.data.Data[a]]=!0;d.setRulesLabelMap(t)}},f)},s.resetColumnFilterPanel=function(){s.columns.forEach(function(e){e.allValueList=[]})},s.reloadRules=function(){s.info.rulesLoading=!0,d.getFilterState()?s.showColumnFilterPanel=!!Object.keys(d.getFilterState()).length:s.showColumnFilterPanel=!1,d.getAllRules(s.rulesTypeSelected).then(function(e){var n;s.rulesList=l("filterMultiples")(e.data.Data,{status:[s.info.supportedStatus.Enabled,s.info.supportedStatus.Disabled,s.info.supportedStatus.Draft]}),s.rulesList.forEach(function(e){var t;0<e.email_template_id&&(t=e.subscribed_users,e.subscribed_users=t.length&&","==t[t.length-1]?t.substring(0,t.length-1):t,e.subscriberCount=e.subscribed_users.length?e.subscribed_users.split(",").filter(Boolean).length:0,e.subscriptionEmailList=e.subscribed_users.length?e.subscribed_users.split(",").filter(Boolean):[],"ENABLED"==e.status&&(0==e.subscription_enabled?e.subscriptionEmailList.includes(u.username)&&(e.subscribeIcon=!1,e.mySubscriedRule=e.subscriptionEmailList.includes(u.username)?"My Subscribed Rules":"Subscribable Rules"):1==e.subscription_enabled&&(e.subscribeIcon=!e.subscriptionEmailList.includes(u.username),e.mySubscriedRule=e.subscriptionEmailList.includes(u.username)?"My Subscribed Rules":"Subscribable Rules"))),e.tags.length&&e.tags.forEach(function(e){e.label=e.tag_name})}),d.getStateGroupData()?(s.groupedFilterData=d.getgroupdata(s.rulesList),s.info=d.getInfoData(),s.showAlertApiFeature||s.groupedFilterData.forEach(function(e){"api_template_name"==e.field&&(e.enabled=!1)}),s.groupedFilterData.forEach(function(e){if(e.multiselect&&(e.data.length?e.enabled=!0:(delete s.info.filter[e.field],e.enabled=!1,e.expanded=!1,e.selected=!1)),"label_display"==e.field||"description"==e.field||"author"==e.field||"rule_name"==e.field)for(var t in s.info.filter)t==[e.field]&&(s.info[e.field]=s.info.filter[e.field])}),n=Object.keys(s.info.filter),s.groupedFilterData.forEach(function(e){if(e.multiselect&&-1!=n.indexOf(e.field)&&"status"!=e.field){var t=s.info.filter[e.field],a=[];for(e.data.forEach(function(e){a.push(e.label)}),i=0;i<t.length;i++)-1==a.indexOf(t[i])&&t.splice(i,1);(s.info.filter[e.field]=t).length||delete s.info.filter[e.field]}})):(s.groupedFilterData=d.getgroupdata(s.rulesList),s.showAlertApiFeature||s.groupedFilterData.forEach(function(e){"api_template_name"==e.field&&(e.enabled=!1)}),s.groupedFilterData.forEach(function(e){e.multiselect&&e.data.length&&(e.enabled=!0),e.expanded=!1})),s.FilterRulesBasedOnUserRoleAndPermission(),s.info.page.current=1,s.tableParams.reload(),s.tableParams.page(s.info.page.current),d.getloadExplorerRules()||(s.info.rulesLoading=!1),s.info.rulesLoading=!1,d.setRulesList(s.rulesList),s.setRulesLabelMap(),s.setAllRulesMap(),setTimeout(function(){s.info.actionMessageFlag=!1},3e3),s.trackUser(s.rulesTypeSelected,"View",{View:s.rulesTypeSelected,data:"none"})},function(e){s.rulesList="",s.info.page.current=1,s.tableParams.reload(),s.tableParams.page(1),d.getloadExplorerRules()||(s.info.rulesLoading=!1),s.info.rulesLoading=!1,e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}):s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").rules_load_failed},console.error("Unable to load Rules List"),f(e)})},s.addNewRule=function(){d.setRuleMode("new"),s.$parent.changeCurrentPage("add_rule")},d.getloadExplorerRules()&&(c.hidePanelLoading(),s.addNewRule()),s.checkRulesSelection=function(e){s.currentSelected=s.currentRuleList.filter(function(e,t){return e.selected}).length,s.showSelectNotify=0<s.currentSelected,s.CurrentPageList.filter(function(e,t){return e.selected}).length==s.info.page.count?s.info.selectAllCurrentPage=!0:s.info.selectAllCurrentPage=!1},s.checkSelectAll=function(){for(var e=0;e<s.currentRuleList.length;e++)s.currentRuleList[e].selected=!0;s.CurrentPageList.filter(function(e,t){return e.selected}).length==s.info.page.count?s.info.selectAllCurrentPage=!0:s.info.selectAllCurrentPage=!1,s.currentSelected=s.currentRuleList.filter(function(e,t){return e.selected}).length,s.showSelectNotify=0<s.currentSelected},s.selectcurrentpage=function(e){if(s.info.selectAllCurrentPage)for(var t=0;t<e.length;t++)e[t].selected=!0;else for(t=0;t<e.length;t++)delete e[t].selected;s.currentSelected=s.currentRuleList.filter(function(e,t){return e.selected}).length,s.showSelectNotify=0<s.currentSelected},s.clearselected=function(){for(var e=0;e<s.currentRuleList.length;e++)delete s.currentRuleList[e].selected;s.CurrentPageList.filter(function(e,t){return e.selected}).length==s.info.page.count?s.info.selectAllCurrentPage=!0:s.info.selectAllCurrentPage=!1,s.showSelectNotify=!1},s.checkSelectedRules=function(){if(s.rulesList&&0<(l("filter")(s.currentRuleList,{selected:!0})||[]).length)return!0;return!1},s.testRule=function(e){s.setPageListforTesting();var t=[];t.push(e),d.setTestRuleData(t),a.setRulesSelected(t),s.$parent.changeCurrentPage("test_rule_history")},s.goToTestRuleHistory=function(){s.setPageListforTesting();var e=[];d.setTestRuleData(e),a.setRulesSelected(e),s.$parent.changeCurrentPage("test_rule_history")},s.goToManageEmailTemplatePage=function(){s.$parent.changeCurrentPage("manage_template")},s.goToManageAPITemplatePage=function(){s.info.pageLoading=!0,s.$parent.changeCurrentPage("manage_API_template")},s.goToManageCategoryPage=function(){s.$parent.changeCurrentPage("add_category")},s.goToTestRule=function(){if(s.checkSelectedRules()){for(var e=[],t=!1,a=s.getFilterredRules(s.rulesList),n=0;n<a.length;n++)if(a[n].selected&&a[n].status==s.info.supportedStatus.Enabled){t=!0;break}if(t){for(n=0;n<a.length;n++)a[n].selected&&a[n].status==s.info.supportedStatus.Enabled&&e.push(a[n]);s.multipleRulesDeleteReq=e,s.msg=r.getVal("rulesMsgs").rule_test_multiple,s.modal=o.openModal("partials/rules-and-alerts/test_rule.html",s,!1,"static")}else o.alertBox({msg:r.getVal("rulesMsgs").rule_select_all_error})}},s.testRulesRequest=function(){s.setPageListforTesting();for(var e=[],t=0;t<s.rulesList.length;t++)s.rulesList[t].selected&&s.rulesList[t].status==s.info.supportedStatus.Enabled&&e.push(s.rulesList[t]);0<e.length&&(d.setTestRuleData(e),a.setRulesSelected(e),s.$parent.changeCurrentPage("test_rule_history"))},s.setPageListforTesting=function(){var e=r.getVal("rulesPages");e.test_rule_history=[{name:"rules_list",label:"Rules List"},{name:"test_rule_history",label:"Test Rule History"}],r.setVal("rulesPages",e)},s.enableDisableRule=function(e,t){s.selectedRule=e,s.selectedField=t,s.selectedRuleName=s.selectedRule.label_display,s.msg=e[t]==s.info.supportedStatus.Enabled,s.confirmEnablingDisableRule()},s.confirmEnablingDisableRule=function(){s.info.enableRuleComments="",s.modal=o.openModal("partials/rules-and-alerts/modal-enable-rule-message-box.html",s,"gb-modal-test-rule-enable-modal","static")},s.enableDisableStatusBtn=function(){return s.info.enableRuleComments.length>=s.info.enableRuleCommentsLimitMin},s.enableDisableRuleAction=function(){var t,e;s.info.rulesLoading||s.info.enableRuleComments.length&&(t=s.selectedRule,e=s.selectedField,s.modal.close(),s.info.rulesLoading=!0,t[e]==s.info.supportedStatus.Enabled?d.disableRule(t.rule_id,s.info.enableRuleComments).then(function(e){s.info.rulesListMsg={type:"success",msg:r.getVal("rulesMsgs").rule_disable_success[0]+t.label_display+r.getVal("rulesMsgs").rule_disable_success[1]},s.trackUser("Rules List","disable",t),s.reloadRules()},function(e){e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}):s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").rule_disable_failed[0]+t.label_display+r.getVal("rulesMsgs").rule_disable_failed[1]},console.error("Unable to disable rule "+t.label),s.info.rulesLoading=!1,f(e)}):d.enableRule(t.rule_id,s.info.enableRuleComments).then(function(e){s.info.rulesListMsg={type:"success",msg:r.getVal("rulesMsgs").rule_enable_success[0]+t.label_display+r.getVal("rulesMsgs").rule_enable_success[1]},s.trackUser("Rules List","enable",t),s.reloadRules()},function(e){e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}):s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").rule_enable_failed[0]+t.label_display+r.getVal("rulesMsgs").rule_enable_failed[1]},console.error("Unable to enable rule "+t.label),s.info.rulesLoading=!1,f(e)}))},s.editRule=function(e){e[s.columns[s.columns.length-1].field]!=s.info.supportedStatus.Disabled?(e.label=e.label_display,d.setRuleMode("edit",e),s.$parent.changeCurrentPage("add_rule")):o.alertBox({msg:r.getVal("rulesMsgs").edit_rule_disabled})},s.changeRuleOwnership=function(e,t){s.currentRule=e,s.currentOwner=t,s.msg="Are you sure you want to change ownership(edit/delete) of rule <strong>"+e.label_display+"</strong> to user <strong>"+t+"</strong> ?",s.modal=o.openModal("partials/rules-and-alerts/change_rule_owner.html",s,!1,"static")},s.changeMultipleRuleOwnership=function(e){if(s.checkSelectedRules())if(s.availableRulesOwnerList.length){if(s.currentLoggedUser=u.username,0<(t=l("filter")(s.rulesList,{selected:!0})||[]).length){for(var t=[],a=s.getFilterredRules(s.rulesList),n=0;n<a.length;n++)a[n].selected&&(a[n].myRule||s.amIAdmin)&&t.push(a[n]);(s.multipleRuleOwnerChange=t).length<1?o.alertBox({msg:r.getVal("rulesMsgs").owner_change_multiple_warn}):(s.currentOwner=e,s.msg=r.getVal("rulesMsgs").owner_change_multiple,s.modal=o.openModal("partials/rules-and-alerts/multiple_owner_change.html",s,!1,"static"))}}else o.alertBox({msg:r.getVal("rulesMsgs").rules_owner_list_not_found})},s.setCurrentOwner=function(e){s.multipleRulesSelectedOwner=e},s.goToChangeMultipleRuleOwnership=function(){for(var e="",t="",a="",n=0;n<s.multipleRuleOwnerChange.length;n++)e=e?e+","+s.multipleRuleOwnerChange[n].rule_id:s.multipleRuleOwnerChange[n].rule_id,t=t?t+","+s.multipleRuleOwnerChange[n].status:s.multipleRuleOwnerChange[n].status,a=a?a+","+s.multipleRuleOwnerChange[n].rule_name:s.multipleRuleOwnerChange[n].rule_name;s.changeMultipleRuleOwnershipRequest(s.multipleRuleOwnerChange,e,t)},s.changeMultipleRuleOwnershipRequest=function(e,t,a){s.modal.close(),s.showColumnFilterPanel=!1,s.info.rulesLoading=!0;var n={rule_owner:s.multipleRulesSelectedOwner,rule_id:t,rule_status:a};d.updateRuleOwnership(n).then(function(e){e.data.Data;s.trackUser("Rules List","MultipleOwnership change",n),s.reloadRules(),s.multipleRulesSelectedOwner=null},function(e){s.info.rulesLoading=!1,s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").update_rule_load_owners_failed}})},s.emptySleectedOwner=function(){s.multipleRulesSelectedOwner=null},s.deleteRule=function(e){s.delRule=e,s.msg=r.getVal("rulesMsgs").rule_del_single[0]+e.label_display+r.getVal("rulesMsgs").rule_del_single[1],s.modal=o.openModal("partials/rules-and-alerts/delete_rule.html",s,!1,"static")},s.deleteRuleRequest=function(a,n,e,t){var i=s.delRule;s.info.rulesLoading=!0;a||(n=i.rule_id,i.label,e=i.status,t=i.email_template_id),d.deleteRule(n,e,t).then(function(e){a?s.deleteSubscriptionFilter(n.split(",").map(function(e){return parseInt(e,10)}),!0):s.deleteSubscriptionFilter(i,!1),s.reloadRules();var t=d.getRulesLabelMap();i?(delete t[i.label],s.trackUser("Rules List","delete",i),s.info.rulesListMsg={type:"success",msg:r.getVal("rulesMsgs").rule_delete_success[0]+i.label_display+r.getVal("rulesMsgs").rule_delete_success[1]}):(a.map(function(e){delete t[e.rule_name],s.trackUser("Rules List","delete",e)}),s.info.rulesListMsg={type:"success",msg:r.getVal("rulesMsgs").rule_delete_multiple_success}),d.setRulesLabelMap(t)},function(e){s.info.rulesLoading=!1,i?console.error("Unable to delete "+i.label):a.map(function(e){console.error("Unable to delete "+e.label_display)}),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}):s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").rule_delete_multiple_failed},f(e)})},s.deleteMultipleRulesConfirm=function(){if(s.checkSelectedRules()){for(var e,t=[],a=!1,n=s.getFilterredRules(s.rulesList),i=0;i<n.length;i++)if(e=n[i],n[i].selected&&e.rule_owner===s.myEmail){a=!0;break}if(a){for(i=0;i<n.length;i++)e=n[i],n[i].selected&&e.rule_owner===s.myEmail&&t.push(n[i]);s.multipleRulesDeleteReq=t,s.msg=r.getVal("rulesMsgs").rule_del_multiple,s.modal=o.openModal("partials/rules-and-alerts/delete_multiple_rules.html",s,!1,"static")}else o.alertBox({msg:r.getVal("rulesMsgs").rule_delete_select_all_error})}},s.goToDeleteRule=function(){for(var e="",t="",a="",n="",i=0;i<s.multipleRulesDeleteReq.length;i++)e=e?e+","+s.multipleRulesDeleteReq[i].rule_id:s.multipleRulesDeleteReq[i].rule_id,t=t?t+","+s.multipleRulesDeleteReq[i].status:s.multipleRulesDeleteReq[i].status,a=a?a+","+s.multipleRulesDeleteReq[i].rule_name:s.multipleRulesDeleteReq[i].rule_name,n=n?n+","+s.multipleRulesDeleteReq[i].email_template_id:s.multipleRulesDeleteReq[i].email_template_id;s.deleteRuleRequest(s.multipleRulesDeleteReq,e,t,n)},s.changePageSize=function(){s.info.page.count=parseInt(s.info.page.count),s.tableParams.count(s.info.page.count),s.info.page.pages=Math.ceil(s.info.page.total/s.info.page.count),s.info.page.current>s.info.page.pages&&(s.info.page.current=s.info.page.pages,s.tableParams.page(s.info.page.current)),d.setPageState(s.info.page.current)},s.nextPage=function(){s.info.page.current<s.info.page.pages&&(s.info.page.current+=1,s.tableParams.page(s.info.page.current),d.setPageState(s.info.page.current))},s.prevPage=function(){1<s.info.page.current&&(--s.info.page.current,s.tableParams.page(s.info.page.current)),d.setPageState(s.info.page.current)},s.firstPage=function(){1!=s.info.page.current&&(s.info.page.current=1,s.tableParams.page(s.info.page.current),d.setPageState(s.info.page.current))},s.lastPage=function(){s.info.page.current!=s.info.page.pages&&(s.info.page.current=s.info.page.pages,s.tableParams.page(s.info.page.current),d.setPageState(s.info.page.current))},s.searchRule=function(e,t){t&&(s.info[e]=""),""!=s.info[e]?(s.info.filter[e]=s.info[e],d.setFilterState(s.info.filter)):s.info.filter[e]&&(delete s.info.filter[e],d.setFilterState(s.info.filter)),d.setStateGroupData(s.groupedFilterData),s.resettofirst=!0,s.tableParams.reload()},s.showHideColumn=function(e,t){e.selected=!e.selected,t.stopPropagation()},s.changeFilter=function(e,t,a){if(s.info[e.field][t])if(s.info.filter[e.field]||(s.info.filter[e.field]=[]),s.info.filter[e.field].push(t),e.field!=s.columns[s.columns.length-1].field)e.filterString=s.info.filter[e.field].join(", ");else{e.filterString="";for(var n=0;n<s.info.filter[e.field].length;n++)e.filterString+=0==n?s.info.filter[e.field][n]==s.info.supportedStatus.Enabled?"Enabled":s.info.filter[e.field][n]==s.info.supportedStatus.Disabled?"Disabled":"Draft":", "+(s.info.filter[e.field][n]==s.info.supportedStatus.Enabled?"Enabled":s.info.filter[e.field][n]==s.info.supportedStatus.Disabled?"Disabled":"Draft")}else if(s.info.filter[e.field].splice(s.info.filter[e.field].indexOf(t),1),0<s.info.filter[e.field].length)if(e.field!=s.columns[s.columns.length-1].field)e.filterString=s.info.filter[e.field].join(", ");else{e.filterString="";for(n=0;n<s.info.filter[e.field].length;n++)e.filterString+=0==n?s.info.filter[e.field][n]==s.info.supportedStatus.Enabled?"Enabled":s.info.filter[e.field][n]==s.info.supportedStatus.Disabled?"Disabled":"Draft":", "+(s.info.filter[e.field][n]==s.info.supportedStatus.Enabled?"Enabled":s.info.filter[e.field][n]==s.info.supportedStatus.Disabled?"Disabled":"Draft")}else e.filterString="",delete s.info.filter[e.field];d.setStateGroupData(s.groupedFilterData),d.setFilterState(s.info.filter),d.setPageState(s.info.page.current),s.showFilterCount(),s.trackUser("Rules List","filter",s.info.filter),s.resettofirst=!0,s.tableParams.reload()},s.formatDateTime=function(e){return moment(new Date(moment.utc(e).format())).format("YYYY/MM/DD HH:MM:SS")},s.sortColumn=function(e){"INPUT"!=document.activeElement.tagName&&"BUTTON"!=document.activeElement.tagName&&(s.tableParams.sorting(e,s.tableParams.isSortBy(e,"asc")?"desc":"asc"),s.info.page.sortField=e+(s.tableParams.isSortBy(e,"asc")?"asc":"desc"))},s.clearAppliedFilters=function(){for(var e in s.groupedFilterData)delete s.groupedFilterData[e].filterString;if(0!=Object.keys(s.info.filter).length){for(var e in s.groupedFilterData)"label_display"==s.groupedFilterData[e].field||"description"==s.groupedFilterData[e].field||"author"==s.groupedFilterData[e].field||"rule_name"==s.groupedFilterData[e].field?s.info[s.groupedFilterData[e].field]="":(s.info[s.groupedFilterData[e].field]={},s.groupedFilterData[e].data&&Array.isArray(s.groupedFilterData[e].data)&&s.groupedFilterData[e].data.forEach(function(e){e.selected=!1}));s.info.filter={},d.setFilterState(void 0),d.setPageState(void 0),d.setStateGroupData(void 0),s.tableParams.reload(),s.info.page.current=1,s.tableParams.page(s.info.page.current)}s.info.page.sortField!=s.info.initialSortField+"desc"&&(s.tableParams.sorting(s.info.initialSortField,"desc"),s.info.page.sortField=s.info.initialSortField+"desc"),d.setStateGroupData(void 0)},s.checkAppliedFilters=function(){var e=!1;return!(!(e=0!=Object.keys(s.info.filter).length||e)&&s.info.page.sortField==s.info.initialSortField+"desc")},s.renderHtml=function(e){return n.trustAsHtml(e)},s.showAnalyicsModal=function(){s.showAnalyticsDashboards=!0,s.modal=o.openModal("partials/rules-and-alerts/dashboard.html",s,"gb-rules-dashboard-modal","static"),s.trackUser("Main_Analytics","View",{View:"Main analytics",data:"none"})},s.hideAnalyticsModal=function(){s.showAnalyticsDashboards=!1,s.modal.close()},s.showOwnersDropDown=function(){s.availableRulesOwnerList.length||o.alertBox({msg:r.getVal("rulesMsgs").rules_owner_list_not_found})},s.loadRulesOwnerList=function(){d.getRulesOwenrList().then(function(e){e=e.data.Data;s.availableRulesOwnerList=e},function(e){s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").rules_load_owners_list_failed},s.availableRulesOwnerList=[]})},s.filterOwnerListByRule=function(e,t){var a=[];if(s.availableRulesOwnerList)for(var n=0;n<s.availableRulesOwnerList.length;n++)s.availableRulesOwnerList[n].email==e||t&&-1==s.availableRulesOwnerList[n].email.indexOf(t)||a.push(s.availableRulesOwnerList[n]);return a},s.loadRulesOwnerList(),s.updateRulesWithOwnerInformation=function(t,a){s.rulesList.forEach(function(e){e.rule_id===t&&(e.rule_owner=a)})},s.changeRuleOwnershipRequest=function(){s.modal.close(),s.info.rulesLoading=!0;var t={rule_owner:s.currentOwner,rule_id:s.currentRule.rule_id,rule_status:s.currentRule.status};d.updateRuleOwnership(t).then(function(e){e.data.Data;s.trackUser("Ownership","change",t),s.reloadRules()},function(e){s.info.rulesLoading=!1,s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").update_rule_load_owners_failed}})},s.FilterRulesBasedOnUserRoleAndPermission=function(){var e=s.rulesList.filter(function(e){return s.amIAdmin?e.myRule=!0:e.status===s.info.supportedStatus.Draft&&e.rule_owner!==s.myEmail?e.myRule=!1:e.rule_owner===s.myEmail?e.myRule=!0:!(e.myRule=!1)});s.rulesList=e},s.showRuleWiseAnalyticsModal=function(e){s.showRuleWiseAnalyticsDashboard=!0;d.setSelectedRuleForAnalytics(e),s.selectedRuleForRuleLabelAnalytics=e,s.modal=o.openModal("partials/rules-and-alerts/dashboard-rule-level.html",s,"gb-rule-level-dashboard-modal","static"),JSON.stringify({rule_id:e});s.trackUser("Rule_wise_Analytics","View",{rule_id:e})},s.hideRuleWiseAnalyticsModal=function(){s.showRuleWiseAnalyticsDashboard=!1,s.modal.close()},s.ruleDrillDetails=function(e){s.showViewDetailsDiv=!1,s.currentRuleName=[],s.currentRule=[],s.currentRule.push(e),s.currentRuleName=s.currentRule[0].rule_name,s.current_label_display=s.currentRule[0].label_display,d.getRuleDrillDetails(s.currentRuleName).then(function(e){var e=e.data.Data,i=0;e.map(function(e){if(i++,e.changes_map){for(var t=!1,a=0;a<e.changes_map.length;a++){for(var n in e.changes_map[a]){if(null==n||"null"==n){t=!0;break}if("state"==n&&e.changes_map[a][n]&&(e.changes_map[a][n].From==s.info.supportedStatus.Enabled||e.changes_map[a][n].From==s.info.supportedStatus.Disabled)&&e.changes_map[a][n].To==s.info.supportedStatus.Draft){t=!0;break}}if(t)break}t&&e.changes_map.splice(a,1),1==e.changes_map.length&&Object.keys(e.changes_map[0])&&"logic"==Object.keys(e.changes_map[0])[0]&&(e.type_of_change=s.info.rulesHistoryTypesOfChanges.logic)}e.type_of_change==s.info.rulesHistoryTypesOfChanges.created||e.type_of_change!==s.info.rulesHistoryTypesOfChanges.state&&0!=e.changes_map.length||i--,e.version=i,e.number_of_changes=e.changes_map.length,e.comments=null==e.comments||"null"==e.comments?"":e.comments}),s.changeDetails=e,0!=s.changeDetails.length?(s.modal=o.openModal("partials/rules-and-alerts/rule-drill-details.html",s,"gb-rule-level-dashboard-modal",!0,"static"),s.trackUser("Rule Change History","View",s.currentRule)):o.alertBox({msg:r.getVal("rulesMsgs").emptyRuleHistoryAlertMsg})},function(e){})},s.ruleHistoryExpandToggle=function(){s.info.ruleHistoryTableExpandAll=!s.info.ruleHistoryTableExpandAll,s.changeDetails.map(function(e){e.number_of_changes&&0<e.number_of_changes&&(s.info.ruleHistoryTableExpandAll?e.showDetails=!0:e.showDetails=!1)})},s.drillViewDetails=function(e){e.showDetails?(e.showDetails=!1,s.info.ruleHistoryTableExpandAll=!1):e.showDetails=!0},s.closeVidetailspopup=function(e){s.showViewDetailsDiv=!1},s.showHideOwnerList=function(e){return!!s.amIAdmin||e.myRule},s.showHideActionItem=function(e){return(e.status!==s.info.supportedStatus.Draft||e.rule_owner===s.myEmail)&&e.rule_owner===s.myEmail},s.ruleReadOnlyInfo=function(t){s.info.showSampleTemplate=!1,s.info.rulesLoading=!0,s.info.ignoreText1="Subject",s.info.ignoreText2="Body",d.getTemplates().then(function(e){s.info.templates=e.data.Data||[],s.info.templates.length&&(s.info.tempbody=s.info.templates.filter(function(e){e.template_id,t.email_template_id}),s.info.templates.forEach(function(e){e.template_id==t.email_template_id&&(s.info.showSampleTemplate=!0,t.subject=e.subject,t.body=e.body)})),s.modal=o.openModal("partials/rules-and-alerts/rule-read-only-info.html",s,"gb-read-only-details-modal",!0,"static"),s.info.rulesLoading=!1},function(e){s.info.showSampleTemplate=!1,s.info.templates=[],console.error("Unable to load templates"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.addRuleMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}),f(e)}),s.headersReadOnly=r.getVal("readOnlyHeaders"),s.sampleTemplateHeaders=r.getVal("sampleTemplateHeaders"),s.readOnlyDetails=t,s.readOnlyDetails.action=0<s.readOnlyDetails.email_template_id?"Persist and Email":0<s.readOnlyDetails.api_template_id?"Persist and Call API":"Persist"},s.trackUser=function(e,t,a){a=JSON.stringify(a);h.standard_user_tracking(s.info.application,e,t,a).then(function(e){},f)},s.openApiAdminConfig=function(){s.$parent.changeCurrentPage("api_admin_config")},s.exportRules=function(){return t.all([d.getAllRules("supported"),d.getAllRules("unsupported")]).then(function(e){var t=e[0].data.Data,e=e[1].data.Data,n=[],a=[],i=[];s.columnsToExport.forEach(function(e){e.enabled&&(a.push(e.title.trim()),i.push(e.field.trim()))}),n.push(a.join(",")),t&&Array.isArray(t)&&t.forEach(function(t){var a=[];i.forEach(function(e){t[e]?(e=(e=(e=(e=(e=(e=t[e].trim()).replace(/,/g,"-")).replace(/\./g," ")).replace(/\./g," ")).replace(/["']/g,"")).replace(/[\r\n(\r\n)]/g," "),a.push(e)):a.push("")}),n.push(a)}),e&&Array.isArray(e)&&e.forEach(function(t){var a=[];i.forEach(function(e){t[e]?(e=(e=(e=(e=(e=(e=t[e].trim()).replace(/,/g,"-")).replace(/\./g," ")).replace(/\./g," ")).replace(/["']/g,"")).replace(/[\r\n(\r\n)]/g," "),a.push(e)):a.push("")}),n.push(a)}),n=n.join("\n"),v.downloadCSV(n,"ruleList.csv")})},d.getAllConfig().then(function(e){s.showAlertApiFeature=e.data.Data.config.api_template_feature,d.setshowAlertApiFeature(s.showAlertApiFeature),s.showAlertApiFeature&&d.getAPITemplates().then(function(e){d.setApiTemplateList(e.data.Data)},function(e){})},function(e){}),d.getSectionsAPI().then(function(e){0!=e.data.Data.length&&d.getSectionColumns(e.data.Data[0].table_name).then(function(e){var t={};e.data.Data.map(function(e){"G"==e[Object.keys(e)[0]].solr_facet&&(t[e[Object.keys(e)[0]].attribute_label]="#"+e[Object.keys(e)[0]].column_name)});d.setGlobalAttribArr(t)},function(e){return!1}),e.data.Data.length},function(e){return!1}),s.showFilterCount=function(){s.filterCount=Object.keys(s.info.filter).length},s.ruleListTimeFilterChange=function(e,t){s.info[e.field]={startTime:t.startTime,endTime:t.endTime},s.info.filter[e.field]=[],s.info.filter[e.field].push(t),s.trackUser("Rules List","filter",s.info.filter),s.tableParams.reload(),s.info.page.current=1,s.tableParams.page(s.info.page.current)},s.selectDateFilterItem=function(e,t){if(s.info.filter[e.field]){if(s.info.filter[e.field][0].label==t.label)return!0;d.setStateGroupData(s.groupedFilterData),d.setFilterState(s.info.filter),d.setPageState(s.info.page.current)}return!1},s.checkfilter=function(){var e=l("filter")(s.currentRuleList,{selected:!0})||[];return s.info.bulkTitle=s.info.filter.status&&1==s.info.filter.status.length?"Select 2 or more rules to edit":"Apply Draft/Enabled/Disabled filter",!!(s.info.filter.status&&1<e.length)&&1==s.info.filter.status.length},s.bulkEditRules=function(){if(s.checkfilter())if(s.availableRulesOwnerList.length){s.currentLoggedUser=u.username;for(var e=[],t=s.currentRuleList,a=0;a<t.length;a++)t[a].selected&&t[a].rule_owner==s.currentLoggedUser&&e.push(t[a]);e.length<1?o.alertBox({msg:r.getVal("rulesMsgs").bulk_edit_multiple_warn}):(s.ownedrulesId=[],s.ownedrules=e.map(function(e){return s.ownedrulesId.push(e.rule_id),e.rule_name}),s.showenable="DISABLED"==s.info.filter.status[0],s.showdisable="ENABLED"==s.info.filter.status[0],s.currentRulesStatus=s.info.filter.status[0],s.info.modelenable=!1,s.info.modeldisable=!1,s.msg=r.getVal("rulesMsgs").owner_change_multiple,s.modal=o.openModal("partials/rules-and-alerts/bulk_edit_rules.html",s,"gb-rules-bulk-edit-modal",!0,"static"),s.bulkdata={status:s.currentRulesStatus,author:"",description:"",category:"select",kb_link:"",priority:"select",severity:"select",max_alerts_display_ui:"",rule_owner:"select",comment:""})}else o.alertBox({msg:r.getVal("rulesMsgs").rules_owner_list_not_found})},s.changestatus=function(e){e==s.bulkdata.status?(s.bulkdata.comment="",s.bulkdata.status=s.currentRulesStatus):s.bulkdata.status=e},s.submitbulk=function(){if(function(e){if(e.status&&e.status!=s.currentRulesStatus&&""==e.comment)return void o.alertBox({msg:"Please Enter a Comment"});for(var t=0,a=Object.values(e),n=0;n<a.length;n++)""==a[n]||"select"==a[n]||"ENABLED"==a[n]||"DISABLED"==a[n]||"DRAFT"==a[n]||t++;if(0!=t)return!0;o.alertBox({msg:"Nothing to edit"})}(s.bulkdata)){s.modal.close(),s.bulkdata.rule_names=s.ownedrules,s.bulkdata.rule_ids=s.ownedrulesId;Object.values(s.bulkdata);for(var e in s.bulkdata)"select"==s.bulkdata[e]&&(s.bulkdata[e]="");s.info.rulesLoading=!0,d.bulkUpdateRules(s.bulkdata).then(function(e){s.modal.close(),s.info.actionMessage="Updated "+s.bulkdata.rule_ids.length+" Rules.",s.info.actionMessageFlag=!0,s.reloadRules()},function(e){s.info.rulesLoading=!1,s.info.rulesListMsg={type:"failure",msg:"Unable to Bulk edit the rules. Please contact "+s.supportEmail}})}},s.showSubscriberList=function(e){s.info.subSearchText="",s.subsort=!0,s.currentname=e.label_display,s.originalSubs=e.subscriptionEmailList.slice(),s.rulesubs=e.subscriptionEmailList.sort(),s.msg="",s.modal=o.openModal("partials/rules-and-alerts/show_subscriber_list.html",s,"gb-rule-list-subscribers",!0,"static")},s.sortSubscribers=function(e){"asc"==e?(s.sortOrder="asc",s.subsort=!0,s.rulesubs=s.rulesubs.sort()):(s.subsort=!1,s.sortOrder="desc",s.rulesubs=s.rulesubs.sort(function(e,t){return t<e?-1:e<t?1:0}))},s.searchSubscribers=function(){""!=s.info.subSearchText?(s.rulesubs=s.originalSubs.filter(function(e){return-1<e.indexOf(s.info.subSearchText)}),s.rulesubs.length&&(s.subsort?s.sortSubscribers("asc"):s.sortSubscribers("desc"))):(s.rulesubs=s.originalSubs.slice(),s.subsort?s.sortSubscribers("asc"):s.sortSubscribers("desc"))},s.resetSubSearch=function(){s.info.subSearchText="",s.rulesubs=s.originalSubs.slice(),s.subsort?s.sortSubscribers("asc"):s.sortSubscribers("desc")},s.subscribeFromUi=function(e){s.info.sysidLoading=!1,s.info.toggleManageSubscription=!0,s.info.initialToggleManageSubscription=!0,s.singleSubscribeRule=e,s.msg=r.getVal("rulesMsgs").rule_subscribe_single[0]+e.label_display+r.getVal("rulesMsgs").rule_subscribe_single[1],s.modal=o.openModal("partials/rules-and-alerts/subscribe_rule.html",s,"gb-rule-single-subscribe-modal",!1,"static")},s.showManageSubscription=function(e){s.info.sysidLoading=!0,s.info.toggleManageSubscription?s.info.sysidLoading=!1:s.openSubscriptionModal(s.singleSubscribeRule,e)},s.subscribeFromUiConfirm=function(){s.info.toggleManageSubscription||(s.info.sysidLoading=!0),s.info.rulesLoading=!0,s.info.rulesPageLoading=!0;u.mps,s.singleSubscribeRule.rule_id,u.username;d.singleSubscribeRule(s.singleSubscribeRule.rule_id).then(function(e){s.info.toggleManageSubscription||s.saveSubscriptionFilter(),s.info.rulesListMsg={type:"success",msg:r.getVal("rulesMsgs").rule_subscription_success},s.info.rulesLoading=!0,s.reloadRules(),s.trackUser("Rules List","single unsubscribe",s.singleSubscribeRule)},function(e){s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").rule_subscription_failure},console.error("Unable subscribe from ui"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.addRuleMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}),s.info.rulesLoading=!1,f(e)})},s.unsubscribeFromUi=function(e){s.singleUnsubscribeRule=e,s.msg=r.getVal("rulesMsgs").rule_unsubscribe_single[0]+e.label_display+r.getVal("rulesMsgs").rule_unsubscribe_single[1],s.modal=o.openModal("partials/rules-and-alerts/unsubscribe_rule.html",s,"gb-rule-single-unsubscribe-modal",!1,"static")},s.unsubscribeFromUiConfirm=function(){s.modal.close(),s.info.rulesLoading=!0,d.singleUnsubscribeRule(s.singleUnsubscribeRule.rule_id).then(function(e){s.deleteSubscriptionFilter(s.singleUnsubscribeRule),s.info.rulesListMsg={type:"success",msg:r.getVal("rulesMsgs").rule_unsubscription_success},s.reloadRules(),s.trackUser("Rules List","single unsubscribe",s.singleUnsubscribeRule)},function(e){console.error("Unable to load templates"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.addRuleMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}),f(e)})},s.showBulkSubscribe=function(){var t=0,e=l("filter")(s.currentRuleList,{selected:!0})||[],a=!1;return 1<e.length&&e.forEach(function(e){e.subscribeIcon&&t++}),a=1<t?!0:a},s.showBulkUnsubscribe=function(){var t=0,e=l("filter")(s.currentRuleList,{selected:!0})||[],a=!1;return 1<e.length&&e.forEach(function(e){0==e.subscribeIcon&&t++}),a=1<t?!0:a},s.openBulkSubscribe=function(){var e=l("filter")(s.currentRuleList,{selected:!0})||[];s.rulesToSubscribe=e.filter(function(e){if(e.subscribeIcon)return e})||[],s.rulesToSubscribe.length&&(s.msg=r.getVal("rulesMsgs").bulk_subscribe_rules,s.modal=o.openModal("partials/rules-and-alerts/bulk_subscribe.html",s,"gb-rules-bulk-edit-modal",!0,"static"))},s.openBulkUnsubscribe=function(){var e=l("filter")(s.currentRuleList,{selected:!0})||[];s.rulesToUnsubscribe=e.filter(function(e){if(0==e.subscribeIcon)return e})||[],s.rulesToUnsubscribe.length&&(s.msg=r.getVal("rulesMsgs").bulk_unsubscribe_rules,s.modal=o.openModal("partials/rules-and-alerts/bulk_unsubscribe.html",s,"gb-rules-bulk-edit-modal",!0,"static"))},s.bulkSubscribeConfirm=function(){s.info.rulesLoading=!0;var t={rule_ids:s.rulesToSubscribe.map(function(e){return e.rule_id}),emailId:u.username};d.bulkSubscribeUnsubscribe(t,!0).then(function(e){s.modal.close(),s.info.rulesListMsg={type:"success",msg:r.getVal("rulesMsgs").rule_subscription_success},s.reloadRules(),s.trackUser("Rules List","bulk subscribe",t)},function(e){console.error("Unable to save "),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}):s.info.rulesListMsg={type:"failure",msg:"Unable to save data Please contact "+s.supportEmail},f(e),s.info.rulesLoading=!1,s.info.sysidLoading=!1})},s.bulkUnsubscribeConfirm=function(){var t={rule_ids:s.rulesToUnsubscribe.map(function(e){return e.rule_id}),emailId:u.username};d.bulkSubscribeUnsubscribe(t,!1).then(function(e){s.deleteSubscriptionFilter(s.rulesToUnsubscribe.map(function(e){return e.rule_id}),!0),s.modal.close(),s.info.rulesListMsg={type:"success",msg:r.getVal("rulesMsgs").rule_unsubscription_success},s.info.rulesLoading=!0,s.reloadRules(),s.trackUser("Rules List","bulk unsubscribe",t)},function(e){console.error("Unable to save "),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}):s.info.rulesListMsg={type:"failure",msg:"Unable to save data Please contact "+s.supportEmail},f(e),s.info.rulesLoading=!1,s.info.sysidLoading=!1})},s.initializeSubscriptionConstants=function(e){s.info.selectedRuleForSubscription=e,s.info.shouldCallLoadPages=!0,s.info.selectedSysIds=[],s.info.selectedSysIdsMaster=[],s.info.pages=[],s.info.sysPageSize=200,s.info.rulesLoading=!0,s.info.sysIdAttr="sysid1",s.info.sysidSearchObj={search:{}},s.info.sysidPagination={pageSiz:s.info.sysPageSize,startIndex:0,endIndex:s.info.sysPageSize-1,noOfPages:0,currentPage:1,paginationText:""},s.info.searchsysIdAttributes=r.getVal("searchIdAttributes"),s.info.searchIdAttributesUnsubscribed=r.getVal("searchIdAttributesUnsubscribed"),s.info.lastSelectedRow={rowIndex:0},s.info.tempAddSysIdList=[],s.info.tempRemoveSysIdList=[],s.info.inSearchView=!1,s.info.selectedSearchAttrList=[],s.info.availableSelectall=!1,s.info.selectedSelectall=!1,s.info.inSearchViewUnsubscribed=!1,s.info.selectedSearchAttrListUnsubscribed=[],s.info.sysIdList=[]},s.openSubscriptionModal=function(a,n){s.initializeSubscriptionConstants(a),t.all([d.getSysidColList(),d.getUnsubscribedSysids(a.rule_id,u.username)]).then(function(e){var t;s.info.sysIdAttributeList=e[0].data.Data.cols.map(function(e){return e.value="",e}),s.info.sysIdAttributeListUnsubscribed=angular.copy(s.info.sysIdAttributeList),e[1].data.Data.length?(e[1].data.Data[0].excSysIds.length?(t=[{mfr:r.getVal("manufacturer"),prod:r.getVal("product"),sch:r.getVal("schema"),sysid_col_name:"sysid1",sysids:e[1].data.Data[0].excSysIds}],d.getExcludedSysidDetails(t).then(function(e){s.info.selectedSysIds=e.data.Data,s.info.selectedSysIds.map(function(e,t){e.rowIndex=t})},function(e){console.error("Unable to load excluded SYSID details"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}):s.info.rulesListMsg={type:"failure",msg:"Unable to load data Please contact "+s.supportEmail},f(e),setTimeout(function(){s.modal.close(),s.info.rulesListMsg={type:"failure",msg:"Unable to load data Please contact "+s.supportEmail}}),s.info.rulesLoading=!1,s.info.sysidLoading=!1})):s.info.selectedSysIds=[],s.info.selectedSysIdsFlat="edit"==n?e[1].data.Data[0].excSysIds:[]):(s.info.selectedSysIds=[],s.info.selectedSysIdsFlat=[]),s.populateDefaultSearchList(),s.populateDefaultSearchListUnsubscribed(),s.getInitialSysidList(n,a,s.opensubmodal)},function(e){console.error("Unable to load "),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}):s.info.rulesListMsg={type:"failure",msg:"Unable to load data Please contact "+s.supportEmail},f(e),s.info.rulesLoading=!1,s.info.sysidLoading=!1})},s.opensubmodal=function(e){s.msg=r.getVal("rulesMsgs").rule_unsubscribe_single[0]+e.rule_name+r.getVal("rulesMsgs").rule_unsubscribe_single[1],s.modal=o.openModal("partials/rules-and-alerts/manage_subscription.html",s,"gb-rule-manage-subscription-modal",!1,"static"),s.info.rulesLoading=!1},s.sysidSortFunction=function(e,t){return e.disabled?1:e.disabled?0:-1},s.getInitialSysidList=function(t,a,n){s.info.sysidPagination.startIndex=0,s.info.sysidPagination.endIndex=200,d.getSysidList(s.info.sysidPagination.startIndex,s.info.sysidPagination.endIndex,s.info.sysidSearchObj,u.username).then(function(e){s.info.totalSysidCount=parseInt(e.data.Count),s.info.currentGroupname=e.data.Group||"","edit"==t&&s.info.selectedSysIdsFlat.length&&s.info.selectedSysIdsFlat&&s.info.selectedSysIdsFlat.length&&(e.data.Data.map(function(t,e){var a;t.disabled=-1<s.info.selectedSysIdsFlat.indexOf(t[s.info.sysIdAttr]),-1<s.info.selectedSysIdsFlat.indexOf(t[s.info.sysIdAttr])&&(a={},s.info.sysIdAttributeList.map(function(e){a[e.colName]=t[e.colName]}),a.disabled=!1,a.rowIndex=e,a.selected=!1,s.info.selectedSysIds.push(a),s.info.selectedSysIds=_.uniqBy(s.info.selectedSysIds,s.info.sysIdAttr))}),s.info.selectedSysIdsMaster=angular.copy(s.info.selectedSysIds)),s.info.sysIdList=e.data.Data.sort(s.sysidSortFunction),s.info.sysIdList=s.info.sysIdList.map(function(e,t){return e.rowIndex=t,e.selected=!1,e}),s.getPages();e=s.info.totalSysidCount<=s.info.sysidPagination.endIndex?s.info.totalSysidCount:s.info.sysidPagination.endIndex+1;s.info.sysidPagination.paginationText="Showing "+(s.info.sysidPagination.startIndex+1)+" to "+e+" of "+s.info.totalSysidCount,"edit"==t&&n(a),"add"==t&&(s.info.selectedSysIds=[],s.info.selectedSysIdsMaster=[],s.info.sysidLoading=!1,s.info.rulesLoading=!1),s.info.shouldCallLoadPages=!1},function(e){console.error("Unable to load sysid list "),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}):s.info.rulesListMsg={type:"failure",msg:"Unable to load data Please contact "+s.supportEmail},f(e),s.info.rulesLoading=!1,s.info.sysidLoading=!1,s.info.sysIdList=[]})},s.getSysId=function(n){d.getSysidList(s.info.sysidPagination.startIndex,s.info.sysidPagination.endIndex,s.getSearchObj(),u.username).then(function(e){s.info.totalSysidCount=parseInt(e.data.Count),s.info.currentGroupname=e.data.Group||"",n&&n.length&&e.data.Data.map(function(t,e){var a;t.disabled=-1<n.indexOf(t[s.info.sysIdAttr]),-1<n.indexOf(t[s.info.sysIdAttr])&&(a={},s.info.sysIdAttributeList.map(function(e){a[e.colName]=t[e.colName]}),a.disabled=!1,a.rowIndex=e,a.selected=!1,s.info.inSearchViewUnsubscribed?(s.info.selectedSysIdsMaster.push(a),s.info.selectedSysIds=_.uniqBy(s.filterSeletedSysid(),s.info.sysIdAttr)):(s.info.selectedSysIds.push(a),s.info.selectedSysIds=_.uniqBy(s.info.selectedSysIds,s.info.sysIdAttr),s.info.selectedSysIdsMaster=angular.copy(s.info.selectedSysIds)))}),s.info.sysIdList=e.data.Data.sort(s.sysidSortFunction),s.info.sysIdList=s.info.sysIdList.map(function(e,t){return e.rowIndex=t,e.selected=!1,e}),s.info.shouldCallLoadPages&&s.getPages();e=s.info.totalSysidCount<=s.info.sysidPagination.endIndex?s.info.totalSysidCount:s.info.sysidPagination.endIndex+1;s.info.sysidPagination.paginationText="Showing "+(s.info.sysidPagination.startIndex+1)+" to "+e+" of "+s.info.totalSysidCount,s.info.sysidLoading=!1,s.info.shouldCallLoadPages=!1,s.resetScrollTop("subscribed_sysid_list")},function(e){console.error("Unable to load "),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}):s.info.rulesListMsg={type:"failure",msg:"Unable to load data Please contact "+s.supportEmail},f(e),s.info.rulesLoading=!1,s.info.sysidLoading=!1,s.info.sysIdList=[]})},s.flattenSysid=function(e){return e[s.info.sysIdAttr]},s.populateDefaultSearchList=function(){s.info.selectedSearchAttrList=[];var t={};s.info.sysIdAttributeList.map(function(e){e.colName===s.info.sysIdAttr&&(t.selected=!0,t.colName=e.colName,t.colLabel=e.colLabel,t.value="")}),s.info.selectedSearchAttrList.push(t),s.info.sysIdAttributeList.map(function(e){e.colName===s.info.sysIdAttr&&(e.selected=!0)})},s.populateDefaultSearchListUnsubscribed=function(){s.info.selectedSearchAttrListUnsubscribed=[];var t={};s.info.sysIdAttributeListUnsubscribed.map(function(e){e.colName===s.info.sysIdAttr&&(t.selected=!0,t.colName=e.colName,t.colLabel=e.colLabel,t.value="")}),s.info.selectedSearchAttrListUnsubscribed.push(t),s.info.sysIdAttributeListUnsubscribed.map(function(e){e.colName===s.info.sysIdAttr&&(e.selected=!0)})},s.changeSearchView=function(e){s.info.selectedSearchAttrList=[];var t=s.info.sysIdAttributeList.filter(function(e){return e.selected});s.info.selectedSearchAttrList=t,setTimeout(function(){s.info.selectedSearchAttrList.length||s.populateDefaultSearchList()})},s.changeSearchViewUnsubscribed=function(e){s.info.selectedSearchAttrListUnsubscribed=[];var t=s.info.sysIdAttributeListUnsubscribed.filter(function(e){return e.selected});s.info.selectedSearchAttrListUnsubscribed=t,setTimeout(function(){s.info.selectedSearchAttrListUnsubscribed.length||s.populateDefaultSearchListUnsubscribed()})},s.resetPagination=function(){s.info.sysidPagination={pageSiz:s.info.sysPageSize,startIndex:0,endIndex:s.info.sysPageSize-1,noOfPages:0,currentPage:1,paginationText:""}},s.getPages=function(){s.resetPagination(),s.info.sysidPagination.noOfPages=Math.ceil(s.info.totalSysidCount/s.info.sysidPagination.pageSiz),s.info.pages=Array.from({length:s.info.sysidPagination.noOfPages},function(e,t){return s.getPageLabel(s.info.totalSysidCount,s.info.sysidPagination.pageSiz,t)})},s.getPageLabel=function(e,t,a){var n=Math.max(s.getPageStart(t,a),0),t=Math.min(s.getPageStart(t,a+1),e),a={};return a.startIndex=n,a.endIndex=t===s.info.totalSysidCount?s.info.totalSysidCount:t-1,a},s.getPageStart=function(e,t){return e*t},s.loadNextSet=function(){s.info.sysidLoading=!0,s.resetTempAddRemoveButtons(),s.info.sysidPagination.currentPage=s.info.sysidPagination.currentPage+1;var e=s.info.pages[s.info.sysidPagination.currentPage-1];s.info.sysidPagination.startIndex=e.startIndex,s.info.sysidPagination.endIndex=e.endIndex,e=s.info.inSearchViewUnsubscribed?s.info.selectedSysIdsMaster.map(function(e){return e[s.info.sysIdAttr]}):s.info.selectedSysIds.map(function(e){return e[s.info.sysIdAttr]}),s.getSysId(e)},s.loadPrevSet=function(){s.info.sysidLoading=!0,s.resetTempAddRemoveButtons(),s.info.sysidPagination.currentPage=s.info.sysidPagination.currentPage-1;var e=s.info.pages[s.info.sysidPagination.currentPage-1];s.info.sysidPagination.startIndex=e.startIndex,s.info.sysidPagination.endIndex=e.endIndex,e=s.info.inSearchViewUnsubscribed?s.info.selectedSysIdsMaster.map(function(e){return e[s.info.sysIdAttr]}):s.info.selectedSysIds.map(function(e){return e[s.info.sysIdAttr]}),s.getSysId(e)},s.callsysid=function(){var e;s.info.sysidLoading=!0,s.info.shouldCallLoadPages=!0,s.info.inSearchView=!0,s.info.sysidPagination.startIndex=0,s.info.sysidPagination.endIndex=200,e=s.info.inSearchViewUnsubscribed?s.info.selectedSysIdsMaster.map(function(e){return e[s.info.sysIdAttr]}):s.info.selectedSysIds.map(function(e){return e[s.info.sysIdAttr]}),s.getSysId(e)},s.resetTempAddRemoveButtons=function(){s.info.tempAddSysIdList=[],s.info.tempRemoveSysIdList=[]},s.getSearchObj=function(){var t={search:{}};return s.info.selectedSearchAttrList.forEach(function(e){e.value.length&&(t.search[e.colName]=e.value)}),t},s.clearsysSearchText=function(){s.info.selectedSearchAttrList.forEach(function(e){e.value=""})},s.clearSearchText=function(){var e;s.info.sysidLoading=!0,s.info.inSearchView=!1,s.clearsysSearchText(),s.resetPagination(),s.info.shouldCallLoadPages=!0,s.info.sysIdAttributeList.forEach(function(e){e.selected=!1}),s.populateDefaultSearchList(),e=s.info.inSearchViewUnsubscribed?s.info.selectedSysIdsMaster.map(function(e){return e[s.info.sysIdAttr]}):s.info.selectedSysIds.map(function(e){return e[s.info.sysIdAttr]}),s.getSysId(e)},s.rowClick=function(e,t,a){e.ctrlKey&&s.toggleRow(t),0===e.button&&(e.ctrlKey||e.shiftKey||(s.clearAll(a),s.toggleRow(t)),e.shiftKey&&s.selectRowsBetweenIndexes([s.info.lastSelectedRow.rowIndex,t.rowIndex],a))},s.toggleRow=function(e){e.selected=!e.selected,s.info.lastSelectedRow=e},s.clearAll=function(e){e.map(function(e){e.selected=!1})},s.selectRowsBetweenIndexes=function(e,t){e.sort(function(e,t){return e-t});for(var a=e[0];a<=e[1];a++)t[a].selected=!0},s.addRmoveBtnState=function(e){"add"===e?s.info.tempAddSysIdList=s.info.sysIdList.filter(function(e){return e.selected}):s.info.tempRemoveSysIdList=s.info.selectedSysIds.filter(function(e){return e.selected})},s.addSysIds=function(){s.info.sysidLoading=!0,s.info.inSearchViewUnsubscribed?s.info.selectedSysIdsMaster=s.info.selectedSysIdsMaster.concat(s.info.tempAddSysIdList):s.info.selectedSysIds=s.info.selectedSysIds.concat(s.info.tempAddSysIdList),s.info.sysIdList=s.info.sysIdList.sort(s.sysidSortFunction),s.info.sysIdList.map(function(a,e){a.rowIndex=e,s.info.inSearchViewUnsubscribed?s.info.selectedSysIdsMaster.map(function(e,t){a[s.info.sysIdAttr]===e[s.info.sysIdAttr]&&(e.rowIndex=t,a.selected=!1,a.disabled=!0)}):s.info.selectedSysIds.map(function(e,t){a[s.info.sysIdAttr]===e[s.info.sysIdAttr]&&(e.rowIndex=t,a.selected=!1,a.disabled=!0)})}),s.info.inSearchViewUnsubscribed?(s.info.selectedSysIdsMaster=_.cloneDeep(s.info.selectedSysIdsMaster),s.info.selectedSysIds=_.uniqBy(s.filterSeletedSysid(),s.info.sysIdAttr)):(s.info.selectedSysIds=_.cloneDeep(s.info.selectedSysIds),s.info.selectedSysIdsMaster=angular.copy(s.info.selectedSysIds)),s.info.tempAddSysIdList=[],s.info.availableSelectall&&(s.info.availableSelectall=!1),s.info.sysidLoading=!1},s.removeSysIds=function(){s.info.sysidLoading=!0,s.info.sysIdsToRemove=[],s.info.sysIdsToRemove=s.info.sysIdsToRemove.concat(s.info.tempRemoveSysIdList),s.info.sysIdsToRemove.forEach(function(a){s.info.sysIdList.forEach(function(e,t){e.rowIndex=t,e[s.info.sysIdAttr]===a[s.info.sysIdAttr]&&(e.selected=!1,e.disabled=!1)})}),s.info.sysIdsToRemove.map(function(e){s.info.inSearchViewUnsubscribed?s.removeItemFromList(s.info.selectedSysIdsMaster,e):s.removeItemFromList(s.info.selectedSysIds,e)}),s.info.tempRemoveSysIdList=[],s.info.selectedSelectall&&(s.info.selectedSelectall=!1),s.info.sysidLoading=!1},s.removeItemFromList=function(a,n){a.forEach(function(e,t){e[s.info.sysIdAttr]===n[s.info.sysIdAttr]&&a.splice(t,1)}),a.map(function(e,t){e.rowIndex=t}),s.info.inSearchViewUnsubscribed?(s.info.selectedSysIdsMaster=a,s.info.selectedSysIds=s.filterSeletedSysid()):(s.info.selectedSysIds=a,s.info.selectedSysIdsMaster=angular.copy(s.info.selectedSysIds))},s.resetScrollTop=function(e){p(function(){$("#"+e)[0].scrollTop=0})},s.searchDisbledButtonState=function(){var t=!0;return s.info.selectedSearchAttrList.map(function(e){e.value.length&&(t=!1)}),t},s.searchDisbledButtonStateUnsubscribed=function(){var t=!0;return s.info.selectedSearchAttrListUnsubscribed.map(function(e){e.value.length&&(t=!1)}),t},s.searchDisbledButtonStateForCancel=function(){var t=!0;return s.info.selectedSearchAttrList.map(function(e){(e.value.length||s.info.inSearchView)&&(t=!1)}),t},s.searchDisbledButtonStateForCancelUnsubscribed=function(){var t=!0;return s.info.selectedSearchAttrListUnsubscribed.map(function(e){(e.value.length||s.info.inSearchViewUnsubscribed)&&(t=!1)}),t},s.saveSubscriptionFilter=function(){s.info.sysidLoading=!0;var t=[{ruleId:s.info.selectedRuleForSubscription.rule_id.toString(),email:u.username,group:s.info.currentGroupname,excSysIds:s.info.inSearchViewUnsubscribed?s.info.selectedSysIdsMaster.map(function(e){return e[s.info.sysIdAttr]})||[]:s.info.selectedSysIds.map(function(e){return e[s.info.sysIdAttr]})||[]}];d.saveFilterAttributes(t).then(function(e){s.modal.close(),s.info.sysidLoading=!1,s.info.rulesListMsg={type:"success",msg:r.getVal("rulesMsgs").filter_attributes_save},s.info.rulesLoading=!0,s.reloadRules(),s.trackUser("Rules List","add-update filter attributes",t)},function(e){console.error("Unable to save filter attributes"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.addRuleMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}):s.info.rulesListMsg={type:"failure",msg:"Unable to save data Please contact "+s.supportEmail},setTimeout(function(){s.modal.close(),s.info.rulesListMsg={type:"failure",msg:"Unable to update subscription Please contact "+s.supportEmail}}),f(e),s.info.rulesLoading=!1,s.info.sysidLoading=!1})},s.deleteSubscriptionFilter=function(e,t){t=t?{ruleIds:e,mps:u.mps,email:u.username}:{ruleIds:[e.rule_id],mps:u.mps,email:u.username},d.deleteFilterAttributes(t).then(function(e){s.info.sysidLoading=!1},function(e){console.error("Unable to load templates"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}):s.info.rulesListMsg={type:"failure",msg:"Unable to load data Please contact "+s.supportEmail},f(e),s.info.rulesLoading=!1,s.info.sysidLoading=!1})},s.selectAllSysid=function(){s.info.sysIdList.forEach(function(e){!e.disabled&&s.info.availableSelectall?e.selected=!0:e.disabled||s.info.availableSelectall||(e.selected=!1)}),s.addRmoveBtnState("add")},s.selectallBtnState=function(){var t=!0;return s.info.sysIdList.forEach(function(e){e.disabled||(t=!1)}),t},s.selectAllSysidSelected=function(){s.info.selectedSysIds.forEach(function(e){s.info.selectedSelectall?e.selected=!0:s.info.selectedSelectall||(e.selected=!1)}),s.addRmoveBtnState()},s.selectallBtnStateSelected=function(){var e=!0;return e=1<s.info.selectedSysIds.length?!1:e},s.getFilterObj=function(){var t={};return s.info.selectedSearchAttrListUnsubscribed.forEach(function(e){e.value.length&&(t[e.colName]=e.value)}),t},s.filterSeletedSysid=function(){var a=s.getFilterObj();return Object.keys(a).length?s.info.selectedSysIdsMaster.filter(function(t){return Object.keys(a).find(function(e){return t[e]&&t[e].toLowerCase().includes(a[e].toLowerCase())})}):s.info.selectedSysIdsMaster},s.searchUnsubscribedSysid=function(){s.info.sysidLoading=!0,s.info.inSearchViewUnsubscribed=!0,s.info.selectedSysIds=_.uniqBy(s.filterSeletedSysid(),s.info.sysIdAttr),s.info.sysidLoading=!1},s.clearSearchTextUnsubscribed=function(){s.info.sysidLoading=!0,s.info.inSearchViewUnsubscribed=!1,s.info.selectedSearchAttrListUnsubscribed.forEach(function(e){e.value="",e.selected=!1}),s.populateDefaultSearchListUnsubscribed(),s.info.selectedSysIds=_.uniqBy(s.filterSeletedSysid(),s.info.sysIdAttr),s.info.sysidLoading=!1},s.openTaggingModal=function(){s.selectedTagsCount=0,s.bulktagsubscribebtnstate=!0,d.getPredefinedTagList().then(function(e){s.info.tagList=e.data.Data.map(function(e){return e.selected=!1,e})},function(e){s.info.tagList=[],console.error("Unable to load templates"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.addRuleMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}),f(e)});var e=u.username;e=s.amIAdmin?l("filter")(s.currentRuleList,{selected:!0,subscription_enabled:!0})||[]:l("filter")(s.currentRuleList,{selected:!0,subscription_enabled:!0,rule_owner:e})||[],(s.rulesForBulkTag=e).length?(s.msg=r.getVal("rulesMsgs").bulk_tag_associate,s.modal=o.openModal("partials/rules-and-alerts/rule_tagging.html",s,"gb-rules-bulk-edit-modal",!0,"static")):o.alertBox({msg:r.getVal("rulesMsgs").rule_delete_select_all_error})},s.bulkTagAssociate=function(){s.info.rulesLoading=!0,s.modal.close();var e=s.info.tagList.filter(function(e){return e.selected}).map(function(e){return e.tag_id});e.length&&(e={associate:[{tag_ids:e,rule_ids:s.rulesForBulkTag.map(function(e){return e.rule_id})}],disassociate:[{}]},d.associateDisassociateTag(e).then(function(e){s.reloadRules(),s.info.rulesListMsg={type:"success",msg:r.getVal("rulesMsgs").bulk_tag_associate_success}},function(e){console.error("Unable to add subscription"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}):s.info.rulesListMsg={type:"failure",msg:"failed to associate tag"},f(e)}))},s.updateTagSelectedCount=function(){s.selectedTagsCount=s.info.tagList.filter(function(e){return e.selected}).length,0<s.selectedTagsCount?s.bulktagsubscribebtnstate=!1:s.bulktagsubscribebtnstate=!0},s.removeTag=function(a,n){var e={msg:"Are you sure you want to disassociate <strong>"+a.tag_name+"</strong> with <strong>"+n.label_display+"</strong>?"};o.confirmationBox({msg:"Remove Tag"},e,"Yes","No").result.then(function(e){s.info.rulesLoading=!0;var t={associate:[{}],disassociate:[{tag_ids:[a.tag_id],rule_ids:[n.rule_id]}]};d.associateDisassociateTag(t).then(function(e){s.reloadRules(),s.info.rulesListMsg={type:"success",msg:r.getVal("rulesMsgs").remove_tag[0]+a.tag_name+r.getVal("rulesMsgs").remove_tag[1]}},function(e){console.error("Unable to add subscription"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),s.info.rulesListMsg={type:"failure",msg:r.getVal("rulesMsgs").h2_down_msg}):s.info.rulesListMsg={type:"failure",msg:"failed to remove tag"},f(e)})},function(e){})},s.showTagSubscribe=function(){var t=0,e=l("filter")(s.currentRuleList,{selected:!0})||[],a=!1;return 0<e.length&&e.forEach(function(e){1==e.subscription_enabled&&t++}),a=0<t?!0:a},s.checkHorizontalOverflow=function(e){if(e&&e.currentTarget)return(e=e.currentTarget.parentElement).clientWidth<e.scrollWidth},s.checkVerticalOverflow=function(e){return e.clientHeight<e.scrollHeight}}]).controller("AddCategoryCtrl",["$scope","$sce","$timeout","RulesService","ModalService","GlobalService","UserTrackingService","AppService",function(n,t,e,i,a,o,s,r){function l(e){!n.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(n.info.sessionTimedOut=!0,a.sessionTimeout())}n.info={},n.info.application=o.getVal("navRules"),n.info.categoriesLoading=!0,n.info.successMsg="",n.info.errorMsg="",n.info.sessionTimedOut=!1,n.clearMessage=function(){n.info.categoriesLoading||(n.info.successMsg="",n.info.errorMsg="")},n.loadCategories=function(){i.getCategories().then(function(e){n.info.categories=e.data.Data,n.info.categoriesLoading=!1,n.info.rulesList=i.getRulesList()},function(e){console.error("Unable to load Categories"),n.info.categoriesLoading=!1,e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(o.logError(Object.values(o.getVal("errorMsgs"))[1]),n.info.errorMsg=o.getVal("rulesMsgs").h2_down_msg):""==n.info.errorMsg?n.info.errorMsg=o.getVal("rulesMsgs").category_load_failed:n.info.errorMsg+="<br>"+o.getVal("rulesMsgs").category_load_failed,l(e)})},n.loadCategories(),n.info.newCategories=[],n.addCategory=function(){n.info.newCategories.push({category:"",category_description:""})},n.editCategory=function(e){e.edit=!0,e.initialCategory=e.category,e.initialDescription=e.category_description},n.undoCategory=function(e){e.category=e.initialCategory,e.category_description=e.initialDescription,delete e.initialCategory,delete e.initialDescription,delete e.edit},n.deleteCategory=function(e){for(var t=0;t<n.info.rulesList.length;t++)if(e.category_id==n.info.rulesList[t].category_id)return void a.alertBox({msg:o.getVal("rulesMsgs").category_rule_associated});e.edit&&n.undoCategory(e),e.deleted=!0},n.undoDeleteCategory=function(e){delete e.deleted},n.deleteNewCategory=function(e){n.info.newCategories.splice(e,1)},n.validateCategories=function(){for(var e=0;e<n.info.categories.length;e++){if(""==n.info.categories[e].category)return void a.alertBox({msg:o.getVal("rulesMsgs").category_blank_name});for(var t=e+1;t<n.info.categories.length;t++)if(n.info.categories[e].category==n.info.categories[t].category)return void a.alertBox({msg:o.getVal("rulesMsgs").category_name_duplicate});for(t=0;t<n.info.newCategories.length;t++)if(n.info.categories[e].category==n.info.newCategories[t].category)return void a.alertBox({msg:o.getVal("rulesMsgs").category_name_duplicate})}for(e=0;e<n.info.newCategories.length;e++)if(""!=n.info.newCategories[e].category||""!=n.info.newCategories[e].category_description){if(""==n.info.newCategories[e].category&&""!=n.info.newCategories[e].category_description)return void a.alertBox({msg:o.getVal("rulesMsgs").category_blank_name});for(t=e+1;t<n.info.newCategories.length;t++)if(n.info.newCategories[e].category==n.info.newCategories[t].category)return void a.alertBox({msg:o.getVal("rulesMsgs").category_name_duplicate})}return!0},n.getOperationsCount=function(){var e,t=0;for(e in n.info.categories)!n.info.categories[e].deleted&&(!n.info.categories[e].edit||n.info.categories[e].category==n.info.categories[e].initialCategory&&n.info.categories[e].category_description==n.info.categories[e].initialDescription)||t++;for(e in n.info.newCategories)""!=n.info.newCategories[e].category&&t++;return t},n.saveCategories=function(){if(n.validateCategories())if(n.info.operationsCount=n.getOperationsCount(),0!=n.info.operationsCount){for(var e in n.info.categoriesLoading=!0,n.info.doneOperations=0,n.info.categories)n.info.categories[e].deleted?n.callDeleteCategory(n.info.categories[e]):!n.info.categories[e].edit||n.info.categories[e].category==n.info.categories[e].initialCategory&&n.info.categories[e].category_description==n.info.categories[e].initialDescription||n.callEditCategory(n.info.categories[e]);for(var e in n.info.newCategories)""!=n.info.newCategories[e].category&&n.callAddCategory(n.info.newCategories[e]);n.info.newCategories=[]}else n.info.newCategories=[]},n.callDeleteCategory=function(t){i.deleteCategory(t.category_id).then(function(e){s.standard_user_tracking(n.info.application,"Category","delete",t.category).then(function(e){},l),n.info.doneOperations++,n.info.doneOperations==n.info.operationsCount&&n.loadCategories(),""==n.info.successMsg?n.info.successMsg=o.getVal("rulesMsgs").category_delete_success[0]+t.category+o.getVal("rulesMsgs").category_delete_success[1]:n.info.successMsg+="<br>"+o.getVal("rulesMsgs").category_delete_success[0]+t.category+o.getVal("rulesMsgs").category_delete_success[1]},function(e){console.error("Unable to delete "+t.category),n.info.doneOperations++,n.info.doneOperations==n.info.operationsCount&&n.loadCategories(),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(o.logError(Object.values(o.getVal("errorMsgs"))[1]),n.info.errorMsg=o.getVal("rulesMsgs").h2_down_msg):""==n.info.errorMsg?n.info.errorMsg=o.getVal("rulesMsgs").category_delete_failed[0]+t.category+o.getVal("rulesMsgs").category_delete_failed[1]:n.info.errorMsg+="<br>"+o.getVal("rulesMsgs").category_delete_failed[0]+t.category+o.getVal("rulesMsgs").category_delete_failed[1],l(e)})},n.callEditCategory=function(a){i.updateCategory(a.category_id,a.category.replace(/\'/g,"''").replace(/^\s+|\s+$/g,""),a.category_description.replace(/\'/g,"''").replace(/^\s+|\s+$/g,"")).then(function(e){var t;t=a.category!=a.initialCategory?((t={}).old=a.initialCategory,t.new=a.category,JSON.stringify(t)):a.category,s.standard_user_tracking(n.info.application,"Category","edit",t).then(function(e){},l),n.info.doneOperations++,n.info.doneOperations==n.info.operationsCount&&n.loadCategories(),a.category!=a.initialCategory?""==n.info.successMsg?n.info.successMsg=o.getVal("rulesMsgs").category_edit_name_success[0]+a.initialCategory+o.getVal("rulesMsgs").category_edit_name_success[1]+a.category+o.getVal("rulesMsgs").category_edit_name_success[2]:n.info.successMsg+="<br>"+o.getVal("rulesMsgs").category_edit_name_success[0]+a.initialCategory+o.getVal("rulesMsgs").category_edit_name_success[1]+a.category+o.getVal("rulesMsgs").category_edit_name_success[2]:""==n.info.successMsg?n.info.successMsg=o.getVal("rulesMsgs").category_edit_success[0]+a.initialCategory+o.getVal("rulesMsgs").category_edit_success[1]:n.info.successMsg+="<br>"+o.getVal("rulesMsgs").category_edit_success[0]+a.initialCategory+o.getVal("rulesMsgs").category_edit_success[1]},function(e){console.error("Unable to edit "+a.initialCategory),n.info.doneOperations++,n.info.doneOperations==n.info.operationsCount&&n.loadCategories(),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(o.logError(Object.values(o.getVal("errorMsgs"))[1]),n.info.errorMsg=o.getVal("rulesMsgs").h2_down_msg):a.category!=a.initialCategory?""==n.info.errorMsg?n.info.errorMsg=o.getVal("rulesMsgs").category_edit_name_failed[0]+a.initialCategory+o.getVal("rulesMsgs").category_edit_name_failed[1]+a.category+o.getVal("rulesMsgs").category_edit_name_failed[2]:n.info.errorMsg+="<br>"+o.getVal("rulesMsgs").category_edit_name_failed[0]+a.initialCategory+o.getVal("rulesMsgs").category_edit_name_failed[1]+a.category+o.getVal("rulesMsgs").category_edit_name_failed[2]:""==n.info.errorMsg?n.info.errorMsg=o.getVal("rulesMsgs").category_edit_failed[0]+a.initialCategory+o.getVal("rulesMsgs").category_edit_failed[1]:n.info.errorMsg+="<br>"+o.getVal("rulesMsgs").category_edit_failed[0]+a.initialCategory+o.getVal("rulesMsgs").category_edit_failed[1],l(e)})},n.callAddCategory=function(t){i.addCategory(t.category.replace(/\'/g,"''").replace(/^\s+|\s+$/g,""),t.category_description.replace(/\'/g,"''").replace(/^\s+|\s+$/g,"")).then(function(e){s.standard_user_tracking(n.info.application,"Category","add",t.category).then(function(e){},l),n.info.doneOperations++,n.info.doneOperations==n.info.operationsCount&&n.loadCategories(),""==n.info.successMsg?n.info.successMsg=o.getVal("rulesMsgs").category_add_success[0]+t.category+o.getVal("rulesMsgs").category_add_success[1]:n.info.successMsg+="<br>"+o.getVal("rulesMsgs").category_add_success[0]+t.category+o.getVal("rulesMsgs").category_add_success[1]},function(e){console.error("Unable to add "+t.category),n.info.doneOperations++,n.info.doneOperations==n.info.operationsCount&&n.loadCategories(),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(o.logError(Object.values(o.getVal("errorMsgs"))[1]),n.info.errorMsg=o.getVal("rulesMsgs").h2_down_msg):""==n.info.errorMsg?n.info.errorMsg=o.getVal("rulesMsgs").category_add_failed[0]+t.category+o.getVal("rulesMsgs").category_add_failed[1]:n.info.errorMsg+="<br>"+o.getVal("rulesMsgs").category_add_failed[0]+t.category+o.getVal("rulesMsgs").category_add_failed[1],l(e)})},n.goToAddRule=function(){n.$parent.changeCurrentPage("add_rule")},n.renderHtml=function(e){return t.trustAsHtml(e)}}]).controller("TestRuleCtrl",["$scope","$sce","$filter","$timeout","$q","$window","AppService","ModalService","RulesService","GlobalService","ErrorService","FileUploader","ngTableParams","UserTrackingService","metaDataService","$document",function(u,n,f,o,m,e,d,s,g,r,l,c,h,b,_,v){u.info={},u.info.application=r.getVal("navRules"),u.info.fileuploadDelay=r.getVal("fileuploadDelay"),u.info.successMsg="",u.info.errorMsg="",u.info.sessionTimedOut=!1,u.info.selectedRules=g.getTestRuleData(),u.info.columns=f("filter")(r.getVal("testRuleColumns"),{enabled:!0}),u.info.testRuleHistoryColumns=f("filter")(r.getVal("testRuleHistoryColumns"),{enabled:!0}),u.info.bundlesLoading=!1,u.info.rulesCopying=!1,u.info.testresultLoading=!1,u.info.bundlesList=[],u.info.testResultsList=[],u.info.maxBundlesCount=20,u.info.testGridColumnsList=f("filter")(r.getVal("testGridColumns"),{enabled:!0}),u.info.supportedStatus=r.getVal("rulesSupportedStatus"),u.ruleTestSucceeded=!1,u.info.pageLoading=!1,u.info.recursionDone=0,u.info.insertedStageRules="",u.info.recursionLimit=4,u.info.bundleStatus=r.getVal("bundleStatus"),u.info.uploadModalOpened=!1,u.info.selectedBundleLoadId=null,u.info.bundleUploadSuccessMsg=r.getVal("rulesMsgs").test_rule_upload_log_success,u.showStatusColLoadIcon=!1,u.showStatusColDoneIcon=!1,u.showStatusColFailIcon=!1,u.testButtonDisable=!1,u.uploadBtnDisable=!1,u.maxTriesToLcp=r.getVal("maxTriesToLcp"),u.allBunldesUploaded=!1,u.logBundlesFromLogvault=[],u.info.enableRuleComments="",u.info.enableRuleCommentsLimitMin=r.getVal("ruleStatusChangeCommentMinLen"),u.info.enableRuleCommentsLimitMax=r.getVal("ruleStatusChangeCommentMaxLen"),u.tableHeadersForMultipleBundle=r.getVal("thMultipleBundleFromLogvault"),u.stagecall=0,u.info.bundleListCallCount=0,u.clearMessage=function(){u.info.pageLoading||(u.info.successMsg="",u.info.errorMsg="")},u.changePageSize=function(){u.info.page.count=parseInt(u.info.page.count),u.info.page.pages=Math.ceil(u.info.page.total/u.info.page.count),u.info.page.current>u.info.page.pages&&(u.info.page.current=u.info.page.pages),arguments.length?u.populateRulesData():u.populateDataPathData()},u.nextPage=function(){u.info.page.current<u.info.page.pages&&(u.info.page.current+=1,arguments.length?u.populateRulesData():u.populateDataPathData())},u.prevPage=function(){1<u.info.page.current&&(--u.info.page.current,arguments.length?u.populateRulesData():u.populateDataPathData())},u.firstPage=function(){1!=u.info.page.current&&(u.info.page.current=1,arguments.length?u.populateRulesData():u.populateDataPathData())},u.lastPage=function(){u.info.page.current!=u.info.page.pages&&(u.info.page.current=u.info.page.pages,arguments.length?u.populateRulesData():u.populateDataPathData())},u.checkAllExpanded=function(){for(var e in u.info.selectedRules)if(!u.info.selectedRules[e].expanded)return void(u.info.allExpanded=!1);u.info.allExpanded=!0},1==u.info.selectedRules.length&&(u.info.selectedRules[0].expanded=!0,u.checkAllExpanded()),u.ruleExpandCollapse=function(){if(u.info.allExpanded){for(var e in u.info.selectedRules)u.info.selectedRules[e].expanded=!1;u.info.allExpanded=!1}else{for(var e in u.info.selectedRules)u.info.selectedRules[e].expanded=!0;u.info.allExpanded=!0}},u.renderHtml=function(e){return n.trustAsHtml(e)},u.openUploadLogModal=function(){u.modal=s.openModal("partials/rules-and-alerts/upload_log.html",u,!1,"static"),u.info.uploadModalOpened=!0},u.openLogvault=function(){e.moveToApplication({app:"logvault",source:"test_rule"})},u.openDatapathModal=function(){u.modal=s.openModal("partials/rules-and-alerts/datapath_modal.html",u,!1,"static")},u.showTestDetails=function(e){u.datapathModalData=e.texts,u.datapathModalLabel=e.label,u.info.page={total:0,current:1,pages:0,count:10,displayMsg:""},u.populateDataPathData(),u.openDatapathModal()},u.populateDataPathData=function(){var e=u.datapathModalData;u.info.page.total=e.length,u.info.page.pages=Math.ceil(u.info.page.total/u.info.page.count),u.info.datapathDisplayData=e.slice((u.info.page.current-1)*u.info.page.count,u.info.page.current*u.info.page.count),u.info.page.current<u.info.page.pages?u.info.page.displayMsg=(u.info.page.current-1)*u.info.page.count+1+" - "+((u.info.page.current-1)*u.info.page.count+u.info.page.count)+" of "+u.info.page.total:u.info.page.displayMsg=(u.info.page.current-1)*u.info.page.count+1+" - "+u.info.page.total+" of "+u.info.page.total},u.populateRulesData=function(){u.info.bundleRules.map(function(e){e.expanded=!1});var e=u.info.bundleRules;u.info.page.total=e.length,u.info.page.pages=Math.ceil(u.info.page.total/u.info.page.count),u.info.displayRules=e.slice((u.info.page.current-1)*u.info.page.count,u.info.page.current*u.info.page.count),u.info.page.current<u.info.page.pages?u.info.page.displayMsg=(u.info.page.current-1)*u.info.page.count+1+" - "+((u.info.page.current-1)*u.info.page.count+u.info.page.count)+" of "+u.info.page.total:u.info.page.displayMsg=(u.info.page.current-1)*u.info.page.count+1+" - "+u.info.page.total+" of "+u.info.page.total},u.openRulesDetails=function(){u.info.page={total:0,current:1,pages:0,count:10,displayMsg:""},u.modal=s.openModal("partials/rules-and-alerts/rules_details.html",u,"gb-rules-test-history-modal","static"),0==arguments.length?(u.info.bundleRules=u.info.selectedRules,u.populateRulesData()):(u.info.rulesLoading=!0,g.getStagingRulesData(arguments[0]).then(function(e){u.info.bundleRules=e.data.Data,u.populateRulesData(),u.info.rulesLoading=!1,u.trackUser("Rule","Edit",u.info.displayRules)},function(e){u.modal.close(),u.info.rulesLoading=!1,p(e),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(u.info.errorMsg=r.getVal("rulesMsgs").h2_down_msg,r.logError(Object.values(r.getVal("errorMsgs"))[1])):(u.info.errorMsg=r.getVal("info_server_down"),r.logError(Object.values(r.getVal("errorMsgs"))[0]))}))},u.getBundleId=function(t){u.info.bundlesList.map(function(e){e.load_id!==t.load_id||e.seen_ts!==t.seen_ts||1==e.expanded?e.expanded=!1:e.expanded=!0}),!1!==t.expanded&&t&&t.rule_id&&(u.info.testresultLoading=!0,u.info.selectedBundleLoadId=t.load_id,g.getBundleId(t.load_id).then(function(e){t.signature=e.data.Data,u.getStagingRulesforBundle(t)},function(e){u.info.testresultLoading=!1,t.expanded=!1,p(e),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),u.info.errorMsg=r.getVal("rulesMsgs").h2_down_msg):u.info.errorMsg=r.getVal("rulesMsgs").test_rule_failed}))},u.getStagingRulesforBundle=function(t){g.getStagingRulesData(t.rule_id).then(function(e){e=e.data.Data||[];u.viewTestResults(t,e)},function(e){u.info.testresultLoading=!1,t.expanded=!1,p(e),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),u.info.errorMsg=r.getVal("rulesMsgs").h2_down_msg):u.info.errorMsg=r.getVal("rulesMsgs").test_rule_failed})};var y,S,D,t,a,w=r.getVal("manufacturer"),M=r.getVal("product"),V=r.getVal("schema");function p(e){!u.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(u.info.sessionTimedOut=!0,s.sessionTimeout())}u.viewTestResults=function(d,c){if(d&&d.signature&&d.rule_id){for(var e=d.signature,t="",a=0;a<u.info.testGridColumnsList.length;a++)t+=u.info.testGridColumnsList[a].field+", ";t+="display_msg";var n=g.getStagingKeyspace(),i=r.getVal("alerts_by_bundle_table"),o=d.rule_id,n="SELECT "+t+" FROM "+n+"_"+i+" where mfr='"+w+"' AND prod='"+M+"' AND sch='"+V+"' AND ec='"+w+"' AND bundle_id='"+e+"' AND rule_id IN ("+o+")";u.info.testResultsPending&&u.deferred.resolve(),u.deferred=m.defer(),u.info.testResultsPending=!0,g.getTestResults(n,u.deferred).then(function(e){u.info.testResultsPending=!1,u.info.testresultLoading=!1,u.info.testResultsList=[];var t={};if(e.data.length)for(var a=0;a<e.data.length;a++){for(var n=!(t[e.data[a].rule_id]=!0),i=0;i<u.info.testResultsList.length;i++)if(u.info.testResultsList[i].label==e.data[a].label){var o={id:u.info.testResultsList[i].length+1,msg:e.data[a].display_msg};u.info.testResultsList[i].texts.push(o),n=!0;break}if(!n){for(var s={},i=0;i<u.info.testGridColumnsList.length;i++)s[u.info.testGridColumnsList[i].field]=e.data[a][u.info.testGridColumnsList[i].field];s.texts=[];o={id:1,msg:e.data[a].display_msg};s.texts.push(o),u.info.testResultsList.push(s)}}for(var r,a=0;a<c.length;a++)if(!!!(f("filter")(u.info.testResultsList,{rule_id:c[a].rule_id},!0)||[]).length){for(s={},i=0;i<u.info.testGridColumnsList.length;i++)s[u.info.testGridColumnsList[i].field]=c[a][u.info.testGridColumnsList[i].rules_field];s.texts=[],u.info.testResultsList.push(s)}/\d+/.test(d.prod_rule_id)?(r=g.getRulesList(),"DRAFT"==(f("filter")(r,{rule_id:parseInt(d.prod_rule_id)},!0)||[])[0].status&&!d.rule_modified&&e.data.length?(u.info.prodEnableRuleId=parseInt(d.prod_rule_id),u.info.prodEnableRuleLabel=c[0].label_display,u.info.prodEnableRuleName=c[0].rule_name,u.info.ruleTestSucceeded=!0):u.info.ruleTestSucceeded=!1):u.info.ruleTestSucceeded=!1;for(var l=[],a=0;a<u.info.testResultsList.length;a++)l.push(u.info.testResultsList[a].label);b.standard_user_tracking(u.info.application,"Test Rule History","View Results",l.join(",")).then(function(e){},p)},function(e){u.info.testResultsPending=!1,0!=e.status&&(u.info.testresultLoading=!1),u.info.testResultsList="",u.info.errorMsg=r.getVal("rulesMsgs").test_rule_failed,!u.info.sessionTimedOut&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(u.info.sessionTimedOut=!0,s.sessionTimeout())})}else u.info.testresultLoading=!1,d.expanded=!1},u.enableDisableStatusBtn=function(){return u.info.enableRuleComments.length>=u.info.enableRuleCommentsLimitMin},u.confirmEnablingRule=function(){u.msg=!1,u.selectedRuleName=u.info.prodEnableRuleLabel,u.info.enableRuleComments="",u.modal=s.openModal("partials/rules-and-alerts/modal-enable-rule-message-box.html",u,"gb-modal-test-rule-enable-modal","static")},u.enableDisableRuleAction=function(){u.info.enableRuleComments.length&&(u.modal.close(),u.info.pageLoading=!0,g.enableRule(u.info.prodEnableRuleId,u.info.enableRuleComments).then(function(e){var t;u.info.enableRuleComments="",g.getRuleMode()&&"edit"==g.getRuleMode().mode&&g.getRuleMode().data&&g.getRuleMode().data.rule_id==u.info.prodEnableRuleId&&((t=g.getRuleMode().data).rule_id=e.data.Data.rule_id,t.rule_name=e.data.Data.rule_name,t.alert_id=e.data.Data.alert_id,t.status=u.info.supportedStatus.Enabled,t.action_id=e.data.Data.action_id,g.setRuleMode("edit",t)),u.info.successMsg=r.getVal("rulesMsgs").rule_enable_success[0]+u.info.prodEnableRuleName+r.getVal("rulesMsgs").rule_enable_success[1],b.standard_user_tracking(u.info.application,"Test Rule History","enable",u.info.prodEnableRuleLabel).then(function(e){},p),g.getAllRules(g.getRuleType()).then(function(e){g.setRulesList(f("filterMultiples")(f("removeDup")(e.data.Data),{status:[u.info.supportedStatus.Enabled,u.info.supportedStatus.Disabled,u.info.supportedStatus.Draft]})),u.info.pageLoading=!1,u.info.ruleTestSucceeded=!1},p)},function(e){u.info.pageLoading=!1,e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),u.info.errorMsg=r.getVal("rulesMsgs").h2_down_msg):u.info.errorMsg=r.getVal("rulesMsgs").rule_enable_failed[0]+u.info.prodEnableRuleName+r.getVal("rulesMsgs").rule_enable_failed[1],p(e)}))},u.loadAllStageBundles=function(e){g.checkLCPStatus().then(function(e){"Success"==e.data.Status&&g.getStageBundles().then(function(e){e.data.Data.length==u.info.initialBundleListLength?u.info.bundleListCallCount<=10?(u.info.bundleListCallCount++,o(function(){u.loadAllStageBundles()},3e3)):u.info.errorMsg=r.getVal("rulesMsgs").bundle_load_failed:(u.info.initialBundleListLength=e.data.Data.length,u.bundlepoll())},function(e){u.info.bundlesLoading=!1,u.info.bundlesList=[],e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),u.info.errorMsg=r.getVal("rulesMsgs").h2_down_msg):u.info.errorMsg=r.getVal("rulesMsgs").bundle_load_failed,p(e)})},function(e){u.info.bundlesLoading=!1,u.info.bundlesList=[],p(e),r.logError(Object.values(r.getVal("errorMsgs"))[2]),u.info.errorMsg=r.getVal("rulesMsgs").lcp_down_msg})},u.bundlepoll=function(){u.info.firstLoad&&(u.info.bundlesLoading=!0),g.checkLCPStatus().then(function(e){"Success"==e.data.Status?g.getStageBundles().then(function(e){u.info.firstLoad&&(u.info.bundlesLoading=!0,u.info.initialBundleListLength=e.data.Data.length),u.info.deleteTemporaryBundle&&(u.info.temporaryBundleData=[],delete u.info.deleteTemporaryBundle);for(var a=f("filter")(e.data.Data,{supported:!0})||[],e=(u.info.bundlesList.map(function(t){t.expanded&&a.map(function(e){t.load_id===e.load_id&&t.seen_ts===e.seen_ts&&(e.expanded=!0)})}),u.info.bundlesList=a,r.getVal(void 0)),t=new Date((new Date).setHours((new Date).getHours()-e)).getTime()/1e3|0,n=0;n<u.info.bundlesList.length;n++)0==u.info.bundlesList[n].bundle_state&&moment(u.info.bundlesList[n].seen_ts).unix()<t&&(u.info.bundlesList[n].bundle_state=4);for(var i=!1,n=0;n<u.info.bundlesList.length;n++)if("Processing"==u.info.bundleStatus[u.info.bundlesList[n].bundle_state]||"Parsing"==u.info.bundleStatus[u.info.bundlesList[n].bundle_state]){i=!0;break}i&&o(function(){u.bundlepoll()},5e3),u.info.bundlesLoading=!1,u.info.firstLoad=!1,u.trackUser("Test History","view",u.info.bundlesList)},function(e){u.info.bundlesLoading=!1,u.info.bundlesList=[],e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),u.info.errorMsg=r.getVal("rulesMsgs").h2_down_msg):u.info.errorMsg=r.getVal("rulesMsgs").bundle_load_failed,p(e)}):(u.info.bundlesLoading=!1,r.logError(Object.values(r.getVal("errorMsgs"))[2]),u.info.errorMsg=r.getVal("rulesMsgs").lcp_down_msg)},function(e){u.info.bundlesLoading=!1,u.info.bundlesList=[],p(e),r.logError(Object.values(r.getVal("errorMsgs"))[2]),u.info.errorMsg=r.getVal("rulesMsgs").lcp_down_msg})},u.info.selectedRules.length&&(u.info.temporaryBundleData=[{rules:u.info.selectedRules,upload_log:!0}]),u.info.firstLoad=!0,u.bundlepoll(),u.insertSelectedRules=function(){return!!u.validateUploadform()&&(l.clearErrors("fileupload"),-1!=u.info.uploader.queue[0].file.name.indexOf(" ")?(l.setError("fileupload",r.getVal("rulesMsgs").test_rule_bundle_upload_name_error),!1):void(0!=u.info.uploader.queue.length&&(u.info.rulesCopying=!0,u.info.temporaryBundleData=[{bundle_name:u.info.uploader.queue[0].file.name,waiting:!0}],u.insertRules(!1))))},u.insertRules=function(a){if(a&&(u.testButtonDisable=!0,u.uploadBtnDisable=!0),l.clearErrors("fileupload"),a)for(var e=0;e<u.logBundlesFromLogvault.length;e++)(tmp=u.logBundlesFromLogvault[e]).status="loading";g.insertRuleStaging(u.getInsertRuleData()).then(function(e){if(200==e.status){a||(u.info.temporaryBundleData=[{bundle_name:u.info.uploader.queue[0].file.name,uploading:!0}]),g.setStagingRules(!0),u.info.insertedStageRules="";for(var t=0;t<e.data.Data.length;t++)u.info.insertedStageRules+=","+e.data.Data[t].rule_id;u.info.insertedStageRules=u.info.insertedStageRules.substring(1),u.info.bunldeSignatureCount=e.data.Data[0].count,a?(u.info.checkUploadToLCPCount=0,u.testRulesWithLogvaultBundle()):(u.info.rulesCopying=!0,setTimeout(function(){u.beginUpload()},u.info.fileuploadDelay))}else l.setError("fileupload",r.getVal("rulesMsgs").test_rule_copy_error),a||(u.info.temporaryBundleData=[]);a?u.trackUser("Test Rules","Upload from logvalult",u.logBundlesFromLogvault):u.trackUser("Test Rules","Upload from local Machine",{"bundle name":u.info.uploader.queue[0].file.name})},function(e){u.testButtonDisable=!1,u.uploadBtnDisable=!1,u.info.temporaryBundleData=[],u.info.rulesCopying=!1,e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),l.setError("fileupload",r.getVal("rulesMsgs").h2_down_msg)):l.setError("fileupload",r.getVal("rulesMsgs").test_rule_copy_error);for(var t=0;t<u.logBundlesFromLogvault.length;t++)delete(tmp=u.logBundlesFromLogvault[t]).status;p(e)})},u.checkfileUploadToLCPStatus=function(t){u.info.checkUploadToLCPCount<10?g.checkfileUploadToLCPStatus(t).then(function(e){u.info.checkUploadToLCPCount++,"Success"==e.data.Status?u.insertBundleRuleAssociation(t):o(function(){u.checkfileUploadToLCPStatus(t)},5e3)},function(e){g.setLogMoving(!1),u.info.temporaryBundleData=[],p(e),u.info.errorMsg=r.getVal("rulesMsgs").log_processing_failed}):(g.setLogMoving(!1),u.info.temporaryBundleData=[],u.info.errorMsg=r.getVal("rulesMsgs").log_processing_failed)},u.insertBundleRuleAssociation=function(n){var t={rule_id:u.info.insertedStageRules,bundle_name:u.info.stageUploadBundleName,bundle_epoch:n,supported:!0,prod_rule_id:1==u.info.selectedRules.length&&u.info.selectedRules[0].status==u.info.supportedStatus.Draft?u.info.selectedRules[0].rule_id:"",rule_modified:!1};g.checkLCPStatus().then(function(e){"Success"==e.data.Status?g.insertBundleRuleAssociation(t).then(function(e){if(e.data.Data=""==e.data.Data?0:e.data.Data,"false"==e.data.Data)o(function(){u.insertBundleRuleAssociation(n)},3e3);else{g.setLogMoving(!1),g.setLastLogUploadTime(Math.floor(Date.now()));for(var t=!(u.info.deleteTemporaryBundle=!0),a=0;a<u.info.bundlesList.length;a++)if("Processing"==u.info.bundleStatus[u.info.bundlesList[a].bundle_state]||"Parsing"==u.info.bundleStatus[u.info.bundlesList[a].bundle_state]){t=!0;break}t||u.loadAllStageBundles(!1)}},function(e){g.setLogMoving(!1),u.info.temporaryBundleData=[],e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),u.info.errorMsg=r.getVal("rulesMsgs").h2_down_msg):u.info.errorMsg=r.getVal("rulesMsgs").log_processing_failed,p(e)}):(g.setLogMoving(!1),u.info.temporaryBundleData=[],r.logError(Object.values(r.getVal("errorMsgs"))[2]),u.info.errorMsg=r.getVal("rulesMsgs").lcp_down_msg)},function(e){g.setLogMoving(!1),u.info.temporaryBundleData=[],p(e),u.info.errorMsg=r.getVal("rulesMsgs").log_processing_failed})},u.getInsertRuleData=function(){for(var e=[],t=[],a=[],n=[],i=0;i<u.info.selectedRules.length;i++){e.push(u.info.selectedRules[i].rule_id),a.push(u.info.selectedRules[i].alert_id);for(var o=!1,s=0;s<t.length;s++)if(parseInt(t[s])==parseInt(u.info.selectedRules[i].category_id)){o=!0;break}o||t.push(u.info.selectedRules[i].category_id);for(var r=!1,s=0;s<n.length;s++)if(parseInt(n[s])==parseInt(u.info.selectedRules[i].email_template_id)){r=!0;break}!r&&u.info.selectedRules[i].email_template_id&&n.push(u.info.selectedRules[i].email_template_id)}var l={rule_id:e.join(","),alert_id:a.join(","),category_id:t.join(",")};return 0<n.length&&(l.template_id=n.join(",")),l},u.closeDataPathModal=function(){u.modal.close()},u.uploadForm={},g.getAllConfig().then(function(i){for(e in d.isGbStudioApp()&&(i.data.Data.config=i.data.Data.default_config||i.data.Data.config,i.data.Data.file_upload_config=i.data.Data.default_file_upload_config||i.data.Data.file_upload_config),u.info.pageLoading=!1,u.info.showMandatoryLabel=!1,u.info.mandatoryLabel=r.getVal("fileupload_mandatory_label"),u.info.uploadData=i.data.Data.file_upload_config.json_form&&JSON.parse(i.data.Data.file_upload_config.json_form),u.info.uploadData)u.info.uploadData[e].required&&(u.uploadForm[u.info.uploadData[e].name]={},u.uploadForm[u.info.uploadData[e].name].nodeVal=""),u.info.uploadData[e].mandatory&&(u.info.showMandatoryLabel=!0);u.info.uploadDataMaxSize=parseInt(i.data.Data.file_upload_config.max_upload_size);for(var e=0;e<u.info.uploader.filters.length;e++)"extensionFilter"==u.info.uploader.filters[e].name&&(u.info.uploader.filters[e]={name:"extensionFilter",fn:function(e){var t,a=!1,n=i.data.Data.file_upload_config.allowed_extension.split(", ");for(t in n)e.name.endsWith(n[t])&&(a=!0);return a}})},function(e){u.info.pageLoading=!1,p(e)}),u.getValue=function(e){return r.getVal(e)},u.getUploadErrors=function(){return l.getErrors("fileupload")},u.info.uploader=new c({url:g.getStagingDomain()+"/fileupload/uploadfile/"+w+"/"+M+"/"+V+"?stage=true",queueLimit:r.getVal("test_log_upload_limit"),filters:[{name:"extensionFilter",fn:function(e){var t,a=!1,n=r.getVal("file_upld_suprtd_extns").split(", ");for(t in n)e.name.endsWith(n[t])&&(a=!0);return a}}],onAfterAddingFile:function(e){u.checkSizeLimit()},onWhenAddingFileFailed:function(e,t,a){"queueLimit"==t.name?l.setError("fileupload",r.getVal("test_log_upload_limit_exceeded")):l.setError("fileupload",r.getVal("file_upld_unsupported"))},onErrorItem:function(e,t,a,n){!u.info.sessionTimedOut&&t&&t.hasOwnProperty("Msg")&&t.Msg.match(/timeout/)&&(u.modal&&u.modal.close(),u.info.sessionTimedOut=!0,s.sessionTimeout())},onSuccessItem:function(e,t,a,n){var i=t.Data.split(":")[0];u.info.temporaryBundleData=[{bundle_name:u.info.uploader.queue[0].file.name,processing:!0}],g.setLogMoving(!0),u.info.checkUploadToLCPCount=0,u.info.stageUploadBundleName=t.Data.split(":")[1],u.checkfileUploadToLCPStatus(i)},onBeforeUploadItem:function(a){var n;angular.forEach(u.uploadForm,function(e,t){(n={})[t]=e.nodeVal,a.formData.push(n)}),u.info.uploadDone=!1},onCompleteAll:function(){var e,t=!1,a=!1,n=!1,i={};for(e in u.uploadForm)u.uploadForm.hasOwnProperty(e)&&(i[e]=u.uploadForm[e].nodeVal);for(e in i.files=[],u.info.uploader.queue)u.info.uploader.queue[e].isSuccess?(t=!0,i.files.push(u.info.uploader.queue[e].file.name)):(u.info.uploader.queue[e].isCancel?n=!0:a=!0,u.info.bundlesList=[]);u.checkSizeLimit(),t&&n&&a||t&&n&&!a?l.setError("fileupload",r.getVal("file_upld_partial")):t||!n||a?!t||n||a?(!t&&!n&&a||!t&&n&&a||t&&!n&&a)&&l.setError("fileupload",r.getVal("file_upld_fail")):(u.info.uploadDone=!1,u.info.uploader.clearQueue(),l.clearErrors("fileupload"),u.modal.close()):l.setError("fileupload",r.getVal("file_upld_cancel")),u.info.uploader.queue.length=0,u.info.disableUpload=!1}}),u.checkSizeLimit=function(){var e,t=0;for(e in u.info.uploader.queue)t+=u.info.uploader.queue[e].file.size;l.clearErrors("fileupload"),t>u.info.uploadDataMaxSize&&l.setError("fileupload",r.getVal("file_upld_maxsize")+'<span title="'+u.info.uploadDataMaxSize+' B">'+f("fileSize")(u.info.uploadDataMaxSize)+"</span>")},u.validateUploadform=function(){var e=!0;for(i in u.info.uploadData)u.info.uploadData[i].required&&u.info.uploadData[i].mandatory&&(""==u.uploadForm[u.info.uploadData[i].name].nodeVal?(u.uploadForm[u.info.uploadData[i].name].error=!0,u.info.disableUpload=!1,e=!(u.info.bundlesList=[])):u.uploadForm[u.info.uploadData[i].name].error=!1);return e},u.beginUpload=function(){u.checkSizeLimit(),u.info.rulesCopying=!1,u.uploadForm.stage={error:!1,nodeVal:!0},0==l.getErrors("fileupload").length&&(u.info.disableUpload=!0,u.info.uploader.uploadAll())},u.removeAll=function(){u.info.uploadDone=!1,u.info.uploader.clearQueue(),l.clearErrors("fileupload"),u.hideUploadModal(),u.openUploadLogModal()},u.removeFile=function(e){u.info.uploadDone=!1,u.info.uploader.clearQueue(),l.clearErrors("fileupload"),u.hideUploadModal(),u.openUploadLogModal()},u.cancelAll=function(){for(var e in u.info.uploader.queue)u.info.uploader.queue[e].cancel();u.info.uploader.cancelAll(),u.info.disableUpload=!1},u.hideUploadModal=function(){u.modal.close(),u.info.uploadModalOpened=!1},u.closeUploadModal=function(){if(u.info.uploader.isUploading)u.msg=r.getVal("abort_upld"),u.modal1=s.openModal("partials/abort_upload.html",u,!1,"static"),u.fadeUploadModal=!0;else{for(var e in u.info.uploader.clearQueue(),u.uploadForm)u.uploadForm.hasOwnProperty(e)&&(u.uploadForm[e].nodeVal="",u.uploadForm[e].error=!1);l.clearErrors("fileupload"),u.modal.close(),u.info.uploadModalOpened=!1,u.fadeUploadModal=!1,u.info.rulesCopying=!1,u.info.uploadDone=!1}},u.abortUpload=function(){for(var e in u.info.uploader.isUploading&&u.cancelAll(),u.info.uploader.clearQueue(),u.uploadForm)u.uploadForm.hasOwnProperty(e)&&(u.uploadForm[e].nodeVal="",u.uploadForm[e].error=!1);l.clearErrors("fileupload"),u.modal.close(),u.info.uploadModalOpened=!1,u.fadeUploadModal=!1,u.info.rulesCopying=!1,u.info.uploadDone=!1},u.hideAbortUpload=function(){u.modal1.close(),u.fadeUploadModal=!1},u.selectedRulesPagination=(S=u.info.selectedRules,D=u.info.selectedRules.length,t=1,{currentPageSize:a=10,getTotalPages:function(){return Math.ceil(D/a)},getCurrentPage:function(){return t},getDisplayMsg:function(){var e=t*a;return S.length<e&&(e=S.length),(t-1)*a+1+" - "+e+" of "+D},setPageSize:function(e){currentPageSize=e,a=e},setTotal:function(e){D=e.length},next:function(){var e=Math.ceil(D/a);e<=++t&&(t=e)},prev:function(){--t<=0&&(t=1)},first:function(){t=1},last:function(){t=Math.ceil(D/a)},getData:function(){return(y=S.slice((t-1)*a,t*a))?y:[]}}),u.emptyLogvaultBundle=function(){u.modal&&(u.modal.close(),angular.element(v[0].getElementsByClassName("modal-backdrop")).remove(),l.clearErrors("fileupload")),u.logBundlesFromLogvault=[],u.testButtonDisable=!1,u.uploadBtnDisable=!1},u.$on("bundleListFromLogVault",function(e,t){u.logBundlesFromLogvault=g.getLogBundle(u.bundleList);for(var a=0;a<u.logBundlesFromLogvault.length;a++)u.logBundlesFromLogvault[a].status="";0<u.logBundlesFromLogvault.length&&(u.modal=s.openModal("partials/rules-and-alerts/bundles_from_logvault.html",u,!1,"static",!0))}),u.$watch("logBundlesFromLogvault",function(e,t){for(var a=!1,n=0;n<e.length;n++){if(!e[n].status){a=!1;break}if("loading"==e[n].status){a=!0;break}}a?u.allBunldesUploaded=!1:(u.allBunldesUploaded=!0,u.testButtonDisable=!1)},!0),u.testRulesWithLogvaultBundle=function(){u.testButtonDisable=!0;for(var e,t=[],a=0;a<u.logBundlesFromLogvault.length;a++)e=u.logBundlesFromLogvault[a],t.push({bundle_name:e.obs_url,bundle_id:e.bundle_id,obs_date:e.obs_date,status:"loading"});g.sendRulesWithLogvaultBundle({download:{bundles:t}}).then(function(e){for(var t=e.data.Data,a=t.length,n=0;n<a;n++){for(var i=t[n],o=i.bundle_name.split(":")[1],s=i.bundle_name.split(":")[0],r=0;r<u.logBundlesFromLogvault.length;r++){var l=u.logBundlesFromLogvault[r];if(l.obs_date.replace("T","_").replace(/:/g,"_").replace("Z","_")+l.obs_url==o){l.bundle_name=o,i=l;break}}i.count=0,i.status="loading",i.insertCount=0,u.checkMultiplefileUploadToLCPStatus(i,s,u.insertMultipleBundleRuleAssociation)}},function(e){u.info.pageLoading=!1,p(e)})},u.checkMultiplefileUploadToLCPStatus=function(t,a,n){t.count<7?g.checkfileUploadToLCPStatus(a).then(function(e){t.count++,"Success"==e.data.Status?n(t,a):o(function(){u.checkMultiplefileUploadToLCPStatus(t,a,n)},5e3)},function(e){p(e),t.status="failed",u.testButtonDisable=!1,u.info.errorMsg=r.getVal("rulesMsgs").log_processing_failed}):(u.testButtonDisable=!1,t.status="failed",l.setError("fileupload",r.getVal("rulesMsgs").log_processing_failed),u.info.errorMsg=r.getVal("rulesMsgs").log_processing_failed)},u.insertMultipleBundleRuleAssociation=function(t,a){var n={rule_id:u.info.insertedStageRules,bundle_name:t.bundle_name,bundle_epoch:a,supported:!0,prod_rule_id:1==u.info.selectedRules.length&&u.info.selectedRules[0].status==u.info.supportedStatus.Draft?u.info.selectedRules[0].rule_id:"",rule_modified:!1};g.checkLCPStatus().then(function(e){"Success"==e.data.Status&&t.insertCount<8?g.insertBundleRuleAssociation(n).then(function(e){t.insertCount++,e.data.Data=""==e.data.Data?0:e.data.Data,"false"==e.data.Data?o(function(){u.insertMultipleBundleRuleAssociation(t,a)},3e3):t.status="success",u.loadAllStageBundles(t)},function(e){e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(r.logError(Object.values(r.getVal("errorMsgs"))[1]),u.info.errorMsg=r.getVal("rulesMsgs").h2_down_msg):(l.setError("fileupload",r.getVal("rulesMsgs").log_processing_failed),u.info.errorMsg=r.getVal("rulesMsgs").log_processing_failed),t.status="failed",u.uploadfailed(t),u.testButtonDisable=!1,p(e)}.bind(this)):(u.testButtonDisable=!1,t.status="failed",l.setError("fileupload",r.getVal("rulesMsgs").log_processing_failed),r.logError(Object.values(r.getVal("errorMsgs"))[2]),u.info.errorMsg=r.getVal("rulesMsgs").lcp_down_msg)},function(e){p(e),l.setError("fileupload",r.getVal("rulesMsgs").log_processing_failed),u.info.errorMsg=r.getVal("rulesMsgs").log_processing_failed})},u.uploadfailed=function(e){for(var t=0;t<u.logBundlesFromLogvault.length;t++)u.logBundlesFromLogvault[t].obs_url.split(":")==e.bundle_name&&(u.logBundlesFromLogvault[t].status="failed")},u.trackUser=function(e,t,a){a=JSON.stringify(a);b.standard_user_tracking(u.info.application,e,t,a).then(function(e){},p)}}]).controller("AddRuleCtrl",["$scope","$sce","$timeout","$window","ModalService","RulesService","$filter","GlobalService","UserTrackingService","AppService","ExplorerService","metaDataService","RulesTestWithLogvault","UtilService","$cookies",function(T,t,n,s,r,d,y,F,f,e,o,a,l,g,c){T.info={},T.info.clinsightFlag=F.getVal("clinsightFlag")||!1,T.info.ruleType=d.getRuleType(),T.info.unsupportedrule="unsupported"==T.info.ruleType,T.info.application=F.getVal("navRules"),T.info.lastElementFocused=null,T.info.maxLimits=F.getVal("rulesMaxLimits"),T.info.addRuleContextHelp=F.getVal("addRulesHelpLinks"),T.showContent={label:!1,description:!1},T.info.sessionTimedOut=!1,T.addRuleAttrSearch="",T.NoAttrSearch=!1,T.ifSearched=!1,T.attributeSearchMinStrLen=F.getVal("minAttrSearch"),T.info.tooltips=F.getVal("addRuleTooltips"),T.info.scopes=F.getVal("rulesScopes"),T.info.columnDataTypes=F.getVal("columnDataTypes"),T.info.convertedAttributes=[],T.info.maxAlertInputLimit=F.getVal("maxAlertInputLimit"),T.info.ruleCurrentVersion=0,T.info.sectionsLoading=!0,T.info.categoriesLoading=!0,T.info.attributeLimit=50,T.sectionsColumnLabelMap={},T.info.categories=[],T.info.severities=[],T.info.priorities=[],T.info.addRuleMsg={},T.info.ruleAdded=!1,T.info.testRuleData=null,T.info.sectionsColumnLabeListOfLogic=[],T.info.operators=y("filter")(F.getVal("rulesOperators"),{enabled:!0}),T.info.functions=y("filter")(F.getVal("rulesFunctions"),{enabled:!0}),T.info.aggregateFunctions=y("filter")(F.getVal("rulesAggregateFunction"),{enabled:!0}),T.info.supportedStatus=F.getVal("rulesSupportedStatus"),T.info.selectedTagsCount=0,T.info.tagList=[],T.processAPItemplateForAddRule=function(e){T.info.apiTemplates=e},T.processAPItemplateForEditRule=function(e){T.info.apiTemplates=e},T.updateTagSelectedCount=function(){T.info.selectedTagsCount=T.info.tagList.filter(function(e){return e.selected}).length},T.fetchAPITemplate=function(t){d.getAPITemplates().then(function(e){t(e.data.Data)},function(e){T.info.apiTemplates=[],console.error("Unable to load templates"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}),u(e)})},T.showAlertApiFeature=d.getshowAlertApiFeature(),T.info.emailText="",d.getNonSsoUsers().then(function(e){T.info.emailList=e.data.Data.reduce(function(e,t){return e.push(t.email),e},[])||[]},function(e){T.info.emailList=[],console.error("Unable to load templates"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}),u(e)}),T.fetchtaglist=function(){d.getPredefinedTagList().then(function(e){T.info.tagList=[],T.info.tagList=e.data.Data.map(function(e){return e.selected=!1,e})||[],d.getRuleMode()&&"edit"==d.getRuleMode().mode&&d.getRuleMode().data.tags.length&&T.info.subscription_enabled&&(T.info.tagList.forEach(function(t){d.getRuleMode().data.tags.forEach(function(e){t.tag_id==e.tag_id&&(t.selected=!0)})}),T.updateTagSelectedCount())},function(e){T.info.tagList=[],console.error("Unable to load templates"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}),u(e)})},T.populateEditRule=function(){T.info.tags=[];var e=d.getRuleMode().data;T.info.pageLabel="Edit Rule - "+e.label_display,T.info.ruleName=e.rule_name,T.info.initialLabel=e.label,T.info.initialScope=e.scope,T.info.initialMaxLimit=e.max_limit,T.info.initialSubscription_enabled=e.subscription_enabled,T.info.initialSubscriptionEmailList=e.subscriptionEmailList?e.subscriptionEmailList.slice():[],0<parseInt(e.email_template_id)?T.info.initialAction="mail":0<parseInt(e.api_template_id)?T.info.initialAction="api":T.info.initialAction="none",T.info.initialLogic=e.logic_display,T.info.initialText=e.text_display,T.info.alertID=parseInt(e.alert_id),T.info.status=e.status,T.info.subscriberCount=e.subscriberCount,T.info.initialApiTemplateId=e.api_template_id,T.info.initialEmailTemplateId=e.email_template_id,T.info.initialJustification=e.alert_justification_display,T.info.initialRecommendation=e.recommendation_display,T.info.initialtagList=e.subscription_enabled&&e.tags.length?e.tags.reduce(function(e,t){return e.push(t.tag_id),e},[]):[],d.getRuleMode()&&d.getRuleMode().modifiedData?(T.info.label=d.getRuleMode().modifiedData.label,T.info.description=d.getRuleMode().modifiedData.description,T.info.category=parseInt(d.getRuleMode().modifiedData.category_id),T.info.author=d.getRuleMode().modifiedData.author,T.info.severity=parseInt(d.getRuleMode().modifiedData.severity_id),T.info.priority=parseInt(d.getRuleMode().modifiedData.priority_id),T.info.action=d.getRuleMode().modifiedData.action,T.info.emailTemplate="select"!=d.getRuleMode().modifiedData.email_template_id&&d.getRuleMode().modifiedData.email_template_id?parseInt(d.getRuleMode().modifiedData.email_template_id):"select",T.info.apiTemplate="select"!=d.getRuleMode().modifiedData.api_template_id&&d.getRuleMode().modifiedData.api_template_id?parseInt(d.getRuleMode().modifiedData.api_template_id):"select",T.info.kbLink=d.getRuleMode().modifiedData.kb_link,T.info.recommendation=d.getRuleMode().modifiedData.recommendation_display,T.info.alert_justification=d.getRuleMode().modifiedData.alert_justification_display,T.info.logic=d.getRuleMode().modifiedData.logic_display,T.info.text=d.getRuleMode().modifiedData.text_display,T.info.scope=d.getRuleMode().modifiedData.scope,T.info.maxLimit=d.getRuleMode().modifiedData.max_limit,T.info.maxLimitDisplay=parseInt(d.getRuleMode().modifiedData.max_alerts_display_ui?d.getRuleMode().modifiedData.max_alerts_display_ui:1),T.info.createdBy=d.getRuleMode().modifiedData.created_by,T.info.createdTs=d.getRuleMode().modifiedData.created_ts,T.info.action_id=d.getRuleMode().modifiedData.action_id,T.showAlertApiFeature&&T.fetchAPITemplate(T.processAPItemplateForAddRule),T.info.subscription_enabled=d.getRuleMode().modifiedData.subscription_enabled,T.info.subscriptionEmailList=d.getRuleMode().modifiedData.subscriptionEmailList,T.info.tagList=d.getRuleMode().modifiedData.tagList,T.updateTagSelectedCount()):(T.info.label=e.label,T.info.description=e.description,T.info.category=parseInt(e.category_id),T.info.author=e.author,T.info.severity=parseInt(e.severity_id),T.info.priority=parseInt(e.priority_id),T.info.apiTemplate="select",T.info.emailTemplate="select",0<parseInt(d.getRuleMode().data.email_template_id)?(T.info.action="mail",T.info.emailTemplate=0==parseInt(d.getRuleMode().data.email_template_id)?"select":parseInt(d.getRuleMode().data.email_template_id),T.info.subscription_enabled=e.subscription_enabled):0<parseInt(d.getRuleMode().data.api_template_id)?(T.info.action="api",T.info.apiTemplate=parseInt(d.getRuleMode().data.api_template_id)):T.info.action="none",T.info.kbLink=e.kb_link,T.info.recommendation=e.recommendation_display,T.info.alert_justification=e.alert_justification_display,T.info.logic=e.logic_display,T.info.text=e.text_display,T.info.scope=e.scope,T.info.maxLimit=e.max_limit,T.info.maxLimitDisplay=parseInt(e.max_alerts_display_ui||1),T.info.createdBy=e.created_by,T.info.createdTs=e.created_ts,T.showAlertApiFeature&&T.fetchAPITemplate(T.processAPItemplateForEditRule),T.setSavedMode(),T.info.action_id=parseInt(d.getRuleMode().data.action_id),T.info.subscription_enabled=e.subscription_enabled,T.info.subscriptionEmailList=e.subscriptionEmailList||[],e.tags&&T.info.clinsightFlag&&T.fetchtaglist())},T.populateAddRule=function(){T.info.tags=[],T.info.pageLabel="Add New Rule",T.info.initialLabel=null,T.info.initialScope=null,T.info.initialMaxLimit=null,T.info.initialAction=null,T.info.initialLogic=null,T.info.initialText=null,T.info.initialMaxLimitDisplay=1,d.getRuleMode()&&d.getRuleMode().modifiedData?(T.info.label=d.getRuleMode().modifiedData.label,T.info.description=d.getRuleMode().modifiedData.description,T.info.category="select"!=d.getRuleMode().modifiedData.category_id?parseInt(d.getRuleMode().modifiedData.category_id):d.getRuleMode().modifiedData.category_id,T.info.author=d.getRuleMode().modifiedData.author,T.info.severity="select"!=d.getRuleMode().modifiedData.severity_id?parseInt(d.getRuleMode().modifiedData.severity_id):d.getRuleMode().modifiedData.severity_id,T.info.priority="select"!=d.getRuleMode().modifiedData.priority_id?parseInt(d.getRuleMode().modifiedData.priority_id):d.getRuleMode().modifiedData.priority_id,T.info.action=d.getRuleMode().modifiedData.action,T.info.emailTemplate="select"!=d.getRuleMode().modifiedData.email_template_id&&d.getRuleMode().modifiedData.email_template_id?parseInt(d.getRuleMode().modifiedData.email_template_id):"select",T.info.apiTemplate="select"!=d.getRuleMode().modifiedData.api_template_id&&d.getRuleMode().modifiedData.api_template_id?parseInt(d.getRuleMode().modifiedData.api_template_id):"select",T.info.maxLimitDisplay=parseInt(d.getRuleMode().modifiedData.maxLimitDisplay?d.getRuleMode().modifiedData.maxLimitDisplay:0),T.info.kbLink=d.getRuleMode().modifiedData.kb_link,T.info.recommendation=d.getRuleMode().modifiedData.recommendation_display,T.info.alert_justification=d.getRuleMode().modifiedData.alert_justification_display,T.info.logic=d.getRuleMode().modifiedData.logic_display,delete T.info.initialLogic,T.info.text=d.getRuleMode().modifiedData.text_display,delete T.info.initialText,T.info.scope=d.getRuleMode().modifiedData.scope,T.info.maxLimit=d.getRuleMode().modifiedData.max_limit,T.info.maxLimitDisplay=parseInt(d.getRuleMode().modifiedData.max_alerts_display_ui?d.getRuleMode().modifiedData.max_alerts_display_ui:1),T.showAlertApiFeature&&T.fetchAPITemplate(T.processAPItemplateForAddRule),T.info.subscription_enabled=d.getRuleMode().modifiedData.subscription_enabled,T.info.subscriptionEmailList=d.getRuleMode().modifiedData.subscriptionEmailList,T.info.tagList=d.getRuleMode().modifiedData.tagList,T.updateTagSelectedCount()):(T.info.label="",T.info.description="",T.info.category="select",T.info.author="",T.info.severity="select",T.info.priority="select",T.info.action="none",T.info.emailTemplate="select",T.info.apiTemplate="select",T.info.kbLink="",T.info.recommendation="",T.info.alert_justification="",T.info.maxLimitDisplay=1,d.getloadExplorerRules()?(T.info.logic=o.getRuleText(),d.disableExplorerRules(),T.setUnsavedMode(),p=!0):(T.info.logic="",T.setSavedMode()),delete T.info.initialLogic,T.info.text="",delete T.info.initialText,T.info.scope=T.info.scopes[0],T.info.maxLimit=T.info.maxLimits[0],T.setSavedMode(),T.showAlertApiFeature&&T.fetchAPITemplate(T.processAPItemplateForAddRule),T.info.subscription_enabled=!1,T.info.subscriptionEmailList=[],T.info.clinsightFlag&&T.fetchtaglist())},T.getSectionData=function(e){for(var t=e.split(/\s*\,\s*/g),a=T.info.sectionsLoaded=0;a<t.length;a++){var n=y("filter")(T.info.attributes,{table_name:t[a]},!0)[0];n.hasData?(T.info.sectionsLoaded++,T.info.sectionsLoaded==t.length&&(T.info.sectionsLoading=!1)):(T.info.sectionsLoading=!0,T.getSectionColumns(n,t.length))}},T.checkSearchText=function(){return T.addRuleAttrSearch.length<T.attributeSearchMinStrLen},T.clearSearchText=function(){T.addRuleAttrSearch="",T.addRuleAttrSearchChange()},T.addRuleAttrSearchChange=function(){T.addRuleAttrSearch.length<T.attributeSearchMinStrLen&&(T.info.attributes=[],T.info.attributes=angular.copy(d.getAttributes()),T.NoAttrSearch=!1,T.ifSearched=!1)},T.searchAttr=function(){var e;T.addRuleAttrSearch.length<T.attributeSearchMinStrLen||(/[!@#$%^&*()_+=\[\]{};':"\\|,.<>\/?]/.test(T.addRuleAttrSearch)?r.alertBox({msg:F.getVal("attrSearchSpecialCharecterMsg")}):(e=T.addRuleAttrSearch,T.info.sectionsLoading=!0,T.info.attributes=angular.copy(d.getAttributes()),d.getSectionsFromAttrAPI(e).then(function(e){for(i=0;i<T.info.attributes.length;i++)T.info.attributes[i].foundAttr=[],T.info.attributes[i].expanded=!1;var t,a=e.data.Data;for(t in a)for(j=0;j<T.info.attributes.length;j++)if(t==T.info.attributes[j].namespace_actual){T.info.attributes[j].foundAttr=a[t],T.info.attributes[j].columns=[],T.info.attributes[j].hasData=!0;for(;0<a[t].length;a[t]++){var n={},o=a[t][0];n.column_name=o.column_name,n.attribute_label=o.label,n.solr_facet=o.namespace_actual,n.type=o.dataType,T.info.attributes[j].columns.push(n)}}for(i=0;i<T.info.attributes.length;i++)0==T.info.attributes[i].foundAttr.length&&(T.info.attributes.splice(i,1),i--);T.ifSearched=!0,0==T.info.attributes.length?T.NoAttrSearch=!0:T.NoAttrSearch=!1,T.info.sectionsLoading=!1,T.setSectionsColumnLabelMap(),f.standard_user_tracking(T.info.application,"Rule","Attribute Search",T.addRuleAttrSearch).then(function(e){},u)},function(e){T.info.attributes=[],u(e)})))},T.getSectionColumns=function(n,i){n.loading=!0,d.getSectionColumns(n.table_name).then(function(e){n.loading=!1,T.info.sectionsLoaded++,T.info.sectionsLoaded==i&&(T.info.sectionsLoading=!1),n.columns=[];for(var t=0;t<e.data.Data.length;t++){var a={};a.column_name=Object.keys(e.data.Data[t])[0],a.attribute_label=e.data.Data[t][a.column_name].attribute_label,a.solr_facet=e.data.Data[t][a.column_name].solr_facet,a.type=e.data.Data[t][a.column_name].type,a.size=e.data.Data[t][a.column_name].size,n.columns.push(a),"G"==a.solr_facet?n.hasGlobal=!0:n.hasLocal=!0}n.hasData=!0,T.addRuleAttrSearch||d.setAttributes(T.info.attributes),T.setSectionsColumnLabelMap()},function(e){T.info.sectionsLoaded++,n.loading=!1,T.info.sectionsLoaded==i&&(T.info.sectionsLoading=!1),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}),u(e)})},T.setSavedMode=function(){d.setRuleSavedStatus(!1)},T.setUnsavedMode=function(){d.setRuleSavedStatus(!0)},T.actionChanged=function(){"mail"==T.info.action&&d.getRuleSavedStatus()||T.setUnsavedMode()},T.actionChange=function(){"mail"!=T.info.action&&0<T.info.selectedTagsCount&&r.alertBox({msg:"Selected tags will be disassociated and auto subscription will be disabled."})},T.goToAddCategory=function(){T.modifyRuleData(),T.$parent.changeCurrentPage("add_category")},T.goToManageTemplates=function(){T.modifyRuleData(),T.$parent.changeCurrentPage("manage_template")},T.goToManageAPITemplates=function(){var e=d.getSectionsAndAttributePair(T.info.logic);e&&d.setSectionsColumnLabelForManageAPI(e),T.modifyRuleData(),T.$parent.changeCurrentPage("manage_API_template")};var p=!(T.modifyRuleData=function(){var e={label:T.info.label,description:T.info.description,category_id:T.info.category,author:T.info.author,severity_id:T.info.severity,priority_id:T.info.priority,email_template_id:"mail"==T.info.action?T.info.emailTemplate:"",action:T.info.action,kb_link:T.info.kbLink,recommendation_display:T.info.recommendation,alert_justification_display:T.info.alert_justification,logic_display:T.info.logic,text_display:T.info.text,scope:T.info.scope,max_limit:T.info.maxLimit,max_alerts_display_ui:T.info.maxLimitDisplay,created_by:T.info.createdBy,created_ts:T.info.createdTs,api_template_id:T.info.apiTemplate,action_id:T.info.action_id,subscription_enabled:T.info.subscription_enabled,subscriptionEmailList:T.info.subscriptionEmailList,tagList:T.info.tagList};d.modifyRuleData(e)}),C=(d.getRuleMode()&&"edit"==d.getRuleMode().mode?T.populateEditRule():T.populateAddRule(),T.$on("loadExplorerRulesEvent",function(e,t){var a;p=!0,T.populateAddRule(),d.disableExplorerRules(),d.getAttributesLoaded()&&(T.info.attributes=d.getAttributes(),a=y("filter")(T.info.attributes,{name:o.getRuleSection()},!0)[0],n(function(){a.expanded=!0;var e=document.getElementById("treeContainer"),t=document.getElementById("section-"+a.table_name);e.scrollTop=t.offsetTop,T.expandSection(a),a.highlighted=!0,n(function(){a.highlighted=!1},5e3)},50),p=!1)}),T.clearMessage=function(){T.info.categoriesLoading||(T.info.addRuleMsg={})},T.insertEditLink=function(){var e,t,a,n,i,o=s.getSelection();null!=o.anchorNode?(e=o.anchorNode.parentNode.offsetParent.innerText,/^[a-z0-9\s\n]+$/i.test(e)?-1!=o.anchorNode.parentNode.offsetParent.className.indexOf("gb-rules-recommendation")?o.extentOffset!=o.baseOffset||o.anchorOffset!=o.focusOffset?(e=o.anchorNode.wholeText,t=o.focusNode.parentElement.tagName,n=o.hasOwnProperty("extentOffset")&&o.hasOwnProperty("baseOffset")?(a=o.extentOffset>o.baseOffset?o.baseOffset:o.extentOffset,o.extentOffset>o.baseOffset?o.extentOffset:o.baseOffset):(a=o.anchorOffset>o.focusOffset?o.focusOffset:o.anchorOffset,o.anchorOffset>o.focusOffset?o.anchorOffset:o.focusOffset),i=e.substring(a,n),"A"==o.anchorNode.parentElement.tagName?(T.info.pageTitle="Edit Link",T.info.pageHeading="Edit link for <strong>"+o.anchorNode.parentElement.textContent+"</strong>",T.info.pageLink=o.anchorNode.parentElement.title,T.info.htmlElement=o.anchorNode.parentElement,T.modal=r.openModal("partials/rules-and-alerts/insert_edit_link.html",T,!1,"static")):"A"!=t?(T.info.pageTitle="Insert Link",T.info.pageHeading="Insert link for <strong>"+i+"</strong>",T.info.innerHtml=o.anchorNode.parentElement.innerHTML,T.info.startPos=a,T.info.endPos=n,T.info.wholeText=e,T.info.htmlElement=o.anchorNode.parentElement,T.info.selectedText=i,T.info.pageLink="http://",T.modal=r.openModal("partials/rules-and-alerts/insert_edit_link.html",T,!1,"static")):r.alertBox({msg:"Something wrong in selection"})):/firefox/i.test(s.navigator.userAgent)&&"A"==o.anchorNode.previousElementSibling.tagName?(T.info.pageTitle="Edit Link",T.info.pageHeading="Edit link for <strong>"+o.anchorNode.previousElementSibling.textContent+"</strong>",T.info.pageLink=o.anchorNode.previousElementSibling.title,T.info.htmlElement=o.anchorNode.previousElementSibling,T.modal=r.openModal("partials/rules-and-alerts/insert_edit_link.html",T,!1,"static")):r.alertBox({msg:F.getVal("rulesMsgs").add_rule_select_recommendation_text}):r.alertBox({msg:F.getVal("rulesMsgs").add_rule_select_recommendation_text}):r.alertBox({msg:"Only alphanumeric characters allowed for recommendation text"})):r.alertBox({msg:F.getVal("rulesMsgs").add_rule_select_recommendation_text})},T.checkLink=function(e){/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)/.test(T.info.pageLink)?(T.modal.close(),"insert"==e?T.insertLinkConfirm():T.editLinkConfirm()):(T.msg="Please enter a valid link",T.modal1=r.openModal("partials/alert_box_extra.html",T,!1,"static"),T.info.fadeModal=!0)},T.insertLinkConfirm=function(){var e=T.info.innerHtml,t=e.indexOf(T.info.wholeText);T.info.htmlElement.innerHTML=e.substring(0,T.info.startPos+t)+"<a title='"+T.info.pageLink+"' dest='"+T.info.pageLink+"' onclick='window.open(this.title, \"_blank\");'>"+T.info.selectedText+"</a>"+e.substr(T.info.endPos+t),T.setUnsavedMode()},T.editLinkConfirm=function(){T.info.htmlElement.dest=T.info.pageLink,T.info.htmlElement.title=T.info.pageLink,T.setUnsavedMode()},T.setSectionsColumnLabelMap=function(){var e,t,a=y("filter")(T.info.attributes,{hasData:!0});for(e in a)if(a[e].label&&a[e].table_name)for(var n in a[e].columns)a[e].columns[n].attribute_label&&(t=[a[e].label,".",a[e].columns[n].attribute_label].join(""),n=[[a[e].table_name,".",a[e].columns[n].column_name].join(""),a[e].columns[n].column_name,a[e].columns[n].type,["(",a[e].table_name,F.getVal("rulesSecColDelimiter"),a[e].columns[n].column_name,F.getVal("rulesSecColDelimiter"),a[e].columns[n].type,")"].join(""),a[e].table_name,a[e].columns[n].solr_facet],T.sectionsColumnLabelMap[t]=n);d.setSectionsColumnLabelMap(T.sectionsColumnLabelMap)},T.$watch("info.categoriesLoading",function(){var a;0==T.info.categoriesLoading&&T.info.attributes&&p&&(a=y("filter")(T.info.attributes,{name:o.getRuleSection()},!0)[0],n(function(){a.expanded=!0,T.expandSection(a),a.highlighted=!0,n(function(){a.highlighted=!1},5e3);var e=document.getElementById("treeContainer"),t=document.getElementById("section-"+a.table_name);e.scrollTop=t.offsetTop},50),0==T.info.sectionsLoading&&(p=!1))}),d.getAttributesLoaded()||d.getSectionsAPI().then(function(e){var a;T.info.attributes=e.data.Data,p&&(a=y("filter")(T.info.attributes,{name:o.getRuleSection()},!0)[0],n(function(){a.expanded=!0,T.expandSection(a),a.highlighted=!0,n(function(){a.highlighted=!1},5e3);var e=document.getElementById("treeContainer"),t=document.getElementById("section-"+a.table_name);e.scrollTop=t.offsetTop},50),0==T.info.categoriesLoading&&(p=!1)),T.info.sectionsLoading=!1,d.setAttributes(T.info.attributes),d.setAttributesLoaded(!0),T.setSectionsColumnLabelMap(),d.getRuleMode()&&"edit"==d.getRuleMode().mode&&d.getRuleMode().data.colt&&T.getSectionData(d.getRuleMode().data.colt)},function(e){T.info.sectionsLoading=!1,T.info.attributes=[],e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}),u(e)}),d.getCategories().then(function(e){T.info.categories=e.data.Data,d.getAttributesLoaded()&&(T.info.attributes=d.getAttributes(),T.info.sectionsLoading=!1,T.setSectionsColumnLabelMap(),d.getRuleMode()&&"edit"==d.getRuleMode().mode&&d.getRuleMode().data.colt&&T.getSectionData(d.getRuleMode().data.colt)),T.info.categoriesLoading=!1},function(e){T.info.categories=[],d.getAttributesLoaded()&&(T.info.attributes=d.getAttributes(),T.info.sectionsLoading=!1,T.setSectionsColumnLabelMap(),d.getRuleMode()&&"edit"==d.getRuleMode().mode&&d.getRuleMode().data.colt&&T.getSectionData(d.getRuleMode().data.colt)),T.info.categoriesLoading=!1,e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}),console.error("Unable to load categories"),u(e)}),T.getRulesVersion=function(){"Add New Rule"!=T.info.pageLabel&&d.getRuleMode().data.label_display&&d.getRuleDrillDetails(d.getRuleMode().data.rule_name).then(function(e){e=e.data.Data;responseDataFiltered=e.filter(function(e){return"Created"==e.type_of_change||"State change"!==e.type_of_change&&0!=e.changes_map.length}),T.info.ruleCurrentVersion=responseDataFiltered.length},function(e){T.info.ruleCurrentVersion=0})},T.getRulesVersion(),d.getTemplates().then(function(e){T.info.templates=e.data.Data},function(e){T.info.templates=[],console.error("Unable to load templates"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}),u(e)}),Array.isArray(d.getSeveritiesList())?T.info.severities=d.getSeveritiesList():d.getSeverities().then(function(e){T.info.severities=e.data.Data,d.setSeveritiesList(T.info.severities)},function(e){T.info.severities=[],e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}),u(e)}),Array.isArray(d.getPrioritiesList())?T.info.priorities=d.getPrioritiesList():d.getPriorities().then(function(e){T.info.priorities=e.data.Data,d.setPrioritiesList(T.info.priorities)},function(e){T.info.priorities=[],e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}),u(e)}),T.loadURL=function(){angular.element(".tooltip-html").load("./../../help/Addviews.html")},T.submitRule=function(e){if("supported"!=d.getRuleType())return T.validateUnsupportedElements()?(T.editUnsupportedRule(),!1):void 0;if("parent"==e&&!T.validateElements())return!1;if("supported"==d.getRuleType()){e=T.info.logic.search(/(count\()|(count \()|(regex\()|(regex \()|(upper\()|(upper \()|(lower\()|(lower \()|(converttoint\()|(converttoint \()|(converttostring\()|(converttostring\()/g);if(-1!=e)return void A(msg=F.getRulesLogicAlerts("rule_logic_error_UpperCaseCountRegexName"),e,e+5)}e=T.validateLogicMap();if(Array.isArray(e)){T.info.sectionsColumnLabeListOfLogic=e;var t=T.deepValidation(T.info.label,"rule_label_invalid_attr","rule_label_local_attr");if(Array.isArray(t)){var a=g.compareFirstWithSecondList(T.info.sectionsColumnLabeListOfLogic,t),n=T.deepValidation(T.info.text,"rule_text_invalid_attr","rule_text_local_attr");if(Array.isArray(n)){a=a.concat(g.compareFirstWithSecondList(T.info.sectionsColumnLabeListOfLogic,n));var i=T.validateAPITemplateMap();if(Array.isArray(i)){i=T.deepValidation(T.info.alert_justification,"rule_justification_invalid_attr","rule_justification_local_attr");if(Array.isArray(i)){a=a.concat(g.compareFirstWithSecondList(T.info.sectionsColumnLabeListOfLogic,i));var o=T.deepValidation(T.info.recommendation,"rule_recommendation_invalid_attr","rule_recommendation_local_attr");if(Array.isArray(o)){var s,r,a=a.concat(g.compareFirstWithSecondList(T.info.sectionsColumnLabeListOfLogic,o));if(T.validateLogicGrammar())T.createColumnType(e,n,t,i,o),T.checkMultipleTable()&&(s=angular.copy(T.info.logic),r=1,T.info.convertedRegexes=[],angular.forEach(T.info.regexMatches,function(e){var t,a="flag"+r,n=(s=s.replace(e.actualLogic,a),new RegExp("CONVERTTOINT\\(\\s*"+a+"\\s*\\)\\s*(\\<|\\>|\\=|\\>\\=|\\<\\=)\\s*\\d+(\\.\\d+)?"));n.test(s)?(t=(n=s.match(n)[0]).match(/(\<|\>|\=|\>\=|\<\=)\s*\d+(\.\d+)?$/)[0].replace(/(^|\s)(\d+)(\s|$|\))/g,"$1$2L$3").replace(/(^|\s)(\d+\.\d+)(\s|$)/g,"$1$2D$3"),s=s.replace(n,a),e.returnType="Long",e.condition=t):e.returnType="String",e.flagVariable=a,e.extractVariable="extract"+r,e.regexVariable="reg"+r,r++,delete e.actualLogic,T.info.convertedRegexes.push(e)}),s=T.convertAggregateFunction(s),T.info.convertedLogic=T.convertScalaCondition(s),T.setHiddenLogic(e),T.setHiddenText(n),T.setHiddenLabel(t),T.setHiddenJustification(i),T.setHiddenRecommendation(o),T.info.ruletype=d.getRuleType(),0<a.length?g.showModal(a.join(",")+F.getVal("ruleValidationSameSectionAsLogic")):T.addEditRule());else{for(var l=0;l<T.info.convertedAttributes.length;l++)T.changeColumnType(T.info.convertedAttributes[l].value,T.info.convertedAttributes[l].type);T.info.convertedAttributes=[]}}}}}}}},T.convertAggregateFunction=function(s){return T.info.convertedCounts=[],T.info.convertedAggregates={},T.info.aggregateFunctions.map(function(e){var n=e.label,i=(T.info.countMatches=v(s,n+"("),1),o=new RegExp("^"+n+"\\s*\\(\\s*|\\s*\\)\\s*$","gi");angular.forEach(T.info.countMatches,function(e){var t=n.toLocaleLowerCase()+i,e=(T.info.convertedAggregates[n]||(T.info.convertedAggregates[n]=[]),s=s.replace(e,t),e.replace(o,"").replace(/^\s+|\s+$/g,"")),a=n.toLocaleLowerCase()+"Variable",e={expression:T.convertScalaCondition(e).replace(/\'/g,'"').replace(/^\s+|\s+$/g,"").replace(/[\"]+/g,'"')};e[a]=t,"AVG"===n&&(e.avgSumVariable="avgSum"+i,e.avgTotalCountVariable="avgCount"+i),T.info.convertedAggregates[n].push(e),i++})}),s},T.processAggregateFunctionForPayload=function(){var a={};return T.info.convertedAggregates&&Object.keys(T.info.convertedAggregates).map(function(e){var t=e.toLowerCase(),t="converted"+(t[0].toUpperCase()+t.substr(1)+"s");a[t]||(a[t]=[]),a[t]=T.info.convertedAggregates[e]}),a},T.getOperatorType=function(t){var a="";return T.info.operators.map(function(e){e.label===t&&(a=e.subtype)}),a},T.isAggregateFunction=function(t){var a=!1;return T.info.aggregateFunctions.map(function(e){"COUNT"!=e.label&&e.label===t&&(a=!0)}),a},T.renderHtml=function(e){return t.trustAsHtml(e)},T.testRule=function(){T.modifyRuleData(),T.setPageListforTesting();var e=[];e.push(T.info.testRuleData),d.setTestRuleData(e),l.setRulesSelected(e),T.$parent.changeCurrentPage("test_rule_history")},T.setPageListforTesting=function(){var e=F.getVal("rulesPages");e.test_rule_history=[{name:"rules_list",label:"Rules List"},{name:"add_rule",label:"Add/Edit Rule"},{name:"test_rule_history",label:"Test Rule History"}],F.setVal("rulesPages",e)},T.addNewRule=function(){d.setRuleMode("new"),T.info.ruleAdded=!1,T.info.addRuleMsg={},T.populateAddRule()},T.checkMultipleTable=function(){if(!(1<T.info.tables.length&&"Table"==T.info.scope))return!0;r.alertBox({msg:F.getVal("rulesMsgs").add_rule_multiple_tables_unsupported})},T.editUnsupportedRule=function(){var e,t,a=T.deepValidation(T.info.label,"rule_label_invalid_attr","rule_label_local_attr");Array.isArray(a)&&(e=T.deepValidation(T.info.alert_justification,"rule_justification_invalid_attr","rule_justification_local_attr"),Array.isArray(e)&&(t=T.deepValidation(T.info.recommendation,"rule_recommendation_invalid_attr","rule_recommendation_local_attr"),Array.isArray(t)&&(T.setHiddenLabel(a),T.setHiddenJustification(e),T.setHiddenRecommendation(t),T.info.ruletype=d.getRuleType(),T.info.categoriesLoading=!0,T.unsdataobj={},unsdataobj="api"==T.info.action&&T.info.apiTemplate&&"select"!=T.info.apiTemplate?{"update.apiTemplateId":T.info.apiTemplate}:{"update.apiTemplateId":0},a={label_actual:T.info.hiddenLabel.replace(/^\s+|\s+$/g,""),recommendation:T.info.hiddenRecommendation?T.info.hiddenRecommendation.replace(/^\s+|\s+$/g,""):"",alert_justification:T.info.hiddenJustification?T.info.hiddenJustification.replace(/^\s+|\s+$/g,""):"","update.label_display":T.info.label.replace(/^\s+|\s+$/g,""),description:T.info.description.replace(/^\s+|\s+$/g,""),category_id:T.info.category,severity:T.info.severity,priority:T.info.priority,kb_link:T.info.kbLink.replace(/^\s+|\s+$/g,""),"update.alert_id":T.info.alertID,logic_actual:"",logic_display:"",logic_condition:"",email_template_id:"mail"==T.info.action?T.info.emailTemplate:0,text_actual:"",text_display:"",recommendation_display:T.info.recommendation?T.info.recommendation.replace(/^\s+|\s+$/g,""):"",alert_justification_display:T.info.alert_justification?T.info.alert_justification.replace(/^\s+|\s+$/g,""):"",scope:T.info.scope,column_type:"",table_name:"",author:T.info.author.replace(/^\s+|\s+$/g,""),"update.set_as_draft":0,"update.draft":0,"update.max_limit":T.info.maxLimit,"update.max_alerts_display_ui":T.info.maxLimitDisplay,"update.modify":0,"update.created_by":T.info.createdBy,"update.created_ts":T.info.createdTs.slice(0,10)+"T"+T.info.createdTs.slice(10+Math.abs(1))+"Z","update.convertedRegex":"","update.convertedCounts":"","update.rule_name":T.info.ruleName,"update.action_id":T.info.action_id,"update.allow_subscription":T.info.subscription_enabled},a=Object.assign(a,unsdataobj),d.editRule(d.getRuleMode().data.rule_id,a,T.info.ruletype).then(function(a){a.data.Data.rule_name;function t(e,t){T.tagFilterFunction=function(e){return e.selected},(e={associate:[{tag_ids:e.associate,rule_ids:[a.data.Data.rule_id]}],disassociate:[{tag_ids:e.disassociate,rule_ids:[a.data.Data.rule_id]}]}).associate[0].tag_ids.length?e.disassociate[0].tag_ids.length||(e.disassociate[0]={}):e.associate[0]={},d.associateDisassociateTag(e).then(function(e){t&&T.resetSelectedTags()},function(e){console.error("Unable to add tags"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}),u(e)})}function n(){var e;1==T.info.initialSubscription_enabled&&0==T.info.subscription_enabled&&0<T.info.initialtagList.length?(e={associate:[],disassociate:T.info.initialtagList},t(e,!0)):1==T.info.initialSubscription_enabled&&T.info.subscription_enabled&&(0<T.info.initialtagList.length||0<T.info.selectedTagsCount)?(e={associate:T.info.tagList.filter(T.tagFilterFunction).map(function(e){return e.tag_id}),disassociate:T.info.tagList.filter(function(e){return T.info.initialtagList.includes(e.tag_id)&&!e.selected}).map(function(e){return e.tag_id})},t(e)):0==T.info.initialSubscription_enabled&&T.info.subscription_enabled&&0<T.info.selectedTagsCount&&(e={associate:T.info.tagList.filter(T.tagFilterFunction).map(function(e){return e.tag_id}),disassociate:[]},t(e))}var i,e,o,s=a.data.Data,r=("none"!=T.info.initialAction&&"api"!=T.info.initialAction||"mail"!=T.info.action?"mail"==T.info.initialAction&&"mail"==T.info.action?(i=T.differenceOf2Arrays(T.info.initialSubscriptionEmailList,T.info.subscriptionEmailList),e={mps:c.mps,ruleId:a.data.Data.rule_id,addEmailId:i.added,removeEmailId:i.removed,enabled:T.info.subscription_enabled},d.updateSubscription(e).then(function(e){var t;!i.removed.length||(t=i.removed.split(",").filter(function(e){if(0<=T.info.emailList.indexOf(e))return e})||[]).length&&T.deleteSubscriptionFilterBulk(s,t),n()},function(e){console.error("Unable to update subscription"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}),u(e)})):"mail"!=T.info.initialAction||"none"!=T.info.action&&"api"!=T.info.action||(T.info.subscription_enabled=!1,e={removeSubscribers:[{mps:c.mps,ruleId:a.data.Data.rule_id}]},d.unsubscribeRule(e).then(function(e){T.info.rulesListMsg={type:"success",msg:F.getVal("rulesMsgs").rule_unsubscription_success},n()},function(e){console.error("Unable to remove subscription"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}),u(e)}),T.deleteSubscriptionFilter(s)):0<T.info.subscriptionEmailList.length?(T.info.subscriptionEmailList,e={subscribers:T.info.subscriptionEmailList.map(function(e){return{mps:c.mps,rule_id:a.data.Data.rule_id,email:e,subscription_enabled:T.info.subscription_enabled}})},d.subscribeRule(e).then(function(e){n()},function(e){console.error("Unable to add subscription"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}),u(e)})):n(),T.info.addRuleMsg={type:"success",msg:T.info.status==T.info.supportedStatus.Draft||T.info.logic.replace(/^\s+|\s+$/g,"")!=T.info.initialLogic||T.info.text.replace(/^\s+|\s+$/g,"")!=T.info.initialText||T.info.initialMaxLimit!=T.info.maxLimit?F.getVal("rulesMsgs").edit_rule_draft_success[0]+T.info.label+F.getVal("rulesMsgs").edit_rule_draft_success[1]:F.getVal("rulesMsgs").edit_rule_enabled_success[0]+T.info.label+F.getVal("rulesMsgs").edit_rule_enabled_success[1]},T.info.categoriesLoading=!1,T.info.ruleAdded=!0,T.info.ruleAddedAsDraft=T.info.status==T.info.supportedStatus.Draft||T.info.logic.replace(/^\s+|\s+$/g,"")!=T.info.initialLogic||T.info.text.replace(/^\s+|\s+$/g,"")!=T.info.initialText||T.info.initialMaxLimit!=T.info.maxLimit,{rule_id:a.data.Data.rule_id,rule_name:a.data.Data.rule_name,alert_id:a.data.Data.alert_id,label:T.info.label,description:T.info.description,category_id:T.info.category,category:y("filter")(T.info.categories,{category_id:T.info.category})[0].category,severity_id:T.info.severity,severity:y("filter")(T.info.severities,{severity_id:T.info.severity})[0].severity,priority_id:T.info.priority,priority:y("filter")(T.info.priorities,{priority_id:T.info.priority})[0].priority,kb_link:T.info.kbLink,logic_display:T.info.logic,email_template_id:"mail"==T.info.action?T.info.emailTemplate:0,text_display:T.info.text,recommendation_display:T.info.recommendation,alert_justification_display:T.info.alert_justification,scope:T.info.scope,author:T.info.author,status:T.info.status==T.info.supportedStatus.Draft||T.info.logic.replace(/^\s+|\s+$/g,"")!=T.info.initialLogic||T.info.text.replace(/^\s+|\s+$/g,"")!=T.info.initialText||T.info.initialMaxLimit!=T.info.maxLimit?T.info.supportedStatus.Draft:T.info.supportedStatus.Enabled,max_limit:T.info.maxLimit,max_alerts_display_ui:T.info.maxLimitDisplay,created_by:T.info.createdBy,created_ts:T.info.createdTs,action_id:a.data.Data.action_id,api_template_id:a.data.Data.api_template_id,subscription_enabled:T.info.subscription_enabled,subscriptionEmailList:T.info.subscriptionEmailList,tags:T.info.tags.reduce(function(e,t){return t.selected&&e.push(t),e},[])}),l=(T.info.testRuleData=r,T.info.initialLabel!=T.info.label&&(delete(e=d.getRulesLabelMap())[T.info.initialLabel],e[T.info.label.replace(/^\s+|\s+$/g,"")]=!0,d.setRulesLabelMap(e)),a.data.Data.rule_id);d.getAllRules(T.info.ruletype).then(function(e){d.setRulesList(y("filterMultiples")(y("removeDup")(e.data.Data),{status:[T.info.supportedStatus.Enabled,T.info.supportedStatus.Disabled,T.info.supportedStatus.Draft]}));e=y("filter")(y("removeDup")(e.data.Data),{rule_id:l})||[];e[0]&&(T.info.createdBy=e[0].created_by,T.info.createdTs=e[0].created_ts,r.subscriptionEmailList=e[0].subscribed_users.length?e[0].subscribed_users.split(",").filter(Boolean):[]),d.setRuleMode("edit",r),T.populateEditRule()},u),o=T.info.initialLabel!=T.info.label.replace(/^\s+|\s+$/g,"")?((o={}).old=T.info.initialLabel,o.new=T.info.label.replace(/^\s+|\s+$/g,""),JSON.stringify(o)):T.info.initialLabel,f.standard_user_tracking(T.info.application,"Rule","edit",o).then(function(e){},u)},function(e){T.info.categoriesLoading=!1,e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}):T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").add_rule_fail},T.info.testRuleData=null,T.info.ruleAdded=!1,console.error("Unable to edit rule"),u(e)}))))},T.checkDraft=function(t){var e=[{name:"label",old:T.info.initialLabel,new:T.info.label},{name:"recommendation",old:T.info.initialRecommendation,new:T.info.recommendation},{name:"alert_justification",old:T.info.initialJustification,new:T.info.alert_justification},{name:"text",old:T.info.initialText,new:T.info.text}];return e.forEach(function(e){e.oldarr=e.old.match(t)?e.old.match(t):e.old,e.newarr=e.new.match(t)?e.new.match(t):e.new}),T.isdraft(angular.copy(e),t)},T.isdraft=function(e,i){function o(e){return e.replace(/[\{\}']+/g,"")}var s=!1;return e.forEach(function(e){if(Array.isArray(e.oldarr)&&Array.isArray(e.newarr)){(e.newarr.length>e.oldarr.length||e.newarr.length<e.oldarr.length)&&(s=!0);for(var t=e.oldarr.map(o),a=e.newarr.map(o),n=0;n<t.length;n++)-1==a.indexOf(t[n])&&(s=!0)}!Array.isArray(e.oldarr)&&Array.isArray(e.newarr)&&(s=!0),Array.isArray(e.oldarr)&&!e.new.match(i)&&(s=!0)}),s=T.info.logic.replace(/^\s+|\s+$/g,"")==T.info.initialLogic&&T.info.scope==T.info.initialScope?s:!0},T.addEditRule=function(){var e,t;T.info.categoriesLoading=!0,data={},data="api"==T.info.action&&T.info.apiTemplate&&"select"!=T.info.apiTemplate?{"update.apiTemplateId":T.info.apiTemplate}:{"update.apiTemplateId":0},d.getRuleMode()&&"edit"==d.getRuleMode().mode?(e={label_actual:T.info.hiddenLabel.replace(/^\s+|\s+$/g,""),recommendation:T.info.hiddenRecommendation?T.info.hiddenRecommendation.replace(/^\s+|\s+$/g,""):"",alert_justification:T.info.hiddenJustification?T.info.hiddenJustification.replace(/^\s+|\s+$/g,""):"","update.label_display":T.info.label.replace(/^\s+|\s+$/g,""),description:T.info.description.replace(/^\s+|\s+$/g,""),category_id:T.info.category,severity:T.info.severity,priority:T.info.priority,kb_link:T.info.kbLink.replace(/^\s+|\s+$/g,""),"update.alert_id":T.info.alertID,logic_actual:T.info.hiddenLogic.replace(/^\s+|\s+$/g,""),logic_display:T.info.logic.replace(/^\s+|\s+$/g,""),logic_condition:T.info.convertedLogic.replace(/\'/g,'"').replace(/^\s+|\s+$/g,"").replace(/[\"]+/g,'"'),email_template_id:"mail"==T.info.action?T.info.emailTemplate:0,text_actual:T.info.hiddenText.replace(/^\s+|\s+$/g,""),text_display:T.info.text.replace(/^\s+|\s+$/g,""),recommendation_display:T.info.recommendation?T.info.recommendation.replace(/^\s+|\s+$/g,""):"",alert_justification_display:T.info.alert_justification?T.info.alert_justification.replace(/^\s+|\s+$/g,""):"",scope:T.info.scope,column_type:T.info.secColTypePairs.join(","),table_name:T.info.tables.join(","),author:T.info.author.replace(/^\s+|\s+$/g,""),"update.set_as_draft":T.info.status==T.info.supportedStatus.Draft||T.info.logic.replace(/^\s+|\s+$/g,"")!=T.info.initialLogic||T.info.text.replace(/^\s+|\s+$/g,"")!=T.info.initialText||T.info.initialMaxLimit!=T.info.maxLimit?1:0,"update.draft":T.info.status==T.info.supportedStatus.Draft?1:0,"update.max_limit":T.info.maxLimit,"update.max_alerts_display_ui":T.info.maxLimitDisplay,"update.modify":T.info.status==T.info.supportedStatus.Draft&&d.getRuleSavedStatus()?1:0,"update.created_by":T.info.createdBy,"update.created_ts":T.info.createdTs.slice(0,10)+"T"+T.info.createdTs.slice(10+Math.abs(1))+"Z","update.convertedRegex":T.info.convertedRegexes,"update.convertedCounts":T.info.convertedCounts,"update.rule_name":T.info.ruleName,"update.action_id":T.info.action_id,"update.convertedAggregates":T.processAggregateFunctionForPayload(),"update.allow_subscription":T.info.subscription_enabled},data=Object.assign(data,e),T.info.status!=T.info.supportedStatus.Enabled&&T.info.status!=T.info.supportedStatus.Disabled||(t=new RegExp("{([^}]*)}","g"),T.checkDraft(t)?(data["update.set_as_draft"]=1,T.info.status=T.info.supportedStatus.Draft):data["update.set_as_draft"]=0),1==T.info.initialSubscription_enabled&&0==T.info.subscription_enabled&&0<T.info.initialtagList.length?T.info.tags=[]:(1==T.info.initialSubscription_enabled&&T.info.subscription_enabled&&(0<T.info.initialtagList.length||0<T.info.selectedTagsCount)||0==T.info.initialSubscription_enabled&&T.info.subscription_enabled&&0<T.info.selectedTagsCount)&&(T.info.tags=T.info.tagList.filter(T.tagFilterFunction)),d.editRule(d.getRuleMode().data.rule_id,data,T.info.ruletype).then(function(a){a.data.Data.rule_name;function t(e,t){t&&T.resetSelectedTags(),(t={associate:[{tag_ids:e.associate,rule_ids:[a.data.Data.rule_id]}],disassociate:[{tag_ids:e.disassociate,rule_ids:[a.data.Data.rule_id]}]}).associate[0].tag_ids.length?t.disassociate[0].tag_ids.length||(t.disassociate[0]={}):t.associate[0]={},d.associateDisassociateTag(t).then(function(e){},function(e){console.error("Unable to add tags"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}),u(e)})}function n(){var e;1==T.info.initialSubscription_enabled&&0==T.info.subscription_enabled&&0<T.info.initialtagList.length?(e={associate:[],disassociate:T.info.initialtagList},t(e,!0)):1==T.info.initialSubscription_enabled&&T.info.subscription_enabled&&(0<T.info.initialtagList.length||0<T.info.selectedTagsCount)?(e={associate:T.info.tagList.filter(T.tagFilterFunction).map(function(e){return e.tag_id}),disassociate:T.info.tagList.filter(function(e){return T.info.initialtagList.includes(e.tag_id)&&!e.selected}).map(function(e){return e.tag_id})},t(e)):0==T.info.initialSubscription_enabled&&T.info.subscription_enabled&&0<T.info.selectedTagsCount&&(e={associate:T.info.tagList.filter(T.tagFilterFunction).map(function(e){return e.tag_id}),disassociate:[]},t(e))}var i,e,o=a.data.Data,s=("none"!=T.info.initialAction&&"api"!=T.info.initialAction||"mail"!=T.info.action?"mail"==T.info.initialAction&&"mail"==T.info.action?(i=T.differenceOf2Arrays(T.info.initialSubscriptionEmailList,T.info.subscriptionEmailList),s={mps:c.mps,ruleId:a.data.Data.rule_id,addEmailId:i.added,removeEmailId:i.removed,enabled:T.info.subscription_enabled},d.updateSubscription(s).then(function(e){var t;!i.removed.length||(t=i.removed.split(",").filter(function(e){if(0<=T.info.emailList.indexOf(e))return e})||[]).length&&T.deleteSubscriptionFilterBulk(o,t),n()},function(e){console.error("Unable to update subscription"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}),u(e)})):"mail"!=T.info.initialAction||"none"!=T.info.action&&"api"!=T.info.action||(T.info.subscription_enabled=!1,s={removeSubscribers:[{mps:c.mps,ruleId:a.data.Data.rule_id}]},d.unsubscribeRule(s).then(function(e){n(),T.info.rulesListMsg={type:"success",msg:F.getVal("rulesMsgs").rule_unsubscription_success}},function(e){console.error("Unable to remove subscription"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}),u(e)}),T.deleteSubscriptionFilter(o)):0<T.info.subscriptionEmailList.length?(T.info.subscriptionEmailList,s={subscribers:T.info.subscriptionEmailList.map(function(e){return{mps:c.mps,rule_id:a.data.Data.rule_id,email:e,subscription_enabled:T.info.subscription_enabled}})},d.subscribeRule(s).then(function(e){n()},function(e){console.error("Unable to add subscription"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}),u(e)})):n(),T.info.addRuleMsg={type:"success",msg:1==data["update.set_as_draft"]?F.getVal("rulesMsgs").edit_rule_draft_success[0]+T.info.label+F.getVal("rulesMsgs").edit_rule_draft_success[1]:F.getVal("rulesMsgs").edit_rule_enabled_success[0]+T.info.label+F.getVal("rulesMsgs").edit_rule_enabled_success[1]},T.info.ruleAddedAsDraft=1==data["update.set_as_draft"],1==data["update.set_as_draft"]?T.info.supportedStatus.Draft:T.info.status),s=T.makeRuleObjectAfterAddEdit(a,s),r=(T.info.testRuleData=s,T.info.initialLabel!=T.info.label&&(delete(r=d.getRulesLabelMap())[T.info.initialLabel],r[T.info.label.replace(/^\s+|\s+$/g,"")]=!0,d.setRulesLabelMap(r)),a.data.Data.rule_id);T.getRulesVersion(),T.fetchRuleListAfterAddEdit(s,r),T.info.initialLabel!=T.info.label.replace(/^\s+|\s+$/g,"")?((e={}).old=T.info.initialLabel,e.new=T.info.label.replace(/^\s+|\s+$/g,"")):e=T.info.initialLabel,T.trackUser("Rule","Edit",e)},function(e){T.addEditFailureHandler(e,"Edit")})):(e={label_actual:T.info.hiddenLabel.replace(/^\s+|\s+$/g,""),"update.label_display":T.info.label.replace(/^\s+|\s+$/g,""),description:T.info.description.replace(/^\s+|\s+$/g,""),category_id:T.info.category,severity:T.info.severity,priority:T.info.priority,kb_link:T.info.kbLink.replace(/^\s+|\s+$/g,""),logic_actual:T.info.hiddenLogic.replace(/^\s+|\s+$/g,""),logic_display:T.info.logic.replace(/^\s+|\s+$/g,""),logic_condition:T.info.convertedLogic.replace(/\'/g,'"').replace(/^\s+|\s+$/g,"").replace(/[\"]+/g,'"'),email_template_id:"mail"==T.info.action?T.info.emailTemplate:0,text_actual:T.info.hiddenText.replace(/^\s+|\s+$/g,""),text_display:T.info.text.replace(/^\s+|\s+$/g,""),recommendation_display:T.info.recommendation.replace(/^\s+|\s+$/g,""),alert_justification_display:T.info.alert_justification.replace(/^\s+|\s+$/g,""),scope:T.info.scope,column_type:T.info.secColTypePairs.join(","),table_name:T.info.tables.join(","),author:T.info.author.replace(/^\s+|\s+$/g,""),"update.max_limit":T.info.maxLimit,"update.max_alerts_display_ui":T.info.maxLimitDisplay,"update.convertedRegex":T.info.convertedRegexes,"update.convertedCounts":T.info.convertedCounts,recommendation:T.info.hiddenRecommendation.replace(/^\s+|\s+$/g,""),alert_justification:T.info.hiddenJustification.replace(/^\s+|\s+$/g,""),"update.convertedAggregates":T.processAggregateFunctionForPayload(),"update.allow_subscription":T.info.subscription_enabled},data=Object.assign(data,e),d.addRule(data).then(function(e){"mail"==T.info.action&&(t={subscribers:[{mps:c.mps,rule_id:e.data.Data.rule_id,email:T.info.subscriptionEmailList.length?T.info.subscriptionEmailList.join():"",subscription_enabled:T.info.subscription_enabled}]},T.info.tags=T.info.tagList.filter(T.tagFilterFunction),d.subscribeRule(t).then(function(e){},function(e){console.error("Unable to load templates"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}),u(e)}),0<T.info.selectedTagsCount&&T.info.subscription_enabled&&d.associateDisassociateTag(T.getAddUpdateTagPayload(e.data.Data.rule_id)).then(function(e){},function(e){console.error("Unable to add tags"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)&&(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}),u(e)})),T.info.addRuleMsg={type:"success",msg:F.getVal("rulesMsgs").add_rule_success[0]+T.info.label+F.getVal("rulesMsgs").add_rule_success[1]},T.info.ruleAddedAsDraft=!0;var t=T.makeRuleObjectAfterAddEdit(e,T.info.supportedStatus.Draft),a=(T.info.testRuleData=t,d.getRulesLabelMap()),a=(a[T.info.label]=!0,d.setRulesLabelMap(a),e.data.Data.rule_id);T.getRulesVersion(),T.fetchRuleListAfterAddEdit(t,a),T.trackUser("Rule","ADD",{rule_name:e.data.Data.rule_name})},function(e){T.addEditFailureHandler(e,"Add")}))},T.addEditFailureHandler=function(e,t){T.info.categoriesLoading=!1,e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}):T.info.addRuleMsg={type:"failure",msg:F.getVal("rulesMsgs").add_rule_fail},T.info.testRuleData=null,T.info.ruleAdded=!1,console.error("Unable to "+t+" rule"),u(e)},T.makeRuleObjectAfterAddEdit=function(e,t){t={rule_id:e.data.Data.rule_id,rule_name:e.data.Data.rule_name,alert_id:e.data.Data.alert_id,label_display:T.info.label,label:T.info.label,description:T.info.description,category_id:T.info.category,category:y("filter")(T.info.categories,{category_id:T.info.category})[0].category,severity_id:T.info.severity,severity:y("filter")(T.info.severities,{severity_id:T.info.severity})[0].severity,priority_id:T.info.priority,priority:y("filter")(T.info.priorities,{priority_id:T.info.priority})[0].priority,kb_link:T.info.kbLink,logic_display:T.info.logic,email_template_id:"mail"==T.info.action?T.info.emailTemplate:0,text_display:T.info.text,recommendation_display:T.info.recommendation,alert_justification_display:T.info.alert_justification,scope:T.info.scope,author:T.info.author,status:t,max_limit:T.info.maxLimit,max_alerts_display_ui:T.info.maxLimitDisplay,created_by:T.info.createdBy,created_ts:T.info.createdTs,action_id:e.data.Data.action_id,api_template_id:e.data.Data.api_template_id,subscription_enabled:T.info.subscription_enabled,subscriptionEmailList:T.info.subscriptionEmailList,tagList:T.info.tagList,tags:T.info.tags.reduce(function(e,t){return t.selected&&e.push(t),e},[])};return"mail"==T.info.action&&(t.subscription_enabled=T.info.subscription_enabled,t.subscriptionEmailList=T.info.subscriptionEmailList),angular.copy(t)},T.fetchRuleListAfterAddEdit=function(t,a){d.getAllRules(T.info.ruletype).then(function(e){T.info.categoriesLoading=!1,T.info.ruleAdded=!0,d.setRulesList(y("filterMultiples")(e.data.Data,{status:[T.info.supportedStatus.Enabled,T.info.supportedStatus.Disabled,T.info.supportedStatus.Draft]}));e=y("filter")(e.data.Data,{rule_id:a})||[];e[0]&&(T.info.createdBy=e[0].created_by,T.info.createdTs=e[0].created_ts),t.created_by=T.info.createdBy,t.created_ts=T.info.createdTs,t.colt=e[0].colt,t.recommendation=e[0].recommendation,t.modified_by=e[0].modified_by,t.modified_ts=e[0].modified_ts,t.alert_id=e[0].alert_id,T.info.testRuleData.alert_id=e[0].alert_id,t.subscriptionEmailList=e[0].subscribed_users.length?e[0].subscribed_users.split(",").filter(Boolean):[],t.action_id=e[0].action_id,d.setRuleMode("edit",t),T.populateEditRule()},u)},T.createColumnType=function(e,t,a,n,i){T.info.secColTypePairs=[],T.info.tables=[];for(var o=0;o<arguments.length;o++)T.getUniqueTalbeAndColumnName(arguments[o])},T.getUniqueTalbeAndColumnName=function(e){for(var t=0;t<e.length;t++){for(var a=!1,n=!1,i=0;i<T.info.secColTypePairs.length;i++)if(T.sectionsColumnLabelMap[e[t]][3]==T.info.secColTypePairs[i]){a=!0;break}for(i=0;i<T.info.tables.length;i++)if(T.sectionsColumnLabelMap[e[t]][4]==T.info.tables[i]){n=!0;break}a||T.info.secColTypePairs.push(T.sectionsColumnLabelMap[e[t]][3]),n||T.info.tables.push(T.sectionsColumnLabelMap[e[t]][4])}},T.validateElements=function(){if(/^\s*$/.test(T.info.label))r.alertBox({msg:"Label"+F.getVal("rulesMsgs").add_rule_field_empty});else{var e=d.getRulesLabelMap(),t=("select"==T.info.emailTemplate||T.info.emailTemplate,"select"==T.info.apiTemplate||T.info.apiTemplate,new RegExp("{([^}]*)}","g"));if("edit"==d.getRuleMode().mode&&T.info.status!=T.info.supportedStatus.Draft&&T.checkDraft(t))return T.msg=F.getVal("rulesMsgs").save_rule_enable_to_draft,void(T.modal=r.openModal("partials/rules-and-alerts/enable_draft_rule.html",T,!1,"static"));if(T.info.initialLabel){if(T.info.label!=T.info.initialLabel&&e.hasOwnProperty(T.info.label))return void r.alertBox({msg:F.getVal("rulesMsgs").add_rule_duplicate_label})}else if(e.hasOwnProperty(T.info.label))return void r.alertBox({msg:F.getVal("rulesMsgs").add_rule_duplicate_label});if("select"!=T.info.category)if(/^\s*$/.test(T.info.author))r.alertBox({msg:"Author"+F.getVal("rulesMsgs").add_rule_field_empty});else if("select"!=T.info.severity)if("select"!=T.info.priority)if("select"!=T.info.scope)if("mail"!=T.info.action||"select"!=T.info.emailTemplate)if("api"!=T.info.action||"select"!=T.info.apiTemplate)if(T.info.maxLimitDisplay&&!/^\s*$/.test(T.info.maxLimitDisplay))if(/^\s*$/.test(T.info.logic))r.alertBox({msg:"Logic"+F.getVal("rulesMsgs").add_rule_field_empty});else{if(!/^\s*$/.test(T.info.text))return!0;r.alertBox({msg:"Text"+F.getVal("rulesMsgs").add_rule_field_empty})}else r.alertBox({msg:"Max. Alerts(View) "+F.getVal("rulesMsgs").add_rule_field_empty});else r.alertBox({msg:F.getVal("rulesMsgs").add_rule_field_unselected+"template"});else r.alertBox({msg:F.getVal("rulesMsgs").add_rule_field_unselected+"template"});else r.alertBox({msg:F.getVal("rulesMsgs").add_rule_field_unselected+"scope"});else r.alertBox({msg:F.getVal("rulesMsgs").add_rule_field_unselected+"priority"});else r.alertBox({msg:F.getVal("rulesMsgs").add_rule_field_unselected+"severity"});else r.alertBox({msg:F.getVal("rulesMsgs").add_rule_field_unselected+"category"})}},T.validateUnsupportedElements=function(){if(/^\s*$/.test(T.info.label))r.alertBox({msg:"Label"+F.getVal("rulesMsgs").add_rule_field_empty});else{var e=d.getRulesLabelMap();if(T.info.initialLabel){if(T.info.label!=T.info.initialLabel&&e.hasOwnProperty(T.info.label))return void r.alertBox({msg:F.getVal("rulesMsgs").add_rule_duplicate_label})}else if(e.hasOwnProperty(T.info.label))return void r.alertBox({msg:F.getVal("rulesMsgs").add_rule_duplicate_label});if("select"!=T.info.category)if(/^\s*$/.test(T.info.author))r.alertBox({msg:"Author"+F.getVal("rulesMsgs").add_rule_field_empty});else if("select"!=T.info.severity)if("select"!=T.info.priority)if("select"!=T.info.scope)if("mail"!=T.info.action||"select"!=T.info.emailTemplate)if("api"!=T.info.action||"select"!=T.info.apiTemplate){if(T.info.maxLimitDisplay&&!/^\s*$/.test(T.info.maxLimitDisplay))return!0;r.alertBox({msg:"Max. Alerts(View) "+F.getVal("rulesMsgs").add_rule_field_empty})}else r.alertBox({msg:F.getVal("rulesMsgs").add_rule_field_unselected+"template"});else r.alertBox({msg:F.getVal("rulesMsgs").add_rule_field_unselected+"template"});else r.alertBox({msg:F.getVal("rulesMsgs").add_rule_field_unselected+"scope"});else r.alertBox({msg:F.getVal("rulesMsgs").add_rule_field_unselected+"priority"});else r.alertBox({msg:F.getVal("rulesMsgs").add_rule_field_unselected+"severity"});else r.alertBox({msg:F.getVal("rulesMsgs").add_rule_field_unselected+"category"})}},T.convertScalaCondition=function(e){for(var t=e.match(/\{([^}]+)\}/g)||[],a=0;a<t.length;a++){var n=t[a],n=n.substring(1,n.length-1),i=T.sectionsColumnLabelMap[n][0];T.sectionsColumnLabelMap[n][2]==T.info.columnDataTypes.Integer||T.sectionsColumnLabelMap[n][2]==T.info.columnDataTypes.Long?i+=".toLong":T.sectionsColumnLabelMap[n][2]==T.info.columnDataTypes.Float?i+=".toFloat":T.sectionsColumnLabelMap[n][2]==T.info.columnDataTypes.Double&&(i+=".toDouble"),e=e.replace("{"+n+"}",i)}var o=1,s={},r=e.match(/\'%(.*?)%\'|\'%(.*?)[^%]\'|\'[^%](.*?)%\'|\"(.*?)\"/g);if(r&&r.length)for(a=0;a<r.length;a++){var l="",c="",c=/\'%(.*?)%\'/.test(r[a])?(l="'%string"+o+"%'",r[a].replace(/^\'%|%\'$/g,"")):/\'%(.*?)[^%]\'/.test(r[a])?(l="'%string"+o+"'",r[a].replace(/^\'%|\'$/g,"")):/\'[^%](.*?)%\'/.test(r[a])?(l="'string"+o+"%'",r[a].replace(/^\'|%\'$/g,"")):(l='"string'+o+'"',r[a].replace(/^\"|\"$/g,""));e=e.replace(r[a],l),s["string"+o]=c,o++}var d=T.parseLogicToScalaCondtion(e,s);return d=(d=d.replace(/\.toLong([^\.toLong|\/]*)\//g,".toDouble$1/")).replace(/(^|\s)(\d+)(\s|$|\))/g,"$1$2L$3").replace(/(^|\s)(\d+\.\d+)(\s|$)/g,"$1$2D$3"),angular.forEach(s,function(e,t){d=d.replace(t,e)}),d},T.checkParentheses=function(e){if(e.replace(/\(/g,"").length==e.replace(/\)/g,"").length)return!0;r.alertBox({msg:F.getRulesLogicAlerts("rule_logic_error")})},{}),m={},h={},b={};function _(){var o=angular.copy(T.info.logic),e=(C={},b={},tempNumbers={},m={},h={},o.match(/'%((?:\\.|[^'\\])*)'|'((?:\\.|[^'\\])*)%'|'%((?:\\.|[^'\\])*)%'|"((?:\\.|[^"\\])*)"/g)),n=1,e=(angular.forEach(e,function(e){var t=e,a="string_"+n;o=o.replace(e,"["+a+"]"),b[a]=t,n++}),o.match(/\{[^\{|^}]*\}/g)),i=1,e=(angular.forEach(e,function(e){var t=e.replace(/\{|\}/g,""),a="attr_"+i;o=o.replace(e,"{"+a+"}"),C[a]=t,i++}),o.replace(/{[^}]+}/g,"").replace(/\[[^\]]+\]/g,"").match(/\s\d+(\.\d+)?/g)),s=1,e=(angular.forEach(e,function(e){var t="number_"+s,a=(e.match(/^\s+/)||[""])[0],n=(e.match(/\s+$/)||[""])[0];o=o.replace(e,a+"{"+t+"}"+n),T.sectionsColumnLabelMap[e.replace(/^\s+|\s+$/g,"")]=[t,"",T.info.columnDataTypes.Long],tempNumbers[t]=e.replace(/^\s+|\s+$/g,""),C[t]=e.replace(/^\s+|\s+$/g,""),s++}),o.match(/REGEX\([^\)]+\)/g)),r=1,l=!1;if(T.info.regexMatches=[],angular.forEach(e,function(e){var t,a,n;l||((t=function(t){if(/REGEX\(\s*\{attr_\d+\}\s*,\s*\[string_\d+\]\s*\)/.test(t)){var e=C[t.match(/attr_\d+/)[0]];if(T.sectionsColumnLabelMap[e][2]==T.info.columnDataTypes.String){var a=b[t.match(/string_\d+/)[0]].replace(/^\"|\"$/g,"");if(!/\s/.test(a)){try{new RegExp(a);if("()"==a)return i=F.getRulesLogicAlerts("rule_logic_invalid_regex_pattern",a),o=k(t),s=(r=T.info.logic.indexOf(o)+o.indexOf(a))+a.length+2,void A(i,r,s);var n=a.match(/\(((?:\\.|\||[^(\(\\)|(\)\\)])*)\)/g);if(!n)return i=F.getRulesLogicAlerts("rule_logic_regex_no_capture",a),o=k(t),s=(r=T.info.logic.indexOf(o)+o.indexOf(a))+a.length+2,void A(i,r,s);if(1<n.length)return i=F.getRulesLogicAlerts("rule_logic_regex_multiple_captures",a),o=k(t),s=(r=T.info.logic.indexOf(o)+o.indexOf(a))+a.length+2,void A(i,r,s)}catch(e){i=F.getRulesLogicAlerts("rule_logic_invalid_regex_pattern",a),o=k(t),s=(r=T.info.logic.indexOf(o)+o.indexOf(a))+a.length+2;return void A(i,r,s)}n={actualLogic:k(t),attr:T.sectionsColumnLabelMap[e][0],table:T.sectionsColumnLabelMap[e][4],pattern:a};return T.info.regexMatches.push(n),e}var i=F.getRulesLogicAlerts("rule_logic_regex_space_found"),o=k(t),s=(r=T.info.logic.indexOf(o)+o.indexOf(a))+a.length+2;A(i,r,s)}else{var i=F.getRulesLogicAlerts("rule_logic_invalid_regex_attribute",e),o=k(t),s=(r=T.info.logic.indexOf(o)+o.indexOf(e))+e.length;A(i,r,s)}}else{var r,i=F.getRulesLogicAlerts("rule_logic_invalid_regex_params"),o=k(t),s=(r=T.info.logic.indexOf(o))+o.length;A(i,r,s)}}(e))?(a=k(e),n="regex_"+r,o=o.replace(e,"{"+n+"}"),T.sectionsColumnLabelMap[a]=T.sectionsColumnLabelMap[t],m[n]=a,C[n]=a,r++):l=!0)}),!l){var d=1,c=!1;if(T.info.aggregateFunctions.map(function(e){var n=e.label,i=n+"(";countMatches=v(o,i),d=1,angular.forEach(countMatches,function(e){var t,a;c||(a=e.substring(i.length,e.length-1),t=k(o).indexOf(k(e))+i.length,"COUNT"!=n||D(a,t)?!function(e){var e=e.match(/{[^}]+}/g)||[],t=[],n=(angular.forEach(e,function(e){e.startsWith("{number")||t.push(e)}),null),i=!1;if(angular.forEach(t,function(e){if(!i){var t=C[e.replace(/\{|\}/g,"")];var a=T.sectionsColumnLabelMap[t][4];if(!n)n=a;else if(n!=a)i=true}}),!i)return!0}(e)?(c=!0,a=F.getRulesLogicAlerts("rule_logic_multiple_sections_in_count"),t=k(e),A(a,a=T.info.logic.indexOf(t),a+t.length)):(a=k(e),t=n.toLocaleLowerCase()+"_"+d,o=o.replace(e,"{"+t+"}"),T.sectionsColumnLabelMap[a]=[t,"",T.info.columnDataTypes.Long],h[t]=a,C[t]=a,d++):c=!0)})}),!c)return o}}function v(s,r){var l=[],e=function(e,t,a){var n=e.length;if(0==n)return[];var i,o=0,s=[];a||(t=t.toLowerCase(),e=e.toLowerCase());for(;-1<(i=t.indexOf(e,o));)s.push(i),o=i+n;return s}(r,s);return angular.forEach(e,function(e){for(var t,a=1,n=0,i=!1,o=e+r.length;o<s.length;o++)if("("==s[o]&&a++,")"==s[o]&&++n==a){t=o+1,i=!0;break}i&&l.push(s.substring(e,t))}),l}function k(e){var t,a=angular.copy(e);return e&&(t=e.match(/\{[^(\{|\})]+\}/g),angular.forEach(t,function(e){C.hasOwnProperty(e.replace(/^\{|\}$/g,""))&&(a=a.replace(e,(-1==e.indexOf("regex_")&&-1==e.indexOf("count_")&&-1==e.indexOf("number_")?"{":"")+C[e.replace(/^\{|\}$/g,"")]+(-1==e.indexOf("regex_")&&-1==e.indexOf("count_")&&-1==e.indexOf("number_")?"}":"")))}),t=e.match(/\[[^(\[|\])]+\]/g),angular.forEach(t,function(e){b.hasOwnProperty(e.replace(/^\[|\]$/g,""))&&(a=a.replace(e,b[e.replace(/^\[|\]$/g,"")]))})),a}function A(e,t,a){r.alertBox({msg:e}).result.then(function(e){"ok"==e&&S(t,a)},function(e){"backdrop click"==e&&S(t,a)})}function S(e,t){var a=document.getElementById("inputLogic");a.focus(),a.setSelectionRange(e,t),angular.element(a).addClass("logic-select"),n(function(){a.setSelectionRange(0,0),angular.element(a).removeClass("logic-select"),a.blur()},3e3)}function D(c,e){var u="";for(r in T.info.operators)"logical"==T.info.operators[r].subtype&&(0==u.length?u+="\\s+"+T.info.operators[r].label+"\\s+":u+="|\\s+"+T.info.operators[r].label+"\\s+");for(var f=new RegExp(u),g=c.match(new RegExp(u,"g")),t=c.split(f),p="",a=0;a<t.length;a++){var n=k(t[a]).length;for(d in t[a]=" "+t[a]+" ",T.info.functions)p+=0==d?T.info.functions[d].label:"|"+T.info.functions[d].label;if(!T.checkFunctions(t[a]))return;var m=new RegExp(p,"g"),i=t[a].split("(")[0].replace(/^\s+|\s+$/g,""),o=(t[a]=t[a].replace(m,""),t[a]=T.removeBrackets(t[a]),null);if(/\{regex_\d+\}/.test(t[a])&&T.sectionsColumnLabelMap[C[t[a].match(/regex_\d+/)[0]]][2]!=T.info.columnDataTypes.String&&/^\s*\{regex_\d+\}\s*$/.test(t[a]))return void A(F.getRulesLogicAlerts("rule_logic_error"),e,e+n);if(!/^\s*\{regex_\d+\}\s*$/.test(t[a])){if(!/^\s*\{/.test(t[a]))return void A(0==a?F.getRulesLogicAlerts("rule_logic_invalid_start"):F.getRulesLogicAlerts("rule_logic_logical_right"),e,e+n);var m=t[a].match(/\}\s*[^\s|^\{]*\s*[\{|\d|\[]?/),s=m[0];if(s=s.replace(/^\}|[\{|\d|\[]$/g,"").replace(/^\s+|\s+$/g,""),"TIMEDIFF"!=i||","!=s){if("NOT"==(s="IS"==s?(s=(m=t[a].match(/\}\s*.*/))[0]).replace(/^\}|\[\w+\]|\d+(\.\d+)?|\{\w+\}/g,"").replace(/^\s+|\s+$/g,""):s)&&(s=(s=(m=t[a].match(/\}\s*.*/))[0]).replace(/^\}|\[\w+\]|\d+(\.\d+)?|\{\w+\}/g,"").replace(/^\s+|\s+$/g,"")),T.isNestedAggregate(i))return;if(!T.checkRepeatedAttributes(t[a],e,n))return;s=k(s);if(/^\s*$/.test(s))return void A(F.getRulesLogicAlerts("rule_logic_operator_right"),e,e+n);var h=!1,b=!1;for(d in T.info.operators){if(T.info.operators[d].label==s){h=!0;break}if(-1!=s.indexOf(T.info.operators[d].label)){b=!0;break}}if(b)return void A(F.getRulesLogicAlerts("rule_logic_invalid_operator",s)+". "+F.getRulesLogicAlerts("rule_logic_operator_space_needed"),o=e+T.info.logic.substr(e,n).indexOf(k(s)),o+k(s).length);if(!h)return void A(F.getRulesLogicAlerts("rule_logic_invalid_operator",s),o=e+T.info.logic.substr(e,n).indexOf(k(m[0])),o+k(m[0]).length);var _=t[a].match(/[\}|\]]\s*[^(\}|\{|\[|\])]*\s*[\{|\[]/g)||[];if(_.length)for(var r=0;r<_.length;r++)if(_[r]=_[r].substring(1,_[r].length-1),!/^\d+(\.\d+)?$/.test(_[r])){for(var v=_[r],y=!1,l=v.replace(/^\s*|\s*$/g,""),S=!1,d=0;d<T.info.operators.length;d++){if(T.info.operators[d].label==l&&("arithmetic"==T.info.operators[d].subtype||"comparison"==T.info.operators[d].subtype||"equal comparison"==T.info.operators[d].subtype||"inline function"==T.info.operators[d].subtype)){y=!0;break}if(T.info.operators[d].label==l){S=!0;break}}if(S)return void A(F.getRulesLogicAlerts("rule_logic_invalid_between_attr",l),o=e+T.info.logic.substr(e,n).indexOf(k(l)),o+k(l).length);if(y&&(!/^\s+/.test(v)||!/\s+$/.test(v)))return void A(F.getRulesLogicAlerts("rule_logic_operator_without_spaces",l)+". "+F.getRulesLogicAlerts("rule_logic_operator_space_needed"),o=e+T.info.logic.substr(e,n).indexOf(k(l)),o+k(l).length);if(!y)return l.length?void A(F.getRulesLogicAlerts("rule_logic_invalid_operator_between",l),o=e+T.info.logic.substr(e,n).indexOf(k(l)),o+k(l).length):void A(F.getRulesLogicAlerts("rule_logic_no_operator"),o=e,o+n)}var D=0;for(d in T.info.operators)if(-1!=t[a].indexOf(" "+T.info.operators[d].label+" ")&&"comparison"==T.info.operators[d].subtype){if(1<=D||t[a].indexOf(" "+T.info.operators[d].label+" ")!=t[a].lastIndexOf(" "+T.info.operators[d].label+" "))return void A(F.getRulesLogicAlerts("rule_logic_cmp_operator_exceeded"),e,e+n);if(!T.checkComparisonOperators(t[a],T.info.operators[d].label,t[a].indexOf(T.info.operators[d].label),e,n,i))return;D++}else if(-1!=t[a].indexOf(" "+T.info.operators[d].label+" ")&&"equal comparison"==T.info.operators[d].subtype){if(1<=D||t[a].indexOf(" "+T.info.operators[d].label+" ")!=t[a].lastIndexOf(" "+T.info.operators[d].label+" "))return void A(F.getRulesLogicAlerts("rule_logic_cmp_operator_exceeded"),e,e+n);if(!T.checkEqualComparisonOperators(t[a],T.info.operators[d].label,t[a].indexOf(T.info.operators[d].label),e,n,i))return;D++}for(d in T.info.operators)if(-1!=t[a].indexOf(" "+T.info.operators[d].label+" ")&&"inline function"==T.info.operators[d].subtype){if(!T.checkInlineFunction(t[a],T.info.operators[d].label,t[a].indexOf(T.info.operators[d].label),e,n,i))return;break}for(d in T.info.operators)if(-1!=t[a].indexOf(" "+T.info.operators[d].label+" ")&&"equal null"==T.info.operators[d].subtype){if(!T.checkEqualNullFunction(t[a],T.info.operators[d].label,t[a].indexOf(T.info.operators[d].label),e,n,i))return;break}for(var w=!1,M=!1,r=0;r<t[a].length;r++)if("{"!=t[a][r])if("}"!=t[a][r]){if("'"!=t[a][r]&&'"'!=t[a][r]||(M=!M),!w&&!M)for(var V=0;V<T.info.operators.length;V++)if(T.info.operators[V].label==t[a][r]&&"arithmetic"==T.info.operators[V].subtype&&!T.checkArithmeticOperators(t[a],T.info.operators[V].label,r,e,n))return}else w=!1;else w=!0;for(var L=!1,r=0;r<T.info.operators.length;r++)"arithmetic"!=T.info.operators[r].subtype&&-1<t[a].indexOf(T.info.operators[r].label)&&(L=!0);if(!L)return void(T.isAggregateFunction(i)&&"comparison"!=T.getOperatorType(s)?A(F.getRulesLogicAlerts("rule_logic_aggregate_condition"),e,e+n):A(F.getRulesLogicAlerts("rule_logic_no_condition"),e,e+n));for(r=0;r<T.info.convertedAttributes.length;r++)T.changeColumnType(T.info.convertedAttributes[r].value,T.info.convertedAttributes[r].type);T.info.convertedAttributes=[],e+=n+(a<t.length-1?g[a].length:0)}else s=""}}return 1}T.validateLogicGrammar=function(){var e=_();if(e)if(/(COUNT|MAX|MIN|SUM|AVG)\s*\(\s*(COUNT|MAX|MIN|SUM|AVG)[^\)]+\)/gm.test(T.info.logic))r.alertBox({msg:F.getVal("rulesLogicAlerts").rule_logic_nexted_aggregate_function});else if(/TIMEDIFF/.test(T.info.logic)&&"File"!=T.info.scope)r.alertBox({msg:F.getVal("rulesLogicAlerts").rule_logic_file_scope_for_TIMEDIFF});else if(/COUNT/.test(T.info.logic)&&"File"!=T.info.scope&&"Bundle"!=T.info.scope)r.alertBox({msg:F.getVal("rulesLogicAlerts").rule_logic_count_in_table});else if((/SUM/.test(T.info.logic)||/AVG/.test(T.info.logic)||/MIN/.test(T.info.logic)||/MAX/.test(T.info.logic))&&"File"!=T.info.scope&&"Bundle"!=T.info.scope)r.alertBox({msg:F.getVal("rulesLogicAlerts").rule_logic_aggregations_in_table});else{if("Table"!=T.info.scope){if(!(/SUM/.test(T.info.logic)||/AVG/.test(T.info.logic)||/MIN/.test(T.info.logic)||/MAX/.test(T.info.logic)||/COUNT/.test(T.info.logic)))return void r.alertBox({msg:F.getVal("rulesLogicAlerts").rule_logic_file_bundle_in_count})}else if(/count_\d+/.test(e))return void r.alertBox({msg:F.getVal("rulesLogicAlerts").rule_logic_count_in_table});if("Table"!=T.info.scope)for(var t=e.split(/\s+AND\s*|\s*OR\s*/),a=/^\s*{\s*(count|sum|min|max|avg)_\d+}\s*/,n=0;n<t.length;n++)if(!a.test(t[n]))return void r.alertBox({msg:F.getVal("rulesLogicAlerts").rule_logic_file_bundle_in_count});var i=T.checkRegexWithOperator(T.info.logic);if(i.result)A(F.getRulesLogicAlerts("rule_logic_regex_assignment_operator"),i.index,i.index+5);else if(T.checkParentheses(e))if(D(e,0))return!0}};T.isNestedAggregate=function(e){if(T.isAggregateFunction(e)||"COUNT"==e){var t=T.info.logic.match(/(MIN|MAX|AVG|SUM|COUNT)\s*.*?\(([^)]*)\)/g);if(t.length&&0<t.length)for(var a=0;a<t.length;a++){var n,i=t[a].match(/\(.*(MIN|MAX|AVG|SUM|COUNT).*\)/g);if(i)return A(F.getRulesLogicAlerts("rule_logic_nexted_aggregate_function"),n=T.info.logic.indexOf(t[a]),n+i[0].length),!0}}return!1},T.checkRegexWithOperator=function(e){for(var t,a=e.search(/REGEX/gi);-1!=a;)if(t=a+T.parseToken(e,a,"(",")").length,a=e.indexOf("REGEX",a+"REGEX".length),t<=e.length&&0==e.substr(t,10).trim().indexOf("="))return{result:!0,index:t};return{result:!1,index:0}},T.checkRepeatedAttributes=function(e,t,a){var n=e.match(/\{([^}]+)\}/g);if(!n)return!0;for(var i={},o=0;o<n.length;o++){var s=C[n[o].replace(/\{|\}/g,"")];if(i.hasOwnProperty(s))return void A(F.getRulesLogicAlerts("rule_logic_repeated_attribute",s),t,t+a+1);i[s]=!0}return!0},T.checkFunctions=function(e){T.info.convertedAttributes=[];for(var t=0;t<T.info.functions.length;t++)if(e.includes(T.info.functions[t].label))if(!function(e,t){t=t.label+"[^}]\\s*{\\w+}\\s*\\)";return!!e.match(new RegExp(t,"g"))}(e,T.info.functions[t]))return l=F.getRulesLogicAlerts("rule_logic_error"),i=k(e).replace(/^\s+|\s+$/g,""),void A(l,d=T.info.logic.indexOf(i),d+i.length);var a="";if(-1!=e.indexOf("TIMEDIFF"))return a=e.match(/\s*[^\s]+\(\s*\{?[^\}]*\}?\s*[,]\s*\{?[^\}]*\}?\s*\)/g),l="",/\s*TIMEDIFF\s*[(]\s*{regex_\d}\s*,\s*{regex_\d}\s*[)]\s*/.test(e)?/\s*TIMEDIFF\s*[(]\s*{regex_\d}\s*,\s*{regex_\d}\s*[)]\s*(>|>=|<|<=|<>|=)\s*/.test(e)?/\s*TIMEDIFF\s*[(]\s*{regex_\d}\s*,\s*{regex_\d}\s*[)]\s*(>|>=|<|<=|<>|=)\s*{number_\d}\s*/.test(e)||(l=F.getRulesLogicAlerts("rule_logic_file_scope_for_TIMEDIFF_returned_value_should_compare_wiht_number",n)):l=F.getRulesLogicAlerts("rule_logic_file_scope_for_TIMEDIFF_returned_value_should_compare_using_comparision_operator",n):l=F.getRulesLogicAlerts("rule_logic_file_scope_for_TIMEDIFF_parameter_error",n),!l||void A(l,d=T.info.logic.indexOf("TIMEDIFF"),d+e.length);if(a=e.match(/\s*[^\s]+\(\s*\{?[^\}]*\}?\s*\)/g))for(var c=Object.keys(C),t=0;t<a.length;t++){for(var u=!1,f=0;f<c.length;f++)if(-1<c[f].indexOf(a[t])){u=!0;break}if(!u&&((a[t].match(/\{/g)||[]).length==(a[t].match(/\}/g)||[]).length&&(a[t].match(/\(/g)||[]).length==(a[t].match(/\)/g)||[]).length)){var n=a[t].split("(")[0].replace(/^\s+|\s+$/g,""),g=a[t].substring(a[t].indexOf("(")+1,a[t].lastIndexOf(")"));if(/^\s*$/.test(g))return void A(l=F.getRulesLogicAlerts("rule_logic_function_without_params"),d=T.info.logic.indexOf(a[t]),d+a[t].length);if(!/^\s*\{[^\}]+\}\s*$/.test(g))return l=F.getRulesLogicAlerts("rule_logic_function_without_attr"),i=k(a[t]),void A(l,d=T.info.logic.indexOf(i),d+i.length);var p=!1;for(f in T.info.functions)if(T.info.functions[f].label==n){var i,p=!0,o=C[a[t].split(/\{|\}/)[1]];if("CONVERTTOINT"!=n&&"TIMEDIFF"!=n&&-1!=a[t].indexOf("regex_"))return l=F.getRulesLogicAlerts("rule_logic_regex_func_invalid",n),i=k(a[t]).replace(/^\s+|\s+$/g,""),void A(l,d=T.info.logic.indexOf(i),d+i.length);if("CONVERTTOINT"==n){if(T.sectionsColumnLabelMap[o][2]!=T.info.columnDataTypes.String)return l=F.getRulesLogicAlerts("rule_logic_no_typecasting",o),i=k(a[t]).replace(/^\s+|\s+$/g,""),void A(l,d=T.info.logic.indexOf(i),d+i.length);T.info.convertedAttributes.push({value:o,type:T.sectionsColumnLabelMap[o][2]}),T.changeColumnType(o,T.info.columnDataTypes.Integer)}else if("CONVERTTOSTRING"==n){if(T.sectionsColumnLabelMap[o][2]==T.info.columnDataTypes.String)return l=F.getRulesLogicAlerts("rule_logic_no_typecasting",o),i=k(a[t]).replace(/^\s+|\s+$/g,""),void A(l,d=T.info.logic.indexOf(i),d+i.length);T.info.convertedAttributes.push({value:o,type:T.sectionsColumnLabelMap[o][2]}),T.changeColumnType(o,T.info.columnDataTypes.String)}break}if(!p)return l=F.getRulesLogicAlerts("rule_logic_invalid_function",n),i=k(a[t]).replace(/^\s+|\s+$/g,""),void A(l,d=T.info.logic.indexOf(i),d+i.length)}}var m=e.match(/(sum|min|max|avg)_\d/gm);if(m&&m.length){var c=Object.keys(C),h=m[0].replace(/{|}/gm,""),s=C[h];if(/{\s*([^}]+?)\s*}.*{\s*([^}]+?)\s*}/gm.test(s))return void A(l=F.getRulesLogicAlerts("rule_logic_invalid_aggregate_function",s),d=T.info.logic.indexOf(s),d+s.length);if(!/(SUM|MIN|MAX|AVG)\s*\(\s*{\s*.+\s*}\s*\)/g.test(s))return void A(l=F.getRulesLogicAlerts("rule_logic_invalid_aggregate_function",s),d=T.info.logic.indexOf(s),d+s.length);if((r=s.match(/{\s*.+\s*}/gm))&&r[0]){var r=r[0].replace(/\s*{\s*|\s*}\s*/g,"");if(T.sectionsColumnLabelMap[r]&&T.sectionsColumnLabelMap[r][2]==T.info.columnDataTypes.String)return void A(l=F.getRulesLogicAlerts("rule_logic_aggregate_not_numeric_attr",s),d=T.info.logic.indexOf(s),d+s.length);if(!T.sectionsColumnLabelMap[r])return!1}}if((m=e.match(/(count)_\d/gm))&&m.length){var l,d,h=m[0].replace(/{|}/gm,""),r=(s=C[h]).indexOf("("),m=T.findClosingBracketMatchIndex(s,r),h=s.substring(r,m);if(/\s+COUNT|MIN|MAX|AVG|SUM\s*\(/gm.test(h))return void A(l=F.getRulesLogicAlerts("rule_logic_nexted_aggregate_function"),d=r,d+h.length)}return!0},T.findClosingBracketMatchIndex=function(e,t){if("("!=e[t])throw new Error("No '(' at index "+t);for(var a=1,n=t+1;n<e.length;n++)switch(e[n]){case"(":a++;break;case")":if(0==--a)return n}return-1},T.changeColumnType=function(e,t){T.sectionsColumnLabelMap[e][2]=t},T.removeBrackets=function(e){for(var t=0,a=!1;t<e.length;)"{"!=e[t]?"}"!=e[t]?a||"("!=e[t]&&")"!=e[t]||(e=e.slice(0,t)+e.slice(t+1),t--):a=!1:a=!0,t++;return e},T.checkInlineFunction=function(e,t,a,n,i,o){if("VERSION"!=o){o=e.substring(0,a-1).replace(/^\s+|\s+$/g,"");if(/^\{[^\}]+\}$/.test(o)){e=e.substr(a+t.length).replace(/^\s+|\s+$/g,"");if(/^\s*$/.test(e))A(F.getRulesLogicAlerts("rule_logic_right_value_required",t),n,n+i);else{o=k(o).replace(/\s+$/g,"").replace(/^\{|\}$/g,""),e=k(e).replace(/\s+$/g,"").replace(/^\{|\}$/g,"");if(T.sectionsColumnLabelMap[o][2]==T.info.columnDataTypes.String){if(/^\'\%[^\'|\%]*\%\'$|^\'[^\'|\%]*\%\'$|^\'\%[^\'|\%]*\'$/.test(e))return!0;A(F.getRulesLogicAlerts("rule_logic_right_pattern_required",t),n,n+i)}else A(F.getRulesLogicAlerts("rule_logic_string_operator",t),n,n+i)}}else A(F.getRulesLogicAlerts("rule_logic_left_attribute",t),n,n+i)}else A(F.getRulesLogicAlerts("rule_logic_version_invalid_operation",t),n,n+i)},T.checkEqualNullFunction=function(e,t,a,n,i,o){e=k(e.substring(0,a-1).replace(/^\s+|\s+$/g,"")).replace(/\s+$/g,"").replace(/^\{|\}$/g,"");if("VERSION"!=o){if(T.sectionsColumnLabelMap[e][2]==T.info.columnDataTypes.String)return!0;A(F.getRulesLogicAlerts("rule_logic_string_operator",t),n,n+i)}else A(F.getRulesLogicAlerts("rule_logic_version_invalid_operation",t),n,n+i)},T.checkArithmeticOperators=function(e,t,a,n,i){var o,s,r=e.substring(0,a),e=e.substr(a+t.length),a=!1,l=!1;if(a=/\{[^\}]+\}\s*$/.test(r)?(o=C[r.match(/\{[^\}]+\}\s*$/)[0].replace(/\s+$/g,"").replace(/^\{|\}$/g,"")],!0):(o=r.match(/[^\s]+\s*$/)?r.match(/[^\s]+\s*$/)[0].replace(/\s+$/g,""):"",!1),l=/^\s*\{[^\}]+\}/.test(e)?(s=C[e.match(/^\s*\{[^\}]+\}/)[0].replace(/^\s+/g,"").replace(/^\{|\}$/g,"")],!0):(s=e.match(/^\s*[^\s]+/)?e.match(/^\s*[^\s]+/)[0].replace(/^\s+/g,""):"",!1),o=k(o),s=k(s),"/"!=t||!/^0(\.0+)?$/.test(s)){if(a){if(T.sectionsColumnLabelMap[o][2]==T.info.columnDataTypes.String)return void A(F.getRulesLogicAlerts("rule_logic_not_numeric_attr",o),n,n+i)}else if(!/^\d+(\.\d+)?$/.test(o))return void A(F.getRulesLogicAlerts("rule_logic_not_number",o),n,n+i);if(l){if(T.sectionsColumnLabelMap[s][2]==T.info.columnDataTypes.String)return void A(F.getRulesLogicAlerts("rule_logic_not_numeric_attr",s),n,n+i)}else{if(/^\s*$/.test(s))return void A(F.getRulesLogicAlerts("rule_logic_right_value_required",t),n,n+i);if(!/^\d+(\.\d+)?$/.test(s))return void A(F.getRulesLogicAlerts("rule_logic_not_number",s),n,n+i)}return!0}A(F.getRulesLogicAlerts("rule_logic_division_zero"),n,n+i)},T.checkEqualComparisonOperators=function(e,t,a,n,i,o){var s=e.substring(0,a),e=e.substr(a+t.length),a=s.replace(/\{[^\}]+\}/g,"{}").replace(/\[[^\]]+\]/g,"[]").match(/\s+\d+(\.\d+)?\s+/g),r=e.replace(/\{[^\}]+\}/g,"{}").replace(/\[[^\]]+\]/g,"[]").match(/\s+\d+(\.\d+)?\s+/g);if(!(a&&1<a.length||r&&1<r.length)){var l,d,a=!1,r=!1,s=(a=/\{[^\}]+\}\s*$/.test(s)?(l=C[s.match(/\{[^\}]+\}\s*$/)[0].replace(/\s+$/g,"").replace(/^\{|\}$/g,"")],!0):(l=s.match(/[^\s]+\s*$/)?s.match(/[^\s]+\s*$/)[0].replace(/\s+$/g,""):"",!1),r=/^\s*\{[^\}]+\}/.test(e)?(d=C[e.match(/^\s*\{[^\}]+\}/)[0].replace(/^\s+/g,"").replace(/^\{|\}$/g,"")],!0):(d=e.match(/^\s*[^\s]+/)?e.match(/^\s*[^\s]+/)[0].replace(/^\s+/g,""):"",!1),l=k(l),d=k(d),new RegExp(/^'%[0-9.]+%'$/));if(a){if(o&&"VERSION"==o){if(T.sectionsColumnLabelMap[l][2]!=T.info.columnDataTypes.String)return void A(F.getRulesLogicAlerts("rule_logic_not_string_attr",l),n,n+i);if(!s.test(d))return void A(F.getRulesLogicAlerts("rule_logic_not_version_string",t),n,n+i)}else if(T.sectionsColumnLabelMap[l][2]==T.info.columnDataTypes.String){if(r){if(T.sectionsColumnLabelMap[d][2]!=T.info.columnDataTypes.String)return void A(F.getRulesLogicAlerts("rule_logic_not_string_attr",l),n,n+i)}else if(!/^\"[^\"]*\"$/.test(d))return void A(F.getRulesLogicAlerts("rule_logic_not_string",d),n,n+i)}else if(r){if(T.sectionsColumnLabelMap[d][2]==T.info.columnDataTypes.String)return void A(F.getRulesLogicAlerts("rule_logic_not_numeric_attr",d),n,n+i)}else if(!/^\d+(\.\d+)?$/.test(d))return void A(F.getRulesLogicAlerts("rule_logic_not_number",d),n,n+i)}else{if(!/^\d+(\.\d+)?$/.test(l))return void A(F.getRulesLogicAlerts("rule_logic_not_number",l),n,n+i);if(r){if(T.sectionsColumnLabelMap[d][2]==T.info.columnDataTypes.String)return void A(F.getRulesLogicAlerts("rule_logic_not_numeric_attr",d),n,n+i)}else if(!/^\d+(\.\d+)?$/.test(d))return void A(F.getRulesLogicAlerts("rule_logic_not_string",d),n,n+i)}return!0}A(F.getRulesLogicAlerts("rule_logic_numrals_exceeded"),n,n+i)},T.checkComparisonOperators=function(e,t,a,n,i,o){var s=e.substring(0,a),e=e.substr(a+t.length),a=s.replace(/\{[^\}]+\}/g,"{}").replace(/\[[^\]]+\]/g,"[]").match(/\s+\d+(\.\d+)?\s+/g),r=e.replace(/\{[^\}]+\}/g,"{}").replace(/\[[^\]]+\]/g,"[]").match(/\s+\d+(\.\d+)?\s+/g);if(!(a&&1<a.length||r&&1<r.length)){var l,d,a=!1,r=!1,s=(a=/\{[^\}]+\}\s*$/.test(s)?(l=C[s.match(/\{[^\}]+\}\s*$/)[0].replace(/\s+$/g,"").replace(/^\{|\}$/g,"")],!0):(l=s.match(/[^\s]+\s*$/)?s.match(/[^\s]+\s*$/)[0].replace(/\s+$/g,""):"",!1),r=/^\s*\{[^\}]+\}/.test(e)?(d=C[e.match(/^\s*\{[^\}]+\}/)[0].replace(/^\s+/g,"").replace(/^\{|\}$/g,"")],!0):(d=e.match(/^\s*[^\s]+/)?e.match(/^\s*[^\s]+/)[0].replace(/^\s+/g,""):"",!1),l=k(l),d=k(d),new RegExp(/^'%[0-9.]+%'$/));if(a){if(o&&"VERSION"==o){if(T.sectionsColumnLabelMap[l][2]!=T.info.columnDataTypes.String)return void A(F.getRulesLogicAlerts("rule_logic_not_string_attr",l),n,n+i)}else if(T.sectionsColumnLabelMap[l][2]==T.info.columnDataTypes.String)return void A(F.getRulesLogicAlerts("rule_logic_not_numeric_attr",l),n,n+i)}else if(!s.test(l))return void A(F.getRulesLogicAlerts("rule_logic_not_number",l),n,n+i);if(r){if(o&&"VERSION"==o){if(!s.test(d))return void A(F.getRulesLogicAlerts("rule_logic_not_version_string",t),n,n+i)}else if(T.sectionsColumnLabelMap[d][2]==T.info.columnDataTypes.String)return void A(F.getRulesLogicAlerts("rule_logic_not_numeric_attr",d),n,n+i)}else if(o&&"VERSION"==o){if(!s.test(d))return void A(F.getRulesLogicAlerts("rule_logic_not_version_string",t),n,n+i)}else{if(/^\s*$/.test(d))return void A(F.getRulesLogicAlerts("rule_logic_right_value_required",t),n,n+i);if(!/^\d+(\.\d+)?$/.test(d))return void A(F.getRulesLogicAlerts("rule_logic_not_number",d),n,n+i)}return!0}A(F.getRulesLogicAlerts("rule_logic_numrals_exceeded"),n,n+i)},T.deepValidation=function(t,a,n){var i=[];if(""==(t=angular.copy(t))||null==t)return[];if(t.length&&0<t.length){var e=T.getJSONFromSting(t);if(!e)return[];try{e=e.replace(/,\s+/gm,","),JSON.parse(e);var o=T.getJSONFromSting(t);return i=T.getSectionColumnsPairFromString(o,a,n)}catch(e){i=T.getSectionAttributeLabelMap(t,a,n);if(!Array.isArray(i))return}}return i},T.validateLogicMap=function(){var e=[],t=null,a="";if(!T.info.logic.length)return e;for(var n=0;n<T.info.logic.length;n++){if("{"==T.info.logic[n]&&t||"}"==T.info.logic[n]&&!t||n==T.info.logic.length-1&&t&&"}"!=T.info.logic[n]||n==T.info.logic.length-1&&"{"==T.info.logic[n])return void A(a=F.getRulesLogicAlerts("rule_logic_error"),t,n+1);if("{"==T.info.logic[n]&&(t=n+1),"}"==T.info.logic[n]&&t){var i=n,o=T.info.logic.substring(t,i);if(!T.sectionsColumnLabelMap.hasOwnProperty(o)&&(a=T.isPartOfRegex(t)?F.getRulesLogicAlerts("rule_logic_invalid_regex_len_attr",o):T.isPartOfLikeoperator(t)?F.getRulesLogicAlerts("rule_logic_invalid_like_curly_brace",o):F.getRulesLogicAlerts("rule_logic_invalid_attr",o)))return void A(a,t,i);e.push(o),t=null}}return e},T.isBracePartOfLikeoperator=function(e){var t,a=T.info.logic,n=a.indexOf("LIKE");if(-1==n)return!1;for(;0<=n;){if(t=T.parseToken(a,n,"(",")").length+n,n<e&&e<t)return!0;if(-1==(n=a.indexOf("LIKE",t)))return!1}return!1},T.isPartOfLikeoperator=function(e){var t,a=T.info.logic,n=a.indexOf("LIKE");if(-1==n)return!1;for(;0<=n;){if(t=T.parseToken(a,n,"{","}").length+n,n<e&&e<t)return!0;if(-1==(n=a.indexOf("LIKE",t)))return!1}return!1},T.isPartOfRegex=function(e){var t=T.info.logic,a=t.indexOf("REGEX");if(-1==a)return!1;for(;0<=a;){var n=T.parseToken(t,a,"(",")").match(/".*"/gm);if(secondParamLen=0,n&&n[0]){if(n=n[0],a=t.indexOf(n),n=(secondParamLen=n.length)+a,a<e&&e<n)return!0;if(-1==(a=t.indexOf("REGEX",n)))return!1}}return!1},T.parseToken=function(e,t,a,n){for(var i=e.length,o=0,s=0,r=e.indexOf("(",t);r<i;r++){switch(e[r]){case a:o++;break;case n:o--}if(0==o){s=r;break}}return e.substring(t,s+1)},T.validateAPITemplateMap=function(){for(var e=[],t=null,a=0;a<T.info.text.length;a++){if("{"==T.info.text[a]&&t||"}"==T.info.text[a]&&!t||a==T.info.text.length-1&&t&&"}"!=T.info.text[a]||a==T.info.text.length-1&&"{"==T.info.text[a])return void r.alertBox({msg:F.getVal("rulesMsgs").rule_text_error});if("{"==T.info.text[a]&&(t=a+1),"}"==T.info.text[a]&&t){var n=a,n=T.info.text.substring(t,n);if(!T.sectionsColumnLabelMap.hasOwnProperty(n))return void r.alertBox({msg:F.getVal("rulesMsgs").rule_text_invalid_attr[0]+n+F.getVal("rulesMsgs").rule_text_invalid_attr[1]});e.push(n),t=null}}return e},T.setHiddenLogic=function(e){for(var t in T.info.logic=T.info.logic.replace(/^\s+|\s+$/g,"").replace(/\s+/g," "),T.info.hiddenLogic=T.info.logic,e){var a=e[t],n=T.sectionsColumnLabelMap[e[t]][0];T.info.hiddenLogic=T.info.hiddenLogic.replace(a,n)}for(var i=F.getVal("rulesLogicAlerts").rule_logic_wildCardCharacters,t=0;t<i.length;t++)for(var o=T.info.hiddenLogic.indexOf("\\"+i[t]);-1!=o;)0==T.isSlashXPartOfRegex(T.info.hiddenLogic,o)&&(T.info.hiddenLogic=T.replaceAt(T.info.hiddenLogic,o,"\\\\"+i[t])),o=T.info.hiddenLogic.indexOf("\\"+i[t],o+4)},T.isSlashXPartOfRegex=function(e,t){var a,n=0;return-1!=(n=(e=(e=angular.copy(e)).toLowerCase()).indexOf("regex",0))&&(a=n+T.parseToken(e,n,"(",")").length,n<t&&t<a)?a:0},T.replaceAt=function(e,t,a){return e.substr(0,t)+a+e.substr(t+a.length)},T.setHiddenText=function(e){for(var t in T.info.hiddenText=T.info.text,e){var a=e[t],t="rule."+T.sectionsColumnLabelMap[e[t]][0];T.info.hiddenText=T.info.hiddenText.replace(a,t)}},T.setHiddenLabel=function(e){for(var t in T.info.hiddenLabel=T.info.label,e){var a=e[t],t="rule."+T.sectionsColumnLabelMap[e[t]][0];T.info.hiddenLabel=T.info.hiddenLabel.replace(a,t)}},T.setHiddenJustification=function(e){for(var t in T.info.hiddenJustification=T.info.alert_justification,e){var a=e[t],t=T.sectionsColumnLabelMap[e[t]];t&&t[0]&&(t="rule."+t[0],T.info.hiddenJustification=T.info.hiddenJustification.replace(a,t))}},T.setHiddenRecommendation=function(e){for(var t in T.info.hiddenRecommendation=T.info.recommendation,e){var a=e[t],t="rule."+T.sectionsColumnLabelMap[e[t]][0];T.info.hiddenRecommendation=T.info.hiddenRecommendation.replace(a,t)}},T.expandSection=function(e){e.foundAttr&&0<e.foundAttr.length?e.expanded&&T.getSectionColumns(e):e.expanded&&!e.hasOwnProperty("hasData")&&T.getSectionColumns(e)},T.focusElement=function(e){T.info.lastElementFocused=e},T.addLogicText=function(e){"logic"==T.info.lastElementFocused?T.onDropLogic(e):"text"==T.info.lastElementFocused?T.onDropText(e):"label"==T.info.lastElementFocused?T.onDropLabel(e):"alert_justification"==T.info.lastElementFocused?T.onDropJustification(e):"recommendation"==T.info.lastElementFocused?T.onDropRecommendation(e):r.alertBox({msg:"Place the cursor  on Label, Recommendation, Justification, Logic or Text"})},T.onDropLogic=function(e,t){var a=angular.element(document.getElementById("inputLogic")).prop("selectionStart"),a="operator"==e[1].type||"function"==e[1].type?(T.info.logic=[T.info.logic.substring(0,a),e[1].text,T.info.logic.substring(a)].join(""),a+e[1].positionInc):(T.info.logic=[T.info.logic.substring(0,a)," {",e[0],".",e[1].label,"} ",T.info.logic.substring(a)].join(""),a+e[0].length+e[1].label.length+5);document.getElementById("inputLogic").focus(),document.getElementById("inputLogic").setSelectionRange(a,a)},T.onDropText=function(e,t){var a=angular.element(document.getElementById("inputText")).prop("selectionStart");"operator"!=e[1].type?(a="function"==e[1].type?(T.info.text=[T.info.text.slice(0,a),e[1].text,T.info.text.slice(a)].join(""),a+e[1].positionInc):(T.info.text=[T.info.text.slice(0,a)," {",e[0],".",e[1].label,"} ",T.info.text.slice(a)].join(""),a+e[0].length+e[1].label.length+5),document.getElementById("inputText").focus(),document.getElementById("inputText").setSelectionRange(a,a)):r.alertBox({msg:"Relational & Logical operators not valid for Text"})},T.onDropLabel=function(e,t){var a=angular.element(document.getElementById("inputLabel")).prop("selectionStart");"operator"!=e[1].type?(a="function"==e[1].type?(T.info.label=[T.info.label.slice(0,a),e[1].text,T.info.label.slice(a)].join(""),a+e[1].positionInc):(T.info.label=[T.info.label.slice(0,a)," {",e[0],".",e[1].label,"} ",T.info.label.slice(a)].join(""),a+e[0].length+e[1].label.length+5),document.getElementById("inputLabel").focus(),document.getElementById("inputLabel").setSelectionRange(a,a)):r.alertBox({msg:"Relational & Logical operators not valid for Label"})},T.onDropJustification=function(e,t){var a=angular.element(document.getElementById("inputJustification")).prop("selectionStart");"operator"!=e[1].type?(a="function"==e[1].type?(T.info.alert_justification=[T.info.alert_justification.slice(0,a),e[1].text,T.info.alert_justification.slice(a)].join(""),a+e[1].positionInc):(T.info.alert_justification=[T.info.alert_justification.slice(0,a)," {",e[0],".",e[1].label,"} ",T.info.alert_justification.slice(a)].join(""),a+e[0].length+e[1].label.length+5),document.getElementById("inputJustification").focus(),document.getElementById("inputJustification").setSelectionRange(a,a)):r.alertBox({msg:"Relational & Logical operators not valid for Label"})},T.onDropRecommendation=function(e,t){var a=angular.element(document.getElementById("inputRecommendation")).prop("selectionStart");"operator"!=e[1].type?(a="function"==e[1].type?(T.info.recommendation=[T.info.recommendation.slice(0,a),e[1].text,T.info.recommendation.slice(a)].join(""),a+e[1].positionInc):(T.info.recommendation=[T.info.recommendation.slice(0,a)," {",e[0],".",e[1].label,"} ",T.info.recommendation.slice(a)].join(""),a+e[0].length+e[1].label.length+5),document.getElementById("inputRecommendation").focus(),document.getElementById("inputRecommendation").setSelectionRange(a,a)):r.alertBox({msg:"Relational & Logical operators not valid here"})},T.getComparisionOperatorForScala=function(e){var t,a=y("filterMultiples")(T.info.operators,{subtype:["comparison","equal comparison"]});for(t in a)if(a[t]&&a[t].label.trim()==e.trim())return a[t].scalaOperator},T.getInlineFunctionForScala=function(e){var t,a=y("filter")(T.info.operators,{subtype:"inline function"});for(t in a)if(a[t]&&a[t].label.trim()==e.trim())return a[t].scalaOperator},T.getEqualNullOperatorForScala=function(e){var t,a=y("filter")(T.info.operators,{subtype:"equal null"});for(t in a)if(a[t]&&a[t].label.trim()==e.trim())return a[t].scalaOperator},T.getFunctionForScala=function(e){for(var t in T.info.functions)if(T.info.functions[t]&&T.info.functions[t].label.trim()==e.trim())return T.info.functions[t].scalaOperator},T.getConnectorForScala=function(e){var t,a=y("filter")(T.info.operators,{subtype:"logical"});for(t in a)if(a[t]&&a[t].label.trim()==e.trim())return a[t].scalaOperator},T.parseLogicToScalaCondtion=function(e,t){var a,n=y("filter")(T.info.operators,{subtype:"logical"}),i="";for(a in n)n[a]&&(0==i.length?i+="\\s+"+n[a].label+"\\s+":i+="|\\s+"+n[a].label+"\\s+");var o=new RegExp(i);if(!o.test(e))return T.parseLogicToScalaCondtion_translateLastStatement(e,t);var s,o=o.exec(e),r=(o&&0<o.length&&(s=T.getConnectorForScala(o[0])),e.split(o[0]));if(2<=r.length){for(var l="",d=0;d<r.length;d++)l=0==d?T.parseLogicToScalaCondtion_translateLastStatement(r[d],t):l+" "+s+" "+T.parseLogicToScalaCondtion(r[d],t);return l}},T.parseLogicToScalaCondtion_translateLastStatement=function(e,c){var t=y("filterMultiples")(T.info.operators,{subtype:["comparison","equal comparison"]}),a="";for(d in t)t[d]&&(0==a.length?a+="\\s+"+t[d].label+"\\s+":a+="|\\s+"+t[d].label+"\\s+");var n=y("filter")(T.info.operators,{subtype:"inline function"}),i="";for(d in n)n[d]&&(0==i.length?i+="\\s*"+n[d].label+"\\s*":i+="|\\s*"+n[d].label+"\\s*");var o="";for(d in T.info.functions)T.info.functions[d]&&(0==o.length?o+="\\s*"+T.info.functions[d].label+"\\s*":o+="|\\s*"+T.info.functions[d].label+"\\s*");var u="";for(d in T.info.aggregateFunctions)T.info.aggregateFunctions[d]&&(0==u.length?u+="\\s*"+T.info.aggregateFunctions[d].label+"\\s*":u+="|\\s*"+T.info.aggregateFunctions[d].label+"\\s*");var f=y("filter")(T.info.operators,{subtype:"equal null"}),g="";for(d in f)f[d]&&(0==g.length?g+="\\s*"+f[d].label+"\\s*":g+="|\\s*"+f[d].label+"\\s*");var p=new RegExp(a),m=new RegExp(i),h=new RegExp(o),b=new RegExp(u),_=new RegExp(g);if(p.test(e)&&((s=p.exec(e))&&0<s.length&&(r=T.getComparisionOperatorForScala(s[0])),(l=e.split(p))[1]=l[1].replace(/\"/g,'"""'),e=l[0]+" "+r+" "+l[1]),m.test(e)&&((s=m.exec(e))&&0<s.length&&(r=T.getInlineFunctionForScala(s[0])),l=e.split(m),/\'%(.*?)[^%]\'/.test(l[1])?r="endsWith":/\'[^%](.*?)%\'/.test(l[1])&&(r="startsWith"),l[1]=l[1].replace(/\'%|%\'|\'/g,'"""'),e=l[0].trim()+"."+r+"("+l[1]+")",-1<s[0].indexOf(" NOT ")&&(e=e.replace(/\w/,"!$&"))),h.test(e)){(s=h.exec(e))&&0<s.length&&(r=T.getFunctionForScala(s[0]));var s,r,l=e.split(h);e="";for(var v,d=0;d<l.length;d++)l[d]&&("CONVERTTOSTRING"==s[0]?e+=l[d].replace(/(\.to[\w]+\s*)?\)/,")."+r):"VERSION"==s[0]?(v=l[d].replace(/\)/,")"),e+=w(v,c)):"COUNT"!=s[0]&&b.test(s[0])?e+=l[d].replace(/\)|\(/g,""):"COUNT"==s[0]?e+=l[d]:e+=l[d].replace(/\)/,")."+r),d==l.length-1&&(e=(e=e.replace(/\s*\(\*s/,"")).replace(/\s*\)\*s/,"")))}return _.test(e)&&((s=_.exec(e))&&0<s.length&&(r=T.getEqualNullOperatorForScala(s[0])),e=(l=e.split(_))[0]+r+(l[1]||""),-1<s[0].indexOf(" NOT ")&&(e=e.replace(/\w/,"!$&").replace(/^\s+/,""))),e},T.resetValues=function(){T.info.emailTemplate="select",T.info.apiTemplate="select"};var w=function(e,c){for(var t,u=T.info.operators.length,a=[],n="",i=[],o=0;o<u;o++)if(-1!=e.indexOf(T.info.operators[o].scalaOperator)){a=e.split(T.info.operators[o].scalaOperator),t=T.info.operators[o].scalaOperator;break}if(a){n=(n=(n=a[0]).replace(/\s*\(\s*/,"")).replace(/\s*\)\s*/,""),a[0]=n;var n="",s=(i=(i=c[a[1].replace(/\s*/g,"").replace(/^'%/g,"").replace(/%'$/g,"")]).split(".")).length;function r(e,t){for(var a="",n=0;n<s;n++)if(""===a?a="(":a+=" && ",a+=e+'.split("\\\\.")('+n+").toInt  == "+parseInt(t[n],10),n==s-1){var i=(a.match(/\(/gm)||[]).length;i-=(a.match(/\)/gm)||[]).length;for(var o=0;o<i;o++)a+=")"}return a}if(s)if("!="===t)n="(!"+r(a[0],i)+")";else if("=="===t)n=r(a[0],i);else{var l=i,d=!1;">="===t?(d=!0,t=">"):"<="===t&&(d=!0,t="<");for(o=0;o<s;o++)if(""===n&&(n="("),o<s-1)n+=a[0]+'.split("\\\\.")('+o+").toInt "+t+" "+parseInt(l[o],10)+" || ("+a[0]+'.split("\\\\.")('+o+").toInt  == "+parseInt(l[o],10)+" && (";else{for(var f=(n.match(/\(/gm)||[]).length,g=(f-=(n.match(/\)/gm)||[]).length,""),p=0;p<f;p++)g+=")";n+=a[0]+'.split("\\\\.")('+o+").toInt "+t+" "+parseInt(l[o],10)+g,d&&(n="("+r(a[0],i)+" || "+n+")")}}}return n};function u(e){!T.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(T.info.sessionTimedOut=!0,r.sessionTimeout())}T.getJSONFromSting=function(e){if(!e)return"";var t=new RegExp(/{[\s\S]*}/gm),e=e.match(t);return e&&0<e.length?e[0]:""},T.getSectionColumnsPairFromString=function(e,t,a){var n,i=[],o={};try{o=JSON.parse(e)}catch(e){o={}}for(var s=Object.keys(o),r=0;r<s.length;r++){if(n=o[s[r]],!1===(n=T.getSectionAttributeLabelMap(n,t,a)))return;i=i.concat(n)}return i},T.getSectionAttributeLabelMap=function(e,t,a){for(var n=[],i=null,o=0;o<e.length;o++){if("{"==e[o]&&i||"}"==e[o]&&!i||o==e.length-1&&i&&"}"!=e[o]||o==e.length-1&&"{"==e[o])return r.alertBox({msg:F.getVal("rulesMsgs").rule_justification_error}),!1;if("{"==e[o]&&(i=o+1),"}"==e[o]&&i){var s=o,s=e.substring(i,s);if(!T.sectionsColumnLabelMap.hasOwnProperty(s))return r.alertBox({msg:F.getVal("rulesMsgs")[t][0]+s+F.getVal("rulesMsgs")[t][1]}),!1;if("Table"!=T.info.scope&&"G"!=T.sectionsColumnLabelMap[s][5])return r.alertBox({msg:F.getVal("rulesMsgs")[a][0]+s+F.getVal("rulesMsgs")[a][1]}),!1;n.push(s),i=null}}return n},T.trackUser=function(e,t,a){a=JSON.stringify(a);f.standard_user_tracking(T.info.application,e,t,a).then(function(e){},u)},T.differenceOf2Arrays=function(e,t){var a,n=[],i=[];if(!e.length&&t.length)return{removed:"",added:t.join()};if(!t.length&&e.length)return{removed:e.join(),added:""};for(a in e)-1===t.indexOf(e[a])&&n.push(e[a]);for(a in t)-1===e.indexOf(t[a])&&i.push(t[a]);return{removed:n.length?n.join():"",added:i.length?i.join():""}},T.info.autocomplete=function(o,s){var r;function a(e){if(e){for(var t=e,a=0;a<t.length;a++)t[a].classList.remove("autocomplete-active");e[r=(r=r>=e.length?0:r)<0?e.length-1:r].classList.add("autocomplete-active")}}function l(e){for(var t=document.getElementsByClassName("autocomplete-items"),a=0;a<t.length;a++)e!=t[a]&&e!=o&&t[a].parentNode.removeChild(t[a])}o.addEventListener("input",function(e){var t,a,n,i=this.value;if(l(),!i)return!1;for(r=-1,(t=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),t.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(t),n=0;n<s.length;n++)s[n].substr(0,i.length).toUpperCase()==i.toUpperCase()&&((a=document.createElement("DIV")).innerHTML="<strong>"+s[n].substr(0,i.length)+"</strong>",a.innerHTML+=s[n].substr(i.length),a.innerHTML+="<input type='hidden' value='"+s[n]+"'>",a.addEventListener("click",function(e){var t;o.value="",t=this.getElementsByTagName("input")[0].value,T.info.subscriptionEmailList.includes(t)||(T.info.subscriptionEmailList.unshift(t),T.info.subscriberObj.unshift({label:t,selected:!1}),T.loadSubscribers()),l()}),t.appendChild(a))}),o.addEventListener("keydown",function(e){var t=(t=document.getElementById(this.id+"autocomplete-list"))&&t.getElementsByTagName("div");40==e.keyCode?(r++,a(t)):38==e.keyCode?(r--,a(t)):13==e.keyCode&&(e.preventDefault(),-1<r&&t&&t[r].click())}),document.addEventListener("click",function(e){l(e.target)})},T.openAddSubscribers=function(){T.info.subBulkRemoveBtn=!1,T.info.emailText="",T.info.searchEmailText="",T.info.subloading=!0,T.msg="",T.info.subscriberObj=T.info.subscriptionEmailList.reduce(function(e,t){return e.push({label:t,selected:!1}),e},[])||[],T.loadSubscribers(),T.originalSub=T.info.subscriberObj.slice(),T.modal=r.openModal("partials/rules-and-alerts/add_rule_subscribers.html",T,"gb-add-edit-subscribers",!0,"static"),setTimeout(function(){T.info.autocomplete(document.getElementById("searchField"),T.info.emailList)},2e3),T.info.subloading=!1},T.loadSubscribers=function(){T.info.searchEmailText?T.info.showSubList=T.info.subscriberObj.filter(function(e){return-1<e.label.indexOf(T.info.searchEmailText)}):T.info.showSubList=T.info.subscriberObj},T.checkemail=function(e){13!=e.keyCode&&32!=e.keyCode||(T.info.re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,T.info.re.test(T.info.emailText)&&(T.info.subscriptionEmailList.includes(T.info.emailText)||(T.info.subscriptionEmailList.unshift(T.info.emailText),T.info.subscriberObj.unshift({label:T.info.emailText,selected:!1}),T.info.emailText="",T.loadSubscribers())))},T.removeFromSubscriptionList=function(t){T.info.subloading=!0,T.info.subscriptionEmailList=T.info.subscriptionEmailList.filter(function(e){return e!=t.label}),T.info.subscriberObj=T.info.subscriberObj.filter(function(e){return e.label!=t.label}),T.loadSubscribers(),T.info.subloading=!1},T.getSelectedSubs=function(){for(var e=!1,t=0;t<T.info.subscriberObj.length;t++)if(T.info.subscriberObj[t].selected){e=!0;break}return e},T.showBulkRemoveBtn=function(){T.info.subBulkRemoveBtn=T.getSelectedSubs()},T.bulkRemoveSubscriers=function(){T.info.subloading=!0,T.info.subscriptionEmailList=T.info.subscriberObj.reduce(function(e,t){return 0==t.selected&&e.push(t.label),e},[]),T.info.subscriberObj=T.info.subscriberObj.filter(function(e){return 0==e.selected}),T.loadSubscribers(),T.showBulkRemoveBtn(),T.info.subloading=!1},T.addSubscribersbtn=function(){T.info.subloading=!0,T.info.re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,T.info.re.test(T.info.emailText)&&(T.info.subscriptionEmailList.includes(T.info.emailText)||(T.info.subscriptionEmailList.unshift(T.info.emailText),T.info.subscriberObj.unshift({label:T.info.emailText,selected:!1}),T.info.emailText="",T.loadSubscribers())),T.info.subloading=!1},T.deleteSubscriptionFilterBulk=function(e,t){e={ruleId:e.rule_id,mps:c.mps,emailIds:t};d.deleteFilterAttributesMultiple(e).then(function(e){},function(e){console.error("Unable to load templates"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.rulesListMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}):T.info.rulesListMsg={type:"failure",msg:"Unable to load data Please contact "+T.supportEmail},u(e),T.info.rulesLoading=!1,T.info.sysidLoading=!1})},T.deleteSubscriptionFilter=function(e,t){t=t?{ruleIds:e,mps:c.mps}:{ruleIds:[e.rule_id],mps:c.mps},d.deleteFilterAttributes(t).then(function(e){},function(e){console.error("Unable to load templates"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(F.logError(Object.values(F.getVal("errorMsgs"))[1]),T.info.rulesListMsg={type:"failure",msg:F.getVal("rulesMsgs").h2_down_msg}):T.info.rulesListMsg={type:"failure",msg:"Unable to load data Please contact "+T.supportEmail},u(e),T.info.rulesLoading=!1,T.info.sysidLoading=!1})},T.tagFilterFunction=function(e){return e.selected},T.getAddUpdateTagPayload=function(e){return{associate:[{tag_ids:T.info.tagList.filter(T.tagFilterFunction).map(function(e){return e.tag_id}),rule_ids:[e]}],disassociate:[{}]}},T.checktagselectedstatus=function(){!T.info.subscription_enabled&&0<T.info.selectedTagsCount&&r.alertBox({msg:"Selected tags will be disassociated if auto-subscription is turned off."})},T.resetSelectedTags=function(){T.info.tagList.forEach(function(e){e.selected=!1}),T.updateTagSelectedCount()}}]).controller("AnalyticsCtrl",["$scope","$sce","$timeout","$filter","ModalService","RulesService","GlobalService","UserTrackingService","AppService","$rootScope",function(r,t,e,d,a,n,i,o,c,s){r.info={},r.info.application=i.getVal("navRules"),r.info.pageLoading=!1,r.analytics={},r.analytics.status=[],r.analytics.priorities=[],r.analytics.severities=[],r.analytics.creatorVsCategory=[],r.timefilter=i.getVal("alertTimeFilter"),r.customTimeMsg=i.getVal("analyticsCustomTimeMsg"),r.selectedTimeFilter=r.timefilter[0],r.maxToDate=moment.utc().format(),r.minFromDate=moment().subtract(30,"day").utc().format(),n.setSelectedTimeFilter(r.selectedTimeFilter),r.info.sessionTimedOut=!1,i.getVal("manufacturer"),i.getVal("product"),i.getVal("schema");function l(e){!r.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(r.info.sessionTimedOut=!0,a.sessionTimeout())}r.renderHtml=function(e){return t.trustAsHtml(e)},r.makeAnalyticsData=function(e){n.setAnalyticsLoaderWait(!1),n.newAnalyticsApi().then(function(e){r.analytics=e.data.Data,n.setAnalyticsData(r.analytics),n.setAnalyticsLoaderWait(!0)})},r.processCreatorVsCategoryData=function(){for(var t={},a=[],e=(r.analytics.creatorVsCategory.map(function(e){t[e.y]||(t[e.y]=[]),t[e.y].push(e.x),-1==a.indexOf(e.x)&&a.push(e.x)}),Object.keys(t)),n=0;n<e.length;n++)for(var i=t[e[n]],o=0;o<a.length;o++){var s=a[o];-1==i.indexOf(s)&&r.analytics.creatorVsCategory.push({x:s,y:e[n],value:0})}},r.analyticsUpdateSeverities=function(e){for(var t,a,n=!1,i=0;i<r.analytics.severities.length;i++)if((t=r.analytics.severities[i]).name==e.severity){t.count++,t.details.push(e),n=!0;break}n||((a={}).name=e.severity,a.count=1,a.details=[e],r.analytics.severities.push(angular.copy(a)))},r.analyticsUpdatePriorities=function(e){for(var t,a,n=!1,i=0;i<r.analytics.priorities.length;i++)if((t=r.analytics.priorities[i]).name==e.priority){t.count++,t.details.push(e),n=!0;break}n||((a={}).name=e.priority,a.count=1,a.details=[e],r.analytics.priorities.push(angular.copy(a)))},r.analyticsUpdateStatus=function(e){for(var t,a,n=!1,i=0;i<r.analytics.status.length;i++)if((t=r.analytics.status[i]).name==e.status){t.count++,t.details.push(e),n=!0;break}n||((a={}).name=e.status,a.count=1,a.details=[e],r.analytics.status.push(angular.copy(a)))},r.analyticsUpdateCreatorVsCategory=function(e){for(var t,a=!1,n=0;n<r.analytics.creatorVsCategory.length;n++)if((t=r.analytics.creatorVsCategory[n]).x==e.created_by&&t.y==e.category){t.value++,a=!0;break}a||r.analytics.creatorVsCategory.push({x:e.created_by,y:e.category,value:1})},r.analyticsUpdateAlertsTriggeredBySeverity=function(e){for(var t,a,n=!1,i=0;i<r.analytics.severities.length;i++)if((t=r.analytics.severities[i]).name==e.severity){t.count++,t.details.push(e),n=!0;break}n||((a={}).name=e.severity,a.count=1,a.details=[e],r.analytics.severities.push(angular.copy(a)))};i=n.getRulesList();i&&r.makeAnalyticsData(i),r.alertsGraphTimeFilterChange=function(e){r.selectedTimeFilter=e,n.setSelectedTimeFilter(r.selectedTimeFilter),"Custom filter"!=e.label&&r.applyTimeFilter(),r.trackUser("Alert Analtics","TimeFilter change",{Timefilter:e})},r.applyTimeFilter=function(){r.trackUser("Alert Analtics","TimeFilter change",{Timefilter:r.selectedTimeFilter}),s.$broadcast("analytics-timefilter-changes",r.selectedTimeFilter)},r.trackUser=function(e,t,a){a=JSON.stringify(a);o.standard_user_tracking(r.info.application,e,t,a).then(function(e){},l)}}]).controller("ManageAPITemplateCtrl",["$scope","$sce","$timeout","$filter","ngTableParams","RulesService","GlobalService","ModalService","UserTrackingService","AppService",function(n,t,e,i,a,o,s,r,l,c){for(var u in n.info={},n.info.application=s.getVal("navRules"),n.info.filter={},n.info.successMsg="",n.info.errorMsg="",n.info.sessionTimedOut=!1,n.columns=i("filter")(s.getVal("APItemplatesColumns"),{enabled:!0}),n.info.initialSortField=s.getVal("templatesSortField"),n.columns)n.info[n.columns[u].field]="";function d(e){!n.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(n.info.sessionTimedOut=!0,r.sessionTimeout())}n.info.initialSorting={},n.info.initialSorting[n.info.initialSortField]="desc",n.info.page={total:0,current:1,pages:0,count:10,sortField:n.info.initialSortField+"desc"},n.info.templatesLoading=!0,n.info.pageLoading=!0,n.apiTempIdlist=[],n.templatesList=[],n.multiDelobj={},n.apiTemplateIds=[],n.showDeleteList=[],n.ignoreDeleteList=[],n.mps=s.getVal("manufacturer")+"/"+s.getVal("product")+"/"+s.getVal("schema"),n.populateTable=function(){n.tableParams=new a({page:1,count:n.info.page.count,sorting:n.info.initialSorting},{total:n.templatesList.length,getData:function(e,t){var a=t.sorting()?i("orderBy")(n.templatesList,t.orderBy()):n.templatesList,a=i("filterTemplates")(a,n.info.filter);t.total(a.length),n.info.page.total=a.length,n.info.page.pages=Math.ceil(n.info.page.total/n.info.page.count),e.resolve(a.slice((t.page()-1)*t.count(),t.page()*t.count()))}})},n.reloadTemplates=function(){o.getAPITemplates().then(function(e){var t=e.data.Data;o.getAPIConfigTemplates().then(function(e){n.alertConfigList=e.data.Data,n.combinedData=t.map(function(t){return Object.assign(t,n.alertConfigList.find(function(e){return e.apiConfigId==t.apiConfigId}))}),n.templatesList=n.combinedData,n.clearAppliedFilters(),n.info.page.current=1,n.tableParams.reload(),n.tableParams.page(1),n.info.templatesLoading=!1,o.setAPITemplatesList(n.templatesList),n.info.rulesList=o.getRulesList(),n.setTemplatesLabelMap(),n.showDeleteList=[]})},function(e){n.templatesList="",n.clearAppliedFilters(),n.info.page.current=1,n.tableParams.reload(),n.tableParams.page(1),n.info.templatesLoading=!1,e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(s.logError(Object.values(s.getVal("errorMsgs"))[1]),n.info.errorMsg=s.getVal("rulesMsgs").h2_down_msg):""==n.info.errorMsg?n.info.errorMsg=s.getVal("rulesMsgs").temp_load_failed:n.info.errorMsg+="<br>"+s.getVal("rulesMsgs").temp_load_failed,d(e)})},n.clearMessage=function(){n.info.templatesLoading||(n.info.successMsg="",n.info.errorMsg="",n.info.addTemplateMsg={})},o.getAPITemplates().then(function(e){n.templatesData=e.data.Data,o.getAPIConfigTemplates().then(function(e){n.alertConfigList=e.data.Data,n.combinedData=n.templatesData.map(function(t){return Object.assign(t,n.alertConfigList.find(function(e){return e.apiConfigId==t.apiConfigId}))}),n.templatesList=n.combinedData,n.populateTable(),n.info.templatesLoading=!1,o.setAPITemplatesList(n.templatesList),n.info.rulesList=o.getRulesList(),n.setTemplatesLabelMap()})},function(e){n.templatesList="",n.populateTable(),n.info.templatesLoading=!1,console.error("Error loading templates list"),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(s.logError(Object.values(s.getVal("errorMsgs"))[1]),n.info.errorMsg=s.getVal("rulesMsgs").h2_down_msg):""==n.info.errorMsg?n.info.errorMsg=s.getVal("rulesMsgs").temp_load_failed:n.info.errorMsg+="<br>"+s.getVal("rulesMsgs").temp_load_failed,d(e)}),n.setTemplatesLabelMap=function(){for(var e={},t=0;t<n.templatesList.length;t++)e[n.templatesList[t].template_name]=!0;o.setTemplatesLabelMap(e)},n.changePageSize=function(){n.info.page.count=parseInt(n.info.page.count),n.tableParams.count(n.info.page.count),n.info.page.pages=Math.ceil(n.info.page.total/n.info.page.count),n.info.page.current>n.info.page.pages&&(n.info.page.current=n.info.page.pages,n.tableParams.page(n.info.page.current))},n.nextPage=function(){n.info.page.current<n.info.page.pages&&(n.info.page.current+=1,n.tableParams.page(n.info.page.current))},n.prevPage=function(){1<n.info.page.current&&(--n.info.page.current,n.tableParams.page(n.info.page.current))},n.firstPage=function(){1!=n.info.page.current&&(n.info.page.current=1,n.tableParams.page(n.info.page.current))},n.lastPage=function(){n.info.page.current!=n.info.page.pages&&(n.info.page.current=n.info.page.pages,n.tableParams.page(n.info.page.current))},n.checkTemplatesSelection=function(){for(var e in n.templatesList)if(!n.templatesList[e].selected)return void(n.info.selectAll=!1);n.info.selectAll=!0},n.checkSelectAll=function(){if(n.info.selectAll)for(var e=0;e<n.templatesList.length;e++)n.templatesList[e].selected=!0;else for(e=0;e<n.templatesList.length;e++)delete n.templatesList[e].selected},n.checkTemplateSelected=function(){if(n.tableParams&&i("filter")(n.tableParams.data,{selected:!0}).length)return!0;return!1},n.addNewTemplate=function(){n.info.templatesLoading=!0,o.setTemplateMode("new"),n.$parent.changeCurrentPage("add_edit_API_template")},n.editTemplate=function(e){n.info.templatesLoading=!0,o.setTemplateMode("edit",e),n.$parent.changeCurrentPage("add_edit_API_template")},n.deleteAPITemplate=function(e){n.filteredapiTempIdlist.includes(e.apiTemplateId)?r.alertBox({msg:s.getVal("rulesMsgs").API_temp_del_rule_associated}):(n.delTemplate=e,n.msg=s.getVal("rulesMsgs").temp_del_single[0]+e.apiTemplateName+s.getVal("rulesMsgs").temp_del_single[1],n.modal=r.openModal("partials/rules-and-alerts/delete_template.html",n,!1,"static"))},n.deleteTemplateConfirm=function(){var t=n.delTemplate,a=(n.info.templatesLoading=!0,n.mps=s.getVal("manufacturer")+"/"+s.getVal("product")+"/"+s.getVal("schema"),{});a.apiTemplateId=t.apiTemplateId,a.mps=n.mps,o.deleteAPITemplate(a).then(function(e){l.standard_user_tracking(n.info.application,"Manage API Template","delete",JSON.stringify(a)).then(function(e){},d),n.reloadTemplates(),""==n.info.successMsg?n.info.successMsg=s.getVal("rulesMsgs").temp_del_success[0]+t.apiTemplateName+s.getVal("rulesMsgs").temp_del_success[1]:n.info.successMsg+="<br>"+s.getVal("rulesMsgs").temp_del_success[0]+t.apiTemplateName+s.getVal("rulesMsgs").temp_del_success[1]},function(e){console.error("Unable to delete "+t.template_name),n.info.templatesLoading=!1,e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(s.logError(Object.values(s.getVal("errorMsgs"))[1]),n.info.errorMsg=s.getVal("rulesMsgs").h2_down_msg):""==n.info.errorMsg?n.info.errorMsg=s.getVal("rulesMsgs").temp_del_failed[0]+t.template_name+s.getVal("rulesMsgs").temp_del_failed[1]:n.info.errorMsg+="<br>"+s.getVal("rulesMsgs").temp_del_failed[0]+t.template_name+s.getVal("rulesMsgs").temp_del_failed[1],d(e)})},n.deleteSelectedTemplates=function(){n.selectedTemplates=i("filter")(n.tableParams.data,{selected:!0});n.selectedTemplates.filter(function(e){n.filteredapiTempIdlist.includes(e.apiTemplateId)||(n.showDeleteList.push(e),n.apiTemplateIds.push(e.apiTemplateId))});if(0!=n.showDeleteList.length){for(var e="<br>",t=0;t<n.selectedTemplates.length;t++)t!=n.selectedTemplates.length-1?e+="<strong>"+n.selectedTemplates[t].apiTemplateName+"<strong>, ":e+="<strong>"+n.selectedTemplates[t].apiTemplateName+"<strong>";n.msg=s.getVal("rulesMsgs").temp_del_multiple+e,n.modal=r.openModal("partials/rules-and-alerts/delete_api_template_multiple.html",n,!1,"static")}else r.alertBox({msg:s.getVal("rulesMsgs").map_temp_multiple_Del_none})},n.deleteSelectedTemplatesConfirm=function(){n.info.templatesLoading=!0,n.multiDelobj.apiTemplateIds=n.apiTemplateIds,n.multiDelobj.mps=n.mps,o.deleteAPITemplateMultiple(n.multiDelobj).then(function(e){n.reloadTemplates(),""==n.info.successMsg?n.info.successMsg=s.getVal("rulesMsgs").temp_del_success[0]+s.getVal("rulesMsgs").temp_del_success[1]:n.info.successMsg+="<br>"+s.getVal("rulesMsgs").temp_del_success[0]+s.getVal("rulesMsgs").temp_del_success[1],l.standard_user_tracking(n.info.application,"Manage API Template","delete",JSON.stringify(n.multiDelobj)).then(function(e){},d),n.info.selectAll=!1})},n.callDeleteTemplate=function(t,a){o.deleteTemplate(t.template_id).then(function(e){n.info.doneDeletions++,n.info.deletedTemplates.push(t.template_name),n.info.doneDeletions==a&&(l.standard_user_tracking(n.info.application,"Manage Template","multiple delete","["+n.info.deletedTemplates.toString()+"]").then(function(e){},d),n.reloadTemplates()),""==n.info.successMsg?n.info.successMsg=s.getVal("rulesMsgs").temp_del_success[0]+t.template_name+s.getVal("rulesMsgs").temp_del_success[1]:n.info.successMsg+="<br>"+s.getVal("rulesMsgs").temp_del_success[0]+t.template_name+s.getVal("rulesMsgs").temp_del_success[1]},function(e){console.error("Unable to delete"),n.info.doneDeletions++,n.info.doneDeletions==a&&(n.info.deletedTemplates.length&&l.standard_user_tracking(n.info.application,"Manage Template","multiple delete","["+n.info.deletedTemplates.toString()+"]").then(function(e){},function(e){}),n.reloadTemplates()),e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(s.logError(Object.values(s.getVal("errorMsgs"))[1]),n.info.errorMsg=s.getVal("rulesMsgs").h2_down_msg):""==n.info.errorMsg?n.info.errorMsg=s.getVal("rulesMsgs").temp_del_failed[0]+t.template_name+s.getVal("rulesMsgs").temp_del_failed[1]:n.info.errorMsg+="<br>"+s.getVal("rulesMsgs").temp_del_failed[0]+t.template_name+s.getVal("rulesMsgs").temp_del_failed[1],d(e)})},n.searchTemplate=function(e){""!=n.info[e]?n.info.filter[e]=n.info[e]:n.info.filter[e]&&delete n.info.filter[e],n.tableParams.reload(),n.info.page.current>n.info.page.pages&&(0==n.info.page.pages?n.info.page.current=1:n.info.page.current=n.info.page.pages,n.tableParams.page(n.info.page.current))},n.sortColumn=function(e){"INPUT"!=document.activeElement.tagName&&"BUTTON"!=document.activeElement.tagName&&(n.tableParams.sorting(e,n.tableParams.isSortBy(e,"asc")?"desc":"asc"),n.info.page.sortField=e+(n.tableParams.isSortBy(e,"asc")?"asc":"desc"))},n.clearAppliedFilters=function(){if(0!=Object.keys(n.info.filter).length){for(var e in n.columns)delete n.columns[e].filterString;for(var e in n.columns)n.info[n.columns[e].field]="";n.info.filter={},n.tableParams.reload(),n.info.page.current=1,n.tableParams.page(n.info.page.current)}n.info.page.sortField!=n.info.initialSortField+"desc"&&(n.tableParams.sorting(n.info.initialSortField,"desc"),n.info.page.sortField=n.info.initialSortField+"desc")},n.checkAppliedFilters=function(){var e=!1;return!(!(e=0!=Object.keys(n.info.filter).length||e)&&n.info.page.sortField==n.info.initialSortField+"desc")},n.renderHtml=function(e){return t.trustAsHtml(e)},n.info.addTemplateMsg=o.getApiTemplateAddedMessage(),n.rulesList=o.getRulesList();n.rulesList.filter(function(e){e.api_template_id&&n.apiTempIdlist.push(e.api_template_id)});n.filteredapiTempIdlist=n.apiTempIdlist.filter(function(e,t,a){return t==a.indexOf(e)}),e(function(){o.setApiTemplateAddedMessage({})},2e3),n.emptySelectedList=function(){n.showDeleteList=[]}}]).controller("AddEditAPITemplateCtrl",["$scope","$sce","$timeout","$filter","ModalService","RulesService","GlobalService","UserTrackingService","AppService",function(a,t,u,e,n,o,s,r,f){a.info={},a.info.application=s.getVal("navRules"),a.info.templateAdded=!1,a.info.addTemplateMsg={},a.info.sessionTimedOut=!1,a.sectionsColumnLabelMap={},a.info.scope="row",a.alertConfigList="",a.info.lastElementFocused=null,a.addApiTemplate={apiTemplateName:"",apiConfigId:"",apiPayload:""};var l=s.getVal("manufacturer");s.getVal("product"),s.getVal("schema");function d(e){!a.info.sessionTimedOut&&e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/timeout/)&&(a.info.sessionTimedOut=!0,n.sessionTimeout())}a.sectionAttributeLabelList=o.getSectionsColumnLabelForManageAPI(),a.showGlobAttrib=!0,a.nameBeforeEdit="",a.populateAddTemplate=function(){a.addApiTemplate.mps=s.getVal("manufacturer")+"/"+s.getVal("product")+"/"+s.getVal("schema"),a.addApiTemplate.pageLabel="Add Template",a.addApiTemplate.apiTemplateName="",a.addApiTemplate.apiConfigId="select",a.addApiTemplate.apiPayload="",a.setSavedMode()},a.populateEditTemplate=function(){a.nameBeforeEdit=o.getTemplateMode().data.apiTemplateName,a.addApiTemplate.pageLabel="Edit Template - "+o.getTemplateMode().data.apiTemplateName,a.addApiTemplate.mps=s.getVal("manufacturer")+"/"+s.getVal("product")+"/"+s.getVal("schema"),a.addApiTemplate.apiTemplateName=o.getTemplateMode().data.apiTemplateName,a.addApiTemplate.apiConfigId=o.getTemplateMode().data.apiConfigId,a.addApiTemplate.apiPayload=o.getTemplateMode().data.apiPayload,a.addApiTemplate.apiTemplateId=o.getTemplateMode().data.apiTemplateId,a.currentKeyLabel=o.getTemplateMode().data.apiAuthKey,a.setSavedMode()},a.setSavedMode=function(){o.setAPITemplateSavedStatus(!1)},a.setUnsavedMode=function(){o.setAPITemplateSavedStatus(!0)},o.getTemplateMode()&&"edit"==o.getTemplateMode().mode?(a.populateEditTemplate(),a.info.pageLoading=!1):a.populateAddTemplate(),a.addNewTemplate=function(){o.setTemplateMode("new"),a.info.templateAdded=!1,a.info.addTemplateMsg={},a.populateAddTemplate()},o.getAPIConfigTemplates().then(function(e){a.alertConfigList=e.data.Data}),a.saveTemplate=function(){a.validateTemplate()&&(o.getTemplateMode()&&"edit"==o.getTemplateMode().mode?(a.info.pageLoading=!0,o.editAPITemplateCall(a.addApiTemplate).then(function(e){a.info.addTemplateMsg={type:"success",msg:s.getVal("rulesMsgs").add_template_success},o.setApiTemplateAddedMessage(a.info.addTemplateMsg),a.setSavedMode(),a.$parent.changeCurrentPage("manage_API_template"),r.standard_user_tracking(a.info.application,"Add_Edit template","edit",JSON.stringify(a.addApiTemplate)).then(function(e){}),a.info.templateAdded=!0},function(e){e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(s.logError(Object.values(s.getVal("errorMsgs"))[1]),a.info.addTemplateMsg={type:"failure",msg:s.getVal("rulesMsgs").h2_down_msg}):a.info.addTemplateMsg={type:"failure",msg:s.getVal("rulesMsgs").add_template_fail},a.info.templateAdded=!1,a.info.pageLoading=!1,d(e)})):(a.info.pageLoading=!0,delete a.addApiTemplate.pageLabel,o.addAPITemplateCall(a.addApiTemplate).then(function(e){a.info.addTemplateMsg={type:"success",msg:s.getVal("rulesMsgs").add_template_success},o.setApiTemplateAddedMessage(a.info.addTemplateMsg),a.setSavedMode(),a.$parent.changeCurrentPage("manage_API_template"),r.standard_user_tracking(a.info.application,"Add_Edit template","add",JSON.stringify(a.addApiTemplate)).then(function(e){},d),a.info.templateAdded=!0},function(e){e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(s.logError(Object.values(s.getVal("errorMsgs"))[1]),a.info.addTemplateMsg={type:"failure",msg:s.getVal("rulesMsgs").h2_down_msg}):a.info.addTemplateMsg={type:"failure",msg:s.getVal("rulesMsgs").add_template_fail},a.info.templateAdded=!1,a.info.pageLoading=!1,d(e)})))},a.setKeyName=function(){var e=a.alertConfigList.filter(function(e){return e.apiConfigId==a.addApiTemplate.apiConfigId});a.currentKeyLabel=e[0].apiAuthKey},a.validateTemplate=function(){var e=[];if(a.info.apiTemplateList=o.getAPITemplatesList(),/^\s*$/.test(a.addApiTemplate.apiTemplateName))n.alertBox({msg:"Template Name"+s.getVal("rulesMsgs").temp_field_blank});else{if(o.getTemplateMode()&&"new"!=o.getTemplateMode().mode?a.nameBeforeEdit!=a.addApiTemplate.apiTemplateName&&(e=a.info.apiTemplateList.filter(function(e){return e.apiTemplateName==a.addApiTemplate.apiTemplateName})):null!=a.info.apiTemplateList&&a.info.apiTemplateList&&(e=a.info.apiTemplateList.filter(function(e){return e.apiTemplateName==a.addApiTemplate.apiTemplateName})),0<e.length)return n.alertBox({msg:s.getVal("rulesMsgs").duplicateTemplateName}),!1;if(/^\s*$/.test(a.addApiTemplate.apiConfigId)||"select"==a.addApiTemplate.apiConfigId)n.alertBox({msg:s.getVal("rulesMsgs").baseTemplateEmpty});else{if(!/^\s*$/.test(a.addApiTemplate.apiPayload)){if(a.showGlobAttrib){var t=a.addApiTemplate.apiPayload.match(/#\w+/gim);if(console.log(t),!t)return void n.alertBox({msg:"The Payload must contain altleast one global attribute."});if(t.filter(function(e,t,a){return a.indexOf(e)==t}),t)for(i=0;i<t.length;i++)if(-1==a.info.globalAtrributeValues.indexOf(t[i]))return void n.alertBox({msg:"The attribute <strong>&nbsp;"+t[i]+"</strong>&nbsp; is Invalid."})}return!0}n.alertBox({msg:"Payload Data"+s.getVal("rulesMsgs").temp_field_blank})}}},a.renderHtml=function(e){return t.trustAsHtml(e)};var c=angular.copy(s.getVal("templateConstants").common),e=(a.info.commonConstants=e("filter")(c,{enabled:!0}),a.info.customerConstants=e("filter")(c[l],{enabled:!0}),null!=a.info.customerConstants?a.info.templateConstants=new Array(a.info.commonConstants.concat(a.info.customerConstants)):a.info.templateConstants=a.info.commonConstants,a.rawconstants=a.info.templateConstants,a.info.templateConstants.forEach(function(e){e.value="#"+e.value.replace(/{|}/gm,"")}),a.info.templateConstants.map(function(e){return e.value}));a.info.globalAtrributeList=o.getGlobalAttribArr(),0===Object.keys(a.info.globalAtrributeList).length&&a.info.globalAtrributeList.constructor===Object?(a.showGlobAttrib=!1,a.info.globalAtrributeValues=e):a.info.globalAtrributeValues=Object.values(a.info.globalAtrributeList).concat(e)}]).controller("apiAdminConfigCtrl",["$scope","$sce","$timeout","$filter","ModalService","RulesService","GlobalService","UserTrackingService","AppService","$interval",function(a,e,t,n,i,o,s,r,l,d){a.info={},a.info.currentPage="template",a.info.showMsg=!1,a.info.application=s.getVal("navRules"),a.info.pageLoading=!0,a.info.templateAdded=!1,a.info.addTemplateMsg={},a.info.sessionTimedOut=!1,a.showimg=!1,a.info.successMsg="",a.info.errorMsg="";s.getVal("manufacturer"),s.getVal("product"),s.getVal("schema");a.configTableData=[],a.userplacehld="Username",a.userpassplacehld="Password",a.apiConfigPost={apiConfigName:"",apiAuthType:"PWD",apiHeaders:"",apiUrl:"",apiAuthKey:"",apiAuthPass:"",apiRequestType:"POST",apiTimeout:3,apiRetries:3},a.changeplaceholders=function(){"PWD"==a.apiConfigPost.apiAuthType?(a.userplacehld="Username",a.userpassplacehld="Password"):(a.userplacehld="Auth Key Label",a.userpassplacehld="Auth Key Value")},a.populateConfigTable=function(){a.loadListPage()},a.changePage=function(e){a.info.pageLoading=!0,"register"==e&&(a.resetForm(),a.$parent.changeCurrentPage("api_admin_config_register")),"edit"==e&&a.$parent.changeCurrentPage("api_admin_config_register"),a.info.currentPage=e,a.info.pageLoading=!1},a.imInregisterPage=function(){return"register"==a.info.currentPage||"edit"==a.info.currentPage},a.imInListPage=function(){return"list"==a.info.currentPage},a.imInAddTemplatePage=function(){return"template"==a.info.currentPage},a.resetForm=function(){a.apiConfigPost={apiConfigName:"",apiAuthType:"PWD",apiHeaders:"",apiUrl:"",apiAuthKey:"",apiAuthPass:"",apiRequestType:"POST",apiTimeout:3,apiRetries:3}},a.addEditApiConfig=function(){a.validateConfigTemplate()&&(a.info.pageLoading=!0,"edit"==a.info.currentPage?o.editAPIConfigTemplate(a.apiConfigPost).then(function(e){a.info.addTemplateMsg={type:"success",msg:s.getVal("rulesMsgs").add_template_success},a.populateConfigTable(),a.$parent.changeCurrentPage("api_admin_config"),r.standard_user_tracking(a.info.application,"API config","Update",JSON.stringify(a.apiConfigPost)).then(function(e){})},function(e){e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(s.logError(Object.values(s.getVal("errorMsgs"))[1]),a.info.addTemplateMsg={type:"failure",msg:s.getVal("rulesMsgs").h2_down_msg}):a.info.addTemplateMsg={type:"failure",msg:s.getVal("rulesMsgs").add_template_fail},a.info.pageLoading=!1}):o.addAPIConfigTemplate(a.apiConfigPost).then(function(e){a.info.addTemplateMsg={type:"success",msg:s.getVal("rulesMsgs").add_template_success},a.populateConfigTable(),a.$parent.changeCurrentPage("api_admin_config"),r.standard_user_tracking(a.info.application,"API config","Add",JSON.stringify(a.apiConfigPost)).then(function(e){})},function(e){e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(s.logError(Object.values(s.getVal("errorMsgs"))[1]),a.info.addTemplateMsg={type:"failure",msg:s.getVal("rulesMsgs").h2_down_msg}):a.info.addTemplateMsg={type:"failure",msg:s.getVal("rulesMsgs").add_template_fail},a.info.pageLoading=!1}))},a.editConfig=function(e){e.apiAuthPass||(e.apiAuthPass=""),e.apiTimeout=3,e.apiRetries=3,a.apiConfigPost=e,a.changePage("edit")},a.deleteConfigTemplateModal=function(e){a.delTemplate=e,a.msg=s.getVal("rulesMsgs").admin_config_temp_del_single[0]+"<strong>"+e.apiConfigName+"</strong>"+s.getVal("rulesMsgs").temp_del_single[1],a.modal=i.openModal("partials/rules-and-alerts/delete_api_config_template.html",a,!1,"static")},a.deleteConfig=function(){a.configidarr.includes(a.delTemplate.apiConfigId)?i.alertBox({msg:s.getVal("rulesMsgs").admin_config_temp_associated[0]+a.delTemplate.apiConfigName+s.getVal("rulesMsgs").admin_config_temp_associated[1]+a.delTemplate.apiConfigName+s.getVal("rulesMsgs").admin_config_temp_associated[2]}):(a.info.pageLoading=!0,o.deleteAPIConfigTemplate(a.delTemplate.apiConfigId).then(function(e){a.info.addTemplateMsg={type:"success",msg:s.getVal("rulesMsgs").temp_del_success[0]+a.delTemplate.apiConfigName+s.getVal("rulesMsgs").temp_del_success[1]},a.populateConfigTable(),r.standard_user_tracking(a.info.application,"API config","Delete",a.delTemplate.apiConfigId).then(function(e){})},function(e){e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(s.logError(Object.values(s.getVal("errorMsgs"))[1]),a.info.addTemplateMsg={type:"failure",msg:s.getVal("rulesMsgs").h2_down_msg}):a.info.addTemplateMsg={type:"failure",msg:s.getVal("rulesMsgs").admin_config_temp_delete_fail},a.info.pageLoading=!1}))},a.loadListPage=function(){o.getAPIConfigTemplates().then(function(e){a.configTableData=e.data.Data,a.configTableData&&a.configTableData.length?a.changePage("list"):a.changePage("template"),a.info.pageLoading=!1},function(e){e.data&&e.data.hasOwnProperty("Msg")&&e.data.Msg.match(/Connection\srefused/)?(s.logError(Object.values(s.getVal("errorMsgs"))[1]),a.info.errorMsg=s.getVal("rulesMsgs").h2_down_msg):""==a.info.errorMsg?a.info.errorMsg=s.getVal("rulesMsgs").temp_load_failed:a.info.errorMsg+="<br>"+s.getVal("rulesMsgs").temp_load_failed,a.info.pageLoading=!1})},a.validateConfigTemplate=function(){if(/^\s*$/.test(a.apiConfigPost.apiConfigName))i.alertBox({msg:"Base Template Name"+s.getVal("rulesMsgs").temp_field_blank});else{var e;if("edit"==a.info.currentPage)return 0<a.configTableData.filter(function(e){return e.apiConfigName!=a.apiConfigPost.apiConfigName}).filter(function(e){return e.apiConfigName==a.apiConfigPost.apiConfigName}).length?void i.alertBox({msg:s.getVal("rulesMsgs").duplicateTemplateName}):!0;if(0<a.configTableData.filter(function(e){return e.apiConfigName==a.apiConfigPost.apiConfigName}).length)i.alertBox({msg:s.getVal("rulesMsgs").duplicateTemplateName});else if(/^\s*$/.test(a.apiConfigPost.apiHeaders))i.alertBox({msg:"Http Header"+s.getVal("rulesMsgs").temp_field_blank});else if(/^\s*$/.test(a.apiConfigPost.apiUrl))i.alertBox({msg:"Base URL"+s.getVal("rulesMsgs").temp_field_blank});else{if(/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(a.apiConfigPost.apiUrl)){if(/^\s*$/.test(a.apiConfigPost.apiAuthKey))return e="PWD"==a.apiConfigPost.apiAuthType?"Username"+s.getVal("rulesMsgs").temp_field_blank:"Auth Key Label"+s.getVal("rulesMsgs").temp_field_blank,void i.alertBox({msg:e});if("register"==a.info.currentPage)if(/^\s*$/.test(a.apiConfigPost.apiAuthPass))return e="PWD"==a.apiConfigPost.apiAuthType?"Password"+s.getVal("rulesMsgs").temp_field_blank:"Auth Key Value"+s.getVal("rulesMsgs").temp_field_blank,void i.alertBox({msg:e});return!0}i.alertBox({msg:s.getVal("rulesMsgs").invalidHttpUrl})}}},a.clearMessage=function(){a.info.templatesLoading||(a.info.successMsg="",a.info.errorMsg="",a.info.addTemplateMsg={})},a.info.apiTemplateList=o.getApiTemplateList(),null!=a.info.apiTemplateList&&(a.configidarr=[],a.info.apiTemplateList.filter(function(e){a.configidarr.push(e.apiConfigId)})),a.$on("broadPageChange",function(e,t){a.info.pageLoading=!0,a.loadListPage()}),a.loadListPage()}]),angular.module("gbApp.services.rules",[]).factory("RulesService",["$http","$location","$cookies","GlobalService","UserTrackingService",function(o,e,u,r,f){var t=null,a={},n=null,g=r.getVal("analyticsColor"),i=!1,s=null,l=null,d=null,c=void 0;return{ruleType:"supported",setSelectedTimeFilter:function(e){t=e},getSelectedTimeFilter:function(){return t},setAnalyticsData:function(e){a=e},getAnalytics:function(e){return e?a[e]:a},getAnalyticsColor:function(e){return g[e]},getRuleType:function(){return this.ruleType},setRuleType:function(e){this.ruleType=e},setAnalyticsLoaderWait:function(e){i=e},getAnalyticsLoaderWait:function(){return i},getRulesOwenrList:function(){var e=r.getVal("umsDomain");return o({url:e+"/customer/user/listrulecreator/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"GET"})},updateRuleOwnership:function(e){var t=r.getVal("infoserverDomain");return o({url:t+"/rules/change_owner/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"POST",data:e})},getSectionsAPI:function(){var e=r.getVal("infoserverDomain");return o({url:e+"/meta/sections/all/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"GET",cache:!0})},getSectionsFromAttrAPI:function(e){var t=r.getVal("infoserverDomain");return o({url:t+"/attribute/suggestion/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e,method:"GET"})},getSectionColumns:function(e){var t=r.getVal("infoserverDomain");return o({url:t+"/meta/columns/table_name/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e,method:"GET"})},loadExplorerRules:function(){this.loadExplorerData=!0},getloadExplorerRules:function(){return this.loadExplorerData},disableExplorerRules:function(){this.loadExplorerData=!1},getLogMoving:function(){return this.logMoving},setLogMoving:function(e){this.logMoving=e},setLastLogUploadTime:function(e){this.lastLogUploadTime=e},getLastLogUploadTime:function(){return this.lastLogUploadTime},getAttributes:function(){return this.attributes},setAttributes:function(e){this.attributes=e},getAttributesLoaded:function(){return this.attributesLoaded},setAttributesLoaded:function(e){this.attributesLoaded=e},getAllRules:function(e){var t=r.getVal("infoserverDomain");return o({url:t+"/rules/list/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e,method:"GET"})},getStagingRulesData:function(e){var t=r.getVal("infoserverDomain");return o({url:t+"/rules/stage/list/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"POST",data:{rule_id:e}})},getRulesLabelsList:function(){var e=r.getVal("infoserverDomain");return o({url:e+"/rules/labels/list/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"GET"})},getRuleMode:function(){return this.ruleMode},setRuleMode:function(e,t){this.ruleMode="new"==e?{mode:"new"}:{mode:"edit",data:t}},modifyRuleData:function(e){this.ruleMode.modifiedData=e},enableRule:function(e,t){var a=r.getVal("infoserverDomain");return o({url:a+"/rules/enable/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e,method:"POST",data:{comments:t}})},enableStageRule:function(e){return o({url:this.getStagingDomain()+"/rules/stage/enable/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e,method:"POST"})},disableRule:function(e,t){var a=r.getVal("infoserverDomain");return o({url:a+"/rules/disable/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e,method:"POST",data:{comments:t}})},editRule:function(e,t,a){var n=r.getVal("infoserverDomain");return o({url:n+"/rules/update/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e+"/"+a,method:"POST",data:t})},editStageRule:function(e){return o({url:this.getStagingDomain()+"/rules/stage/update/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e,method:"POST"})},addRule:function(e){var t=r.getVal("infoserverDomain");return o({url:t+"/rules/add/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"POST",data:e})},deleteRule:function(e,t,a){e={rule_ids:e,rule_status:t,api_template_ids:a},t=r.getVal("infoserverDomain");return o({url:t+"/rules/delete/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"POST",data:e})},getRulesList:function(){return this.rulesList},setRulesList:function(e){this.rulesList=e},getRulesLabelMap:function(){return this.rulesLabelMap},setRulesLabelMap:function(e){this.rulesLabelMap=e},getTestRuleData:function(){return this.testRuleData},setTestRuleData:function(e){this.testRuleData=e},getCategories:function(){var e=r.getVal("infoserverDomain");return o({url:e+"/rules/category/list/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"GET",headers:{"Cache-Control":"no-cache"}})},addCategory:function(e,t){e={category:e,category_description:t},t=r.getVal("infoserverDomain");return o({url:t+"/rules/category/add/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"POST",data:e})},deleteCategory:function(e){var t=r.getVal("infoserverDomain");return o({url:t+"/rules/category/delete/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e,method:"POST"})},updateCategory:function(e,t,a){t={category:t,category_description:a},a=r.getVal("infoserverDomain");return o({url:a+"/rules/category/update/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e,method:"POST",data:t})},getSeverities:function(){var e=r.getVal("infoserverDomain");return o({url:e+"/rules/severity/list/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"GET"})},getSeveritiesList:function(){return this.severitiesList},setSeveritiesList:function(e){this.severitiesList=e},getPriorities:function(){var e=r.getVal("infoserverDomain");return o({url:e+"/rules/priority/list/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"GET"})},getPrioritiesList:function(){return this.prioritiesList},setPrioritiesList:function(e){this.prioritiesList=e},getTemplates:function(){var e=r.getVal("infoserverDomain");return o({url:e+"/rules/email_template/list/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"GET"})},getTemplatesList:function(){return this.templatesList},setTemplatesList:function(e){this.templatesList=e},getTemplatesLabelMap:function(){return this.templatesLabelMap},setTemplatesLabelMap:function(e){this.templatesLabelMap=e},getTemplateMode:function(){return this.templateMode},setTemplateMode:function(e,t){this.templateMode="new"==e?{mode:"new"}:{mode:"edit",data:t}},deleteTemplate:function(e){var t=r.getVal("infoserverDomain");return o({url:t+"/rules/email_template/delete/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e,method:"POST"})},addTemplate:function(e,t,a,n){e={template_name:e,subject:t,body:a},t=r.getVal("infoserverDomain");return o({url:t+"/rules/email_template/add/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"POST",data:e})},editTemplate:function(e,t,a,n,i){t={template_name:t,subject:a,body:n},a=r.getVal("infoserverDomain");return o({url:a+"/rules/email_template/update/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e,method:"POST",data:t})},getStageBundles:function(){r.getVal("infoserverDomain");return o({url:this.getStagingDomain()+"/rules/stage/bundle/list/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"GET"})},insertRuleStaging:function(e){return o({url:this.getStagingDomain()+"/rules/stage/insert/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"POST",data:e})},getStagingRules:function(){return this.stagingRules},setStagingRules:function(e){this.stagingRules=e},getRuleSavedStatus:function(){return this.ruleSaved},setRuleSavedStatus:function(e){this.ruleSaved=e},getTemplateSavedStatus:function(){return this.templateSaved},setTemplateSavedStatus:function(e){this.templateSaved=e},insertBundleRuleAssociation:function(e){r.getVal("infoserverDomain");return o({method:"POST",url:this.getStagingDomain()+"/rules/stage/bundle/insert/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),data:e})},getBundleId:function(e){r.getVal("infoserverDomain");return o({method:"GET",url:this.getStagingDomain()+"/rules/stage/bundle_id/list/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e})},getTestResults:function(e,t){return o({method:"GET",url:this.getStagingDomain()+"/analytics/"+r.getVal("manufacturer")+"/"+e,timeout:t.promise})},checkfileUploadToLCPStatus:function(e){return o({method:"GET",url:this.getStagingDomain()+"/fileupload/stage/status/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e})},checkLCPStatus:function(){return o({method:"GET",url:this.getStagingDomain()+"/monitor/stage/lcp/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")})},getAllConfig:function(){return f.getAllConfig()},setStagingDomain:function(e){this.infoserverDomainStaging=e},getStagingDomain:function(){return this.infoserverDomainStaging},setStagingKeyspace:function(e){this.infoserverStagingKeyspace=e},getStagingKeyspace:function(){return this.infoserverStagingKeyspace},getTopTenRulesByAlerts:function(e,t){e=r.getVal("infoserverDomain")+"/analytics/top_n/rules/by_count/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+r.getVal("manufacturer")+"/"+e+"/"+t+"/10";return o({url:e,method:"GET"})},getAlertsTriggerBySeverity:function(e,t){e=r.getVal("infoserverDomain")+"/analytics/alerts/by_severity/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+r.getVal("manufacturer")+"/"+e+"/"+t;return o({url:e,method:"GET"})},getAlertsOfARule:function(e,t,a){t=r.getVal("infoserverDomain")+"/analytics/alerts/by_rule_id/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+r.getVal("manufacturer")+"/"+t+"/"+a+"/"+e;return o({url:t,method:"GET"})},getRulesNotTriggered:function(e,t){e=r.getVal("infoserverDomain")+"/analytics/rules/nontriggered/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+r.getVal("manufacturer")+"/"+e+"/"+t;return o({url:e,method:"GET"})},getCompleteAlertsCount:function(e,t){e=r.getVal("infoserverDomain")+"/analytics/alerts/by_date/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+r.getVal("manufacturer")+"/"+e+"/"+t;return o({url:e,method:"GET"})},setSelectedRuleForAnalytics:function(e){n=e},getSelectedRuleForAnalytics:function(){return n},setLogBundle:function(e){this.logBundles=e},getLogBundle:function(e){return this.logBundles},sendRulesWithLogvaultBundle:function(e){var t=this.getStagingDomain()+"/logvault/rules_testing/download/bundles/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema");return o({url:t,method:"POST",data:e})},newAnalyticsApi:function(){var e=r.getVal("infoserverDomain")+"/rules/analytics/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema");return o({url:e,method:"GET"})},getRuleDrillDetails:function(e){e=r.getVal("infoserverDomain")+"/rules/history/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e;return o({url:e,method:"GET"})},getAPITemplates:function(){var e=r.getVal("infoserverDomain")+"/rules/api_template/list/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema");return o({url:e,method:"POST"})},setApiTemplateList:function(e){this.apiTemplateList=e},getApiTemplateList:function(){return this.apiTemplateList},getAPIConfigTemplates:function(){var e=r.getVal("infoserverDomain")+"/rules/api_template/listconfig/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema");return o({url:e,method:"POST"})},deleteAPIConfigTemplate:function(e){e=r.getVal("infoserverDomain")+"/rules/api_template/deleteconfig/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e;return o({url:e,method:"POST"})},addAPIConfigTemplate:function(e){var t=r.getVal("infoserverDomain")+"/rules/api_template/addconfig/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema");return o({url:t,method:"POST",data:e})},editAPIConfigTemplate:function(e){var t=r.getVal("infoserverDomain")+"/rules/api_template/updateconfig/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema");return o({url:t,method:"POST",data:e})},setSectionsColumnLabelMap:function(e){s=e},getSectionsColumnLabelMap:function(){return s},setSectionsColumnLabelForManageAPI:function(e){l=e},getSectionsColumnLabelForManageAPI:function(){return l},getSectionsAndAttributePair:function(i){s=s||{};var e=[],t=null;if(!i.length)return e;for(var a=0;a<i.length;a++){if("{"==i[a]&&t||"}"==i[a]&&!t||a==i.length-1&&t&&"}"!=i[a]||a==i.length-1&&"{"==i[a])return[];if("{"==i[a]&&(t=a+1),"}"==i[a]&&t){var n=a,n=i.substring(t,n);if(!s.hasOwnProperty(n)&&(function(e){var t,a=i,n=a.indexOf("REGEX");if(-1==n)return!1;for(;0<=n;){if(t=$scope.parseToken(a,n,"(",")").length+n,n<e&&e<t)return!0;if(-1==(n=a.indexOf("REGEX",t)))return!1}return!1}(t)?r.getRulesLogicAlerts("rule_logic_invalid_regex_len_attr",n):function(e){var t,a=i,n=a.indexOf("LIKE");if(-1==n)return!1;for(;0<=n;){if(t=function(e,t,a,n){for(var i=e.length,o=0,s=0,r=0,s,l=e.indexOf("(",t),d;l<i;l++){switch(e[l]){case a:o++;break;case n:o--;break}if(o==0){r=l;break}}return e.substring(t,r+1)}(a,n,"{","}").length+n,n<e&&e<t)return!0;if(-1==(n=a.indexOf("LIKE",t)))return!1}return!1}(t)?r.getRulesLogicAlerts("rule_logic_invalid_like_curly_brace",n):r.getRulesLogicAlerts("rule_logic_invalid_attr",n)))return;e.push(n),t=null}}return e},addAPITemplateCall:function(e){var t=r.getVal("infoserverDomain");return o({url:t+"/rules/api_template/add/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"POST",data:e})},editAPITemplateCall:function(e){var t=r.getVal("infoserverDomain");return o({url:t+"/rules/api_template/update/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"POST",data:e})},deleteAPITemplate:function(e){var t=r.getVal("infoserverDomain");return o({url:t+"/rules/api_template/delete/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"POST",data:e})},deleteAPITemplateMultiple:function(e){var t=r.getVal("infoserverDomain");return o({url:t+"/rules/api_template/deletemultiple/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"POST",data:e})},getAPITemplatesList:function(){return this.templatesList},setAPITemplatesList:function(e){this.templatesList=e},setApiTemplateAddedMessage:function(e){this.templateAddedMsg=e},getApiTemplateAddedMessage:function(){return this.templateAddedMsg},setGlobalAttribArr:function(e){this.globalAttributes=e},getGlobalAttribArr:function(){return this.globalAttributes},getDrillDownData:function(t,e){var a=[],n="";return e.data&&e.data.name&&(n=e.data.name),angular.copy(this.getRulesList()).forEach(function(e){e[t]==n&&a.push(e)}),a},setshowAlertApiFeature:function(e){this.showAlertApiFeatureflag=e},getshowAlertApiFeature:function(){return this.showAlertApiFeatureflag},getAPITemplateSavedStatus:function(){return this.templateSaved},setAPITemplateSavedStatus:function(e){this.templateSaved=e},getRulesConstants:function(){return o({url:"../config/constants/rules_constants.json",method:"GET"})},getgroupdata:function(e){var t=r.getVal("clinsightFlag")||!1,o=e,s=this;return c?d=c:(d=r.getVal("groupedData")).forEach(function(e){"tags"==e.field&&(t||(e.multiselect=!1,e.enabled=!1,e.selected=!1)),e.data=[]}),o.forEach(function(e){d.forEach(function(a){var n,i;n="tags"==a.field||e[a.field]?angular.copy(e[a.field]):"",a.multiselect&&n&&("tags"==a.field&&e[a.field].length?(e[a.field].forEach(function(e){a.data.push(e)}),a.data=a.data.filter(function(e){return!this[e.tag_id]&&(this[e.tag_id]=!0)},Object.create(null))):a.data&&Array.isArray(a.data)||"tags"==a.field?a.data&&Array.isArray(a.data)&&0==a.data.length&&"tags"!=a.field?a.data.push(n):(i=!1,a.data.forEach(function(e,t){("tags"!=a.field&&"object"==typeof e&&e.label&&e.label.toUpperCase()===n.toUpperCase()||"tags"!=a.field&&"string"==typeof e&&e.toUpperCase()===n.toUpperCase())&&(i=!0)}),i||"tags"==a.field||a.data.push(n)):(a.data=[],a.data.push(n)))})}),d.forEach(function(e){if(e.multiselect){e.data.length||(e.enabled=!1);for(var t=e.data.length,a=0;a<t;a++){var n=angular.copy(e.data[a]),i={};"object"!=typeof n?i.label=n:i=n,e.data[a]=i}s.deleteDataWhichAreNotInFreshlist(e,e.data,e.field,o)}}),d},deleteDataWhichAreNotInFreshlist:function(e,t,a,n){for(var i=0;i<t.length;i++){for(var o=!1,s=0;s<n.length;s++)if("tags"==a&&t.length){if(n[s][a]&&-1!=n[s][a].map(function(e){return e.tag_name}).indexOf(t[i].label)){o=!0;break}}else if(t[i].label===n[s][a]){o=!0;break}o||(t.splice(i,1),e.expanded=!1)}},setFilterState:function(e){this.filterState=e},getFilterState:function(){return this.filterState},setStateGroupData:function(e){c=e},getStateGroupData:function(){return c},setInfoData:function(e){this.infoData=e},getInfoData:function(){return this.infoData},setPageState:function(e){this.pageState=e},getPageState:function(){return this.pageState},bulkUpdateRules:function(e){var t=r.getVal("infoserverDomain");return o({url:t+"/rules/bulk_update/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"POST",data:e})},singleSubscribeRule:function(e){var t=r.getVal("infoserverDomain");return o({url:t+"/rules/subscription/subscribe_user/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e,method:"POST"})},singleUnsubscribeRule:function(e){var t=r.getVal("infoserverDomain");return o({url:t+"/rules/subscription/unsubscribe_user/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+e,method:"POST"})},subscribeRule:function(e){var t=r.getVal("infoserverDomain");return o({url:t+"/rules/subscription/subscribe/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"POST",data:e})},unsubscribeRule:function(e){var t=r.getVal("infoserverDomain");return o({url:t+"/rules/subscription/unsubscribe/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"POST",data:e})},getallSubscriberList:function(){r.getVal("infoserverDomain");return o({url:"stat/getRuleSubscriptionAssociation.json",method:"GET"})},updateSubscription:function(e){var t=r.getVal("infoserverDomain");return o({url:t+"/rules/subscription/updatesubscription/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"POST",data:e})},getNonSsoUsers:function(){var e=r.getVal("umsDomain");return o({url:e+"/customer/user/list/"+r.getVal("manufacturer"),method:"GET"})},getSingleTestResult:function(e){var t=r.getVal("infoserverDomain");return o({method:"GET",url:t+"/analytics/"+r.getVal("manufacturer")+"/"+e,timeout:defer.promise})},getSysidList:function(e,t,a,n){r.getVal("umsDomain");n=r.getVal("umsDomain")+"/user/ec/system_info/list/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+encodeURIComponent(n)+"/"+e+"/"+t;return o({method:"POST",url:n,data:a})},getUnsubscribedSysids:function(e,t){e=r.getVal("umsDomain")+"/rules/alerts/filters/list/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"?ruleId="+e+"&user="+encodeURIComponent(t);return o({method:"GET",url:e})},getSysidColList:function(){var e=r.getVal("umsDomain"),e=(r.getVal("infoserverDomain"),e+"/bundle/system_cols_info/ec/list/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"));return o({method:"GET",url:e})},saveFilterAttributes:function(e){var t=r.getVal("umsDomain")+"/rules/alerts/filters/add_update/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema");return o({method:"POST",url:t,data:e})},deleteFilterAttributes:function(e){var t=r.getVal("umsDomain")+"/rules/alerts/filters/bulk_rules_delete/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema");return o({method:"POST",url:t,data:e})},bulkSubscribeUnsubscribe:function(e,t){var a=r.getVal("infoserverDomain");return o({url:a+"/rules/subscription/bulk_rules_subscription/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+t,method:"POST",data:e})},deleteFilterAttributesMultiple:function(e){var t=r.getVal("umsDomain")+"/rules/alerts/filters/bulk_users_delete/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema");return o({method:"POST",url:t,data:e})},getExcludedSysidDetails:function(e){var t=r.getVal("umsDomain"),t=(r.getVal("infoserverDomain"),t+"/bundle/available_system_info/ec/list/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"));return o({method:"POST",url:t,data:e})},getPredefinedTagList:function(){var e=r.getVal("infoserverDomain");return o({method:"GET",url:e+"/rules/tags/rules/list/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema")+"/"+u.username})},associateDisassociateTag:function(e){var t=r.getVal("infoserverDomain");return o({url:t+"/tags/associate/disassociate/rules/"+r.getVal("manufacturer")+"/"+r.getVal("product")+"/"+r.getVal("schema"),method:"POST",data:e})}}}]);