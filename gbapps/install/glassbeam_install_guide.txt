#####################################################################
#               GLASSBEAM
#   Installation and Configuration Guide
#   Glassbeam Platform Release 3.1.3, Revision 1.2
#####################################################################
#    Date of Publication: May 3, 2011
#     Copyright 2010 Glassbeam, Inc. 
#            CONFIDENTIAL
#     Glassbeam Web Site : www.glassbeam.com
#####################################################################

Version	Description	Date of Modification	Author
1.1	Initial Draft	03/05/2011		Samaresh.nath	
1.2	Revised		11/05/2011		Samaresh.nath	
1.3	Revised		16/05/2011		Dharani Kumar	

#####################################################################


TABLE OF CONTENTS

1)  INTRODUCTION
2)  SYSTEM PREPARATION FOR GLASSBEAM
3)  INSTALLATION STEPS FOR GLASSBEAM TAR BALL
	3.1)  Run NEW Installation
	3.2)  Run UPGRADE Installation
	3.3)  Create MySQL test DataBase
4)  STEPS TO INSTALL ANY MODULE MANUALLY
5)  INSTALLATION STEPS FOR VERTICA DATABASE
6)  INSTALLATION STEPS FOR VERTICA ODBC DRIVER
7)  CONFIGURATION SETTINGS
	7.1) CORE Configuration Changes
	7.2) UI Configuration Changes
8)  CREATING GLASSBEAM USER
9)  INSTALLING TORQUE (REQUIRED FOR NEW SCHEDULERS)
10) PATCH INSTALLS


#####################################################################


1) INTRODUCTION
 
This document details the Installation and configuration for the Glassbeam (v3.1.2a). It contains all the necessary instructions and verification steps for deploying Glassbeam product. Explains, how to prepare the machine before installing Glassbeam. Installation steps for Vertica database, Installation of Glassbeam application and Configuration setting.

#####################################################################

2) SYSTEM PREPARATION FOR GLASSBEAM

	(a) Complete RHEL 5 installed.
	(b) 64bit CPU architecture is recommended.
	(c) Make sure that the machine has the Perl version must be 5.8.8.
	    To check the perl version installed on the machine type below command
		
		$perl -v
		
	     You will get following output
		
		This is perl, v5.8.8 built for x86_64-linux-thread-multi

2.1) Follow the steps below if you are upgrading the Perl from older version to 5.8.8
	
	(i)  Login as root and Download the Perl 5.8.8. Under /usr/local/src directory.
	(ii) Follow the below steps :
		
		$ cd /usr/local/src/
		$ tar -zxvf perl-5.8.8.tar.gz
		$ cd perl-5.8.8
		$ ./Configure -de
		$ make && make test
		$ make install
		
	      If /usr/bin/perl exist then rename it
		
		$ mv /usr/bin/perl /usr/bin/perl_old

	      Point the /usr/bin/perl sym-link to the newer binary
		
		$ ln /usr/local/bin/perl5.8.8 /usr/bin/perl

2.2) Make sure that the /etc/hosts file includes all of the hosts that become 
part of the cluster. 
For example, if the hosts are named host01, host02, host03, and host04, the /etc/hosts file on each host should look like this

		127.0.0.1		localhost.localdomain localhost
		<10.163.0.36> 		host01
		<10.163.0.37> 		host02

Replace the example IP addresses shown here with the real ones. Do not remove the loopback address (127.0.0.1).

2.3) Make sure that the host identifies itself correctly. 
	For example, on host01:

	# /bin/hostname -f
	localhost.localdomain

localhost.localdomain is incorrect. In this case, you must set the hostname manually:

	# /bin/hostname host01
	# /bin/hostname -f
	host01

The command /bin/hostname host01 sets the hostname to host01 until system reboot.
Edit the /etc/sysconfig/network file to set HOSTNAME to host01:

HOSTNAME=host01

Ping the host. For example:

	# ping host01
		PING host01 (10.163.0.36) 56(84) bytes of data.
		64 bytes from host01 (10.163.0.36): icmp_seq=0 ttl=64 time=0.086 ms

2.4) Compare the ping command output to the hostname. 
The output of the hostname command must be identical to that of the ping command. 

2.5) Check that /etc/sysconfig/network contains the same hostname.

2.6) Verify the sudo config file for the wheel group.

2.7) Verify if python is available on all cluster hosts.

	# which python
	/usr/bin/python

If Python is not installed, browse to the Official Python Web site http://www.python.org/ and
Install Python on all hosts.

2.8) Run visudo (as root) to open /etc/sudoers file for editing , 
and make sure that the following line is commented:

	# Defaults    requiretty

and these lines are present in /etc/sudoers

	# Same thing without a password
	%wheel          ALL=(ALL)       NOPASSWD: ALL
	%glassbeam      ALL=(ALL)      NOPASSWD: ALL


2.9) Make sure that the following OS packages are already available in RHEL_5.3:

	All CPAN Perl Modules
	All Perl DBD modules
	All Perl DBI modules
	All XML packages
	XML-Parser-2.36
		XML-Simple-2.18
		XML-SemanticDiff-0.95
		Test-XML-0.08
	MExtUtils
	Xserver
	VNCServer
	Sendmail
	All MySql modules
	expat-devel 
	gcc compiler
	c++ compiler
	lex
	byacc
	autoconf
	automake
	make



################################################################################################


3) INSTALLATION STEPS FOR GLASSBEAM TAR BALL


NOTE : Vertica should be installed before installing glassbeam. Vertica shouldnot be running while installing glassbeam.
--> Download the tar ball from this link gb-release-3.1.2a-BUILD-1.2.tar.gz
--> Upload the tar ball bundle to the root directory
--> RUN THIS PACKAGE AS A ROOT USER
--> Untar the package by using this command 
	
	tar -zxf <tar ball>

--> Change directory to the gb-release-<release version>-BUILD-<n>.<n>
--> Inside the Package folder you will find lists of sub folders.
	Ui
	Tools
	Install
	Home-dbadmin
	Crontab
	Core

         ---------------------------------
The synatx and options avaliable to run INSTALL.sh are mentioned below:

Usage:  ./INSTALL.sh -i <NEW/UPGRADE> -l <1/0> 
        -i [NEW/UPGRADE] (mandatory)     < NEW - fresh install  or UPGRADE - upgrade previous installation >
        -l [0 or 1]      (optional)      < 1 to create mysql test databases- GBCustomer and GBCustomerTest >
		
        -----------------------------------

3.1) Run NEW Installation

Change directory to the install/bin directory, and then run the INSTALL.sh.

	# ./INSTALL.sh -i NEW

	-----------------------------------

3.2) Run UPGRADE Installation

Change directory to the install/bin directory, and then run the INSTALL.sh.

	# ./INSTALL.sh -i UPGRADE

	-----------------------------------

3.3) Create MySQL test Databases

if you also want the installer to create two test databases i.e GBcustomer and
GBCustomerTest then use the following option

	# ./INSTALL.sh -i NEW -l 1

Note that the test databases will be created only in "NEW" installation type.
Also if these databases exist already , then they will be dropped during installation,
and then recreated

The MySQL dump files which will be used to create test databases are:
	install/bin/GBCustomerTest.txt
	install/bin/GBCustomer.txt
	install/bin/dbadd_1.3.6.mysql

################################################################################################


4) STEPS TO INSTALL ANY MODULE MANUALLY

(i) 	Use following command to uncompress the package.
	
	tar   -zxf   package_name.tar.gz

(ii)	Open the directory created by uncompressing the package.
(iii)	Use following commands in listed order to install the module  
	
	./configure
	perl  Makefile.PL 
	make
	make test
	sudo make install

If configure file is not present in the directory , skip the first step ,
i.e. --->  ./configure
Be sure to run the "make install" command as root.

If any of the packages fail remove the entry from 
/root/gb-release-/install/bin/module-install.conf 

Start again with install command. 
After the completing the installation, install the failed packages manually.
Check the log files created in /root/gb-release-/install/bin/module-error-  for more information.


################################################################################################


5) INSTALLATION STEPS FOR VERTICA DATABASE

(i) Download the Vertica 4.1.7 from the following link 

	https://glassbeam.svn.cvsdude.com/gbplatform/trunk/vertica-installer/vertica_4.1.7/vertica-4.1.7-0.x86_64.RHEL5.rpm

(ii) Upload the vertica rpm to the root directory

(iii) Go to the directory /root/<vertica package> and do the following as root user:

	# rpm -Uvh vertica-4.1.7-0.x86_64.RHEL5.rpm

	# rpm  -e  vertica-4.1.7-0.x86_64.RHEL5.rpm

      This will give the following output

	Preparing...
	########################################### [100%]
	1:vertica
	########################################### [100%]


(iV) Use one of the following commands to run the installation script as root user:

	# /opt/vertica/sbin/install_vertica -s <10.163.0.36>  -r vertica-4.1.7-0.x86_64.RHEL5.rpm -u dbadmin
	
	*** Follow the instruction come out during the installations ***


NOTE :- Before running the AdminTools make sure that all the directories under /opt/vertica/ bin owned by the user dbadmin. 
If not able to log in as sudo su - dbadmin from gbprod (requesting password),
modify "#visudo file" to uncomment line as below as root:

	##Same thing without a password
	%wheel ALL=(ALL)             NOPASSWD:   ALL


(V) For the First time you log in as the Database Administrator and run the Vertica Administration Tools, it will ask you to "select licence file to install".
Just select the licence file path and press OK.

(vi) After installing the license file, when you invoke the adminTools, the following menu is shown.

	1	View Database Cluster State
	2	Connect to Database
	3	Start Database
	4 	Stop DataBase
	5	Restart Vertica on Host
	6	Configuration Menu
	7	Advanced Menu
	8	Help on using the Administration Tools
	E	Exit

 


(vii) Select the option 6 Configuration Menu and click ok. 

The following menu will appear which allows you to create a new database.

	1	Create Database
	2	Create Database Design
	3	Drop Database
	4	View Database
	5	Set Restart Policy
	6	Edit Authentication
	7	Distribute Config Files
	M 	Main Menu

 

(viii) When you click ok, then the dialog box will appear which asks the new database name and description. 
Please enter the desired database name and proceed.

 

(iX)  It asks for the password for the db. Give a blank password and click ok. 

 
(x)  It asks for the confirmation if blank password is given. 
Click yes and proceed.

(xi) Then the nex window appears asking for the hosts for the DB. 
Select appropriate box and click OK.

(xii) A new dialog will appears asking for the catalog path and the data path. 
Ensure these paths are correct and click OK.

(xiii) The tool will confirm if you are configuring only one host as below. Click ok and proceed.

(xiv) Then again the final window box will appear confirming for the creation of db. Click YES. 


The database will be created and started and the following message will appear.

	DATABASE gbo created successfully.
		OK 


################################################################################################


6) INSTALLATION STEPS FOR VERTICA ODBC DRIVER


(i) Download the ODBC driver from this link

	https://glassbeam.svn.cvsdude.com/gbplatform/trunk/vertica-installer/vertica_4.1.7/vertica_4.1.7_odbc_3.5_unixodbc_x86_64_linux.tar.gz
 
(ii) Upload the tar file to the root directory.
As root change the directory to /root

(iii) Copy the tar file of the odbc driver to the /opt/vertica/client directory using command below.
(create a directory by name "client" under /opt/vertica if not present).

	$ cp vertica_4.1.7_odbc_3.5_unixodbc_x86_64_linux.tar.gz /opt/vertica/client

(iv) Change the directory to /opt/vertica/client

	$ cd /opt/vertica/client

(v) Uncompress the file:

	$ tar -zxvf vertica_4.1.7_odbc_3.5_unixodbc_x86_64_linux.tar.gz

	The following folders are created:

	/opt/vertica/client/include  ##which contains the header file
	/opt/vertica/client/lib      ##which contains the library file

(vi) Now we need to create a DSN for linux.
Creating a DSN for a Linux or Solaris client machine entails configuring the following files and then testing the configuration:

	a.	/usr/local/etc/odbc.ini 
	b.	/usr/local/etc/odbcinst.ini

	ALTERNATIVE ODBC PART IN SOME SERVERS: 
	a.	/etc/odbc.ini
	b.	/etc/odbcinst.ini

	Command for debug either which Version of ODBC installed: 
		
		$odbcinst -j

(vii) Configure the odbc.ini file as following


	[Vertica]
	Description = VerticaDSN ODBC driver
	Driver = /opt/vertica/client/lib64/ 	vertica_4.1.7_odbc_3.5_unixodbc_x86_64_linux.so
	Debug = 1
	Database = qa0
	Servername = localhost
	UserName = dbadmin	
	Password =
	Port = 5433


(viii)	Configure odbcinst.ini file as following 
	
	[Vertica]
	Description = Vertica Data Base
	Driver =opt/vertica/client/lib/vertica_4.1.7_odbc_3.5_unixodbc_x86_64_linux.so


(ix) Following are the fields which we can configure 

	(a) Description - Additional information about the data source.

	(b) Driver - The location and designation of the Vertica ODBC driver. 		For example:
		/opt/vertica/lib/vertica_4.1.7_odbc_3.5_unixodbc_x86_64_linux.so
	
	(c) Debug - If set to 1, driver debug information is saved in
			 tmp/mylog_NNN.log, where
			 NNN is application process ID.

	(d) Database - The name of the database running on the server. 
		       This example uses "vmartdb" for the VMart_Schema.

	(e) ServerName - The name of the server where Vertica is installed. 
			Use localhost if Verticais installed on the same machine.

	(f) UserName - Either the database superuser (same name as database administrator account) or a user that the superuser has created and granted privileges. This example uses the user name "dbadmin".

	(g) Password - The password for the specified user name. 
			This example leaves the password field blank.

	(h) Port - The port number on which Vertica listens for ODBC connections. 
			For example,5433.

	(i) ConnSettings - Can contain SQL commands separated by a semicolon. These
commands are being executed immediately after connecting to the server.

	(j) SSLKeyFile - The file path and name of the client's private key. 
This file can reside anywhere on the system.

	(k) SSLCertFile - The file path and name of the client's public certificate. This file can reside anywhere on the system.


################################################################################################


7) CONFIGURATION SETTINGS

NOTE: ALL the configuration scripts must be run with gbprod user

7.1) CORE Configuration Changes
 
     (a) SAConfig.pm (SCHEMAS Parameter need to be changes manually )

      	 'PODSCHEMA'     => '_pod',
       	 'ALERTSCHEMA'   => '_alert',    (Remove this if NOT required for that Customer)

       	'SCHEMAS'       => [
                '_pod',
                '_alert',
       	 ],


7.2) UI Configuration Changes

(i) RUN : perl /glassbeam/ui/prod/bin/config.pl new 
		(after file has been updated accordingly)

	(a) Config.pl (Schema parameter need to be changes after installations )
		
		my $POD_SCHEMA = "pod";
		my $ALERT_SCHEMA = "alert";
	
	(b) config.pl (Generic Configurations Parameters)

		my $SEARCH_KEYWORD = {};
		my $DEFAULT_SEARCH = '';

(ii)	RUN : perl  /glassbeam/ui/prod/bin/gb_logging.pl (this creates user tables in DB)

(iii)	RUN : perl  /glassbeam/ui/prod/bin/configDB.pl new

(iv)	RUN : perl  /glassbeam/ui/prod/bin/key.pl

(v)	RUN : perl  /glassbeam/ui/prod/bin/create_admin.pl admin <password> <id>

	The syntax to run create_admin.pl is as below :

	$perl create_admin.pl <admin_user> <admin_password> <customer_id >

	"customer id" should be a number as given below
	1 for Bluearc
	2 for Hansen
	3 for Aruba
	4 for IBM
	5 for Riverbed

	Example :  perl create_admin.pl db_user PASSWD 3


(vi)	RUN : perl  /glassbeam/ui/prod/bin/create_cust.pl 
		(after file has been updated accordingly) 

	(a) Create_config.pl (DOMAIN, IP, DBNAME, Customer ID and Schema name need to be changes as part of the Configurations Parameters)

	$aMap->{'<domain1>.glassbeam.com'} = [ {'ip' => '<DB IP>', 'dev' => 'N', 'db' => '<DBNAME>', 'customer' => '<CUSTOMER ID>', 'schema' => '<SCHEMA NAME>'}  ];

	$aMap->{'<IP>'} =          [          {'ip' => '<DB IP>', 'dev' => 'N', 'db' => '<DBNAME>', 'customer' => '<CUSTOMER ID', 'schema' => '<SCHEMA NAME>'}            ];


(vii)	RUN : perl  /glassbeam/ui/prod/bin/<cust>_config_cloud.pl new <cust> 
	(<cust> = ,ba, ibm, hm,etc.)

(viii)  Restart Apache using following command:

	sudo /glassbeam/tools/apache/bin/apachectl -k start

################################################################################################


8) CREATING GLASSBEAM USER

You need to create a user (other than the admin user) to login to the Glassbeam portal through following step.


(i) Run the following URL:

	http://<ip_address or domain>/gb/ui/prod/signin.cgi?request=http://<ip_address or domian>/gb/ui/prod/user_info.cgi


	http://10.163.36.24/gb/ui/prod/signin.cgi?request=http://10.163.36.24/gb/ui/prod/user_info.cgi


(ii) New Registry in MySQL:

Create MySQL tables using the script

	build/install/bin/dbadd_1.3.4.mysql

Running the script:

	mysql -u <mysqlusername> -h <mysqlhostname> -p < dbadd_1.3.4.mysqlpassword: <type mysql password here>

U can see the current mysql username, hostname and password from /glassbeam/core/lib/SAConfig.pm



################################################################################################


9) INSTALLING TORQUE (REQUIRED FOR NEW SCHEDULERS)


(i) Go to folder install/torque-gb-3.0.1 inside the build.

(ii) As root user (u can do 'sudo su -' to go to root), execute the command:
	
	./torque.setup gbprod localhost.localdomain
	. /etc/profile
	pbs_sched

(iii) On reboot, need to run following commands as root

	pbs_server
	pbs_sched

NOTE:- torque.setup takes hostname as second parameter. This hostname has to be fully qualified hostname (eg: penguin7.orchesys.com). Currently only localhost works

	# need to run sudo or as root, need to configure hostname in /etc/hosts
	# need to setup hostname properly so that ping <hostname> works


################################################################################################


10) Reboot the server

11) PATCH INSTALLS

https://glassbeam.svn.cvsdude.com/gbplatform/branches/install/patches/<version>/ folder has all patches for the version. 
Pick up the patch folder with the latest date. 

Example:

https://glassbeam.svn.cvsdude.com/gbplatform/branches/install/patches/3.1.5/patch-02082011

Do svn export on the foloder

Example:
svn export --username <username> --password <password> https://glassbeam.svn.cvsdude.com/gbplatform/branches/install/patches/3.1.5/patch-02082011

See the README.txt in this file, by default you need to do the following:

Go to patch folder created. Do
	chmod -R 755 *
	run command
	sh install.sh

