<div ng-controller="ConfigCtrl as configCtrl">
    <div class="page-loader-white-gb gb-loader-instance-viewer" ng-show="!configCtrl.info.ready">
        <div class="page-loader-body">
            <div class="rect rect1"></div>
            <div class="rect rect2"></div>
            <div class="rect rect3"></div>
            <div class="rect rect4"></div>
            <div class="rect rect5"></div>
        </div>
    </div>
    <nav class="gb_view navbar-static-top" role="navigation">
        <div class="container-fluid contaner padding-0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse"
                        data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand padding-0" href="#"></a>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li style="display: none;">
                        <div class="btn-group gb-select">
                            <select title="End customer" class='form-control' ng-model="configCtrl.info.defaultEndCust"
                                    ng-options="ec.ec_name for ec in configCtrl.defaultFilters | orderBy:'ec_name'"
                                    ng-change="configCtrl.changeEndCust()"></select>
                        </div>
                    </li>
                    <li>
                        <div class="btn-group">
                            <button title="Select Sections" class="btn btn-xs dropdown-toggle gb-btn-nav-big"
                                    data-toggle="dropdown" type="button">
                                <span class="pull-left">Select Sections</span><span
                                    class="caret pull-right gb-section-select-btn"></span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-form gb-apps-sections-popup right-3"
                                 role="menu">
                                <div class="sections-popup-search-cntr" ng-click="$event.stopPropagation();">
                                    <input type="text" placeholder="Search sections"
                                           class="input-style3 gb-search-box margin-3" ng-model='configCtrl.search.label'>
                                </div>
                                <div class="sections-popup-body loading" ng-show="configCtrl.getSectionsLoading()"
                                     ng-click="$event.stopPropagation();">
                                     <div class="page-loader-body">
                                        <div class="rect rect1"></div>
                                        <div class="rect rect2"></div>
                                        <div class="rect rect3"></div>
                                        <div class="rect rect4"></div>
                                        <div class="rect rect5"></div>
                                    </div>
                                </div>
                                <div class="sections-popup-body" ng-hide="configCtrl.getSectionsLoading()"
                                     ng-click="$event.stopPropagation();">
                                    <div ng-if="(configCtrl.getSections() | filter:{'icon_type' : 'NVPAIR_BASIC'} | filter:configCtrl.search).length == 0">
                                        <span class="no-section-msg">No section found</span>
                                    </div>
                                    <div class="gb-sections-item"
                                         ng-repeat="section in configCtrl.getSections() | filter:{'icon_type' : 'NVPAIR_BASIC'} | filter:configCtrl.search track by $index"
                                         ng-class="{true:'gb-sections-item-selected', false:''}[section.default]">
                                        <label>
                                            <input type="checkbox" ng-model="section.default"
                                                   ng-checked="section.default"/>
                                            <span title="{{section.label}}">{{section.label | cut:true:32:'...'}}</span>
                                        </label>
                                    </div>
                                    <div class="divider"
                                         ng-if="(configCtrl.getSections() | filter:{'icon_type' : 'NVPAIR_BASIC'} | filter:configCtrl.search).length > 0"></div>
                                    <div class="gb-sections-item"
                                         ng-repeat="section in configCtrl.getSections() | filter:{'icon_type' : '!NVPAIR_BASIC'} | filter:configCtrl.search track by $index"
                                         ng-class="{true:'gb-sections-item-selected', false:''}[section.default]">
                                        <label class="gb-link-normal" ng-click="showSectionDiff(section)">
                                            <span title="{{section.label}}">{{section.label | cut:true:32:'...'}}</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="sections-popup-footer">
                                    <button class="gb-primary-btn btn-xs" ng-click="configCtrl.done()">
                                        Done
                                    </button>
                                    <button class="gb-secondary-btn btn-xs" ng-click="configCtrl.cancel()">
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </li>                    
                    <li ng-if="configCtrl.showSysid2DD()">
                        <div class="btn-group gb-select">
                            <button class="btn btn-xs dropdown-toggle gb-btn-nav-big"
                                    title="{{configCtrl.getSysId2Tooltip()}}"
                                    type="button" data-toggle="dropdown">
                                <span class="pull-left gb-btn-nav-big-title padding-top-btm-3 text-align-left"
                                      ng-if="configCtrl.getSysId2()">{{configCtrl.getSysId2()}}</span>
                                <span class="pull-left gb-btn-nav-big-title padding-top-btm-3 text-align-left"
                                      ng-if="!configCtrl.getSysId2()">&nbsp; Select</span><span
                                    class="caret pull-right"></span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-right right-minus-365 width-553" role="menu">
                                <div class="right-inner-addon" ng-click="$event.stopPropagation();">
                                    <i class="icon-search"></i>
                                    <input type="text"
                                           ng-model="configCtrl.subSysfilter"
                                           class="form-control gb-explorer-filter-search-box font-size-10 gb-apps-sysid-searchbox"
                                           placeholder="Search {{configCtrl.getSysId2Tooltip()}}"/>
                                </div>
                                <ul class="view-list-dropdown-menu overflow-200-auto border-0">
                                    <li ng-repeat="sid in configCtrl.getSysId2List() | filter: configCtrl.subSysfilter | limitTo: configCtrl.info.sysIdLimit track by $index"
                                        class="gb-apps-sys-id border-bottom-f8f8f8"
                                        ng-class="{'gb-apps-sys-id-selected': !!sid.selected}"
                                        ng-click="configCtrl.changeSubSysId(sid);" title="{{sid}}">
                                        {{sid | cut:true:40:'...'}}
                                    </li>
                                </ul>
                                <ul class="view-list-dropdown-menu border-0"
                                    ng-show="!(configCtrl.info.sid2 | filter: configCtrl.subSysfilter| limitTo: configCtrl.info.sysIdLimit).length">
                                    <li class="gb-apps-no-record border-0">
                                        No record found
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    <!-- <li ng-show="(configCtrl.getSections()).length > 0">
                        <span class="icon-newtab gb-icon gb-newtab-section-icon" ng-click="showSectionDiff((configCtrl.getSections())[0])" title="Open section viewer"></span>
                    </li> -->
                    <li>
                        <span title="{{!!configCtrl.hasGoldenConfigSection() ? 'Clear Golden Configuration' : 'Golden configuration'}}" class="icon-settings2 gb-icon"
                              ng-class="{'gconf-pressed': configCtrl.hasGoldenConfigSection()}"
                              ng-mouseover="configCtrl.info.goldenConfig=true"
                              ng-if="configCtrl.info.userrole == configCtrl.getValue('manufacturer') + '_admin' || configCtrl.info.usertype == configCtrl.getValue('gbUserOrgType') || (configCtrl.info.loaded && configCtrl.info.goldenconfig.disabled)"
                              ng-mouseleave="configCtrl.info.goldenConfig=false"
                              ng-click="configCtrl.toggleGoldenConfigData()"></span>
                        <!-- <ul role="menu" class="gb-dropdown-goldenConfig"
                            sly-show="(configCtrl.info.userrole == configCtrl.getValue('manufacturer') + '_admin' || configCtrl.info.usertype == configCtrl.getValue('gbUserOrgType')) && configCtrl.info.goldenConfig"
                            ng-mouseover="configCtrl.info.goldenConfig=true"
                            ng-mouseleave="configCtrl.info.goldenConfig=false"
                            ng-click="configCtrl.showGoldenConfig()">
                            <li>
                                <span>Golden configuration</span>
                            </li>
                        </ul> -->
                        <!-- <span title="Clear golden configuration" class="icon-cancel-circle margin-left-minus-7 gb-icon"
                              ng-if="configCtrl.hasGoldenConfigSection()"
                              ng-click="configCtrl.clearGoldenConfigData()"></span> -->
                    </li>
                </ul>

                <ul class="nav navbar-nav navbar-right gb-nav-item">
                    <li>
                        <span class="icon-file-pdf gb-icon gb-newtab-section-icon" ng-click="configCtrl.exportAllPDF()" title="Export as PDF"></span>
                    </li>
                    <li class="margin-right-12">
                        <span class="icon-disk gb-icon gb-search-icon" ng-click="configCtrl.showSaveViewModal()" title="Save view"></span>
                    </li>
                    <li>
                        <div class="btn-group" id="configdiff-select-view-div">

                            <button title="{{configCtrl.getCurrentViewName()}}"
                                    class="dropdown-toggle btn btn-xs gb-btn-nav-big" data-toggle="dropdown"
                                    ng-click="configCtrl.getSavedViews()">
                                <span class="pull-left">{{configCtrl.getCurrentViewName() | cut:true:17:'...'}}</span><span
                                    class="caret pull-right gb-section-select-btn"></span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-form dropdown-menu-right gb-explorer-saved-filter-dropdown right-3"
                                 role="menu" ng-click="$event.stopPropagation();">
                                <div class="panel panel-default gb-explorer-panel">
                                    <div class="panel-heading gb-explorer-saved-filter-heading-container">
                                        <span class="panel-title gb-explorer-saved-filter-heading">Saved Config diff Views</span>
                                    </div>
                                    <div class="panel-body">

                                        <div class="row-fluid col-sm-12 gb-explorer-filter-type-div">
                                            <div class="pull-left">
                                                <button ng-click="configCtrl.info.filterBtn = 'all'"
                                                        ng-class="{'active' : configCtrl.info.filterBtn == 'all'}"
                                                        class="btn btn-classic gb-explorer-filter-selection-button gb-apps-filter-selection-button">
                                                    All Views
                                                </button>
                                                <button ng-click="configCtrl.info.filterBtn = 'my'"
                                                        ng-class="{'active' : configCtrl.info.filterBtn == 'my'}"
                                                        class="btn btn-classic gb-explorer-filter-selection-button gb-apps-filter-selection-button">
                                                    My Views
                                                </button>
                                                <button ng-click="configCtrl.info.filterBtn = 'others'"
                                                        ng-class="{'active' : configCtrl.info.filterBtn == 'others'}"
                                                        class="btn btn-classic gb-explorer-filter-selection-button gb-apps-filter-selection-button">
                                                    Other's Views
                                                </button>
                                            </div>
                                            <div class="right-inner-addon pull-right">
                                                <i class="icon-search"></i>
                                                <input type="text" placeholder="Search"
                                                       ng-model="configCtrl.inlineSearch.view_name"
                                                       class="form-control gb-explorer-filter-search-box"/>
                                            </div>
                                        </div>

                                        <div ng-show="configCtrl.v_loading" class="col-sm-12 loading">
                                            <div class="page-loader-body">
                                                <div class="rect rect1"></div>
                                                <div class="rect rect2"></div>
                                                <div class="rect rect3"></div>
                                                <div class="rect rect4"></div>
                                                <div class="rect rect5"></div>
                                            </div>
                                        </div>
                                        <br>
                                        <div ng-show="!configCtrl.f_views.length && !configCtrl.v_loading && configCtrl.info.filterBtn == 'all' && ( configCtrl.views | filter : configCtrl.filterByScope |filter: configCtrl.inlineSearch).length  == 0"
                                             class="col-sm-12 gb-info gb-explorer-info">
                                            <span>No record found.</span>
                                        </div>

                                        <div ng-show="!configCtrl.f_views.length && configCtrl.info.filterBtn == 'my' && ( configCtrl.views | filter : configCtrl.filterByScope |filter: configCtrl.inlineSearch).length  == 0"
                                             class="col-sm-12 gb-info gb-explorer-info">
                                            <span>No record found.</span>
                                        </div>

                                        <div ng-show="!configCtrl.f_views.length && configCtrl.info.filterBtn == 'others' && ( configCtrl.views | filter : configCtrl.filterByScope |filter: configCtrl.inlineSearch).length  == 0"
                                             class="col-sm-12 gb-info gb-explorer-info">
                                            <span>No record found.</span>
                                        </div>

                                        <div class="col-sm-12 gb-panel-contents">
                                            <table class="table table-hover table-condensed">
                                                <tbody>
                                                <tr ng-repeat="view in configCtrl.views | filter : configCtrl.filterByScope | filter: configCtrl.inlineSearch | orderBy:'view_name' track by $index">
                                                    <td width="20px" class="gb-panel-content-serial"><b>{{$index +
                                                        1}}</b></td>

                                                    <td ng-click="configCtrl.loadView(view)" class="gb-link-normal"><b
                                                            class="pull-left">{{view.view_name}}</b>
                                                        <br>

                                                        <div class="gb-word-wrap">
                                                            {{((view.desc|uppercase)=="NA" || (view.desc == "undefined"))?"No description provided for this View.":view.desc | gbunescape}}
                                                            <br><span class="gb-created-by">Created by:  {{view.created_by}}</span>
                                                        </div>
                                                    </td>

                                                    <td width="35px" class="gb-panel-content-actions"
                                                        ng-class="{'gb-explorer-set-as-default-selected': view.default}">
                                                        <a href="#" ng-show="view.created_by == configCtrl.getLoggedInUserName()"
                                                           title="Set as default view" class="gb-filter-options-icon"
                                                           ng-click="configCtrl.setDefaultView(view, $event)"><span
                                                                class="icon-reply-all"></span></a></td>


                                                    <td width="40px" class="gb-panel-content-actions"><a href="#"
                                                                                                         title="Delete view"
                                                                                                         class="gb-filter-options-icon"
                                                                                                         ng-show="view.created_by == configCtrl.getLoggedInUserName()"
                                                                                                         ng-click="configCtrl.showDeleteView(view, $event)"><span
                                                            class="icon-remove2"></span></a></td>


                                                    <td width="35px" class="gb-panel-content-actions"><a href="#"
                                                                                                         class="gb-filter-options-icon"
                                                                                                         ng-init="configCtrl.accessType=view.public?'Public':'Private'"
                                                                                                         ng-attr-title="Saved section view is {{configCtrl.accessType}}. Click to make {{configCtrl.accessType == 'Public'?'Private':'Public'}}"
                                                                                                         ng-show="view.created_by == configCtrl.getLoggedInUserName()"
                                                                                                         ng-click="configCtrl.setAccessibility(view, $event)"><span
                                                            ng-class="{'icon-lock2': !view.public, 'icon-unlocked': view.public}"></span></a>
                                                    </td>
                                                </tr>

                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <a ng-href="{{configCtrl.getKbLink()}}" ng-show="configCtrl.getKbLink()" target="_blank"
                           class="pull-right gb-toolbar-icon-link" title="{{configCtrl.getKbLink()}}"><span
                                class="icon-info gb-icon"></span></a>
                    </li>
                    <li>
                        <span class="icon-loop2 gb-icon gb-search-icon" ng-show="configCtrl.getSelectedSections().length"
                              ng-click="configCtrl.resetSections()" title="Clear selection of sections"></span>

                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid iviewer-apps-iframe-full">
        <div ng-hide="configCtrl.getSectionsLoading()">
            <div class="gb-msg-center" ng-hide="(configCtrl.getSections() | filter : configCtrl.select).length>0" align="center" class="msg_style1">
                <span class="msg">{{configCtrl.getValue('select_section')}}</span>
            </div>
        </div>
        <div class="page-loader-white-gb gb-loader-instance-viewer" ng-show="configCtrl.getSectionsLoading()">
             <div class="page-loader-body">
                <div class="rect rect1"></div>
                <div class="rect rect2"></div>
                <div class="rect rect3"></div>
                <div class="rect rect4"></div>
                <div class="rect rect5"></div>
            </div>
        </div>
        <div ng-repeat="section in configCtrl.f_sections = (configCtrl.getSections() | filter : configCtrl.select) track by $index">
            <div>
                &nbsp;
            </div>

            <div class="row gb-sub-header">
                <label class="gb-link-normal gb-label-color-2 pull-left" ng-click="section.visible=!section.visible"
                       title="Click to toggle the section">{{section.label}}</label>

                <div class="btn-group  pull-right gb-section-setting-dd">
                    <span class="glyphicon glyphicon-align-justify gb-icon-header" data-toggle="dropdown"
                          title="Manage section"></span>

                    <ul class="dropdown-menu gb-dropdown-settings" role="menu">
                        <li class="dropdown-submenu-left" ng-if="section.data && !section.loading">
                            <a>Show/Hide columns</a>

                            <ul class="dropdown-menu gb-dropdown-settings" role="menu"
                                ng-click="$event.stopPropagation();">
                                <li>
                                    <label>
                                        <input type="checkbox" ng-change="configCtrl.toggleAll(section)"
                                               ng-model="section.shownAll">
                                        Show All </label>
                                </li>
                                <li>
                                    <ul class="gb-filter-checkbox-group">
                                        <li ng-repeat="key in section.keys track by $index">
                                            <label>
                                                <input type="checkbox" ng-model="key.visible"
                                                       ng-change="configCtrl.changeShownAll(section)">
                                                <span>{{key.col_name.length>18?key.col_name.substring(0, 15)+"...": key.col_name}}</span>
                                            </label>
                                        </li>
                                    </ul>
                                </li>
                            </ul>

                        </li>
                        <li class="dropdown-submenu-left disabled" ng-if="!!!section.data && !section.loading">
                            <a>Show/Hide columns</a>
                        </li>
                        <li ng-click="$event.stopPropagation();">
                            <table class="gb-change-pagesize-cnt">
                                <tr>
                                    <td>Show</td>
                                    <td>
                                        <button type="button" class="btn gb-menu-btn-sm"
                                                ng-disabled="section.count <= configCtrl.info.nfo.min_obs_limit || !!!section.data"
                                                ng-click="configCtrl.decObsCount(section)">
                                            -
                                        </button>
                                    </td>
                                    <td><span
                                            class="form-control gb-dd-input"> {{!!section.data ? section.count : ''}} </span>
                                    </td>
                                    <td>
                                        <button type="button" class="btn gb-menu-btn-sm"
                                                ng-disabled="section.count >= configCtrl.info.max_obs_limit || !!!section.data"
                                                ng-click="configCtrl.incObsCount(section)">
                                            +
                                        </button>
                                    </td>
                                </tr>
                            </table>

                        </li>
                        <li ng-if="!!!section.data && !section.loading" class="disabled">
                            <a href="#">
                                <table style="width: 100%">
                                    <tr>
                                        <td>Export</td>
                                        <td style="text-align: right"><span
                                                class="glyphicon glyphicon-file pull-right gb-icon-big"></span></td>
                                    </tr>
                                </table>
                            </a>
                        </li>
                        <li ng-if="section.data && !section.loading">
                            <a href="#" export-xls export-type="configdiff" export-info="configCtrl.info"
                               export-section="section">
                                <table style="width: 100%">
                                    <tr>
                                        <td>Export</td>
                                        <td style="text-align: right"><span
                                                class="glyphicon glyphicon-file pull-right gb-icon-big"></span></td>
                                    </tr>
                                </table>
                            </a>
                        </li>
                        <li>
                            <a href="#" ng-click="configCtrl.removeSection(section)">Remove Section</a>
                        </li>
                    </ul>
                </div>
                <span class="glyphicon glyphicon-refresh pull-right gb-icon-header" data-toggle="dropdown"
                      ng-show="configCtrl.hasFilter(section)" ng-click="configCtrl.resetFilter(section)" title="Clear filter(s)"></span>
            </div>
            <div ng-show="!!section.data && section.no_cols">
                {{configCtrl.getValue('no_cols')}}
            </div>
            <div ng-show="section.loading" class="section-loader">
                <div class="rect rect1"></div>
                <div class="rect rect2"></div>
                <div class="rect rect3"></div>
                <div class="rect rect4"></div>
                <div class="rect rect5"></div>
            </div>
            <div ng-show="!!!section.data && !section.loading">
                {{configCtrl.getValue('no_diff_data')}}
            </div>
            <div ng-class="{'flip-scroll': section.isTranspose}"
                 id="sectionGrid-{{$index}}"
                 ng-show="section.visible && !section.no_cols && section.data"
                 class="gb-grid-container">
                <table class="table table-condensed gb-table gb-apps-table">
                    <thead class="gb-table-th">
                    <tr>
                        <th>Observations({{section.data.length}})</th>
                        <th ng-repeat="ts in section.data track by $index"> {{ts.obs}}</th>
                    </tr>
                    </thead>
                    <tr ng-repeat="row in section.keys track by $index" ng-show="row.visible">
                        <td class="gb-obs-cell" ng-class="{'gb-cell-left-border' : row.changed}">{{row['col_name']}}
                        </td>
                        <td ng-repeat="x in section.data track by $index" class="gb-word-wrap"
                            ng-class-odd="{'gb-obs-diff-cell-odd' : x.data[row.key] != section.ref_data[row.key]}"
                            ng-class-even="{'gb-obs-diff-cell-even' : x.data[row.key] != section.ref_data[row.key]}" create-rules load-ctrl="appCtrl" on-select="configCtrl.generateRuleLogic(section, row)">
                            {{x.data[row.key]}}
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>